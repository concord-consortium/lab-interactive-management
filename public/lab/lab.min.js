(function(){var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("../../vendor/almond/almond",function(){}),define("lab.version",["require"],function(e){return{repo:{branch:"master",commit:{sha:"8973b6b862ec8ca45238af1dce8b781036c02a43",short_sha:"8973b6b8",url:"https://github.com/concord-consortium/lab/commit/8973b6b8",author:"Stephen Bannasch",email:"stephen.bannasch@gmail.com",date:"2013-07-10 03:36:02 +0000",short_message:"simplify setup:server cap task",message:"simplify setup:server cap task"},dirty:!1}}}),define("common/actual-root",[],function(){var e=/^(\/.+?\/)(interactives|embeddable)\.html$/,t=/(\/.+?\/)(doc|examples|experiments)(\/\w+)*?\/\w+\.html/,n;return n=document.location.pathname.match(e),n&&n[1]?n[1]:(n=document.location.pathname.match(t),n&&n[1]||"/")}),define("lab.config",["require","common/actual-root"],function(e){var t=e("common/actual-root"),n;return n={sharing:!0,logging:!0,tracing:!1,home:"http://lab.concord.org",homeForSharing:null,homeInteractivePath:"/interactives.html",homeEmbeddablePath:"/embeddable.html",actualRoot:"",utmCampaign:null,fontface:"Lato",hostName:"lab.dev.concord.org",dataGamesProxyPrefix:"DataGames/Games/concord/lab.dev/",authoring:!1,environment:"development"},n.actualRoot=t,n}),define("common/structured-clone",["require"],function(e){function r(){var e=0;if(!!window.postMessage)try{window.onmessage=function(n){var r=Object.prototype.toString.call(n.data);e=r.indexOf("Null")!=-1||r.indexOf("DOMWindow")!=-1?1:0,t={structuredClones:e}},window.postMessage(document.createElement("a"),"*")}catch(n){e=n.DATA_CLONE_ERR||n.message=="Cannot post cyclic structures."?1:0,t={structuredClones:e}}}function i(){return t&&t.structuredClones>0}var t=!1,n={};return r(),n.supported=i,n}),define("arrays/index",["require","exports","module"],function(e,t,n){var r={};r.version="0.0.1",r.webgl=typeof window!="undefined"&&!!window.WebGLRenderingContext,r.typed=function(){try{return new Float64Array(0),!0}catch(e){return!1}}(),r.create=function(e,t,n){n||(r.webgl||r.typed?n="Float32Array":n="regular"),t===undefined&&(t=0);var i,s;if(n==="regular")i=new Array(e);else switch(n){case"Float64Array":i=new Float64Array(e);break;case"Float32Array":i=new Float32Array(e);break;case"Int32Array":i=new Int32Array(e);break;case"Int16Array":i=new Int16Array(e);break;case"Int8Array":i=new Int8Array(e);break;case"Uint32Array":i=new Uint32Array(e);break;case"Uint16Array":i=new Uint16Array(e);break;case"Uint8Array":i=new Uint8Array(e);break;case"Uint8ClampedArray":i=new Uint8ClampedArray(e);break;default:throw new Error("arrays: couldn't understand array type \""+n+'".')}return r.fill(i,t),i},r.fill=function(e,t){var n=-1,r=e.length;while(++n<r)e[n]=t},r.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__&&e.buffer.__proto__.constructor&&Object.prototype.toString.call(e)==="[object Array]")return e.__proto__.constructor;switch(e.constructor){case Array:return Array;case Float32Array:return Float32Array;case Uint8Array:return Uint8Array;case Float64Array:return Float64Array;case Int32Array:return Int32Array;case Int16Array:return Int16Array;case Int8Array:return Int8Array;case Uint32Array:return Uint32Array;case Uint16Array:return Uint16Array;case Uint8ClampedArray:return Uint8ClampedArray;default:throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e)}},r.copy=function(e,t){var n=e.length,i=-1;while(++i<n)t[i]=e[i];return r.constructor_function(t)===Array&&(t.length=n),t},r.clone=function(e){var t,n=e.length,i,s;s=r.constructor_function(e);if(s===Array){i=new s(n);for(t=0;t<n;t++)i[t]=e[t];return i}if(e.buffer.slice)return i=new s(e.buffer.slice(0)),i;i=new s(n);for(t=0;t<n;t++)i[t]=e[t];return i},r.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},r.max=function(e){return Math.max.apply(Math,e)},r.min=function(e){return Math.min.apply(Math,e)},r.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r},r.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r},r.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n>i?n:i;return i}}},r.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n<i?n:i;return i}}},r.average=function(e){var t,n=0,r=e.length;for(t=0;t<r;t++)n+=e[t];return n/r},r.extend=function(e,t){var n,i,s;i=r.constructor_function(e);if(i===Array){s=e.length,e.length=t;for(;s<t;s++)e[s]=0;return e}return n=new i(t),n.set(e.subarray(0,t)),n},r.remove=function(e,t){var n=r.constructor_function(e),i;if(n!==Array)throw new Error("arrays.remove for typed arrays not implemented yet.");return i=e.slice(t+1),e.length=t,Array.prototype.push.apply(e,i),e},r.isArray=function(e){if(e===undefined||e===null)return!1;switch(Object.prototype.toString.call(e)){case"[object Array]":case"[object Float32Array]":case"[object Float64Array]":case"[object Uint8Array]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object Uint8ClampedArray]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":return!0;default:return!1}};for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}),define("arrays",["arrays/index"],function(e){return e}),define("common/console",["require","lab.config"],function(e){var t=e("lab.config"),n,r,i=function(){};return typeof console=="undefined"&&(console={},window&&(window.console=console)),r=console,r.log===undefined&&(r.log=i),r.info===undefined&&(r.info=i),r.warn===undefined&&(r.warn=i),r.error===undefined&&(r.error=i),r.time===undefined&&(r.time=i),r.timeEnd===undefined&&(r.timeEnd=i),r.log.apply===undefined&&(r.log=Function.prototype.bind.call(console.log,console)),r.info.apply===undefined&&(r.info=Function.prototype.bind.call(console.info,console)),r.warn.apply===undefined&&(r.warn=Function.prototype.bind.call(console.warn,console)),r.error.apply===undefined&&(r.error=Function.prototype.bind.call(console.error,console)),r.time.apply===undefined&&(r.time=Function.prototype.bind.call(console.time,console)),r.timeEnd.apply===undefined&&(r.timeEnd=Function.prototype.bind.call(console.timeEnd,console)),n={log:function(){t.logging&&r.log.apply(r,arguments)},info:function(){t.logging&&r.info.apply(r,arguments)},warn:function(){t.logging&&r.warn.apply(r,arguments)},error:function(){t.logging&&r.error.apply(r,arguments)},time:function(){t.tracing&&r.time.apply(r,arguments)},timeEnd:function(){t.tracing&&r.timeEnd.apply(r,arguments)}},n}),define("common/alert",["require","common/console"],function(e){var t=e("common/console"),n=typeof alert!="undefined"?alert:t.error;return function(t){n(t)}}),define("common/controllers/interactive-metadata",[],function(){return{interactive:{title:{required:!0},publicationStatus:{defaultValue:"public"},subtitle:{defaultValue:""},about:{defaultValue:""},importedFrom:{},fontScale:{defaultValue:1},models:{required:!0},parameters:{defaultValue:[]},outputs:{defaultValue:[]},filteredOutputs:{defaultValue:[]},exports:{required:!1},components:{defaultValue:[]},layout:{defaultValue:{}},template:{defaultValue:"simple"}},model:{type:{required:!0},id:{required:!0},url:{conflictsWith:["model"]},importedFrom:{},model:{conflictsWith:["url"]},onLoad:{},viewOptions:{},modelOptions:{},parameters:{},outputs:{},filteredOutputs:{}},parameter:{name:{required:!0},initialValue:{required:!0},onChange:{},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},output:{name:{required:!0},value:{required:!0},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},filteredOutput:{name:{required:!0},property:{required:!0},type:{defaultValue:"RunningAverage"},period:{defaultValue:2500},label:{},unitType:{},unitName:{},unitPluralName:{},unitAbbreviation:{}},exports:{perRun:{required:!1,defaultValue:[]},perTick:{required:!0}},playback:{id:{required:!0},type:{required:!0},stepping:{defaultValue:!0}},text:{id:{required:!0},type:{required:!0},onClick:{},text:{defaultValue:""},width:{defaultValue:"auto"},height:{defaultValue:"auto"}},image:{id:{required:!0},type:{required:!0},src:{defaultValue:""},width:{defaultValue:"auto"},height:{defaultValue:"auto"},onClick:{}},div:{id:{required:!0},type:{required:!0},width:{defaultValue:"auto"},height:{defaultValue:"auto"},onClick:{},classes:{defaultValue:[]},tooltip:{}},button:{id:{required:!0},type:{required:!0},action:{required:!0},text:{defaultValue:""},width:{defaultValue:""},height:{defaultValue:""}},checkbox:{id:{required:!0},type:{required:!0},text:{defaultValue:""},textOn:{defaultValue:"right"},width:{defaultValue:"auto"},height:{defaultValue:"auto"},property:{conflictsWith:["initialValue"]},onClick:{},initialValue:{conflictsWith:["property"]}},slider:{id:{required:!0},type:{required:!0},min:{required:!0},max:{required:!0},steps:{required:!0},title:{defaultValue:""},labels:{defaultValue:[]},width:{defaultValue:"auto"},height:{defaultValue:"auto"},displayValue:{},property:{conflictsWith:["initialValue","action"]},action:{conflictsWith:["property"]},initialValue:{conflictsWith:["property"]}},pulldown:{id:{required:!0},type:{required:!0},label:{defaultValue:""},labelOn:{defaultValue:"top"},options:{defaultValue:[]},property:{}},pulldownOption:{text:{defaultValue:""},action:{conflictsWith:["value"]},value:{conflictsWith:["action"]},selected:{conflictsWith:["value"]},disabled:{},loadModel:{}},radio:{id:{required:!0},type:{required:!0},orientation:{defaultValue:"vertical"},label:{defaultValue:""},labelOn:{defaultValue:"top"},options:{defaultValue:[]},property:{}},radioOption:{text:{defaultValue:""},action:{conflictsWith:["value"]},value:{conflictsWith:["action"]},selected:{conflictsWith:["value"]},disabled:{},loadModel:{}},numericOutput:{id:{required:!0},type:{required:!0},label:{defaultValue:""},units:{defaultValue:""},orientation:{defaultValue:"horizontal"},width:{defaultValue:"auto"},height:{defaultValue:"auto"},property:{},displayValue:{}},thermometer:{id:{required:!0},type:{required:!0},min:{required:!0},max:{required:!0},width:{defaultValue:"2.5em"},height:{defaultValue:"100%"},labelIsReading:{defaultValue:!1},reading:{defaultValue:{units:"K",offset:0,scale:1,digits:0}},labels:{defaultValue:[]}},graph:{id:{required:!0},type:{required:!0},dataPoints:{defaultValue:[]},fontScaleRelativeToParent:{defaultValue:!0},properties:{defaultValue:[]},title:{defaultValue:"Graph"},width:{defaultValue:"100%"},height:{defaultValue:"100%"},xlabel:{defaultValue:"Model Time (ps)"},xmin:{defaultValue:0},xmax:{defaultValue:20},ylabel:{defaultValue:""},ymin:{defaultValue:0},ymax:{defaultValue:10},xTickCount:{defaultValue:10},yTickCount:{defaultValue:10},xscaleExponent:{defaultValue:.5},yscaleExponent:{defaultValue:.5},xFormatter:{defaultValue:"3.2r"},yFormatter:{defaultValue:"3.2r"},lines:{defaultValue:!0},bars:{defaultValue:!1}},barGraph:{id:{required:!0},type:{required:!0},property:{required:!0},secondProperty:{conflictsWith:["averagePeriod"]},min:{defaultValue:0},max:{defaultValue:10},title:{defaultValue:""},titleOn:{defaultValue:"right"},labels:{defaultValue:5},units:{defaultValue:!1},gridLines:{defaultValue:10},labelFormat:{defaultValue:"0.1f"},averagePeriod:{conflictsWith:["secondProperty"]},barWidth:{defaultValue:"2em"},height:{defaultValue:"100%"},barColor:{defaultValue:"#e23c34"},fillColor:{defaultValue:"#fff"}}}}),define("common/validator",["require","arrays"],function(e){function n(e,t){this.prop=e,this.message=t}function r(e,t,r){var i,s;for(i=0,s=r.length;i<s;i++)if(e.hasOwnProperty(r[i]))throw new n(t,"Properties set contains conflicting properties: "+r[i]+" and "+t)}function i(e,t,r,i){if(e.readOnly)throw new n(t,"Properties set tries to overwrite read-only property "+t);if(!i&&e.immutable)throw new n(t,"Properties set tries to overwrite immutable property "+t);return e.validate?e.validate(r):r}var t=e("arrays");return n.prototype=new Error,n.prototype.constructor=n,{validate:function(e,t,n){var s={},o,u;if(arguments.length<2)throw new Error("Incorrect usage. Provide metadata and hash which should be validated.");for(o in t)t.hasOwnProperty(o)&&(u=e[o],u!==undefined&&(t[o]=i(u,o,t[o],n),u.conflictsWith&&r(t,o,u.conflictsWith),s[o]=t[o]));return s},validateSingleProperty:i,propertyIsWritable:function(e){return!e.readOnly},propertyChangeInvalidates:function(e){return e.propertyChangeInvalidates===undefined?!0:!!e.propertyChangeInvalidates},validateCompleteness:function(e,r){var i={},s,o;if(arguments.length<2)throw new Error("Incorrect usage. Provide metadata and hash which should be validated.");for(s in e)if(e.hasOwnProperty(s)){o=e[s];if(r[s]===undefined||r[s]===null){if(o.required===!0)throw new n(s,"Properties set is missing required property "+s);t.isArray(o.defaultValue)?i[s]=t.copy(o.defaultValue,[]):typeof o.defaultValue=="object"?i[s]=$.extend(!0,{},o.defaultValue):o.defaultValue!==undefined&&(i[s]=o.defaultValue)}else!t.isArray(r[s])&&typeof r[s]=="object"&&typeof o.defaultValue=="object"?i[s]=$.extend(!0,{},o.defaultValue,r[s]):t.isArray(r[s])?i[s]=$.extend(!0,[],r[s]):i[s]=r[s]}return this.validate(e,i,!0)},ValidationError:n}}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=r.unshift,l=i.toString,c=i.hasOwnProperty,h=r.forEach,p=r.map,d=r.reduce,v=r.reduceRight,m=r.filter,g=r.every,y=r.some,b=r.indexOf,w=r.lastIndexOf,E=Array.isArray,S=Object.keys,x=s.bind,T=function(e){if(e instanceof T)return e;if(!(this instanceof T))return new T(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=T),exports._=T):e._=T,T.VERSION="1.4.2";var N=T.each=T.forEach=function(e,t,r){if(e==null)return;if(h&&e.forEach===h)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(T.has(e,o)&&t.call(r,e[o],o,e)===n)return};T.map=T.collect=function(e,t,n){var r=[];return e==null?r:p&&e.map===p?e.map(t,n):(N(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)},T.reduce=T.foldl=T.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduce===d)return r&&(t=T.bind(t,r)),i?e.reduce(t,n):e.reduce(t);N(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.reduceRight=T.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(v&&e.reduceRight===v)return r&&(t=T.bind(t,r)),arguments.length>2?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=T.keys(e);s=o.length}N(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.find=T.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},T.filter=T.select=function(e,t,n){var r=[];return e==null?r:m&&e.filter===m?e.filter(t,n):(N(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},T.reject=function(e,t,n){return T.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},T.every=T.all=function(e,t,r){t||(t=T.identity);var i=!0;return e==null?i:g&&e.every===g?e.every(t,r):(N(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=T.some=T.any=function(e,t,r){t||(t=T.identity);var i=!1;return e==null?i:y&&e.some===y?e.some(t,r):(N(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};T.contains=T.include=function(e,t){return e==null?!1:b&&e.indexOf===b?e.indexOf(t)!=-1:C(e,function(e){return e===t})},T.invoke=function(e,t){var n=u.call(arguments,2);return T.map(e,function(e){return(T.isFunction(t)?t:e[t]).apply(e,n)})},T.pluck=function(e,t){return T.map(e,function(e){return e[t]})},T.where=function(e,t){return T.isEmpty(t)?[]:T.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},T.max=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&T.isEmpty(e))return-Infinity;var r={computed:-Infinity};return N(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},T.min=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&T.isEmpty(e))return Infinity;var r={computed:Infinity};return N(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},T.shuffle=function(e){var t,n=0,r=[];return N(e,function(e){t=T.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return T.isFunction(e)?e:function(t){return t[e]}};T.sortBy=function(e,t,n){var r=k(t);return T.pluck(T.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t);return N(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};T.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(T.has(e,t)?e[t]:e[t]=[]).push(n)})},T.countBy=function(e,t,n){return L(e,t,n,function(e,t,n){T.has(e,t)||(e[t]=0),e[t]++})},T.sortedIndex=function(e,t,n,r){n=n==null?T.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},T.toArray=function(e){return e?e.length===+e.length?u.call(e):T.values(e):[]},T.size=function(e){return e==null?0:e.length===+e.length?e.length:T.keys(e).length},T.first=T.head=T.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},T.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},T.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},T.rest=T.tail=T.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},T.compact=function(e){return T.filter(e,function(e){return!!e})};var A=function(e,t,n){return N(e,function(e){T.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};T.flatten=function(e,t){return A(e,t,[])},T.without=function(e){return T.difference(e,u.call(arguments,1))},T.uniq=T.unique=function(e,t,n,r){T.isFunction(t)&&(r=n,n=t,t=!1);var i=n?T.map(e,n,r):e,s=[],o=[];return N(i,function(n,r){if(t?!r||o[o.length-1]!==n:!T.contains(o,n))o.push(n),s.push(e[r])}),s},T.union=function(){return T.uniq(a.apply(r,arguments))},T.intersection=function(e){var t=u.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.indexOf(t,e)>=0})})},T.difference=function(e){var t=a.apply(r,u.call(arguments,1));return T.filter(e,function(e){return!T.contains(t,e)})},T.zip=function(){var e=u.call(arguments),t=T.max(T.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=T.pluck(e,""+r);return n},T.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},T.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=T.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(b&&e.indexOf===b)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},T.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(w&&e.lastIndexOf===w)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},T.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};T.bind=function(t,n){var r,i;if(t.bind===x&&x)return x.apply(t,u.call(arguments,1));if(!T.isFunction(t))throw new TypeError;return i=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=t.prototype;var e=new O,s=t.apply(e,i.concat(u.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(u.call(arguments)))}},T.bindAll=function(e){var t=u.call(arguments,1);return t.length==0&&(t=T.functions(e)),N(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,t){var n={};return t||(t=T.identity),function(){var r=t.apply(this,arguments);return T.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},T.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(u.call(arguments,1)))},T.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},T.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},T.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},T.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},T.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},T.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},T.keys=S||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)T.has(e,n)&&(t[t.length]=n);return t},T.values=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push(e[n]);return t},T.pairs=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push([n,e[n]]);return t},T.invert=function(e){var t={};for(var n in e)T.has(e,n)&&(t[e[n]]=n);return t},T.functions=T.methods=function(e){var t=[];for(var n in e)T.isFunction(e[n])&&t.push(n);return t.sort()},T.extend=function(e){return N(u.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},T.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return N(n,function(n){n in e&&(t[n]=e[n])}),t},T.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)T.contains(n,i)||(t[i]=e[i]);return t},T.defaults=function(e){return N(u.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var i=l.call(e);if(i!=l.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=M(e[o],t[o],n,r)))break}else{var a=e.constructor,f=t.constructor;if(a!==f&&!(T.isFunction(a)&&a instanceof a&&T.isFunction(f)&&f instanceof f))return!1;for(var c in e)if(T.has(e,c)){o++;if(!(u=T.has(t,c)&&M(e[c],t[c],n,r)))break}if(u){for(c in t)if(T.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};T.isEqual=function(e,t){return M(e,t,[],[])},T.isEmpty=function(e){if(e==null)return!0;if(T.isArray(e)||T.isString(e))return e.length===0;for(var t in e)if(T.has(e,t))return!1;return!0},T.isElement=function(e){return!!e&&e.nodeType===1},T.isArray=E||function(e){return l.call(e)=="[object Array]"},T.isObject=function(e){return e===Object(e)},N(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return l.call(t)=="[object "+e+"]"}}),T.isArguments(arguments)||(T.isArguments=function(e){return!!e&&!!T.has(e,"callee")}),typeof /./!="function"&&(T.isFunction=function(e){return typeof e=="function"}),T.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},T.isNaN=function(e){return T.isNumber(e)&&e!=+e},T.isBoolean=function(e){return e===!0||e===!1||l.call(e)=="[object Boolean]"},T.isNull=function(e){return e===null},T.isUndefined=function(e){return e===void 0},T.has=function(e,t){return c.call(e,t)},T.noConflict=function(){return e._=t,this},T.identity=function(e){return e},T.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},T.random=function(e,t){return t==null&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=T.invert(_.escape);var D={escape:new RegExp("["+T.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(_.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(e){T[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),T.result=function(e,t){if(e==null)return null;var n=e[t];return T.isFunction(n)?n.call(e):n},T.mixin=function(e){N(T.functions(e),function(t){var n=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(T,e))}})};var P=0;T.uniqueId=function(e){var t=P++;return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(e,t,n){n=T.defaults({},n,T.templateSettings);var r=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){s+=e.slice(i,u).replace(j,function(e){return"\\"+B[e]}),s+=n?"'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?"'+\n((__t=("+r+"))==null?'':__t)+\n'":o?"';\n"+o+"\n__p+='":"",i=u+t.length}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(n.variable||"obj","_",s)}catch(u){throw u.source=s,u}if(t)return o(t,T);var a=function(e){return o.call(this,e,T)};return a.source="function("+(n.variable||"obj")+"){\n"+s+"}",a},T.chain=function(e){return T(e).chain()};var F=function(e){return this._chain?T(e).chain():e};T.mixin(T),N(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];T.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),N(["concat","join","slice"],function(e){var t=r[e];T.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(e){return function(){var t,n;return t||e._}}(this)),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="1.0.0";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender||e.$,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=o.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,o,a,f,c,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,f=o.length;a<f;a++){e=o[a];if(s=this._events[e]){this._events[e]=r=[];if(t||n)for(c=0,h=s.length;c<h;c++)i=s[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r)r[s].off(t,n,this),i&&delete this._listeners[s];return this}},f=/\s+/,l=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(f.test(n)){var s=n.split(f);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},c=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},h={listenTo:"on",listenToOnce:"once"};u.each(h,function(e,t){a[t]=function(t,n,r){var i=this._listeners||(this._listeners={}),s=t._listenerId||(t._listenerId=u.uniqueId("l"));return i[s]=t,typeof n=="object"&&(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,u.extend(o,a);var p=o.Model=function(e,t){var n,r=e||{};t||(t={}),this.cid=u.uniqueId("c"),this.attributes={},u.extend(this,u.pick(t,d)),t.parse&&(r=this.parse(r,t)||{});if(n=u.result(this,"defaults"))r=u.defaults({},r,n);this.set(r,t),this.changed={},this.initialize.apply(this,arguments)},d=["url","urlRoot","collection"];u.extend(p.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l,c;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,a=n.silent,o=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=u.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i
[this.idAttribute]);for(r in i)t=i[r],u.isEqual(c[r],t)||o.push(r),u.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t;if(!a){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r,e),e))return!1;n&&n(t,r,e),t.trigger("sync",t,r,e)},j(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o=this.attributes;e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t;if(r&&(!n||!n.wait)&&!this.set(r,n))return!1;n=u.extend({validate:!0},n);if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=u.extend({},o,r)),n.parse===void 0&&(n.parse=!0);var a=this,f=n.success;return n.success=function(e){a.attributes=o;var t=a.parse(e,n);n.wait&&(t=u.extend(r||{},t));if(u.isObject(t)&&!a.set(t,n))return!1;f&&f(a,e,n),a.trigger("sync",a,e,n)},j(this,n),i=this.isNew()?"create":n.patch?"patch":"update",i==="patch"&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)};if(this.isNew())return e.success(),!1;j(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||B();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},u.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,u.extend(t||{},{validationError:n})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];u.each(v,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),u[e].apply(u,t)}});var m=o.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,merge:!1,remove:!1};u.extend(m.prototype,a,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){return this.set(e,u.defaults(t||{},y))},remove:function(e,t){e=u.isArray(e)?e.slice():[e],t||(t={});var n,r,i,s;for(n=0,r=e.length;n<r;n++){s=this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byId[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},set:function(e,t){t=u.defaults(t||{},g),t.parse&&(e=this.parse(e,t)),u.isArray(e)||(e=e?[e]:[]);var n,i,o,a,f,l,c=t.at,h=this.comparator&&c==null&&t.sort!==!1,p=u.isString(this.comparator)?this.comparator:null,d=[],v=[],m={};for(n=0,i=e.length;n<i;n++){if(!(o=this._prepareModel(e[n],t)))continue;(f=this.get(o))?(t.remove&&(m[f.cid]=!0),t.merge&&(f.set(o.attributes,t),h&&!l&&f.hasChanged(p)&&(l=!0))):t.add&&(d.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o))}if(t.remove){for(n=0,i=this.length;n<i;++n)m[(o=this.models[n]).cid]||v.push(o);v.length&&this.remove(v,t)}d.length&&(h&&(l=!0),this.length+=d.length,c!=null?s.apply(this.models,[c,0].concat(d)):r.apply(this.models,d)),l&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=d.length;n<i;n++)(o=d[n]).trigger("add",o,this,t);return l&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,u.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return u.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var r=u.isFunction(t)?t:function(e){return e.get(t)};return u.sortedIndex(this.models,e,r,n)},pluck:function(e){return u.invoke(this.models,"get",e)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},j(this,e),this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(i){t.wait&&n.add(e,t),r&&r(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(b,function(e){m.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var w=["groupBy","countBy","sortBy"];u.each(w,function(e){m.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var E=o.View=function(e){this.cid=u.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];u.extend(E.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)continue;var r=t.match(S),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=u.extend({},u.result(this,"options"),e)),u.extend(this,u.pick(e,x)),this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(u.result(this,"el"),!1)}}),o.sync=function(e,t,n){var r=T[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||B()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1),i.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled)&&(i.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,a,n),a};var T={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var N=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,L=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;u.extend(N.prototype,a,{initialize:function(){},route:function(e,t,n){u.isRegExp(e)||(e=this._routeToRegExp(e)),u.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var r=this;return o.history.route(e,function(i){var s=r._extractParameters(e,i);n&&n.apply(r,s),r.trigger.apply(r,["route:"+t].concat(s)),r.trigger("route",t,s),o.history.trigger("route",r,t,s)}),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;this.routes=u.result(this,"routes");var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(A,"\\$&").replace(C,"(?:$1)?").replace(k,function(e,t){return t?e:"([^/]+)"}).replace(L,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return u.map(n,function(e){return e?decodeURIComponent(e):null})}});var O=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,_=/^\/+|\/+$/g,D=/msie [\w.]+/,P=/\/$/;O.started=!1,u.extend(O.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(P,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(M,"")},start:function(e){if(O.started)throw new Error("Backbone.history has already been started");O.started=!0,this.options=u.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=D.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(_,"/"),r&&this._wantsHashChange&&(this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),O.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!O.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new O;var H=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};p.extend=m.extend=N.extend=E.extend=O.extend=H;var B=function(){throw new Error('A "url" property or function must be specified')},j=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),define("backbone",["underscore"],function(e){return function(){var t,n;return t||e.Backbone}}(this)),define("grapher/bar-graph/bar-graph-model",["require","backbone"],function(e){var t=e("backbone"),n=t.Model.extend({defaults:{value:0,secondValue:null,min:0,max:10,barWidth:"2em",height:"20em",title:"",titleOn:"right",barColor:"#e23c34",fillColor:"white",labels:10,units:"",gridLines:10,labelFormat:"0.1f"}});return n}),define("common/jquery-plugins",[],function(){$.fn.measure=function(e,t,n){var r,i,s;return r=$(this).clone(!1),r.css({visibility:"hidden",position:"absolute"}),r.appendTo(n),t?i=r.find(t):i=r,s=e.apply(i),r.remove(),s},$.fn.truncate=function(e){var t=$(this),n=$("<span>"),r,i;n.text(t.text()),n.css({"font-size":t.css("font-size"),"font-weight":t.css("font-weight"),"white-space":"nowrap",visibility:"hidden"}),n.appendTo(t.parent()),r=n.width();if(r>e){i=n.text()+"...",n.text(i);while(r>e&&i.length>3)i=n.text().slice(0,-4)+"...",n.text(i),r=n.width();t.attr("title",t.text()),t.text(i)}n.remove()}}),define("grapher/bar-graph/bar-graph-view",["require","common/jquery-plugins","backbone"],function(e){e("common/jquery-plugins");var t=e("backbone"),n=0,r=function(){return n++},i=function(e){return e.node().getBBox().width},s=16,o=function(e){var t=e/s;return function(e){return e*t}},u=function(e,t){var n=[],r={},i,s;for(i=0,s=t.length;i<s;i++)n[i]=t[i].value,r[n[i]]=t[i].label;e.tickValues(n).tickFormat(function(e){return r[e]})},a=function(e,t){var n=d3.format(e);return function(e){return n(e)+" "+t}},f=t.View.extend({tagName:"div",className:"bar-graph",initialize:function(){this.uid=r(),this.$topArea=$('<div class="top-area">').appendTo(this.$el),this.vis=d3.select(this.el).append("svg"),this.defs=this.vis.append("defs"),this.axisContainer=this.vis.append("g"),this.fill=this.vis.append("rect"),this.bar=this.vis.append("rect"),this.gridContainer=this.vis.append("g"),this.trianglePos=this.vis.append("g"),this.traingle=this.trianglePos.append("polygon"),this.titleContainer=this.vis.append("g"),this.yScale=d3.scale.linear(),this.heightScale=d3.scale.linear(),this.yAxis=d3.svg.axis(),this.scale=null,this.barWidth=null,this.$bottomArea=$('<div class="bottom-area">').appendTo(this.$el),this.model.on("change",this.modelChanged,this)},render:function(){var e=this.model.toJSON(),t=parseFloat(this.$el.css("font-size")),n=this.scale=o(t),r=e.labels>0||e.labels.length>0,s=r?n(8):n(3),f=r?n(8):n(3),l=0;this.$el.outerHeight(e.height),this._setupHorizontalTitle(),this.svgHeight=this.$el.height()-this.$topArea.height()-this.$bottomArea.height(),this.vis.attr({width:600,height:this.svgHeight}),this.yScale.domain([e.min,e.max]).range([this.svgHeight-s,f]).clamp(!0),this.heightScale.domain([e.min,e.max]).range([0,this.svgHeight-s-f]).clamp(!0),this.axisContainer.selectAll("*").remove(),r&&(this.yAxis.scale(this.yScale).tickValues(null).tickPadding(0).tickSize(0,0,0).orient("left"),typeof e.labels=="number"?this.yAxis.ticks(e.labels).tickFormat(a(e.labelFormat,e.units)):u(this.yAxis,e.labels),this.axisContainer.call(this.yAxis),l+=i(this.axisContainer),this.axisContainer.attr("transform","translate("+l+")"),l+=n(5)),this.fill.attr({width:e.barWidth,height:this.heightScale(e.max),x:l,y:this.yScale(e.max),rx:"0.5em",ry:"0.5em",fill:this._getFillGradient(e.fillColor)}),this.bar.attr({width:e.barWidth,x:l,rx:"0.5em",ry:"0.5em",fill:this._getBarGradient(e.barColor)}),this.barWidth=i(this.fill),this.traingle.classed("triangle",!0).attr({points:"15,-7 15,7 1,0",transform:"translate("+l+") scale("+n(1)+")"}),this._setupGrid(l),l+=this.barWidth,l=this._setupTitle(l),this.vis.attr("width",l/t+"em"),this.$el.css("min-width",l/t+"em"),this.$el.css("min-width",l/t+.8+"em"),this.update()},update:function(){var e=this.model.get("value"),t=this.model.get("secondValue");this.bar.attr("height",this.heightScale(e)).attr("y",this.yScale(e)),typeof t!="undefined"&&t!==null?(this.traingle.classed("hidden",!1),this.trianglePos.attr("transform","translate(0,"+this.yScale(t)+")")):this.traingle.classed("hidden",!0)},modelChanged:function(){var e=this.model.changedAttributes(),t=0,n,r,i;for(i in e)if(e.hasOwnProperty(i)){t++;if(t>2){this.render();return}}n=typeof e.value!="undefined",r=typeof e.secondValue!="undefined",t===1&&(n||r)||t===2&&n&&r?this.update():this.render()},_getBarGradient:function(e){var t="bar-gradient-"+this.uid,n=this.defs.select("#"+t);return e=d3.rgb(e),n.empty()?n=this.defs.append("linearGradient").attr("id",t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"):n.selectAll("stop").remove(),n.append("stop").attr("stop-color",e.brighter(2).toString()).attr("offset","0%"),n.append("stop").attr("stop-color",e.toString()).attr("offset","100%"),"url(#"+t+")"},_getFillGradient:function(e){var t="fill-gradient-"+this.uid,n=this.defs.select("#"+t);return n.empty()?n=this.defs.append("linearGradient").attr("id",t).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"):n.selectAll("stop").remove(),n.append("stop").attr("stop-color",e).attr("offset","0%"),n.append("stop").attr("stop-color",e).attr("stop-opacity",.5).attr("offset","15%"),n.append("stop").attr("stop-color",e).attr("stop-opacity",.4).attr("offset","100%"),"url(#"+t+")"},_setupGrid:function(e){var t=this.yScale.ticks(this.model.get("gridLines")),n=this.yScale,r=this.barWidth;return t.pop(),t.shift(),this.grid=this.gridContainer.selectAll(".grid-line").data(t,String),this.grid.enter().append("path").attr("class","grid-line"),this.grid.exit().remove(),this.grid.attr("d",function(t){return"M "+e+" "+Math.round(n(t))+" h "+r}),e},_setupTitle:function(e){var t=this.model.get("title"),n=this,r,i,s,o;return t&&this.model.get("titleOn")==="right"&&(e+=this.scale(10),r=$.isArray(t),i=r?t.length:1,s=this.titleContainer.selectAll(".title").data(r?t:[t]),s.exit().remove(),o=s.enter().append("g").attr("class","title"),o.append("title"),o.append("text"),s.each(function(e,t){var r=d3.select(this);r.select("title").text(e),r.select("text").text(n._processTitle(e)).attr("dy",-(i-t-1)+"em")}),this.titleContainer.attr("transform","translate("+e+", "+this.svgHeight/2+") rotate(90)"),e+=parseFloat($(s.node()).css("font-size"))*i),e},_setupHorizontalTitle:function(){var e=this.model.get("title"),t=this.model.get("titleOn"),n;this.$topArea.empty(),this.$bottomArea.empty();if(!e||e.length===0||t==="right")return;e=$.isArray(e)?e:[e],t==="top"?n=this.$topArea:t==="bottom"&&(n=this.$bottomArea),e.forEach(function(e){n.append('<p class="title">'+e+"</p>")})},_processTitle:function(e){var t=$('<span class="title">'+e+"</span>").appendTo(this.$el),n;return t.truncate(this.svgHeight),n=t.text(),t.remove(),n}});return f}),define("common/controllers/bar-graph-controller",["require","grapher/bar-graph/bar-graph-model","grapher/bar-graph/bar-graph-view","common/controllers/interactive-metadata","common/validator"],function(e){var t=e("grapher/bar-graph/bar-graph-model"),n=e("grapher/bar-graph/bar-graph-view"),r=e("common/controllers/interactive-metadata"),i=e("common/validator"),s={min:"min",max:"max",title:"title",titleOn:"titleOn",barColor:"barColor",fillColor:"fillColor",labels:"labels",gridLines:"gridLines",labelFormat:"labelFormat",units:"units"},o=function(e){var t={},n,r;for(n in s)s.hasOwnProperty(n)&&(r=s[n],e[n]!==undefined&&(t[r]=e[n]));return t};return function(s){var u,a,f,l,c,h=function(){a.set({value:model.get(l)})},p=function(){a.set({secondValue:model.get(c)})};return s=i.validateCompleteness(r.barGraph,s),a=new t(o(s)),f=new n({model:a,id:s.id}),f.$el.addClass("component"),l=s.property,c=s.secondProperty,u={modelLoadedCallback:function(){var e="";model.addPropertiesListener([l],h),typeof s.averagePeriod!="undefined"&&s.averagePeriod!==null&&(c=l+"-bargraph-"+s.id+"-average",model.defineFilteredOutput(c,{},l,"RunningAverage",s.averagePeriod)),c&&model.addPropertiesListener([c],p),s.units===!0?e=model.getPropertyDescription(l).getUnitAbbreviation():s.units&&(e=s.units),a.set({barWidth:s.barWidth,height:s.height,units:e}),f.render(),h()},getViewContainer:function(){return f.$el},resize:function(){f.render()},serialize:function(){var e=$.extend(!0,{},s);return e}},u}}),define("grapher/core/axis",["require"],function(e){return{numberWidthUsingFormatter:function(e,t,n,r,i){var s,o,u,a,f,l;return s=e.append("svg").attr("width",t).attr("height",n).attr("class","graph"),o=s.append("g").append("text").attr("class","axis").attr("x",-r/4+"px").attr("dy",".35em").attr("text-anchor","end").text(i),l=o.node(),l.getBBox?(u=o.node().getBBox(),a=u.width,f=u.height):(a=0,f=0),s.remove(),[a,f]},axisProcessDrag:function(e,t,n){var r,i,s=n,o=0,u=n[0],a=n[1],f=a-u;if(t!==0)if(u>=0&&a>u)o=u,r=e-o,i=r*.4+o,t>i&&(change=r/(t-o),f=a-o,s=[u,u+f*change]);else if(u<0&&a>0){o=0,r=e-o,i=r*.4+o;if(e>=0&&t>i||e<0&&t<i)change=r/(t-o),s=[u*change,a*change]}else u<0&&a<0&&(o=a,r=e-o,i=r*.4+o,t<i&&(change=r/(t-o),f=u-o,s=[a+f*change,a]));return s}}}),define("grapher/core/graph",["require","grapher/core/axis"],function(e){var t=e("grapher/core/axis"),n={autoscale:"Show all data (autoscale)"};return function(r,s,o,u){function zt(e,t,n){if(t||!s)s=$t(t);Wt(e,n),s.xrange=s.xmax-s.xmin,s.yrange=s.ymax-s.ymin,Object.prototype.toString.call(s.title)==="[object Array]"?R=s.title:R=[s.title],R.reverse(),D=d3.format(s.xFormatter),P=d3.format(s.yFormatter),Pt=s.sampleInterval,dataSampleStart=s.dataSampleStart,Tt=s.strokeWidth,O=s.xTickCount,M=s.yTickCount,_t=[];switch(s.dataType){case"fake":Mt=Zt(),_t=[Mt];break;case"points":Qn(s.dataPoints);break;case"samples":Gn(s.dataSamples,Pt,dataSampleStart)}Ot=[],At=null,en(Mt.length)}function Wt(e,t){e&&(f=d3.select(e),l=f.node(),c=$(l),h=f.property("clientWidth"),p=f.property("clientHeight")),t&&(o=t),m!==undefined&&(m.remove(),m=undefined),I!==undefined&&(I.remove(),I=undefined),U!==undefined&&(U.remove(),U=undefined),s.dataChange?G="ns-resize":G="crosshair",Xt(),Ct=NaN,kt=NaN,Lt=null}function Xt(e,t){!e&&!t?(h=Math.max(f.property("clientWidth"),120),p=Math.max(f.property("clientHeight"),62)):(h=e,l.style.width=h+"px",t?(p=t,l.style.height=p+"px"):(l.style.height="100%",t=f.property("clientHeight"),p=t,l.style.height=p+"px")),Jt()}function Vt(){Xt(),Y=parseFloat(c.css("font-size")),s.fontScaleRelativeToParent||c.css("font-size",.5+Nt.value/6+"em"),Y=parseFloat(c.css("font-size")),Z=Y/2,et=Y/4,m===undefined?(tt=Y,nt=Y,rt=Y,it=Y):(tt=parseFloat($("svg.graph text.title").css("font-size")),nt=parseFloat($("svg.graph text.axis").css("font-size")),rt=parseFloat($("svg.graph text.xlabel").css("font-size")),it=parseFloat($("svg.graph text.ylabel").css("font-size"))),L===undefined?(st=[Y,Y],ylabelMetrics=[Y*2,Y]):(st=t.numberWidthUsingFormatter(f,h,p,nt,Kt(L.ticks(O),D)),ylabelMetrics=t.numberWidthUsingFormatter(f,h,p,nt,Kt(A.ticks(M),P))),ut=st[0],ft=st[1],at=ylabelMetrics[0],lt=ylabelMetrics[0],pt=ut*.6,mt=ft*1.1,ct=mt+ft*1.3,dt=ct-ft/3,gt=at+ft/4,ht=gt+lt,vt=-(gt+lt/4);switch(Nt.value){case 0:d={top:Z,right:Z,bottom:Y,left:Y};break;case 1:d={top:s.title?tt*1.8:Y,right:Z,bottom:Y,left:Y};break;case 2:d={top:s.title?tt*1.8:Y,right:pt,bottom:nt*1.25,left:at*1.25},O=Math.max(6,s.xTickCount/2),M=Math.max(6,s.yTickCount/2);break;case 3:d={top:s.title?tt*1.8:Y,right:pt,bottom:s.xlabel?ct:nt*1.25,left:s.ylabel?ht:at};break;default:d={top:s.title?tt*1.8:Y,right:pt,bottom:s.xlabel?ct:nt*1.25,left:s.ylabel?ht:at}}Nt.value>2?d.top+=(R.length-1)*Nt.value/3*Nt.value/3*Y:R=[R[0]],v={width:h-d.left-d.right,height:p-d.top-d.bottom},L=d3.scale[s.xscale]().domain([s.xmin,s.xmax]).range([0,v.width]),s.xscale==="pow"&&L.exponent(s.xscaleExponent),A=d3.scale[s.yscale]().domain([s.ymin,s.ymax]).nice().range([v.height,0]).nice(),s.yscale==="pow"&&A.exponent(s.yscaleExponent),Qt(),Gt(),_=d3.svg.line().x(function(e,t){return L(Mt[t][0])}).y(function(e,t){return A(Mt[t][1])})}function $t(e){if(e)for(var t in Ht)e[t]===undefined&&(e[t]=Ht[t]);else e=Ht;return e.axisShift<1&&(e.axisShift=1),e}function Jt(){s.responsiveLayout?h<=Nt.icon?(Nt.category="icon",Nt.value=0):h<=Nt.tiny?(Nt.category="tiny",Nt.value=1):h<=Nt.small?(Nt.category="small",Nt.value=2):h<=Nt.medium?(Nt.category="medium",Nt.value=3):(Nt.category="large",Nt.value=4):(Nt.category="large",Nt.value=4)}function Kt(e,t,n){var r=0,i=0,s,o,u;n=n||5;for(u=0;u<e.length;u++)s=t(+e[u].toPrecision(n)),s=s.replace(/^\s\s*/,"").replace(/\s\s*$/,""),o=s.length,o>r&&(r=o,i=u);return t(e[i])}function Qt(){L.domain([s.xmin,s.xmax]).range([0,v.width])}function Gt(){A.domain([s.ymin,s.ymax]).range([v.height,0])}function Yt(){var e=L.domain(),t=A.domain();s.xmax=e[1],s.xmin=e[0],s.ymax=t[1],s.ymin=t[0]}function Zt(){var e=s.yrange/2,t=e/2,n;return s.datacount=v.width/30,s.xtic=s.xrange/s.datacount,s.ytic=s.yrange/s.datacount,n=d3.range(s.datacount).map(function(n){return[n*s.xtic+s.xmin,s.ymin+t+Math.random()*e]}),n}function en(e){return typeof e=="number"&&(Dt=e),typeof Dt!="number"&&(Dt=Mt.length-1),Dt}function tn(e,t,n){var r=0,i=[];t=t||1,n=n||0;for(r=0;r<e.length;r++)i.push([r*t+n,e[r]]);return i}function nn(e){o=e,e?q.text(e):q.text("")}function rn(){F=f.append("div"),F.attr("class","button-layer").style("z-index",3).append("a").attr({"class":"autoscale-button",title:n.autoscale}).on("click",function(){An()}).append("i").attr("class","icon-picture"),sn()}function sn(){F.style({width:Y*1.75+"px",height:Y*1.25+"px",top:d.top+Z+"px",left:d.left+(v.width-Y*2)+"px"})}function on(){m=f.append("svg").attr("width",h).attr("height",p).attr("class","graph").style("z-index",2),g=m.append("g").attr("transform","translate("+d.left+","+d.top+")"),y=g.append("rect").attr("class","plot").attr("width",v.width).attr("height",v.height).attr("pointer-events","all").attr("fill","rgba(255,255,255,0)").on("mousemove",wn).on("mousedown",Sn).on("touchstart",Sn),y.call(d3.behavior.zoom().x(L).y(A).on("zoom",ln)),I=f.append("div").attr("class","background").style({width:v.width+"px",height:v.height+"px",top:d.top+"px",left:d.left+"px","z-index":0}),jn(),b=g.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",v.width).attr("height",v.height).attr("viewBox","0 0 "+v.width+" "+v.height),x=b.append("line").attr("stroke",H).attr("stroke-dasharray","2,2").attr("y1",0).attr("y2",v.height).attr("x1",function(e){return At===null?0:At[0]}).attr("x2",function(e){return At===null?0:At[0]}).attr("class","ruler hidden"),T=b.append("line").attr("stroke",H).attr("stroke-dasharray","2,2").attr("x1",0).attr("x2",v.width).attr("y1",function(e){return At===null?0:At[1]}).attr("y2",function(e){return At===null?0:At[1]}).attr("class","ruler hidden"),bt=m.append("rect").attr("class","draggable-axis").attr("x",d.left-gt).attr("y",d.top).attr("rx",lt/6).attr("width",gt).attr("height",v.height).attr("pointer-events","all").style("cursor","row-resize").on("mousedown",Nn).on("touchstart",Nn),Et=bt.append("title"),yt=m.append("rect").attr("class","draggable-axis").attr("x",d.left).attr("y",v.height+d.top).attr("rx",lt/6).attr("width",v.width).attr("height",mt).attr("pointer-events","all").style("cursor","col-resize").on("mousedown",Tn).on("touchstart",Tn),wt=yt.append("title"),Nt.value<=2&&s.ylabel&&wt.text(s.xlabel),Nt.catefory&&s.ylabel&&Et.text(s.ylabel),fn(),Rt=b.append("g").attr("class","brush"),s.title&&Nt.value>0?(w=g.selectAll("text").data(R,function(e){return e}),w.enter().append("text").attr("class","title").text(function(e){return e}).attr("x",function(e){return v.width/2-Math.min(v.width,an(this))/2}).attr("dy",function(e,t){return-t*tt-Z+"px"}),N=w.append("title").text("")):s.title&&(N=y.append("title").text(s.title)),s.xlabel&&Nt.value>2&&(E=g.append("text").attr("class","axis").attr("class","xlabel").text(s.xlabel).attr("x",v.width/2).attr("y",v.height).attr("dy",dt+"px").style("text-anchor","middle")),s.ylabel&&Nt.value>2&&(S=g.append("g").append("text").attr("class","axis").attr("class","ylabel").text(s.ylabel).style("text-anchor","middle").attr("transform","translate("+vt+" "+v.height/2+") rotate(-90)"),Nt.category==="small"&&bt.append("title").text(s.ylabel)),d3.select(l).on("mousemove.drag",kn).on("touchmove.drag",kn).on("mouseup.drag",Ln).on("touchend.drag",Ln),q=g.append("text").attr("class","graph-notification").text(o).attr("x",v.width/2).attr("y",v.height/2).style("text-anchor","middle"),yn(),bn()}function un(){g.attr("width",h).attr("height",p).attr("transform","translate("+d.left+","+d.top+")"),y.attr("width",v.width).attr("height",v.height),I.style({width:v.width+"px",height:v.height+"px",top:d.top+"px",left:d.left+"px","z-index":0}),b.attr("top",0).attr("left",0).attr("width",v.width).attr("height",v.height).attr("viewBox","0 0 "+v.width+" "+v.height),bt.attr("x",d.left-gt).attr("y",d.top-lt/2).attr("width",gt).attr("height",v.height+lt),yt.attr("x",d.left).attr("y",v.height+d.top).attr("width",v.width).attr("height",mt),fn(),s.title&&Nt.value>0?(w.attr("x",function(e){return v.width/2-Math.min(v.width,an(this))/2}).attr("dy",function(e,t){return-t*tt-Z+"px"}),N.text("")):s.title&&N.text(s.title),s.xlabel&&Nt.value>2?(E.attr("x",v.width/2).attr("y",v.height).attr("dy",dt+"px"),wt.text("")):wt.text(s.xlabel),s.ylabel&&Nt.value>2?(S.attr("transform","translate("+vt+" "+v.height/2+") rotate(-90)"),Et.text("")):Et.text(s.ylabel),q.attr("x",v.width/2).attr("y",v.height/2),g.selectAll("g.x").remove(),g.selectAll("g.y").remove(),yn(),bn(),Fn()}function an(e){return e.getComputedTextLength?e.getComputedTextLength():100}function fn(){Nt.value<=1?(yt.style
({fill:"rgba(196, 196, 196, 0.2)"}),bt.style({fill:"rgba(196, 196, 196, 0.2)"})):(yt.style({fill:null}),bt.style({fill:null}))}function ln(){var e=g.selectAll("g.x").data(L.ticks(O),String).attr("transform",B),t=e.enter().insert("g","a").attr("class","x").attr("transform",B);t.append("line").attr("stroke",H).attr("y1",0).attr("y2",v.height),Nt.value>1&&t.append("text").attr("class","axis").attr("y",v.height).attr("dy",nt+"px").attr("text-anchor","middle").text(D).on("mouseover",function(){d3.select(this).style("font-weight","bold")}).on("mouseout",function(){d3.select(this).style("font-weight","normal")}),e.exit().remove();var n=g.selectAll("g.y").data(A.ticks(M),String).attr("transform",j),r=n.enter().insert("g","a").attr("class","y").attr("transform",j).attr("background-fill","#FFEEB6");r.append("line").attr("stroke",H).attr("x1",0).attr("x2",v.width);if(Nt.value>1){if(s.yscale==="log"){var i=r[0].length;i>100?r=r.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[1]/)}):i>50?r=r.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[12]/)}):r=r.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[125]/)})}r.append("text").attr("class","axis").attr("x",-nt/4+"px").attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(P).on("mouseover",function(){d3.select(this).style("font-weight","bold")}).on("mouseout",function(){d3.select(this).style("font-weight","normal")})}n.exit().remove(),y.call(d3.behavior.zoom().x(L).y(A).on("zoom",ln)),cn()}function cn(e){en(e),Rn(Dt),yn(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function hn(e){en(e),pn()}function pn(e){var t,n=L.domain(),r=Math.round(n[0]),i=Math.round(n[1]),o=Math.max(0,r),u=n[1]-n[0],a=u*.95,f;en(e),f=Mt[Dt-1][0],K?(K=J(),K?(vn(),ln()):cn(Dt)):f>n[0]+a?(J=dn(a*.9,s.axisShift),K=J(),ln()):f<n[1]-a&&Dt<Mt.length&&r>0?(J=dn(a*.9,s.axisShift,-1),K=J(),ln()):f<n[0]?(J=dn(a*.1,1,-1),K=J(),ln()):cn(Dt)}function dn(e,t,n){var r=L.domain()[0],i=L.domain()[1],s=1/t,o=0;return function(){var t;return n=n||1,o+=s,t=e*Q(o),n>0?(L.domain([r+t,i+t]),Yt(),L.domain()[0]<r+e):(L.domain([r-t,i-t]),Yt(),L.domain()[0]>r-e)}}function vn(){isNaN(Ct)||(Ct=NaN),isNaN(kt)||(kt=NaN)}function mn(e){return cs=[],e===At&&cs.push("selected"),cs.length===0?null:cs.join(" ")}function gn(){var e=L.domain(),t=L.range();St=(t[1]-t[0])/(e[1]-e[0]),St=Math.min(St,6),xt=St/4}function yn(){var e,t=null;s.markAllDataPoints&&Nt.value>1?t=Mt:s.markNearbyDataPoints&&Nt.value>1&&(t=Ot.slice(0),At!==null&&t.indexOf(At)==-1&&t.push(At)),t!==null&&(gn(),e=g.select("svg").selectAll("circle").data(t),e.enter().append("circle").attr("class",mn).attr("cx",function(e){return L(e[0])}).attr("cy",function(e){return A(e[1])}).attr("r",St).style("stroke-width",xt).style("cursor",G).on("mousedown.drag",Cn).on("touchstart.drag",Cn).append("title").text(function(e){return"( "+D(e[0])+", "+P(e[1])+" )"}),e.attr("class",mn).attr("cx",function(e){return L(e[0])}).attr("cy",function(e){return A(e[1])}).select("title").text(function(e){return"( "+D(e[0])+", "+P(e[1])+" )"}),e.exit().remove()),bn()}function bn(){s.showRulersOnSelection&&At!==null?(x.attr("y1",0).attr("y2",v.height).attr("x1",function(e){return At===null?0:L(At[0])}).attr("x2",function(e){return At===null?0:L(At[0])}).attr("class",function(e){return"ruler"+(At===null?" hidden":"")}),T.attr("x1",0).attr("x2",v.width).attr("y1",function(e){return At===null?0:A(At[1])}).attr("y2",function(e){return At===null?0:A(At[1])}).attr("class",function(e){return"ruler"+(At===null?" hidden":"")})):(x.attr("class","ruler hidden"),T.attr("class","ruler hidden"))}function wn(){if(s.markNearbyDataPoints){var e=d3.mouse(g.node()),t=L.invert(Math.max(0,Math.min(v.width,e[0]))),n,r,o,u;Ot=[];for(i=0;i<_t.length;i++)Mt=_t[i],n=En(t,i),n!==null&&(r=Mt.indexOf(n),o=r-s.extraCirclesVisibleOnHover,u=r+(s.extraCirclesVisibleOnHover+1),o<0&&(o=0),u>Mt.length-1&&(u=Mt.length),Ot=Ot.concat(Mt.slice(o,u)));cn()}}function En(e,t){if(typeof t=="undefined"||t===null)t=0;Mt=_t[t];if(Mt.length===0)return null;var n=0,r=Mt.length-1,i,s,o,u,a;while(n<r)i=Math.floor((n+r)/2),Mt[i][0]<e?n=i+1:r=i;return o=Mt[i-1],u=Mt[i],a=Mt[i+1],typeof o!="undefined"&&Math.abs(o[0]-e)<=Math.abs(u[0]-e)?o:typeof a=="undefined"||Math.abs(u[0]-e)<=Math.abs(a[0]-e)?u:a}function Sn(){var e;d3.event.preventDefault(),d3.select("body").style("cursor","move");if(d3.event.altKey){y.style("cursor","nesw-resize");if(d3.event.shiftKey&&s.addData){e=d3.mouse(g.node());var t=[];t[0]=L.invert(Math.max(0,Math.min(v.width,e[0]))),t[1]=A.invert(Math.max(0,Math.min(v.height,e[1]))),Mt.push(t),Mt.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),At=t,cn()}else e=d3.mouse(g.node()),Ct=L.invert(e[0]),kt=A.invert(e[1]),Lt=!1,d3.event.stopPropagation()}}function xn(){return!1}function Tn(){l.focus(),document.onselectstart=xn,d3.event.preventDefault();var e=d3.mouse(g.node());Ct=L.invert(e[0])}function Nn(){l.focus(),d3.event.preventDefault(),document.onselectstart=xn;var e=d3.mouse(g.node());kt=A.invert(e[1])}function Cn(e){l.focus(),d3.event.preventDefault(),document.onselectstart=xn,At===e?At=Lt=null:At=Lt=e,cn()}function kn(){var e=d3.mouse(g.node()),n,r,i,o,u,a,f;document.onselectstart=function(){return!0},d3.event.preventDefault(),Lt&&(s.dataChange?Lt[1]=A.invert(Math.max(0,Math.min(v.height,e[1]))):(n=Mt.indexOf(Lt),n&&n<Mt.length-1&&(r=L.invert(e[0]),i=Lt[0],o=Mt[n+1],u=Mt[n-1],a=i-(i-u[0])/2,f=i+(o[0]-i)/2,r<a?(Lt=u,At=Lt):r>f&&(Lt=o,At=Lt))),Yt(),cn()),isNaN(Ct)||(d3.select("body").style("cursor","col-resize"),y.style("cursor","col-resize"),K?L.domain(t.axisProcessDrag(Ct,L.invert(e[0]),L.domain())):L.domain(t.axisProcessDrag(Ct,L.invert(e[0]),L.domain())),Yt(),gn(),ln(),d3.event.stopPropagation()),isNaN(kt)||(d3.select("body").style("cursor","row-resize"),y.style("cursor","row-resize"),A.domain(t.axisProcessDrag(kt,A.invert(e[1]),A.domain())),Yt(),ln(),d3.event.stopPropagation())}function Ln(){d3.select("body").style("cursor","auto"),y.style("cursor","auto"),document.onselectstart=function(){return!0},isNaN(Ct)||(ln(),Ct=NaN),isNaN(kt)||(ln(),kt=NaN),Lt=null}function An(){var e,t,n,r,i,o,u=Infinity,a=-Infinity,f=Infinity,l=-Infinity,c,h;if(Mt.length<2)return;for(e=0;e<_t.length;e++){Mt=_t[e];for(t=0,n=Mt.length;t<n;t++)r=Mt[t],i=r[0],o=r[1],i<u&&(u=i),i>a&&(a=i),o<f&&(f=o),o>l&&(l=o)}h=function(e,t){return e<0?-Math.pow(-e,t):Math.pow(e,t)};switch(s.yscale){case"linear":c=function(e){return e};break;case"log":f=Math.log(f)/Math.log(10),l=Math.log(l)/Math.log(10),c=function(e){return Math.pow(10,e)};break;case"pow":f=h(f,s.yscaleExponent),l=h(l,s.yscaleExponent),c=function(e){return h(e,1/s.yscaleExponent)}}L.domain([u,a]).nice(),A.domain([c(f-.15*(l-f)),c(l+.15*(l-f))]).nice(),Yt(),ln()}function On(e){return arguments.length?(e===null?jt=!1:e.length===0?(jt=!0,Bt.xmin=Infinity,Bt.xmax=Infinity):(jt=!0,Bt.xmin=e[0],Bt.xmax=e[1]),Bn(),qt&&qt(On()),a):jt?Bt.xmax===Infinity&&Bt.xmin===Infinity?[]:[Bt.xmin,Bt.xmax]:null}function Mn(){return jt}function _n(e){return arguments.length?(e=!!e,Ft!==e&&(Ft=e,Bn()),a):Ft}function Dn(e){return arguments.length?(e=!!e,It!==e&&(It=e,Bn()),a):It}function Pn(e){return arguments.length?(qt=e,a):qt}function Hn(){var e;It&&(e=Ut.extent(),On(e[0]!==e[1]?e:[]))}function Bn(){jt&&Ft?(Ut=Ut||d3.svg.brush().x(L).extent([Bt.xmin||0,Bt.xmax||0]).on("brush",Hn),Rt.call(Ut.extent([Bt.xmin||0,Bt.xmax||0])).style("display","inline").style("pointer-events",It?"all":"none").selectAll("rect").attr("height",v.height)):Rt.style("display","none")}function jn(){U=f.append("canvas"),z=U.node(),Fn()}function Fn(){U.attr("class","overlay").style({position:"absolute",width:v.width+"px",height:v.height+"px",top:d.top+"px",left:d.left+"px","z-index":1}),z=U.node(),z.width=v.width,z.height=v.height,z.top=d.top,z.left=d.left,qn(),Rn(Dt)}function In(){z.getContext&&(z.width=z.width,W.fillStyle=X,W.fillRect(0,0,z.width,z.height),W.strokeStyle="rgba(255,65,0, 1.0)")}function qn(){z.getContext&&(W=z.getContext("2d"),W.globalCompositeOperation="source-over",W.lineWidth=1,W.fillStyle=X,W.fillRect(0,0,z.width,z.height),W.strokeStyle="rgba(255,65,0, 1.0)")}function Rn(e){var t,n,r,i,o,u,a,f=A(1e-5),l=s.lines,c=s.bars,h=2*Math.PI,p=_t[0].length,d=_t.length,v,m,g,y;if(typeof z.getContext=="undefined")return;en(e),In(),W.fillRect(0,0,z.width,z.height);if(p===0)return;v=L.domain()[0],m=L.domain()[1],g=Math.max(0,v);if(l)for(t=0;t<d;t++){Mt=_t[t],a=0;for(n=0;n<p;n++){if(Mt[n][0]>=v)break;a++}a>0&&--a;if(a>=p)break;o=L(Mt[a][0]),u=A(Mt[a][1]),Un(t),W.beginPath(),W.moveTo(o,u),i=Mt[a][0],a++;for(;a<e;a++){i=Mt[a][0],o=L(i),u=A(Mt[a][1]),W.lineTo(o,u);if(i>=m)break}W.stroke();if(a<p&&i<m){Un(t,!0);for(;a<p;a++){i=Mt[a][0],o=L(i),u=A(Mt[a][1]),W.lineTo(o,u);if(i>=m)break}W.stroke()}}else if(c)for(t=0;t<d;t++){Mt=_t[t],Un(t),pointStop=e-1;for(a=g;a<pointStop;a++){o=L(Mt[a][0]),u=A(Mt[a][1]);if(u===0)continue;W.beginPath(),W.moveTo(o,f),W.lineTo(o,u),W.stroke()}pointStop=Mt.length-1;if(a<pointStop){Un(t,!0);for(;a<pointStop;a++)o=L(Mt[a][0]),u=A(Mt[a][1]),W.beginPath(),W.moveTo(o,f),W.lineTo(o,u),W.stroke()}}else for(t=0;t<d;t++){Mt=_t[t],y=0,zn(t),Un(t,!0),pointStop=e-1;for(a=0;a<pointStop;a++)o=L(Mt[a][0]),u=A(Mt[a][1]),W.arc(o,u,1,0,h,!1),W.fill();pointStop=Mt.length-1;if(a<pointStop){zn(t,!0),Un(t,!0);for(;a<pointStop;a++)o=L(Mt[a][0]),u=A(Mt[a][1]),W.arc(o,u,1,0,h,!1),W.fill()}}}function Un(e,t){var n=t?.4:1;switch(e){case 0:W.strokeStyle="rgba(160,00,0,"+n+")";break;case 1:W.strokeStyle="rgba(44,160,0,"+n+")";break;case 2:W.strokeStyle="rgba(44,0,160,"+n+")"}}function zn(e,t){var n=t?.4:1;switch(e){case 0:W.fillStyle="rgba(160,00,0,"+n+")";break;case 1:W.fillStyle="rgba(44,160,0,"+n+")";break;case 2:W.fillStyle="rgba(44,0,160,"+n+")"}}function Wn(e){Jn(e),en(Mt.length),hn()}function Xn(e){Kn(e),en(Mt.length),hn()}function Vn(e){var t=Mt.length,n=(t+dataSampleStart)*Pt,r=[n,e];Mt.push(r),en(Mt.length),hn()}function $n(e){Mt.push(e),en(Mt.length),hn()}function Jn(e){if(Object.prototype.toString.call(e[0][0])==="[object Array]"){for(var t=0;t<e.length;t++)Mt=_t[t],Mt.push.apply(Mt,e[t]),_t[t]=Mt;Mt=_t[0]}else Mt.push.apply(Mt,e),_t=[Mt]}function Kn(e){var t,n;if(Object.prototype.toString.call(e[0])==="[object Array]"){for(n=0;n<e.length;n++)_t[n]||_t.push([]),Mt=_t[n],t=Mt.length*Pt,Mt.push.apply(Mt,tn(e[n],Pt,t)),_t[n]=Mt;Mt=_t[0]}else for(n=0;n<e.length;n++)_t[n]||_t.push([]),t=_t[n].length*Pt,_t[n].push([t,e[n]])}function Qn(e){function t(e){var t=[];return e.forEach(function(e){t.push(e)}),t}_t=[];if(!e||e.length===0){Mt=[],_t=[Mt];return}if(Object.prototype.toString.call(e[0][0])==="[object Array]"){for(var n=0;n<e.length;n++)_t.push(t(e[n]));Mt=_t[0]}else Mt=e,_t=[t(Mt)]}function Gn(e,t,n){_t=[];if(Object.prototype.toString.call(e[0])==="[object Array]"){for(var r=0;r<e.length;r++)_t.push(tn(e[r],t,n));Mt=_t[0]}else Mt=tn(e,t,n),_t=[Mt];Pt=t,dataSampleStart=n}function Yn(e){Qn(e)}function Zn(e){Gn(e,Pt,dataSampleStart)}function er(e){Mt.length&&(Mt.splice(e,1),Dt>=Mt.length&&(Dt=Mt.length-1))}function tr(){m.node().addEventListener("keydown",function(e){if(!At)return!1;if(e.type=="keydown"){switch(e.keyCode){case 8:case 46:if(s.dataChange){var t=Mt.indexOf(At);er(t),At=Mt.length?Mt[t>0?t-1:0]:null,cn()}e.preventDefault(),e.stopPropagation()}e.preventDefault()}})}function nr(){s.title&&w&&w.text(s.title)}function rr(){s.xlabel&&E&&E.text(s.xlabel)}function ir(){s.ylabel&&S?S.text(s.ylabel):S.style("display","none")}function sr(){Vt(),m===undefined?on():un(),s.showButtons&&(F||rn(),sn()),ln()}function or(e,t,n){return arguments.length?zt(e,t,n):zt(),sr(),sr(),tr(),a}function ur(e,t){return Xt(e,t),Wt(),sr(),a}var a={},f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H=function(e){return e?"#ccc":"#666"},B=function(e){return"translate("+L(e)+",0)"},j=function(e){return"translate(0,"+A(e)+")"},F,I,q,R=[],U,z,W,X="rgba(255,255,255, 0.0)",V={},J,K=!1,Q=d3.ease("cubic"),G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt={category:"medium",value:3,icon:120,tiny:240,small:480,medium:960,large:1920},Ct=NaN,kt=NaN,Lt=null,At=null,Ot=[],Mt=[],_t,Dt,Pt,Ht={showButtons:!0,responsiveLayout:!1,fontScaleRelativeToParent:!0,dataType:"points",dataPoints:[],dataSamples:[],sampleInterval:1,dataSampleStart:0,title:"graph",xlabel:"x-axis",ylabel:"y-axis",xmax:10,xmin:0,ymax:10,ymin:0,xTickCount:10,yTickCount:10,xFormatter:".3s",yFormatter:".3r",xscale:"linear",yscale:"linear",xscaleExponent:.5,yscaleExponent:.5,axisShift:10,markAllDataPoints:!1,markNearbyDataPoints:!1,extraCirclesVisibleOnHover:2,showRulersOnSelection:!1,strokeWidth:2,dataChange:!1,addData:!1,notification:!1,lines:!0,bars:!1},Bt={xmin:null,xmax:null,ymin:null,ymax:null},jt=!1,Ft=!1,It=!0,qt,Rt,Ut;return a={update:cn,repaint:sr,reset:or,redraw:ln,resize:ur,notify:nn,selectionDomain:On,selectionVisible:_n,selectionListener:Pn,selectionEnabled:Dn,hasSelection:Mn,brushElement:function(){return Rt},brushControl:function(){return Ut},brushListener:function(){return Hn},scale:Xt,updateOrRescale:hn,xDomain:function(e){return arguments.length?(L.domain(e),Qt&&(Qt(),ln()),a):L.domain()},yDomain:function(e){return arguments.length?(A.domain(e),Gt&&(Gt(),ln()),a):A.domain()},xmin:function(e){return arguments.length?(s.xmin=e,s.xrange=s.xmax-s.xmin,Qt&&(Qt(),ln()),a):s.xmin},xmax:function(e){return arguments.length?(s.xmax=e,s.xrange=s.xmax-s.xmin,Qt&&(Qt(),ln()),a):s.xmax},ymin:function(e){return arguments.length?(s.ymin=e,s.yrange=s.ymax-s.ymin,Gt&&(Gt(),ln()),a):s.ymin},ymax:function(e){return arguments.length?(s.ymax=e,s.yrange=s.ymax-s.ymin,Gt&&(Gt(),ln()),a):s.ymax},xLabel:function(e){return arguments.length?(s.xlabel=e,rr(),a):s.xlabel},yLabel:function(e){return arguments.length?(s.ylabel=e,ir(),a):s.ylabel},title:function(e){return arguments.length?(s.title=e,nr(),a):s.title},width:function(e){return arguments.length?(v.width=e,a):v.width},height:function(e){return arguments.length?(v.height=e,a):v.height},elem:function(e){return arguments.length?(f=d3.select(e),graph(f),a):f},numberOfPoints:function(){return Mt?Mt.length:!1},addPoints:Wn,addPoint:$n,resetPoints:Yn,addSamples:Xn,addSample:Vn,resetSamples:Zn},zt(r,s,o),l&&(sr(),sr()),a}}),define("common/controllers/graph-controller",["require","grapher/core/graph","common/controllers/interactive-metadata","common/validator"],function(e){var t=e("grapher/core/graph"),n=e("common/controllers/interactive-metadata"),r=e("common/validator"),i={title:"title",dataPoints:"dataPoints",fontScaleRelativeToParent:"fontScaleRelativeToParent",xlabel:"xlabel",xmin:"xmin",xmax:"xmax",ylabel:"ylabel",ymin:"ymin",ymax:"ymax",xTickCount:"xTickCount",yTickCount:"yTickCount",xscaleExponent:"xscaleExponent",yscaleExponent:"yscaleExponent",xFormatter:"xFormatter",yFormatter:"yFormatter",lines:"lines",bars:"bars"},s=0;return function(o,u,a){function v(){var e=[],t,n,r=model.get("time");for(t=0,n=h.length;t<n;t++)e.push([r,model.get(h[t])]);return e}function m(){var e={},t,n;for(t in i)i.hasOwnProperty(t)&&(n=i[t],e[n]=o[t]);return e}function g(){var e=v(),t;for(t=0;t<e.length;t++)p[t]=[e[t]];l.resetPoints(p)}function y(){var e=v(),t;for(t=0;t<e.length;t++)p[t].push(e[t]);l.addPoints(e)}function b(){var e;for(e=0;e<h.length;e++)p[e].length=model.stepCounter()+1;l.resetPoints(p)}function w(){l.updateOrRescale(model.stepCounter())}function E(){l.reset("#"+o.id,m())}function S(){model.on("tick."+d,y),model.on("stepBack."+d,w),model.on("stepForward."+d,w),model.on("seek."+d,w),model.on("reset."+d,function(){E(),g()}),model.on("play."+d,function(){l.numberOfPoints()&&model.stepCounter()<l.numberOfPoints()&&b()}),model.on("invalidation."+d,b)}var f,l,c,h,p=[],d="graphController"+ ++s;return o=r.validateCompleteness(n.graph,o),h=o.properties.slice(),f=$("<div>").attr("id",o.id).addClass("graph"),f.addClass("component"),f.css({width:o.width,height:o.height}),c={modelLoadedCallback:function(){l?E():l=new t(f[0],m(),undefined,a.getNextTabIndex()),g(),S()},getView:function(){return l},getViewContainer:function(){return f},resize:function(){l&&l.resize()},serialize:function(){var e=$.extend(!0,{},o),t=l.xDomain(),n=l.yDomain(),r=o.xmin;return e.ymin=n[0],e.ymax=n[1],e.xmin=r,e.xmax=r+t[1]-t[0],e}}}}),define("import-export/dg-exporter",["require","common/console"],function(e){var t=e("common/console");return{gameName:"Next Gen MW",parentCollectionName:"Summary of Run",childCollectionName:"Time Series of Run",perRunColumnLabelCount:0,perRunColumnLabelPositions:{},mockDGController:{doCommand:function(e){return t.log("action: ",e.action),t.log("args: ",e.args),{caseID:0}}},isDgGameControllerDefined:function(){return!!(window.parent&&window.parent.DG&&window.parent.DG.currGameController)},isExportAvailable:function(){return this.isDgGameControllerDefined()},getDGGameController:function(){return this.isDgGameControllerDefined()?window.parent.DG.currGameController:this.mockDGController},doCommand:function(e,t){var n=this.getDGGameController();return n.doCommand({action:e,args:t})},exportData:function(e,t,n,r){var i,s,o,u=[],a=[],f=[],l,c,h;for(h=0;h<t.length;h++)i=e[h],s=t[h],this.perRunColumnLabelPositions[i]==null&&(this.perRunColumnLabelPositions[i]=this.perRunColumnLabelCount++),o=this.perRunColumnLabelPositions[i],u[o]={name:i},a[o]=s;for(h=0;h<n.length;h++)f.push({name:n[h]});this.doCommand("initGame",{name:this.gameName}),this.doCommand("createCollection",{name:this.parentCollectionName,attrs:[{name:"Number of Time Points"}].concat(u),childAttrName:"contents"}),this.doCommand("createCollection",{name:this.childCollectionName,attrs:f}),c=[r.length].concat(a),l=this.doCommand("openCase",{collection:this.parentCollectionName,values:c}),this.doCommand("createCases",{collection:this.childCollectionName,values:r,parent:l.caseID}),this.doCommand("closeCase",{collection:this.parentCollectionName,values:c,caseID:l.caseID})},openTable:function(){this.doCommand("createComponent",{type:"DG.TableView",log:!1})},logAction:function(e){this.doCommand("logAction",{formatStr:e})}}}),define("common/controllers/export-controller",["require","import-export/dg-exporter"],function(e){var t=e("import-export/dg-exporter"),n=function(n){function u(){var e=[],t,n;for(t=0,n=i.length;t<n;t++)e.push(model.get(i[t]));return e}function a(){s=[u()]}function f(){s.push(u())}function l(){s.length=model.stepCounter()+1}function c(e){var n,i=[],s=[],o;for(o=0;o<r.length;o++)i[o]=p(r[o]),s[o]=model.get(r[o]);n="User "+e+" model. ",n+="Per-run Settings and Data: ",n+=JSON.stringify({action:e,type:"model",fields:i,values:s}),t.logAction(n)}function h(){model.on("tick.exportController",f),model.on("reset.exportController",a),model.on("play.exportController",l),model.on("invalidation.exportController",l),model.on("play.exportController",function(){c("started")}),model.on("willReset.exportController",function(){c("reset")})}function p(e){var t=model.getPropertyDescription(e),n=t.getLabel(),r=t.getUnitAbbreviation(),i="";return n.length>0?i+=n:i+=e,r&&r.length>0&&(i+=" (",i+=r,i+=")"),i}var r=(n.perRun||[]).slice(),i=["displayTime"].concat(n.perTick.slice()),s,o;return o={modelLoadedCallback:function(){function e(e){return function(t){return model.getPropertyType(t)===e}}r=r.filter(e("parameter")).concat(r.filter(e("output"))),a(),h()},exportData:function(){var e=[],n=[],o=[],u;c("exported");for(u=0;u<r.length;u++)e[u]=p(r[u]),n[u]=model.get(r[u]);for(u=0;u<i.length;u++)o[u]=p(i[u]);t.exportData(e,n,o,s),t.openTable()}}};return n.isExportAvailable=function(){return t.isExportAvailable()},n}),define("common/controllers/scripting-api",["require","common/alert"],function(e){var t=e("common/alert");return function(n){var r={api:function(){function e(e){return typeof e=="number"&&parseFloat(e)===parseInt(e,10)}function r(e){return typeof e=="object"&&e.slice===Array.prototype.slice}function i(e){return e?Math.random()*e:Math.random()}function s(e){return Math.floor(Math.random()*e)}function o(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function u(e,t){var n=[],r;for(r=0;r<t;r++)n[r]=r;for(r=0;r<e;r++)o(n,r,r+s(t-r));return n.length=e,n}function a(e,t,n){var r;if(typeof _gaq=="undefined")return;r=_gaq,e||(e="Interactive"),r.push(["_trackEvent",e,t,n])}return{isInteger:e,isArray:r,randomInteger:s,randomFloat:i,swapElementsOfArray:o,choose:u,deg2rad:Math.PI/180,rad2deg:180/Math.PI,trackEvent:a,format:d3.format,get:function(){return model.get.apply(model,arguments)},set:function(){return model.set.apply(model,arguments)},loadModel:function(t,r){model.stop(),n.loadModel(t),typeof r=="function"&&n.pushOnLoadScript(r)},onPropertyChange:function(t,n){model.addPropertiesListener([t],function(){n(model.get(t))})},callAt:function(t,n){var r={time:t,action:n,check:function(){model.get("time")>=this.time&&(this.action(),this.check=function(){})}};model.addPropertiesListener("time",function(){r.check()})},callEvery:function(t,n){var r={lastCall:0,interval:t,action:n,execute:function(){var e=model.get("time");while(e-this.lastCall>=this.interval)this.action(),this.lastCall+=this.interval}};model.addPropertiesListener("time",function(){r.execute()})},onClick:function(t,r){n.getModelController().modelContainer.setClickHandler("."+t,r)},onSelect:function(t){n.getModelController().modelContainer.setSelectHandler(t)},start:function(){model.start(),a("Interactive","Start","Starting interactive: "+n.get("title"))},stop:function(){model.stop()},reset:function(){model.stop(),n.modelController.reload()},stepForward:function(){model.stepForward(),model.isNewStep()||n.modelController.modelContainer.update()},stepBack:function(){model.stepBack(),n.modelController.modelContainer.update()},tick:function(){model.tick()},isStopped:function(){return model.isStopped()},getTime:function(){return model.get("time")},getFPS:function(){return model.getFPS()},getSimulationProgressRate:function(){return model.getSimulationProgressRate()},startPerformanceTuning:function(){model.performanceOptimizer.enable()},repaint:function(){n.getModelController().repaint()},exportData:function(){var t=n.getDGExportController();if(!t)throw new Error("No exports have been specified.");t.exportData()},Math:Math,"undefined":undefined,alert:t,console:window.console!==null?window.console:{log:function(){},error:function(){},warn:function(){},dir:function(){}}}}(),freeze:function(){Object.freeze(this.api)},extend:function(e){$.extend(this.api,new e(this.api))},exposeScriptingAPI:function(){window.script=$.extend({},this.api),window.script.run=function(e,t){var n,i=[],s=[];for(n in t)t.hasOwnProperty(n)&&(i.push(n),s.push(t[n]));return r.makeFunctionInScriptContext.apply(null,i.concat(e)).apply(null,s)}},makeFunctionInScriptContext:function(){function u(){var t=Object.getOwnPropertyNames(window),n,r,i,s;for(r=0,i=t.length;r<i;r++)n=t[r],e.hasOwnProperty(n)||(s=function(e){return function(){throw new ReferenceError(e+" is not defined")}}(n),Object.defineProperty(e,n,{set:s,get:s}))}var e={},n=Array.prototype.slice.call(arguments,0,arguments.length-1),r=arguments[arguments.length-1],i,s,o;typeof r!="string"&&(r=r.join("      \n")),i="with (shadowedGlobals) {\n  with (scriptingAPI) {\n    return function("+n.join(",")+") {\n"+"      'use "+"strict';\n"+"      "+r+"\n"+"    };\n"+"  }\n"+"}";try{s=new Function("shadowedGlobals","scriptingAPI","scriptSource",i),o=s(e,this.api,r)}catch(a){return t('Error compiling script: "'+a.toString()+'"\nScript:\n\n'+r),function(){throw new Error("Cannot run a script that could not be compiled")}}return function(){u();try{return o.apply(null,Array.prototype.slice.call(arguments))}catch(e){t('Error running script: "'+e.toString()+'"\nScript:\n\n'+r)}}}};return r}}),define("common/controllers/button-controller",["common/controllers/interactive-metadata","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator");return function(r,i,s){var o,u;return r=t.validateCompleteness(e.button,r),o=$("<button>").attr("tabindex",s.getNextTabIndex()).attr("id",r.id).html(r.text),o.addClass("component"),o.css({width:r.width,height:r.height}),o.click(i.makeFunctionInScriptContext(r.action)),u={getViewContainer:function(){return o},serialize:function(){return $.extend(!0,{},r)}},u}}),define("common/controllers/checkbox-controller",["common/controllers/interactive-metadata","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator");return function(r,i,s){function d(){v(model.get(o))}function v(e){e?(f.prop("checked",!0),l.addClass("checked")):(f.prop("checked",!1),l.removeClass("checked"))}function m(e){e.preventDefault(),f.prop("checked")?v(!1):v(!0),f.trigger("change")}var o,u,a,f,l,c,h,p;return r=t.validateCompleteness(e.checkbox,r),o=r.property,u=r.onClick,a=r.initialValue,c=$("<label>").append("<span>"+r.text+"</span>"),c.attr("for",r.id),f=$('<input type="checkbox">').attr("id",r.id),s&&f.attr("tabindex",s.getNextTabIndex()),l=$('<div class="fakeCheckable">'),f.css("display","none"),r.textOn==="left"?h=$("<div>").append(c).append(f).append(l.addClass("right")):h=$("<div>").append(f).append(l).append(c),h.addClass("interactive-checkbox"),h.addClass("component"),l.on("touchstart click",m),c.on("touchstart click",m),h.css({width:r.width,height:r.height}),u&&(u=i.makeFunctionInScriptContext("value",u)),f.on("change",function(){var e=!1,t;$(this).is(":checked")&&(e=!0),o!==undefined&&(t={},t[o]=e,model.set(t)),u!==undefined&&u(e)}),p={modelLoadedCallback:function(){o!==undefined?(model.addPropertiesListener([o],d),d()):a!==undefined&&(v(a),u(a))},getViewContainer:function(){return h},serialize:function(){var e=$.extend(!0,{},r);return o===undefined&&(e.initialValue=f.is(":checked")?!0:!1),e}},p}}),function(e){function n(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function r(){var e=require("util");return"Markdown.mk_block( "+e.inspect(this.toString())+", "+e.inspect(this.trailing)+", "+e.inspect(this.lineNumber)+" )"}function s(e){var t=0,n=-1;while((n=e.indexOf("\n",n+1))!==-1)t++;return t}function o(e,t){function i(e){this.len_after=e,this.name="close_"+t}var n=e+"_state",r=e=="strong"?"em_state":"strong_state";return function(s,o){if(this[n][0]==t)return this[n].shift(),[s.length,new i(s.length-t.length)];var u=this[r].slice(),a=this[n].slice();this[n].unshift(t);var f=this.processInline(s.substr(t.length)),l=f[f.length-1],c=this[n].shift();if(l instanceof i){f.pop();var h=s.length-l.len_after;return[h,[e].concat(f)]}return this[r]=u,this[n]=a,[t.length,t]}}function u(e){var t=e.split(""),n=[""],r=!1;while(t.length){var i=t.shift();switch(i){case" ":r?n[n.length-1]+=i:n.push("");break;case"'":case'"':r=!r;break;case"\\":i=t.shift();default:n[n.length-1]+=i}}return n}function c(e){return f(e)&&e.length>1&&typeof e[1]=="object"&&!f(e[1])?e[1]:undefined}function h(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function d(e){if(typeof e=="string")return h(e);var t=e.shift(),n={},r=[];e.length&&typeof e[0]=="object"&&!(e[0]instanceof Array)&&(n=e.shift());while(e.length)r.push(arguments.callee(e.shift()));var i="";for(var s in n)i+=" "+s+'="'+h(n[s])+'"';return t=="img"||t=="br"||t=="hr"?"<"+t+i+"/>":"<"+t+i+">"+r.join("")+"</"+t+">"}function v(e,t,n){var r;n=n||{};var i=e.slice(0);typeof n.preprocessTreeNode=="function"&&(i=n.preprocessTreeNode(i,t));var s=c(i);if(s){i[1]={};for(r in s)i[1][r]=s[r];s=i[1]}if(typeof i=="string")return i;switch(i[0]){case"header":i[0]="h"+i[1].level,delete i[1].level;break;case"bulletlist":i[0]="ul";break;case"numberlist":i[0]="ol";break;case"listitem":i[0]="li";break;case"para":i[0]="p";break;case"markdown":i[0]="html",s&&delete s.references;break;case"code_block":i[0]="pre",r=s?2:1;var o=["code"];o.push.apply(o,i.splice(r)),i[r]=o;break;case"inlinecode":i[0]="code";break;case"img":i[1].src=i[1].href,delete i[1].href;break;case"linebreak":i[0]="br";break;case"link":i[0]="a";break;case"link_ref":i[0]="a";var u=t[s.ref];if(!u)return s.original;delete s.ref,s.href=u.href,u.title&&(s.title=u.title),delete s.original;break;case"img_ref":i[0]="img";var u=t[s.ref];if(!u)return s.original;delete s.ref,s.src=u.href,u.title&&(s.title=u.title),delete s.original}r=1;if(s){for(var a in i[1])r=2;r===1&&i.splice(r,1)}for(;r<i.length;++r)i[r]=arguments.callee(i[r],t,n);return i}function m(e){var t=c(e)?2:1;while(t<e.length)typeof e[t]=="string"?t+1<e.length&&typeof e[t+1]=="string"?e[t]+=e.splice(t+1,1)[0]:++t:(arguments.callee(e[t]),++t)}var t=e.Markdown=function g(e){switch(typeof e){case"undefined":this.dialect=g.dialects.Gruber;break;case"object":this.dialect=e;break;default:if(!(e in g.dialects))throw new Error("Unknown Markdown dialect '"+String(e)+"'");this.dialect=g.dialects[e]}this.em_state=[],this.strong_state=[],this.debug_indent=""};e.parse=function(e,n){var r=new t(n);return r.toTree(e)},e.toHTML=function(n,r,i){var s=e.toHTMLTree(n,r,i);return e.renderJsonML(s)},e.toHTMLTree=function(t,n,r){typeof t=="string"&&(t=this.parse(t,n));var i=c(t),s={};i&&i.references&&(s=i.references);var o=v(t,s,r);return m(o),o};var i=t.mk_block=function(e,t,i){arguments.length==1&&(t="\n\n");var s=new String(e);return s.trailing=t,s.inspect=r,s.toSource=n,i!=undefined&&(s.lineNumber=i),s};t.prototype.split_blocks=function(t,n){var r=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,o=[],u,a=1;(u=/^(\s*\n)/.exec(t))!=null&&(a+=s(u[0]),r.lastIndex=u[0].length);while((u=r.exec(t))!==null)o.push(i(u[1],u[2],a)),a+=s(u[0]);return o},t.prototype.processBlock=function(t,n){var r=this.dialect.block,i=r.__order__;if("__call__"in r)return r.__call__.call(this,t,n);for(var s=0;s<i.length;s++){var o=r[i[s]].call(this,t,n);if(o)return(!f(o)||o.length>0&&!f(o[0]))&&this.debug(i[s],"didn't return a proper array"),o}return[]},t.prototype.processInline=function(t){return this.dialect.inline.__call__.call(this,String(t))},t.prototype.toTree=function(t,n){var r=t instanceof Array?t:this.split_blocks(t),i=this.tree;try{this.tree=n||this.tree||["markdown"];e:while(r.length){var s=this.processBlock(r.shift(),r);if(!s.length)continue e;this.tree.push.apply(this.tree,s)}return this.tree}finally{n&&(this.tree=i)}},t.prototype.debug=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.debug_indent),typeof print!="undefined"&&print.apply(print,e),typeof console!="undefined"&&typeof console.log!="undefined"&&console.log.apply(null,e)},t.prototype.loop_re_over_block=function(e,t,n){var r,i=t.valueOf();while(i.length&&(r=e.exec(i))!=null)i=i.substr(r[0].length),n.call(this,r);return i},t.dialects={},t.dialects.Gruber={block:{atxHeader:function(t,n){var r=t.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!r)return undefined;var s=["header",{level:r[1].length}];return Array.prototype.push.apply(s,this.processInline(r[2])),r[0].length<t.length&&n.unshift(i(t.substr(r[0].length),t.trailing,t.lineNumber+2)),[s]},setextHeader:function(t,n){var r=t.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!r)return undefined;var s=r[2]==="="?1:2,o=["header",{level:s},r[1]];return r[0].length<t.length&&n.unshift(i(t.substr(r[0].length),t.trailing,t.lineNumber+2)),[o]},code:function(t,n){var r=[],s=/^(?: {0,3}\t| {4})(.*)\n?/,o;if(!t.match(s))return undefined;e:do{var u=this.loop_re_over_block(s,t.valueOf(),function(e){r.push(e[1])});if(u.length){n.unshift(i(u,t.trailing));break e}if(!n.length)break e;if(!n[0].match(s))break e;r.push(t.trailing.replace(/[^\n]/g,"").substring(2)),t=n.shift()}while(!0);return[["code_block",r.join("\n")]]},horizRule:function(t,n){var r=t.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!r)return undefined;var s=[["hr"]];return r[1]&&s.unshift.apply(s,this.processBlock(r[1],[])),r[3]&&n.unshift(i(r[3])),s},lists:function(){function o(t){return new RegExp("(?:^("+s+"{0,"+t+"} {0,3})("+e+")\\s+)|"+"(^"+s+"{0,"+(t-1)+"}[ ]{0,4})")}function u(e){return e.replace(/ {0,3}\t/g,"    ")}function a(e,t,n,r){if(t){e.push(["para"].concat(n));return}var i=e[e.length-1]instanceof Array&&e[e.length-1][0]=="para"?e[e.length-1]:e;r&&e.length>1&&n.unshift(r);for(var s=0;s<n.length;s++){var o=n[s],u=typeof o=="string";u&&i.length>1&&typeof i[i.length-1]=="string"?i[i.length-1]+=o:i.push(o)}}function f(e,t){var n=new RegExp("^("+s+"{"+e+"}.*?\\n?)*$"),r=new RegExp("^"+s+"{"+e+"}","gm"),o=[];while(t.length>0){if(n.exec(t[0])){var u=t.shift(),a=u.replace(r,"");o.push(i(a,u.trailing,u.lineNumber))}break}return o}function c(e,t,n){var r=e.list,i=r[r.length-1];if(i[1]instanceof Array&&i[1][0]=="para")return;if(t+1==n.length)i.push(["para"].concat(i.splice(1)));else{var s=i.pop();i.push(["para"].concat(i.splice(1)),s)}}var e="[*+-]|\\d+\\.",t=/[*+-]/
,n=/\d+\./,r=new RegExp("^( {0,3})("+e+")[ 	]+"),s="(?: {0,3}\\t| {4})";return function(e,n){function s(e){var n=t.exec(e[2])?["bulletlist"]:["numberlist"];return h.push({list:n,indent:e[1]}),n}var i=e.match(r);if(!i)return undefined;var h=[],p=s(i),d,v=!1,m=[h[0].list],g;e:for(;;){var y=e.split(/(?=\n)/),b="";for(var w=0;w<y.length;w++){var E="",S=y[w].replace(/^\n/,function(e){return E=e,""}),x=o(h.length);i=S.match(x);if(i[1]!==undefined){b.length&&(a(d,v,this.processInline(b),E),v=!1,b=""),i[1]=u(i[1]);var T=Math.floor(i[1].length/4)+1;if(T>h.length)p=s(i),d.push(p),d=p[1]=["listitem"];else{var N=!1;for(g=0;g<h.length;g++){if(h[g].indent!=i[1])continue;p=h[g].list,h.splice(g+1),N=!0;break}N||(T++,T<=h.length?(h.splice(T),p=h[T-1].list):(p=s(i),d.push(p))),d=["listitem"],p.push(d)}E=""}S.length>i[0].length&&(b+=E+S.substr(i[0].length))}b.length&&(a(d,v,this.processInline(b),E),v=!1,b="");var C=f(h.length,n);C.length>0&&(l(h,c,this),d.push.apply(d,this.toTree(C,[])));var k=n[0]&&n[0].valueOf()||"";if(k.match(r)||k.match(/^ /)){e=n.shift();var L=this.dialect.block.horizRule(e,n);if(L){m.push.apply(m,L);break}l(h,c,this),v=!0;continue e}break}return m}}(),blockquote:function(t,n){if(!t.match(/^>/m))return undefined;var r=[];if(t[0]!=">"){var i=t.split(/\n/),s=[];while(i.length&&i[0][0]!=">")s.push(i.shift());t=i.join("\n"),r.push.apply(r,this.processBlock(s.join("\n"),[]))}while(n.length&&n[0][0]==">"){var o=n.shift();t=new String(t+t.trailing+o),t.trailing=o.trailing}var u=t.replace(/^> ?/gm,""),a=this.tree;return r.push(this.toTree(u,["blockquote"])),r},referenceDefn:function(t,n){var r=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!t.match(r))return undefined;c(this.tree)||this.tree.splice(1,0,{});var s=c(this.tree);s.references===undefined&&(s.references={});var o=this.loop_re_over_block(r,t,function(e){e[2]&&e[2][0]=="<"&&e[2][e[2].length-1]==">"&&(e[2]=e[2].substring(1,e[2].length-1));var t=s.references[e[1].toLowerCase()]={href:e[2]};e[4]!==undefined?t.title=e[4]:e[5]!==undefined&&(t.title=e[5])});return o.length&&n.unshift(i(o,t.trailing)),[]},para:function(t,n){return[["para"].concat(this.processInline(t))]}}},t.dialects.Gruber.inline={__oneElement__:function(t,n,r){var i,s,o=0;n=n||this.dialect.inline.__patterns__;var u=new RegExp("([\\s\\S]*?)("+(n.source||n)+")");i=u.exec(t);if(!i)return[t.length,t];if(i[1])return[i[1].length,i[1]];var s;return i[2]in this.dialect.inline&&(s=this.dialect.inline[i[2]].call(this,t.substr(i.index),i,r||[])),s=s||[i[2].length,i[2]],s},__call__:function(t,n){function s(e){typeof e=="string"&&typeof r[r.length-1]=="string"?r[r.length-1]+=e:r.push(e)}var r=[],i;while(t.length>0)i=this.dialect.inline.__oneElement__.call(this,t,n,r),t=t.substr(i.shift()),l(i,s);return r},"]":function(){},"}":function(){},"\\":function(t){return t.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)?[2,t[1]]:[1,"\\"]},"![":function(t){var n=t.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(n){n[2]&&n[2][0]=="<"&&n[2][n[2].length-1]==">"&&(n[2]=n[2].substring(1,n[2].length-1)),n[2]=this.dialect.inline.__call__.call(this,n[2],/\\/)[0];var r={alt:n[1],href:n[2]||""};return n[4]!==undefined&&(r.title=n[4]),[n[0].length,["img",r]]}return n=t.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),n?[n[0].length,["img_ref",{alt:n[1],ref:n[2].toLowerCase(),original:n[0]}]]:[2,"!["]},"[":function y(e){var n=String(e),r=t.DialectHelpers.inline_until_char.call(this,e.substr(1),"]");if(!r)return[1,"["];var i=1+r[0],s=r[1],y,o;e=e.substr(i);var u=e.match(/^\s*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(u){var a=u[1];i+=u[0].length,a&&a[0]=="<"&&a[a.length-1]==">"&&(a=a.substring(1,a.length-1));if(!u[3]){var f=1;for(var l=0;l<a.length;l++)switch(a[l]){case"(":f++;break;case")":--f==0&&(i-=a.length-l,a=a.substring(0,l))}}return a=this.dialect.inline.__call__.call(this,a,/\\/)[0],o={href:a||""},u[3]!==undefined&&(o.title=u[3]),y=["link",o].concat(s),[i,y]}return u=e.match(/^\s*\[(.*?)\]/),u?(i+=u[0].length,o={ref:(u[1]||String(s)).toLowerCase(),original:n.substr(0,i)},y=["link_ref",o].concat(s),[i,y]):s.length==1&&typeof s[0]=="string"?(o={ref:s[0].toLowerCase(),original:n.substr(0,i)},y=["link_ref",o,s[0]],[i,y]):[1,"["]},"<":function(t){var n;return(n=t.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))!=null?n[3]?[n[0].length,["link",{href:"mailto:"+n[3]},n[3]]]:n[2]=="mailto"?[n[0].length,["link",{href:n[1]},n[1].substr("mailto:".length)]]:[n[0].length,["link",{href:n[1]},n[1]]]:[1,"<"]},"`":function(t){var n=t.match(/(`+)(([\s\S]*?)\1)/);return n&&n[2]?[n[1].length+n[2].length,["inlinecode",n[3]]]:[1,"`"]},"  \n":function(t){return[3,["linebreak"]]}},t.dialects.Gruber.inline["**"]=o("strong","**"),t.dialects.Gruber.inline.__=o("strong","__"),t.dialects.Gruber.inline["*"]=o("em","*"),t.dialects.Gruber.inline._=o("em","_"),t.buildBlockOrder=function(e){var t=[];for(var n in e){if(n=="__order__"||n=="__call__")continue;t.push(n)}e.__order__=t},t.buildInlinePatterns=function(e){var t=[];for(var n in e){if(n.match(/^__.*__$/))continue;var r=n.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");t.push(n.length==1?r:"(?:"+r+")")}t=t.join("|"),e.__patterns__=t;var i=e.__call__;e.__call__=function(e,n){return n!=undefined?i.call(this,e,n):i.call(this,e,t)}},t.DialectHelpers={},t.DialectHelpers.inline_until_char=function(e,t){var n=0,r=[];for(;;){if(e[n]==t)return n++,[n,r];if(n>=e.length)return null;res=this.dialect.inline.__oneElement__.call(this,e.substr(n)),n+=res[0],r.push.apply(r,res.slice(1))}},t.subclassDialect=function(e){function t(){}function n(){}return t.prototype=e.block,n.prototype=e.inline,{block:new t,inline:new n}},t.buildBlockOrder(t.dialects.Gruber.block),t.buildInlinePatterns(t.dialects.Gruber.inline),t.dialects.Maruku=t.subclassDialect(t.dialects.Gruber),t.dialects.Maruku.processMetaHash=function(t){var n=u(t),r={};for(var i=0;i<n.length;++i)if(/^#/.test(n[i]))r.id=n[i].substring(1);else if(/^\./.test(n[i]))r["class"]?r["class"]=r["class"]+n[i].replace(/./," "):r["class"]=n[i].substring(1);else if(/\=/.test(n[i])){var s=n[i].split(/\=/);r[s[0]]=s[1]}return r},t.dialects.Maruku.block.document_meta=function(t,n){if(t.lineNumber>1)return undefined;if(!t.match(/^(?:\w+:.*\n)*\w+:.*$/))return undefined;c(this.tree)||this.tree.splice(1,0,{});var r=t.split(/\n/);for(p in r){var i=r[p].match(/(\w+):\s*(.*)$/),s=i[1].toLowerCase(),o=i[2];this.tree[1][s]=o}return[]},t.dialects.Maruku.block.block_meta=function(t,n){var r=t.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!r)return undefined;var i=this.dialect.processMetaHash(r[2]),s;if(r[1]===""){var o=this.tree[this.tree.length-1];s=c(o);if(typeof o=="string")return undefined;s||(s={},o.splice(1,0,s));for(a in i)s[a]=i[a];return[]}var u=t.replace(/\n.*$/,""),f=this.processBlock(u,[]);s=c(f[0]),s||(s={},f[0].splice(1,0,s));for(a in i)s[a]=i[a];return f},t.dialects.Maruku.block.definition_list=function(t,n){var r=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,i=["dl"],s;if(!(a=t.match(r)))return undefined;var o=[t];while(n.length&&r.exec(n[0]))o.push(n.shift());for(var u=0;u<o.length;++u){var a=o[u].match(r),f=a[1].replace(/\n$/,"").split(/\n/),l=a[2].split(/\n:\s+/);for(s=0;s<f.length;++s)i.push(["dt",f[s]]);for(s=0;s<l.length;++s)i.push(["dd"].concat(this.processInline(l[s].replace(/(\n)\s+/,"$1"))))}return[i]},t.dialects.Maruku.inline["{:"]=function(t,n,r){if(!r.length)return[2,"{:"];var i=r[r.length-1];if(typeof i=="string")return[2,"{:"];var s=t.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!s)return[2,"{:"];var o=this.dialect.processMetaHash(s[1]),u=c(i);u||(u={},i.splice(1,0,u));for(var a in o)u[a]=o[a];return[s[0].length,""]},t.buildBlockOrder(t.dialects.Maruku.block),t.buildInlinePatterns(t.dialects.Maruku.inline);var f=Array.isArray||function(e){return Object.prototype.toString.call(e)=="[object Array]"},l;Array.prototype.forEach?l=function(e,t,n){return e.forEach(t,n)}:l=function(e,t,n){for(var r=0;r<e.length;r++)t.call(n||e,e[r],r,e)},e.renderJsonML=function(e,t){t=t||{},t.root=t.root||!1;var n=[];if(t.root)n.push(d(e));else{e.shift(),e.length&&typeof e[0]=="object"&&!(e[0]instanceof Array)&&e.shift();while(e.length)n.push(d(e.shift()))}return n.join("\n\n")}}(function(){return typeof exports=="undefined"?(window.markdown={},window.markdown):exports}()),define("markdown",function(e){return function(){var t,n;return t||e.markdown}}(this)),define("common/inherit",[],function(){return function(t,n){function r(){}r.prototype=n.prototype,t.prototype=new r,t.superClass=n.prototype,t.prototype.constructor=t}}),define("common/controllers/interactive-component",["require","common/controllers/interactive-metadata","common/validator"],function(e){function r(e,r,i){var s;this.component=n.validateCompleteness(t[e],r),this.$element=$("<div>").attr("id",r.id).addClass("component"),this.component.width&&this.$element.css("width",this.component.width),this.component.height&&this.$element.css("height",this.component.height),this.component.onClick&&(typeof this.component.onClick!="function"?s=i.makeFunctionInScriptContext(this.component.onClick):s=this.component.onClick,this.$element.on("click",s),this.$element.addClass("clickable")),this.component.classes&&this.component.classes.length&&this.$element.addClass(this.component.classes.join(" ")),this.component.tooltip&&this.$element.attr("title",this.component.tooltip)}var t=e("common/controllers/interactive-metadata"),n=e("common/validator");return r.prototype.getViewContainer=function(){return this.$element},r.prototype.serialize=function(){return this.component},r}),define("common/controllers/text-controller",["require","markdown","common/inherit","common/controllers/interactive-component"],function(e){function i(e,n){var i,s,o,u,a='class="opens-in-new-window" target="blank"';r.call(this,"text",e,n),this.$element.addClass("interactive-text"),this.$element.addClass("markdown-typography"),i=$.isArray(this.component.text)?this.component.text:[this.component.text],s=this.$element,o="",$.each(i,function(e,t){o+=t+"\n"}),u=t.toHTML(o),u=u.replace(/<a(.*?)>/g,"<a$1 "+a+">"),s.append(u)}var t=e("markdown"),n=e("common/inherit"),r=e("common/controllers/interactive-component");return n(i,r),i}),define("common/controllers/image-controller",["require","lab.config","common/inherit","common/controllers/interactive-component"],function(e){function o(e,t,n){var o=typeof Lab!="undefined"?Lab.config.actualRoot:"";r.call(this,"image",e,t),this._controller=n,this._$img=$("<img>"),this._externalUrl=i.test(this.component.src),this._resourcesUrl=s.test(this.component.src),this._externalUrl?this._$img.attr("src",this.component.src):this._resourcesUrl&&this._$img.attr("src",this.component.src.replace(s,o+"/resources/")),this.component.width!=="auto"&&this._$img.css("width","100%"),this.component.height!=="auto"&&this._$img.css("height","100%"),this._$img.appendTo(this.$element)}var t=e("lab.config"),n=e("common/inherit"),r=e("common/controllers/interactive-component"),i=/^https?:\/\//i,s=/^{resources}\//i;return n(o,r),o.prototype.modelLoadedCallback=function(){var e,n;this._externalUrl||(e=this.component.src,n=this._controller.getModelController().modelUrl,n=n.slice(0,n.lastIndexOf("/")+1),e=t.actualRoot+n+e,this._$img.attr("src",e))},o}),define("common/controllers/radio-controller",["common/controllers/interactive-metadata","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator");return function(r,i,s){function h(){var e=model.get(r.property),t,n;for(t=0,n=f.length;t<n;t++)f[t].value===e?(l[t].attr("checked",!0),c[t].addClass("checked")):(l[t].removeAttr("checked"),c[t].removeClass("checked"))}function p(e){var t=$(this).closest("span"),n=t.find("input"),r=t.find(".fakeCheckable"),i,s;e.preventDefault();if(n.attr("disabled")!==undefined)return;for(i=0,s=l.length;i<s;i++)l[i].removeAttr("checked"),c[i].removeClass("checked");n.attr("checked")!==undefined?(n.removeAttr("checked"),r.removeClass("checked")):(n.attr("checked","checked"),r.addClass("checked")),n.trigger("change")}function d(){var n,o,h,d,v,m;r=t.validateCompleteness(e.radio,r),f=r.options;for(v=0,m=f.length;v<m;v++)f[v]=t.validateCompleteness(e.radioOption,f[v]);u=$("<div>").attr("id",r.id),u.addClass("interactive-radio"),u.addClass("component"),u.addClass(r.orientation),r.label&&(h=$("<span>").text(r.label),h.addClass("label"),h.addClass(r.labelOn==="top"?"on-top":"on-left"),u.append(h));for(v=0,m=f.length;v<m;v++)d=f[v],n=$("<input>").attr("type","radio").attr("name",r.id).attr("tabindex",s.getNextTabIndex()).attr("id",r.id+"-"+v),l.push(n),h=$("<label>").attr("for",r.id+"-"+v).text(d.text),o=$('<div class="fakeCheckable">'),c.push(o),d.disabled&&(n.attr("disabled",d.disabled),o.addClass("disabled")),d.selected&&(n.attr("checked",d.selected),o.addClass("checked")),a=$("<span>").addClass("option").append(n).append(o).append(h),u.append(a),o.on("touchstart click",p),h.on("touchstart click",p),n.change(function(e){return function(){e.action?i.makeFunctionInScriptContext(e.action)():e.loadModel?(model.stop(),s.loadModel(e.loadModel)):e.value!==undefined&&model.set(r.property,e.value)}}(d))}var o,u,a,f,l=[],c=[];return o={modelLoadedCallback:function(){r.property!==undefined&&(model.addPropertiesListener([r.property],h),h())},getViewContainer:function(){return u},serialize:function(){var e,t;if(r.property===undefined)for(e=0,t=f.length;e<t;e++)l[e].attr("checked")?f[e].selected=!0:delete f[e].selected;return $.extend(!0,{},r)}},d(),o}}),define("common/controllers/slider-controller",["common/controllers/interactive-metadata","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator");return function(r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T=function(){var e=model.get(f);w.slider("value",e),d&&E.text(d(e))};x={modelLoadedCallback:function(){f&&model.addPropertiesListener([f],T),c!==undefined&&c!==null?l&&(w.slider("value",c),l(c),d&&E.text(d(c))):f&&T()},getViewContainer:function(){return g},resize:function(){var e,t;r.height!=="auto"&&(e=g.height()-y.outerHeight(!0),b!==undefined&&(e-=b.outerHeight(!0)),S.css("height",e),w.css("top",.5*e),t=parseFloat(E.css("font-size")),E.css("height",e+t*.4),E.css("top",-0.5*e-t*.4))},serialize:function(){var e=$.extend(!0,{},r);return f||(e.initialValue=w.slider("value")),e}},r=t.validateCompleteness(e.slider,r),o=r.min,u=r.max,a=r.steps,l=r.action,f=r.property,c=r.initialValue,h=r.title,p=r.labels,d=r.displayValue,o===undefined&&(o=0),u===undefined&&(u=10),a===undefined&&(a=10),y=$('<p class="title">'+h+"</p>"),S=$('<div class="container">'),w=$('<div class="html-slider">').attr("id",r.id),w.appendTo(S),w.slider({min:o,max:u,step:(u-o)/a}),E=w.find(".ui-slider-handle"),E.attr("tabindex",s.getNextTabIndex()),g=$('<div class="interactive-slider">').append(y).append(S),g.addClass("component");for(v=0;v<p.length;v++)m=p[v],b=$('<p class="label">'+m.label+"</p>"),b.css("left",(m.value-o)/(u-o)*100+"%"),S.append(b);return l&&(l=i.makeFunctionInScriptContext("value",l),w.bind("slide",function(e,t){l(t.value),d&&E.text(d(t.value))})),f&&w.bind("slide",function(e,t){var n={};n[f]=t.value,model&&model.set(n),d&&E.text(d(t.value))}),d&&(d=i.makeFunctionInScriptContext("value",d)),g.css({width:r.width,height:r.height}),r.width==="auto"&&g.css("min-width","12em"),x.resize(),x}}),define("common/controllers/pulldown-controller",["common/controllers/interactive-metadata","common/validator","common/jquery-plugins"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator");return require("common/jquery-plugins"),function(r,i,s){function p(){h=!0,a.data("selectBox-selectBoxIt").selectOption(model.get(r.property).toString())}function d(){function b(e){var t=parseFloat(n.css("font-size"));return e/t}var n=s.interactiveContainer,o,p,d,v,m,g,y;r=t.validateCompleteness(e.pulldown,r),l=r.options;for(m=0,g=l.length;m<g;m++)l[m]=t.validateCompleteness(e.pulldownOption,l[m]);a=$("<select>");for(m=0,g=l.length;m<g;m++)y=l[m],f=$("<option>").html(y.text),c.push(f),y.disabled&&f.prop("disabled",y.disabled),y.selected&&f.prop("selected",y.selected),typeof y.value!="undefined"&&f.prop("value",y.value),a.append(f);a.change(function(){if(h){h=!1;return}var e=$(this).prop("selectedIndex"),t=r.options[e].action,n=r.options[e].value;t?i.makeFunctionInScriptContext(t)():r.options[e].loadModel?(model.stop(),s.loadModel(r.options[e].loadModel)):n!==undefined&&model.set(r.property,n)}),u=$("<div>").attr("id",r.id).addClass("interactive-pulldown").addClass("component"),r.label&&(o=$("<span>").text(r.label),o.addClass("label"),o.addClass(r.labelOn==="top"?"on-top":"on-left"),u.append(o)),u.append(a),a.selectBoxIt(),u.find(".selectboxit").css("width","auto"),u.find(".selectboxit-text").css("max-width","none"),p=u.measure(function(){return this.width()},"ul",n),d=u.measure(function(){return this.width()},".selectboxit-arrow-container",n),v=b(p+d)+.3+"em",u.find(".selectboxit").css("width",v),u.find(".selectboxit-text").css("max-width",b(p)+"em"),u.find(".selectboxit-container select").css({width:v,height:"100%"})}var o,u,a,f,l,c=[],h=!1;return o={modelLoadedCallback:function(){r.property!==undefined&&(model.addPropertiesListener([r.property],p),p())},getViewContainer:function(){return u},serialize:function(){var e,t;if(r.property===undefined)for(e=0,t=l.length;e<t;e++)c[e].prop("selected")?l[e].selected=!0:delete l[e].selected;return $.extend(!0,{},r)}},d(),o}}),define("common/controllers/numeric-output-controller",["common/controllers/interactive-metadata","common/validator"],function(){var e=require("common/controllers/interactive-metadata"),t=require("common/validator");return function(r,i){var s,o,u,a,f,l,c,h,p,d,v=function(){var e=model.get(s);a?c.text(a(e)):c.text(e)};return r=t.validateCompleteness(e.numericOutput,r),s=r.property,o=r.label,u=r.units,a=r.displayValue,l=$('<span class="label"></span>'),$output=$('<span class="output"></span>'),c=$('<span class="value"></span>'),h=$('<span class="units"></span>'),o&&l.html(o),u&&h.html(u),f=$('<div class="numeric-output">').attr("id",r.id).append(l).append($output.append(c).append(h)),f.addClass("component"),f.addClass(r.orientation),f.css({width:r.width,height:r.height}),a&&(a=i.makeFunctionInScriptContext("value",a)),d={modelLoadedCallback:function(){s&&(p=model.getPropertyDescription(s),p&&(o||l.html(p.getLabel()),u||h.html(p.getUnitAbbreviation())),v(),model.addPropertiesListener([s],v))},getViewContainer:function(){return f},serialize:function(){return $.extend(!0,{},r)}},d}}),define("common/parent-message-controller",[],function(){function r(e,t){Lab.structuredClone.supported()?window.parent.postMessage(e,t):window.parent.postMessage(JSON.stringify(e),t)}function i(t){r(t,e)}function s(e){r(e,"*")}function o(e,n){t[e]=n}function u(){t={}}function a(){return Object.keys(t)}function f(n){if(n.source!==window.parent)return;var r=n.data;typeof r=="string"&&(r=JSON.parse(r)),e||r.type==="hello"&&(e=r.origin),n.origin===e&&t[r.type]&&t[r.type](r)}function l(){if(window.parent===window)return;s({type:"hello",origin:document.location.href.match(/(.*?\/\/.*?)\//)[1]}),window.addEventListener("message",f,!1)}var e,t={},n;return n={initialize:l,getListenerNames:a,addListener:o,removeAllListeners:u,post:i}}),define("common/controllers/parent-message-api",["require","common/parent-message-controller"],function(e){var t=e("common/parent-message-controller");return function(e,n,r){function i(n){t.post({type:"propertyValue",name:n,values:e.get(n)})}t.removeAllListeners(),t.addListener("setFocus",function(e){n&&n.setFocus&&n.setFocus()}),t.addListener("getModelSnapshot",function(){var e=r.modelController.modelContainer.$el;typeof window.getDomSnapshot=="function"&&window.getDomSnapshot(e,null,function(e){t.post({type:"png",values:e})})}),t.addListener("getInteractiveSnapshot",function(){typeof window.getDomSnapshot=="function"&&window.getDomSnapshot(r.interactiveContainer.parent(),null,function(e){t.post({type:"png",values:e})})}),t.addListener("loadInteractive",function(e){r&&r.loadInteractive&&r.loadInteractive(e.data)}),t.addListener("loadModel",function(e){r&&r.loadModel&&r.loadModel(e.data.modelId,e.data.modelObject)}),t.addListener("getModelState",function(e){r&&r.getModelController&&t.post({type:"modelState",values:r.getModelController().state()})}),t.addListener("getInteractiveState",function(e){r&&r.getModelController&&t.post({type:"interactiveState",values:r.serialize()})}),t.addListener("runBenchmarks",function(){var e;r&&r.getModelController&&(e=r.getModelController(),benchmark.bench(e.benchmarks,function(n){console.log(n),t.post({type:"returnBenchmarks",values:{results:n,benchmarks:e.benchmarks}},function(){},function(){})}))}),t.addListener("listenForDispatchEvent",function(n){var r=n.eventName,i=n.properties,s={},o=0,u=null;e.on(r,function(){if(i)for(o=0;o<i.length;o++)u=i[o],s[u]=e.get(u);t.post({type:r,values:s})})}),t.addListener("removeListenerForDispatchEvent",function(t){var n=t.eventName,r=t.properties,i={},s=0,o=null;e.on(n,null)}),t.addListener("get",function(e){i(e.propertyName)}),t.addListener("observe",function(t){e.addPropertiesListener(t.propertyName,function(){i(t.propertyName)}),i(t.propertyName)}),t.addListener("set",function(t){var n={};n[t.propertyName]=t.propertyValue,e.set(n)}),t.addListener("tick",function(t){e.tick(t.numTimes)}),t.addListener("play",function(t){e.start()}),t.initialize()}}),function(e,t){typeof exports=="object"&&exports?module.exports=t:typeof define=="function"&&define.amd?define("mustache",t):e.Mustache=t}(this,function(){function u(e,t){return RegExp.prototype.test.call(e,t)}function a(e){return!u(r,e)}function l(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function h(e){return String(e).replace(/[&<>"'\/]/g,function(e){return c[e]})}function p(e){this.string=e,this.tail=e,this.pos=0}function d(e,t){this.view=e,this.parent=t,this.clearCache()}function v(){this.clearCache()}function m(e){function n(e,n,r){if(!t[e]){var i=m(n);t[e]=function(e,t){return i(e,t,r)}}return t[e]}var t={};return function(t,r,i){var s="",o,u;for(var a=0,f=e.length;a<f;++a){o=e[a];switch(o[0]){case"#":u=i.slice(o[3],o[5]),s+=t._section(o[1],r,u,n(a,o[4],i));break;case"^":s+=t._inverted(o[1],r,n(a,o[4],i));break;case">":s+=t._partial(o[1],r);break;case"&":s+=t._name(o[1],r);break;case"name":s+=t._escaped(o[1],r);break;case"text":s+=o[1]}}return s}}function g(e){var t=[],n=t,r=[],i;for(var s=0,o=e.length;s<o;++s){i=e[s];switch(i[0]){case"#":case"^":r.push(i),n.push(i),n=i[4]=[];break;case"/":var u=r.pop();u[5]=i[2],n=r.length>0?r[r.length-1][4]:t;break;default:n.push(i)}}return t}function y(e){var t=[],n,r;for(var i=0,s=e.length;i<s;++i)n=e[i],n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(r=n,t.push(n));return t}function b(e){return[new RegExp(l(e[0])+"\\s*"),new RegExp("\\s*"+l(e[1]))]}var e={};e.name="mustache.js",e.version="0.7.2",e.tags=["{{","}}"],e.Scanner=p,e.Context=d,e.Writer=v;var t=/\s*/,n=/\s+/,r=/\S/,i=/\s*=/,s=/\s*\}/,o=/#|\^|\/|>|\{|&|=|!/,f=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};e.escape=h,p.prototype.eos=function(){return this.tail===""},p.prototype.scan=function(e){var t=this.tail.match(e);return t&&t.index===0?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},p.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},d.make=function(e){return e instanceof d?e:new d(e)},d.prototype.clearCache=function(){this._cache={}},d.prototype.push=function(e){return new d(e,this)},d.prototype.lookup=function(e){var t=this._cache[e];if(!t){if(e===".")t=this.view;else{var n=this;while(n){if(e.indexOf(".")>0){var r=e.split("."),i=0;t=n.view;while(t&&i<r.length)t=t[r[i++]]}else t=n.view[e];if(t!=null)break;n=n.parent}}this._cache[e]=t}return typeof t=="function"&&(t=t.call(this.view)),t},v.prototype.clearCache=function(){this._cache={},this._partialCache={}},v.prototype.compile=function(t,n){var r=this._cache[t];if(!r){var i=e.parse(t,n);r=this._cache[t]=this.compileTokens(i,t)}return r},v.prototype.compilePartial=function(e,t,n){var r=this.compile(t,n);return this._partialCache[e]=r,r},v.prototype.compileTokens=function(e,t){var n=m(e),r=this;return function(e,i){if(i)if(typeof i=="function")r._loadPartial=i;else for(var s in i)r.compilePartial(s,i[s]);return n(r,d.make(e),t)}},v.prototype.render=function(e,t,n){return this.compile(e)(t,n)},v.prototype._section=function(e,t,n,r){var i=t.lookup(e);switch(typeof i){case"object":if(f(i)){var s="";for(var o=0,u=i.length;o<u;++o)s+=r(this,t.push(i[o]));return s}return i?r(this,t.push(i)):"";case"function":var a=this,l=function(e){return a.render(e,t)},c=i.call(t.view,n,l);return c!=null?c:"";default:if(i)return r(this,t)}return""},v.prototype._inverted=function(e,t,n){var r=t.lookup(e);return!r||f(r)&&r.length===0?n(this,t):""},v.prototype._partial=function(e,t){!(e in this._partialCache)&&this._loadPartial&&this.compilePartial(e,this._loadPartial(e));var n=this._partialCache[e];return n?n(t):""},v.prototype._name=function(e,t){var n=t.lookup(e);return typeof n=="function"&&(n=n.call(t.view)),n==null?"":String(n)},v.prototype._escaped=function(t,n){return e.escape(this._name(t,n))},e.parse=function(r,u){function E(){if(m&&!w)while(v.length)d.splice(v.pop(),1);else v=[];m=!1,w=!1}r=r||"",u=u||e.tags,typeof u=="string"&&(u=u.split(n));if(u.length!==2)throw new Error("Invalid tags: "+u.join(", "));var f=b(u),c=new p(r),h=[],d=[],v=[],m=!1,w=!1,S,x,T,N;while(!c.eos()){S=c.pos,T=c.scanUntil(f[0]);if(T)for(var C=0,k=T.length;C<k;++C)N=T.charAt(C),a(N)?v.push(d.length):w=!0,d.push(["text",N,S,S+1]),S+=1,N==="\n"&&E();S=c.pos;if(!c.scan(f[0]))break;m=!0,x=c.scan(o)||"name",c.scan(t);if(x==="=")T=c.scanUntil(i),c.scan(i),c.scanUntil(f[1]);else if(x==="{"){var L=new RegExp("\\s*"+l("}"+u[1]));T=c.scanUntil(L),c.scan(s),c.scanUntil(f[1]),x="&"}else T=c.scanUntil(f[1]);if(!c.scan(f[1]))throw new Error("Unclosed tag at "+c.pos);if(x==="/"){if(h.length===0)throw new Error('Unopened section "'+T+'" at '+S);var A=h.pop();if(A[1]!==T)throw new Error('Unclosed section "'+A[1]+'" at '+S)}var O=[x,T,S,c.pos];d.push(O);if(x==="#"||x==="^")h.push(O);else if(x==="name"||x==="{"||x==="&")w=!0;else if(x==="="){u=T.split(n);if(u.length!==2)throw new Error("Invalid tags at "+S+": "+u.join(", "));f=b(u)}}var A=h.pop();if(A)throw new Error('Unclosed section "'+A[1]+'" at '+c.pos);return g(y(d))};var w=new v;return e.clearCache=function(){return w.clearCache()},e.compile=function(e,t){return w.compile(e,t)},e.compilePartial=function(e,t,n){return w.compilePartial(e,t,n)},e.compileTokens=function(e,t){return w.compileTokens(e,t)},e.render=function(e,t,n){return w.render(e,t,n)},e.to_html=function(t,n,r,i){var s=e.render(t,n,r);if(typeof i!="function")return s;i(s)},e}()),define("text",["module"],function(e){"use strict";var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};return t={version:"2.0.2",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+"."+s.ext,h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.moduleName+"."+o.ext,a=r.toUrl(o.moduleName+"."+o.ext)+".js";t.load(u,r,function(n){var r=function(e){return i(a,e)};r.asModule=function(e,t){return i.asModule(e,a,t)},t.write(e,u,r,s)},s)}},typeof process!="undefined"&&process.versions&&!!process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)}):typeof Packages!="undefined"&&typeof java!="undefined"?t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)}:t.createXhr()&&(t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),c.onXhr&&c.onXhr(i,e),i.onreadystatechange=function(t){var s,o;i.readyState===4&&(s=i.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=i,r(o)):n(i.responseText))},i.send(null)}),t}),define("text!common/controllers/thermometer.tpl",[],function(){return'<div class="interactive-thermometer component" id="{{id}}">\n  <div class="thermometer-main-container">\n    <div class="thermometer">\n      <div class="thermometer-fill"></div>\n    </div>\n    <p class="label">{{labelText}}</p>\n  </div>\n  <div class="labels-container">\n    {{#labels}}\n      <span class="value-label" style="bottom: {{position}}">{{label}}</span>\n    {{/labels}}\n  </div>\n</div>'}),define("common/controllers/thermometer-controller",["require","mustache","text!common/controllers/thermometer.tpl","common/controllers/interactive-metadata","common/validator","common/jquery-plugins"],function(e){var t=e("mustache"),n=e("text!common/controllers/thermometer.tpl"),r=e("common/controllers/interactive-metadata"),i=e("common/validator");return e("common/jquery-plugins"),function(s,o,u){function S(){var e,o,b,w,E,S,x,T,N,C,k,L;s=i.validateCompleteness(r.thermometer,s),e=s.reading,a=e.units,o=e.offset,b=e.scale,f=e.digits,C=s.min,N=s.max,l=function(e){return b*e+o},c=function(e){return(e-C)/(N-C)*100+"%"},h=s.labelIsReading,E=h?"":"Thermometer",w={id:s.id,labelText:h?"":"Thermometer"},S=s.labels,T=-Infinity,w.labels=[];for(k=0,L=S.length;k<L;k++)w.labels.push({label:S[k].label,position:c(l(S[k].value))}),S[k].label.length>T&&(T=S[k].label.length,x=k);d=$(t.render(n,w)),v=d.find(".thermometer"),m=d.find(".thermometer-fill"),g=d.find(".label"),y=d.find(".labels-container"),T=d.measure(function(){return this.width()/parseFloat(this.css("font-size"))+"em"},".value-label:eq("+x+")",u.interactiveContainer),y.css("width",T),d.css("height",s.height),p=!1,/%$/.test(s.width)?(d.css("width",s.width),p=!0):v.css("width",s.width)}var a,f,l,c,h,p,d,v,m,g,y,b,w=function(e){e=l(e),g.text(e.toFixed(f)+" "+a)},E=function(){var e=model.get("targetTemperature");m.css("height",c(l(e))),h&&w(e)};return b={modelLoadedCallback:function(){model.addPropertiesListener("targetTemperature",function(){E()}),E()},getViewContainer:function(){return d},resize:function(){var e=d.height()-g.height();v.height(e),y.height(e),p&&v.width(d.width()-y.width())},serialize:function(){return s}},S(),b}}),define("common/controllers/playback-controller",["require","common/inherit","common/controllers/interactive-component"],function(e){function r(e,t){n.call(this,"playback",e,t),this.$element.addClass("interactive-playback"),this._modelStopped=!0,this._modelPlayable=!0
,this._showClock=!0,this._timeDesc=null,this._$reset=$('<a class="reset"><i class="icon-step-backward"></i></a>').appendTo(this.$element),this._$playPause=$('<a class="play-pause"><i class="icon-play"></i><i class="icon-pause"></i></a>').appendTo(this.$element),this._$timeDisplay=$('<span class="time-display">').appendTo(this._$playPause),this._$stepBackward=$('<a class="step"><i class="icon-backward"></i></a>').insertBefore(this._$playPause),this._$stepForward=$('<a class="step"><i class="icon-forward"></i></a>').insertAfter(this._$playPause),this._$reset.after('<div class="spacer reset">'),this._$stepBackward.after('<div class="spacer step">'),this._$stepForward.before('<div class="spacer step">'),this._$reset.on("click",function(){t.api.reset()}),this._$playPause.on("click",$.proxy(function(){this._modelStopped?this._modelPlayable&&t.api.start():t.api.stop()},this)),this._$stepBackward.on("click",function(){t.api.stepBack()}),this._$stepForward.on("click",function(){t.api.stepForward()})}var t=e("common/inherit"),n=e("common/controllers/interactive-component");return t(r,n),r.prototype._simulationStateChanged=function(){this._modelStopped=model.isStopped(),this._modelStopped?this._$playPause.removeClass("playing"):this._$playPause.addClass("playing"),this._modelPlayable=model.properties.isPlayable===!1?!1:!0,this._modelPlayable?this._$playPause.removeClass("disabled"):this._$playPause.addClass("disabled")},r.prototype._showClockChanged=function(){this._showClock=model.get("showClock"),this._showClock?(this._$playPause.addClass("with-clock"),this._timeDesc=model.getPropertyDescription("displayTime"),this._timeChanged()):this._$playPause.removeClass("with-clock")},r.prototype._timeChanged=function(){if(!this._showClock)return;this._$timeDisplay.html(this._timeDesc.format(model.get("displayTime")))},r.prototype._displayModeChanged=function(){var e=model.get("controlButtons"),t;e?e==="play"?(this.$element.find(".play-pause").removeClass("hidden"),this.$element.find(".spacer, .step, .reset").addClass("hidden")):e==="reset"?(this.$element.find(".reset").removeClass("hidden"),this.$element.find(".spacer, .play-pause, .step").addClass("hidden")):e==="play_reset"?(this.$element.find(".spacer, .play-pause, .reset").removeClass("hidden"),this.$element.find(".step").addClass("hidden")):e==="play_reset_step"&&this.$element.find(".spacer, .step, .reset, .play-pause").removeClass("hidden"):this.$element.find(".step, .reset, .play-pause").addClass("hidden"),t=this.$element.find("a"),t.removeClass("first"),t.removeClass("last"),t=t.not(".hidden"),t.first().addClass("first"),t.last().addClass("last")},r.prototype.modelLoadedCallback=function(){model.on("play."+this.component.id,$.proxy(this._simulationStateChanged,this)),model.on("stop."+this.component.id,$.proxy(this._simulationStateChanged,this)),model.addPropertiesListener(["isPlayable"],$.proxy(this._simulationStateChanged,this)),this._simulationStateChanged(),model.addPropertiesListener(["showClock"],$.proxy(this._showClockChanged,this)),model.addPropertiesListener(["displayTime"],$.proxy(this._timeChanged,this)),this._showClockChanged(),model.addPropertiesListener(["controlButtons"],$.proxy(this._displayModeChanged,this)),this._displayModeChanged()},r}),define("common/controllers/div-controller",["require","common/inherit","common/controllers/interactive-component"],function(e){function r(e,t){n.call(this,"div",e)}var t=e("common/inherit"),n=e("common/controllers/interactive-component");return t(r,n),r}),define("common/controllers/setup-banner",["lab.config","common/controllers/text-controller","common/controllers/image-controller","common/controllers/div-controller","common/controllers/playback-controller"],function(){var e=require("lab.config"),t=require("common/controllers/text-controller"),n=require("common/controllers/image-controller"),r=require("common/controllers/div-controller"),i=require("common/controllers/playback-controller"),s=1.5,o=s*.65,u=s/10;return function(f,l,c,h,p){function w(e,s){var o;e.type==="text"?o=t:e.type==="image"?o=n:e.type==="div"?o=r:e.type==="playback"&&(o=i),d[e.id]=new o(e,f),v.push(s),m[s.id]=[e.id]}function E(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement?!0:~$(".fullscreen").css("background-image").indexOf("exit")}var d={},v=[],m={},g=l.about||l.subtitle,y,b;return v.push({id:"top-bar",top:"0",left:"0",height:s+"em","padding-top":u+"em","padding-bottom":u+"em",width:"container.width",aboveOthers:!0}),v.push({id:"bottom-bar",bottom:"container.height",left:"0",width:"container.width",height:"2.5em",belowOthers:!0}),h.update(l),w({type:"text",id:"about-link",text:"About",onClick:function(){g?h.open():c.open()}},{id:"banner-right",fontScale:o,top:"0",height:s+"em","padding-top":u+"em","padding-bottom":u+"em",right:"interactive.width","padding-left":"1em","padding-right":"0.75em",align:"right",aboveOthers:!0}),e.sharing&&(p.update(l),w({type:"text",id:"share-link",text:"Share",onClick:function(){p.open()}},{id:"banner-middle",fontScale:o,top:"0",height:s+"em","padding-top":u+"em","padding-bottom":u+"em",right:"banner-right.left","padding-right":"1em",align:"right",aboveOthers:!0})),c.update(l),w({type:"div",id:"credits-link",height:"2.5em",width:"8.1em",classes:["credits"],tooltip:"Credits",onClick:function(){c.open()}},{id:"banner-bottom-left",bottom:"container.height",left:"0","padding-left":"0.3em",align:"left",belowOthers:!0}),y=document.body,b=y.requestFullScreen||y.webkitRequestFullScreen||y.mozRequestFullScreen||y.msRequestFullScreen,document.cancelFullscreenMethod=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msCancelFullScreen,b&&w({type:"div",id:"fullsize-link",height:"2.5em",width:"2.5em",classes:["fullscreen"],tooltip:"Open interactive in full-screen mode",onClick:function(){E()?document.cancelFullscreenMethod():b.call(y)}},{id:"banner-bottom-right",bottom:"container.height",right:"container.width",align:"left","padding-left":"1em",belowOthers:!0}),w({type:"playback",id:"playback"},{id:"interactive-playback-container",bottom:"container.height",left:"container.width/2 - interactive-playback-container.width/2",height:"banner-bottom-left.height",belowOthers:!0}),{components:d,template:v,layout:m}}}),define("common/controllers/basic-dialog",[],function(){function t(t){this.$element=$("<div>"),this.$element.dialog($.extend({},e,t))}var e={autoOpen:!1,dialogClass:"interactive-dialog",appendTo:"#responsive-content",width:"80%"};return t.prototype.open=function(){this.$element.dialog("open")},t.prototype.set=function(e,t){this.$element.dialog("option",e,t)},t.prototype.setContent=function(e){this.$element.empty(),this.$element.append('<input type="hidden" autofocus="autofocus" />'),this.$element.append(e)},t}),define("common/controllers/about-dialog",["require","arrays","markdown","common/inherit","common/controllers/basic-dialog"],function(e){function s(){i.call(this,{dialogClass:"about-dialog"})}var t=e("arrays"),n=e("markdown"),r=e("common/inherit"),i=e("common/controllers/basic-dialog");return r(s,i),s.prototype.update=function(e){var r=$("<div>"),i,s,o,u='class="opens-in-new-window" target="blank"';this.set("title","About: "+e.title),r.addClass("markdown-typography"),e.subtitle&&(o=n.toHTML(e.subtitle),o=o.replace(/<a(.*?)>/,"<a$1 "+u+">"),r.append(o)),i=t.isArray(e.about)?e.about:[e.about],s="",$.each(i,function(e,t){s+=t+"\n"}),o=n.toHTML(s),o=o.replace(/<a(.*?)>/g,"<a$1 "+u+">"),r.append(o),this.setContent(r)},s}),define("text!common/controllers/share-dialog.tpl",[],function(){return"<div>\n  <h2>\n    Paste this\n    <a class='opens-in-new-window' href='{{embeddableSharingUrl}}' target='_blank'>link</a>\n    in email or IM.\n  </h2>\n  <textarea>{{embeddableSharingUrl}}</textarea>\n  <h2>Paste HTML to embed in website or blog.</h2>\n  <p>Select Size:\n    <select id='iframe-size'>\n      <option value='smaller'>30% smaller</option>\n      <option selected value='actual'>actual</option>\n      <option value='larger'>50% larger</option>\n    </select>\n  </p>\n  <textarea id='share-iframe-content'></textarea>\n  {{> copyright}}\n</div>\n"}),define("text!common/controllers/copyright.tpl",[],function(){return'<div class="copyright-section"><strong>Copyright © 2013&nbsp;</strong><a class="opens-in-new-window" href="http://concord.org" id="share-license-link" target="_blank">The Concord Consortium</a>. All rights reserved. The software is licensed under&nbsp;<a class="opens-in-new-window" href="http://opensource.org/licenses/BSD-2-Clause" id="share-license-link" target="_blank">Simplified BSD</a>, <a class="opens-in-new-window" href="http://opensource.org/licenses/MIT" id="share-license-link" target="_blank">MIT</a> or <a class="opens-in-new-window" href="http://opensource.org/licenses/Apache-2.0" id="share-license-link" target="_blank">Apache 2.0</a> licenses. Please provide attribution to the Concord Consortium and the URL&nbsp;<a class="opens-in-new-window" href="http://concord.org/" id="share-license-link" target="_blank">http://concord.org</a>.</div>'}),define("common/controllers/share-dialog",["require","lab.config","mustache","common/inherit","common/controllers/basic-dialog","text!common/controllers/share-dialog.tpl","text!common/controllers/copyright.tpl"],function(e){function f(){var e=u.hash,r=u.href.match(/(.*?\/\/.*?)\//)[1],a=u.pathname.replace(/\/[^\/]+$/,"/embeddable.html");i.call(this,{dialogClass:"share-dialog"}),this._view={},t.homeForSharing?this._view.embeddableSharingUrl=t.homeForSharing+t.homeEmbeddablePath+e:this._view.embeddableSharingUrl=r+a+e,this.setContent(n.render(s,this._view,{copyright:o})),this._$interactiveContainer=$("#responsive-content"),this._$iframeSize=this.$element.find("#iframe-size"),this._$iframeContent=this.$element.find("#share-iframe-content"),this._$iframeSize.on("change",$.proxy(this.updateIframeSize,this)),this.updateIframeSize()}var t=e("lab.config"),n=e("mustache"),r=e("common/inherit"),i=e("common/controllers/basic-dialog"),s=e("text!common/controllers/share-dialog.tpl"),o=e("text!common/controllers/copyright.tpl"),u=document.location,a=n.compile('<iframe width="{{width}}px" height="{{height}}px" frameborder="no" scrolling="no" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true" src="{{{embeddableSharingUrl}}}"></iframe>');return r(f,i),f.prototype.updateIframeSize=function(){var e=this._$interactiveContainer.innerWidth(),t=this._$interactiveContainer.innerHeight(),n=this._$iframeSize.val();switch(n){case"smaller":this._view.width=Math.floor(e*.7),this._view.height=Math.floor(t*.7);break;case"larger":this._view.width=Math.floor(e*1.5),this._view.height=Math.floor(t*1.5);break;default:this._view.width=e,this._view.height=t}this._$iframeContent.val(a(this._view))},f.prototype.update=function(e){this.set("title","Share: "+e.title)},f}),define("text!common/controllers/credits-dialog.tpl",[],function(){return'<div>\n  <p>\n    This interactive was created by the <a href="{{concordUrl}}" target="_blank">Concord Consortium</a>\n    using our <a href="{{nextGenUrl}}" target="_blank">Next-Generation Molecular Workbench</a> software,\n    with funding by a grant from <a href="http://www.google.org/" target="_blank">Google.org</a>.\n   </p>\n   {{#showShareable}}\n   <p>\n      Find a <a href="{{interactiveCreditsUrl}}" class="opens-in-new-window" target="_blank">shareable version</a>\n      of this interactive along with dozens of other open-source interactives for science, math and engineering at\n      <a href="{{concordUrl}}" class="opens-in-new-window" target="_blank">concord.org</a>.\n    </p>\n    {{/showShareable}}\n  {{> copyright}}\n</div>\n'}),define("common/controllers/credits-dialog",["require","lab.config","mustache","common/inherit","common/controllers/basic-dialog","text!common/controllers/credits-dialog.tpl","text!common/controllers/copyright.tpl"],function(e){function u(){i.call(this,{dialogClass:"credits-dialog"})}var t=e("lab.config"),n=e("mustache"),r=e("common/inherit"),i=e("common/controllers/basic-dialog"),s=e("text!common/controllers/credits-dialog.tpl"),o=e("text!common/controllers/copyright.tpl");return r(u,i),u.prototype.update=function(e){var r={concordUrl:"http://concord.org",nextGenUrl:"http://mw.concord.org/nextgen/"},i=document.location.hash,u;this.set("title","Credits: "+e.title),t.homeForSharing?r.interactiveCreditsUrl=t.homeForSharing+t.homeEmbeddablePath+i:r.interactiveCreditsUrl=t.home+t.homeEmbeddablePath+i,t.utmCampaign&&(u="utm_source="+encodeURIComponent(e.title.replace(/ /gi,"+"))+"&utm_medium=embedded_interactive&utm_campaign="+t.utmCampaign,r.concordUrl+="?"+u,r.nextGenUrl+="?"+u,r.interactiveCreditsUrl+="&"+encodeURI("utm_source=embed_link&utm_medium=embedded_interactive&utm_campaign="+t.utmCampaign)),t.sharing||(r.showShareable=!0),this.setContent(n.render(s,r,{copyright:o}))},u}),define("common/layout/semantic-layout-config",[],function(){return{iterationsLimit:35,minModelWidth:150,minFontSize:.65,canonicalFontSize:.9,canonicalInteractiveWidth:600,canonicalInteractiveHeight:420,containerColors:["rgba(0,0,255,0.1)","rgba(255,0,0,0.1)","rgba(0,255,0,0.1)","rgba(255,255,0,0.1)","rgba(0,255,255,0.1)","rgba(255,255,128,0.1)","rgba(128,255,0,0.1)","rgba(255,128,0,0.1)"]}}),define("common/layout/semantic-layout",["require","lab.config","common/layout/semantic-layout-config","arrays","common/console","common/alert"],function(require){var labConfig=require("lab.config"),layoutConfig=require("common/layout/semantic-layout-config"),arrays=require("arrays"),console=require("common/console"),alert=require("common/alert");return function SemanticLayout($interactiveContainer){function reset(){modelWidth=layoutConfig.minModelWidth,modelTop=0,modelLeft=0,topBoundary=0,leftBoundary=0,bottomBarWidth=0}function getDimensionOfContainer(e,t){var n=e.position();switch(t){case"top":return n.top;case"bottom":return n.top+e.outerHeight();case"left":return n.left;case"right":return n.left+e.outerWidth();case"height":return e.outerHeight();case"width":return e.outerWidth()}}function setFontSize(){var e=$interactiveContainer.width()/$interactiveContainer.height(),t,n;interactiveAspectRatio<=e?t=$interactiveContainer.height()/basicInteractiveHeight:t=$interactiveContainer.width()/basicInteractiveWidth,padding=t*10,n=layoutConfig.canonicalFontSize*fontScale*t,n<layoutConfig.minFontSize&&(n=layoutConfig.minFontSize),$("#responsive-content").css("font-size",n+"em")}function setupBackground(){var e=layoutConfig.containerColors,t,n,r;for(n=0,r=containerSpecList.length;n<r;n++)t=containerSpecList[n].id,$containerByID[t].css("background",labConfig.authoring?e[n%e.length]:"")}function createContainers(){var e,t,n,r,i;$interactiveContainer.empty(),$containerByID={},containerSpecByID={};for(r=0,i=containerSpecList.length;r<i;r++){e=containerSpecList[r],t=e.id,containerSpecByID[t]=e,$containerByID[t]=$("<div id='"+t+"'>").appendTo($interactiveContainer),$containerByID[t].css({display:"inline-block",position:"absolute","z-index":"1"}),e.width===undefined&&$containerByID[t].css("white-space","nowrap");for(n in e){if(!e.hasOwnProperty(n))continue;/^padding-/.test(n)?$containerByID[t].css(n,e[n]):n==="align"?$containerByID[t].css("text-align",e[n]):n==="min-width"?$containerByID[t].css("min-width",e[n]):n==="fontScale"&&$containerByID[t].css("font-size",e[n]+"em")}}}function placeComponentsInContainers(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;a=$.extend({},componentByID);for(t in containersContent){if(!containersContent.hasOwnProperty(t))continue;if(!$containerByID[t]){f="Incorrect layout definition - '"+t+"' container does not exist.",alert(f);continue}n=containersContent[t];if(!arrays.isArray(n)){f="Incorrect layout definition for '"+t+"' container. It should specify "+"an array of components or an array of arrays of components (multiple rows).",alert(f);continue}arrays.isArray(n[0])||(n=[n]);for(h=0,p=n.length;h<p;h++){r=n[h],i=$('<div class="interactive-row"/>'),i.css("width","100%"),p===1&&i.css("height","100%"),$containerByID[t].append(i);for(d=0,v=r.length;d<v;d++){e=r[d];if(a[e]===undefined){alert("Incorrect layout definition. Component with ID '"+e+"'' is not defined.");continue}i.append(a[e].getViewContainer()),delete a[e]}}}u=containerSpecByID.bottom||containerSpecList[containerSpecList.length-1],s=$containerByID[u.id].children(),i=s.last(),i.length||(i=$('<div class="interactive-row"/>'),$containerByID[u.id].append(i));for(e in a){if(!a.hasOwnProperty(e))continue;i.append(a[e].getViewContainer())}for(l=0,c=containerSpecList.length;l<c;l++)o=$containerByID[containerSpecList[l].id].children().children(),o.length>1&&o.addClass("component-spacing")}function positionContainers(){var e,t,n,r,i,s,o,u,a,f;$modelContainer.css({width:modelWidth,height:modelController.getHeightForWidth(modelWidth),left:modelLeft,top:modelTop});for(u=0,a=containerSpecList.length;u<a;u++)e=containerSpecList[u],t=$containerByID[e.id],!e.left&&!e.right&&(e.left="0"),!e.top&&!e.bottom&&(e.top="0"),e.left&&(n=parseDimension(e.left),t.css("left",n)),e.top&&(r=parseDimension(e.top),t.css("top",r)),e.height&&t.css("height",parseDimension(e.height)),e.width&&t.css("width",parseDimension(e.width)),e.right&&(i=parseDimension(e.right),e.left?t.css("width",i-n):(n=i-t.outerWidth(),t.css("left",n))),e.bottom&&(s=parseDimension(e.bottom),e.top?t.css("height",s-r):(r=s-t.outerHeight(),t.css("top",r))),e.aboveOthers&&(s=getDimensionOfContainer(t,"bottom")+padding,s>topBoundary&&(topBoundary=s)),e.belowOthers&&(o=getDimensionOfContainer(t,"height")+padding,o>bottomBarWidth&&(bottomBarWidth=o));leftBoundary=padding;for(f in $containerByID){if(!$containerByID.hasOwnProperty(f))continue;if(containerSpecByID[f]&&containerSpecByID[f].aboveOthers)continue;if(containerSpecByID[f]&&containerSpecByID[f].belowOthers)continue;t=$containerByID[f],r=getDimensionOfContainer(t,"top"),t.css("top",r+topBoundary),n=getDimensionOfContainer(t,"left"),t.css("left",n+leftBoundary)}}function resizeModelContainer(){var e=-Infinity,t=-Infinity,n=Infinity,r=Infinity,i,s,o,u,a,f,l;for(i in $containerByID){if(!$containerByID.hasOwnProperty(i))continue;if(containerSpecByID[i]&&containerSpecByID[i].aboveOthers)continue;if(containerSpecByID[i]&&containerSpecByID[i].belowOthers)continue;s=$containerByID[i],o=getDimensionOfContainer(s,"right"),o>e&&(e=o),u=getDimensionOfContainer(s,"bottom"),u>t&&(t=u),f=getDimensionOfContainer(s,"left"),f<n&&(n=f),a=getDimensionOfContainer(s,"top"),a<r&&(r=a)}return e<=availableWidth&&t<=availableHeight-bottomBarWidth&&(Math.abs(availableWidth-e)<1||Math.abs(availableHeight-bottomBarWidth-t)<1)&&Math.abs(n-leftBoundary)<1&&Math.abs(r-topBoundary)<1?!0:(l=Math.min(availableWidth/e,(availableHeight-bottomBarWidth)/t),isNaN(l)||(modelWidth*=l),modelWidth<layoutConfig.minModelWidth&&(modelWidth=layoutConfig.minModelWidth),modelLeft-=n-leftBoundary,modelTop-=r-topBoundary,!1)}function parseDimension(dim){var vars,i,ii,value;if(typeof dim=="number"||/^[0-9]+\.?[0-9]*(em)?$/.test(dim))return dim;vars=dim.match(/[a-zA-Z\-]+\.[a-zA-Z]+/g);for(i=0,ii=vars.length;i<ii;i++)value=getDimension(vars[i]),dim=dim.replace(vars[i],value);return/^[^a-zA-Z]*$/.test(dim)?eval(dim):0}function getDimension(e){switch(e){case"container.width":return availableWidth;case"container.height":return availableHeight;case"interactive.width":return availableWidth-leftBoundary;case"interactive.height":return availableHeight-topBoundary-bottomBarWidth;default:return e=e.split("."),getDimensionOfContainer($containerByID[e[0]],e[1])}}function calcInteractiveAspectRatio(){var e=layoutConfig.iterationsLimit,t=layoutConfig.canonicalInteractiveWidth,n=layoutConfig.canonicalInteractiveHeight,r=t/n,i=-Infinity,s=-Infinity,o,u,a;reset(),availableWidth=t,availableHeight=n,modelWidth=availableWidth,basicInteractiveWidth=t,basicInteractiveHeight=n,setFontSize(),positionContainers();while(--e>0&&!resizeModelContainer())positionContainers();console.log("[layout] aspect ratio calc: "+(layoutConfig.iterationsLimit-e)+" iterations");for(o in $containerByID){if(!$containerByID.hasOwnProperty(o))continue;u=$containerByID[o],a=getDimensionOfContainer(u,"right"),a>i&&(i=a),a=getDimensionOfContainer(u,"bottom"),a>s&&(s=a)}interactiveAspectRatio=i/s,interactiveAspectRatio<r?(basicInteractiveWidth=n*interactiveAspectRatio,basicInteractiveHeight=n):(basicInteractiveWidth=t,basicInteractiveHeight=t/interactiveAspectRatio)}var layout,containerSpecList,containersContent,componentByID,modelController,fontScale,containerSpecByID,$containerByID,$modelContainer,basicInteractiveWidth,basicInteractiveHeight,interactiveAspectRatio,availableWidth,availableHeight,padding=10,modelWidth,modelTop,modelLeft,topBoundary,leftBoundary,bottomBarWidth;return layout={initialize:function(e,t,n,r){containerSpecList=e,containersContent=t,componentByID=n,fontScale=r,createContainers(),placeComponentsInContainers(),interactiveAspectRatio=null},setupModel:function(e){modelController=e,interactiveAspectRatio=null;if($containerByID.model){if($containerByID.model===modelController.getViewContainer())return;$containerByID.model.remove()}$modelContainer=modelController.getViewContainer(),$modelContainer.css({display:"inline-block",position:"absolute","z-index":"0"}),$modelContainer.appendTo($interactiveContainer),$containerByID.model=$modelContainer},layoutInteractive:function(){var e=layoutConfig.iterationsLimit,t;console.time("[layout] update"),interactiveAspectRatio||calcInteractiveAspectRatio(),reset(),availableWidth=$interactiveContainer.width(),availableHeight=$interactiveContainer.height(),modelWidth=availableWidth,setFontSize(),positionContainers();while(--e>0&&!resizeModelContainer())positionContainers();console.log("[layout] update: "+(layoutConfig.iterationsLimit-e)+" iterations"),modelController.resize();for(t in componentByID)componentByID.hasOwnProperty(t)&&componentByID[t].resize!==undefined&&componentByID[t].resize();setupBackground(),console.timeEnd("[layout] update")}},layout}}),define("common/layout/templates",[],function(){return{simple:[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"narrow-right":[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em",width:"model.width / 4","min-width":"6em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"wide-right":[{id:"top",bottom:"model.top",width:"interactive.width"},{id:"right",top:"model.top",left:"model.right",height:"model.height","padding-left":"1em","padding-right":"0.5em",width:"model.width","min-width":"6em"},{id:"bottom",top:"model.bottom",width:"interactive.width","padding-top":"0.5em"}],"left-right-bottom":[{id:"left",top:"model.top",height:"model.height",right:"model.left","padding-right":"0.5em"},{id:"right",top:"model.top",height:"model.height",left:"model.right","padding-left":"1em","padding-right":"0.5em"},{id:"bottom",top:"model.bottom",left:"model.left",width:"model.width"}]}}),define("common/controllers/model-controller",["require","lab.config"],function(e){var t=e("lab.config");return function(n,r,i,s,o,u,a){function c(){f.modelContainer.update()}function h(){f.benchmarks=new a(f)}function p(){model=new s(r),model.on("tick",c)}function d(){f.modelContainer=new o(model,f.modelUrl)}function v(e,t,n){f.modelUrl=e||f.modelUrl,r=t||r,p(),f.modelContainer.bindModel(model,f.modelUrl),n||l.modelLoaded()}function m(){f.modelContainer.repaint()}function g(){f.modelContainer.resize()}function y(){return model.serialize()}var f={},l=d3.dispatch("modelLoaded");f.on=function(e,t){l.on(e,t)},f.getViewContainer=function(){return f.modelContainer.$el},f.getHeightForWidth=function(e){return f.modelContainer.getHeightForWidth(e)},f.enableKeyboardHandlers=function(){return model.get("enableKeyboardHandlers")},f.modelInDOM=function(){f.modelContainer.setup()},f.reload=v,f.repaint=m,f.resize=g,f.state=y,f.ScriptingAPI=u,f.modelContainer=null,f.benchmarks=null,f.type=s.type,f.modelUrl=n;if(t.environment==="production")try{p()}catch(b){throw alert(b),new Error(b)}else p();return h(),d(),f}}),define("common/performance",[],function(){var e;return typeof performance!="undefined"&&typeof performance.now!="undefined"?e=$.proxy(performance.now,performance):e=$.proxy(Date.now,Date),{now:e}}),define("common/array-types",["require","arrays"],function(e){var t=e("arrays"),n=function(){if(typeof navigator=="undefined")return!0;var e=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,t=navigator.userAgent.match(e);return!t||!t[3]}(),r=t.typed&&n;return{floatType:r?"Float32Array":"regular",int32Type:r?"Int32Array":"regular",int16Type:r?"Int16Array":"regular",int8Type:r?"Int8Array":"regular",uint16Type:r?"Uint16Array":"regular",uint8Type:r?"Uint8Array":"regular"}}),define("md2d/models/engine/constants/units",["require","exports","module"],function(e,t,n){var r=1.66054e-27,i=1.602177e-19,s=i,o=1e-15,u=1e-9,a=10,f=1e3,l={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"},c,h,p;t.unit=c={FEMTOSECOND:{name:"femtosecond",value:1,type:l.TIME},SECOND:{name:"second",value:o,type:l.TIME},NANOMETER:{name:"nanometer",value:1,type:l.LENGTH},ANGSTROM:{name:"Angstrom",value:1*a,type:l.LENGTH},METER:{name:"meter",value:1*u,type:l.LENGTH},DALTON:{name:"Dalton",value:1,type:l.MASS},GRAM:{name:"gram",value:1*r*f,type:l.MASS},KILOGRAM:{name:"kilogram",value:1*r,type:l.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:l.ENERGY},JOULE:{name:"Joule",value:r*u*u*(1/o)*(1/o),type:l.ENERGY},EV:{name:"electron volt",value:r*u*u*(1/o)*(1/o)*(1/s),type:l.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:l.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*s,type:l.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:l.CHARGE},COULOMB:{name:"Coulomb",value:i,type:l.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:l.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:l.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:l.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:l.FORCE},NEWTON:{name:"Newton",value:1*r*u*(1/o)*(1/o),type:l.FORCE},EV_PER_NM:{name:"electron volts per nanometer",value:1*r*u*u*(1/o)*(1/o)*(1/s),type:l.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:l.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*u*(1/o),type:l.VELOCITY}},t.ratio=h=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},t.convert=p=function(e,t){var n=t&&t.from,r=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!r)throw new Error('units.convert() did not receive a "to" argument');return e*h(r,{per:n})}}),define("md2d/models/engine/constants/index",["require","exports","module","./units"],function(e,t,n){var r=e("./units"),i=r.unit,s=r.ratio,o=r.convert,u={ELEMENTARY_CHARGE:{value:1,unit:i.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:i.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:i.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:s(i.DALTON,{per:i.GRAM}),unit:i.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:i.FARADS_PER_METER}},a,f;u.COULOMB_CONSTANT={value:1/(4*Math.PI*u.PERMITTIVITY_OF_FREE_SPACE.value),unit:i.METERS_PER_FARAD},t.unit=i,t.ratio=s,t.convert=o;for(a in u)u.hasOwnProperty(a)&&(f=u[a],t[a]=function(e){return{as:function(t){return r.convert(e.value,{from:e.unit,to:t})}}}(f))}),function(root){var CoffeeScript=function(){function require(e){return require[e]}return require["./helpers"]=new function(){var e=this;(function(){var t,n;e.starts=function(e,t,n){return t===e.substr(n,t.length)},e.ends=function(e,t,n){var r;return r=t.length,t===e.substr(e.length-r-(n||0),r)},e.compact=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],t&&i.push(t);return i},e.count=function(e,t){var n,r;n=r=0;if(!t.length)return 1/0;while(r=1+e.indexOf(t,r))n++;return n},e.merge=function(e,n){return t(t({},e),n)},t=e.extend=function(e,t){var n,r;for(n in t)r=t[n],e[n]=r;return e},e.flatten=n=function(e){var t,r,i,s;r=[];for(i=0,s=e.length;i<s;i++)t=e[i],t instanceof Array?r=r.concat(n(t)):r.push(t);return r},e.del=function(e,t){var n;return n=e[t],delete e[t],n},e.last=function(e,t){return e[e.length-(t||0)-1]}}).call(this)},require["./rewriter"]=new function(){var e=this;(function(){var t,n,r,i,s,o,u,f,l,c,h,p,d,v,m,g,y,b,w=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},E=[].slice;e.Rewriter=function(){function e(){}return e.prototype.rewrite=function(e){return this.tokens=e,this.removeLeadingNewlines(),this.removeMidExpressionNewlines(),this.closeOpenCalls(),this.closeOpenIndexes(),this.addImplicitIndentation(),this.tagPostfixConditionals(),this.addImplicitBraces(),this.addImplicitParentheses(),this.tokens},e.prototype.scanTokens=function(e){var t,n,r;r=this.tokens,t=0;while(n=r[t])t+=e.call(this,n,t,r);return!0},e.prototype.detectEnd=function(e,t,n){var s,o,u,a,f;u=this.tokens,s=0;while(o=u[e]){if(s===0&&t.call(this,o,e))return n.call(this,o,e);if(!o||s<0)return n.call(this,o,e-1);if(a=o[0],w.call(i,a)>=0)s+=1;else if(f=o[0],w.call(r,f)>=0)s-=1;e+=1}return e-1},e.prototype.removeLeadingNewlines=function(){var e,t,n,r,i;i=this.tokens;for(e=n=0,r=i.length;n<r;e=++n){t=i[e][0];if(t!=="TERMINATOR")break}if(e)return this.tokens.splice(0,e)},e.prototype.removeMidExpressionNewlines=function(){return this.scanTokens(function(e,t,r){var i;return e[0]==="TERMINATOR"&&(i=this.tag(t+1),w.call(n,i)>=0)?(r.splice(t,1),0):1})},e.prototype.closeOpenCalls=function(){var e,t;return t=function(e,t){var n;return(n=e[0])===")"||n==="CALL_END"||e[0]==="OUTDENT"&&this.tag(t-1)===")"},e=function(e,t){return this.tokens[e[0]==="OUTDENT"?t-1:t][0]="CALL_END"},this.scanTokens(function(n,r){return n[0]==="CALL_START"&&this.detectEnd(r+1,t,e),1})},e.prototype.closeOpenIndexes=function(){var e,t;return t=function(e,t){var n;return(n=e[0])==="]"||n==="INDEX_END"},e=function(e,t){return e[0]="INDEX_END"},this.scanTokens(function(n,r){return n[0]==="INDEX_START"&&this.detectEnd(r+1,t,e),1})},e.prototype.addImplicitBraces=function(){var e,t,n,s,o,a,f,l;return s=[],o=null,l=null,n=!0,a=0,f=0,t=function(e,t){var r,i,s,o,a,c;return a=this.tokens.slice(t+1,t+3+1||9e9),r=a[0],o=a[1],s=a[2],"HERECOMMENT"===(r!=null?r[0]:void 0)?!1:(i=e[0],w.call(h,i)>=0&&(n=!1),(i==="TERMINATOR"||i==="OUTDENT"||w.call(u,i)>=0&&n&&t-f!==1)&&(!l&&this.tag(t-1)!==","||(o!=null?o[0]:void 0)!==":"&&((r!=null?r[0]:void 0)!=="@"||(s!=null?s[0]:void 0)!==":"))||i===","&&r&&(c=r[0])!=="IDENTIFIER"&&c!=="NUMBER"&&c!=="STRING"&&c!=="@"&&c!=="TERMINATOR"&&c!=="OUTDENT")},e=function(e,t){var n;return n=this.generate("}","}",e[2]),this.tokens.splice(t,0,n)},this.scanTokens(function(u,a,c){var p,d,v,m,g,y,b,E;if(b=m=u[0],w.call(i,b)>=0)return s.push([m==="INDENT"&&this.tag(a-1)==="{"?"{":m,a]),1;if(w.call(r,m)>=0)return o=s.pop(),1;if(m!==":"||(p=this.tag(a-2))!==":"&&((E=s[s.length-1])!=null?E[0]:void 0)==="{")return 1;n=!0,f=a+1,s.push(["{"]),d=p==="@"?a-2:a-1;while(this.tag(d-2)==="HERECOMMENT")d-=2;return v=this.tag(d-1),l=!v||w.call(h,v)>=0,y=new String("{"),y.generated=!0,g=this.generate("{",y,u[2]),c.splice(d,0,g),this.detectEnd(a+2,t,e),2})},e.prototype.addImplicitParentheses=function(){var e,t,n,r,i;return n=i=r=!1,t=function(e,t){var n,o,a,f;o=e[0];if(!i&&e.fromThen)return!0;if(o==="IF"||o==="ELSE"||o==="CATCH"||o==="->"||o==="=>"||o==="CLASS")i=!0;if(o==="IF"||o==="ELSE"||o==="SWITCH"||o==="TRY"||o==="=")r=!0;return o!=="."&&o!=="?."&&o!=="::"||this.tag(t-1)!=="OUTDENT"?!e.generated&&this.tag(t-1)!==","&&(w.call(u,o)>=0||o==="INDENT"&&!r)&&(o!=="INDENT"||(a=this.tag(t-2))!=="CLASS"&&a!=="EXTENDS"&&(f=this.tag(t-1),w.call(s,f)<0)&&(!(n=this.tokens[t+1])||!n.generated||n[0]!=="{")):!0},e=function(e,t){return this.tokens.splice(t,0,this.generate("CALL_END",")",e[2]))},this.scanTokens(function(
s,u,c){var p,d,v,m,g,y,b,E;g=s[0];if(g==="CLASS"||g==="IF"||g==="FOR"||g==="WHILE")n=!0;return y=c.slice(u-1,u+1+1||9e9),m=y[0],d=y[1],v=y[2],p=!n&&g==="INDENT"&&v&&v.generated&&v[0]==="{"&&m&&(b=m[0],w.call(f,b)>=0),i=!1,r=!1,w.call(h,g)>=0&&(n=!1),m&&!m.spaced&&g==="?"&&(s.call=!0),s.fromThen?1:p||(m!=null?m.spaced:void 0)&&(m.call||(E=m[0],w.call(f,E)>=0))&&(w.call(o,g)>=0||!s.spaced&&!s.newLine&&w.call(l,g)>=0)?(c.splice(u,0,this.generate("CALL_START","(",s[2])),this.detectEnd(u+1,t,e),m[0]==="?"&&(m[0]="FUNC_EXIST"),2):1})},e.prototype.addImplicitIndentation=function(){var e,t,n,r,i;return i=n=r=null,t=function(e,t){var n;return e[1]!==";"&&(n=e[0],w.call(p,n)>=0)&&(e[0]!=="ELSE"||i==="IF"||i==="THEN")},e=function(e,t){return this.tokens.splice(this.tag(t-1)===","?t-1:t,0,r)},this.scanTokens(function(s,o,u){var f,l,c;return f=s[0],f==="TERMINATOR"&&this.tag(o+1)==="THEN"?(u.splice(o,1),0):f==="ELSE"&&this.tag(o-1)!=="OUTDENT"?(u.splice.apply(u,[o,0].concat(E.call(this.indentation(s)))),2):f!=="CATCH"||(l=this.tag(o+2))!=="OUTDENT"&&l!=="TERMINATOR"&&l!=="FINALLY"?w.call(d,f)>=0&&this.tag(o+1)!=="INDENT"&&(f!=="ELSE"||this.tag(o+1)!=="IF")?(i=f,c=this.indentation(s,!0),n=c[0],r=c[1],i==="THEN"&&(n.fromThen=!0),u.splice(o+1,0,n),this.detectEnd(o+2,t,e),f==="THEN"&&u.splice(o,1),1):1:(u.splice.apply(u,[o+2,0].concat(E.call(this.indentation(s)))),4)})},e.prototype.tagPostfixConditionals=function(){var e,t,n;return n=null,t=function(e,t){var n;return(n=e[0])==="TERMINATOR"||n==="INDENT"},e=function(e,t){if(e[0]!=="INDENT"||e.generated&&!e.fromThen)return n[0]="POST_"+n[0]},this.scanTokens(function(r,i){return r[0]!=="IF"?1:(n=r,this.detectEnd(i+1,t,e),1)})},e.prototype.indentation=function(e,t){var n,r;return t==null&&(t=!1),n=["INDENT",2,e[2]],r=["OUTDENT",2,e[2]],t&&(n.generated=r.generated=!0),[n,r]},e.prototype.generate=function(e,t,n){var r;return r=[e,t,n],r.generated=!0,r},e.prototype.tag=function(e){var t;return(t=this.tokens[e])!=null?t[0]:void 0},e}(),t=[["(",")"],["[","]"],["{","}"],["INDENT","OUTDENT"],["CALL_START","CALL_END"],["PARAM_START","PARAM_END"],["INDEX_START","INDEX_END"]],e.INVERSES=c={},i=[],r=[];for(g=0,y=t.length;g<y;g++)b=t[g],v=b[0],m=b[1],i.push(c[m]=v),r.push(c[v]=m);n=["CATCH","WHEN","ELSE","FINALLY"].concat(r),f=["IDENTIFIER","SUPER",")","CALL_END","]","INDEX_END","@","THIS"],o=["IDENTIFIER","NUMBER","STRING","JS","REGEX","NEW","PARAM_START","CLASS","IF","TRY","SWITCH","THIS","BOOL","NULL","UNDEFINED","UNARY","SUPER","@","->","=>","[","(","{","--","++"],l=["+","-"],s=["->","=>","{","[",","],u=["POST_IF","FOR","WHILE","UNTIL","WHEN","BY","LOOP","TERMINATOR"],d=["ELSE","->","=>","TRY","FINALLY","THEN"],p=["TERMINATOR","CATCH","FINALLY","ELSE","OUTDENT","LEADING_WHEN"],h=["TERMINATOR","INDENT","OUTDENT"]}).call(this)},require["./lexer"]=new function(){var e=this;(function(){var t,n,r,i,s,o,u,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};J=require("./rewriter"),B=J.Rewriter,y=J.INVERSES,K=require("./helpers"),W=K.count,$=K.starts,z=K.compact,V=K.last,e.Lexer=N=function(){function e(){}return e.prototype.tokenize=function(e,t){var n,r;t==null&&(t={}),U.test(e)&&(e="\n"+e),e=e.replace(/\r/g,"").replace(q,""),this.code=e,this.line=t.line||0,this.indent=0,this.indebt=0,this.outdebt=0,this.indents=[],this.ends=[],this.tokens=[],n=0;while(this.chunk=e.slice(n))n+=this.identifierToken()||this.commentToken()||this.whitespaceToken()||this.lineToken()||this.heredocToken()||this.stringToken()||this.numberToken()||this.regexToken()||this.jsToken()||this.literalToken();return this.closeIndentation(),(r=this.ends.pop())&&this.error("missing "+r),t.rewrite===!1?this.tokens:(new B).rewrite(this.tokens)},e.prototype.identifierToken=function(){var e,t,n,r,u,a,f,l,c;return(u=m.exec(this.chunk))?(r=u[0],n=u[1],e=u[2],n==="own"&&this.tag()==="FOR"?(this.token("OWN",n),n.length):(t=e||(a=V(this.tokens))&&((l=a[0])==="."||l==="?."||l==="::"||!a.spaced&&a[0]==="@"),f="IDENTIFIER",!t&&(Q.call(E,n)>=0||Q.call(o,n)>=0)&&(f=n.toUpperCase(),f==="WHEN"&&(c=this.tag(),Q.call(S,c)>=0)?f="LEADING_WHEN":f==="FOR"?this.seenFor=!0:f==="UNLESS"?f="IF":Q.call(R,f)>=0?f="UNARY":Q.call(P,f)>=0&&(f!=="INSTANCEOF"&&this.seenFor?(f="FOR"+f,this.seenFor=!1):(f="RELATION",this.value()==="!"&&(this.tokens.pop(),n="!"+n)))),Q.call(w,n)>=0&&(t?(f="IDENTIFIER",n=new String(n),n.reserved=!0):Q.call(H,n)>=0&&this.error('reserved word "'+n+'"')),t||(Q.call(i,n)>=0&&(n=s[n]),f=function(){switch(n){case"!":return"UNARY";case"==":case"!=":return"COMPARE";case"&&":case"||":return"LOGIC";case"true":case"false":return"BOOL";case"break":case"continue":return"STATEMENT";default:return f}}()),this.token(f,n),e&&this.token(":",":"),r.length)):0},e.prototype.numberToken=function(){var e,t,n,r,i;if(!(n=M.exec(this.chunk)))return 0;r=n[0],/^0[BOX]/.test(r)?this.error("radix prefix '"+r+"' must be lowercase"):/E/.test(r)&&!/^0x/.test(r)?this.error("exponential notation '"+r+"' must be indicated with a lowercase 'e'"):/^0\d*[89]/.test(r)?this.error("decimal literal '"+r+"' must not be prefixed with '0'"):/^0\d+/.test(r)&&this.error("octal literal '"+r+"' must be prefixed with '0o'"),t=r.length;if(i=/^0o([0-7]+)/.exec(r))r="0x"+parseInt(i[1],8).toString(16);if(e=/^0b([01]+)/.exec(r))r="0x"+parseInt(e[1],2).toString(16);return this.token("NUMBER",r),t},e.prototype.stringToken=function(){var e,t,n;switch(this.chunk.charAt(0)){case"'":if(!(e=F.exec(this.chunk)))return 0;this.token("STRING",(n=e[0]).replace(k,"\\\n"));break;case'"':if(!(n=this.balancedString(this.chunk,'"')))return 0;0<n.indexOf("#{",1)?this.interpolateString(n.slice(1,-1)):this.token("STRING",this.escapeLines(n));break;default:return 0}return(t=/^(?:\\.|[^\\])*\\(?:0[0-7]|[1-7])/.test(n))&&this.error("octal escape sequences "+n+" are not allowed"),this.line+=W(n,"\n"),n.length},e.prototype.heredocToken=function(){var e,t,n,r;return(n=c.exec(this.chunk))?(t=n[0],r=t.charAt(0),e=this.sanitizeHeredoc(n[2],{quote:r,indent:null}),r==='"'&&0<=e.indexOf("#{")?this.interpolateString(e,{heredoc:!0}):this.token("STRING",this.makeString(e,r,!0)),this.line+=W(t,"\n"),t.length):0},e.prototype.commentToken=function(){var e,t,n;return(n=this.chunk.match(u))?(e=n[0],t=n[1],t&&this.token("HERECOMMENT",this.sanitizeHeredoc(t,{herecomment:!0,indent:Array(this.indent+1).join(" ")})),this.line+=W(e,"\n"),e.length):0},e.prototype.jsToken=function(){var e,t;return this.chunk.charAt(0)!=="`"||!(e=b.exec(this.chunk))?0:(this.token("JS",(t=e[0]).slice(1,-1)),t.length)},e.prototype.regexToken=function(){var e,t,n,r,i,s,o;return this.chunk.charAt(0)!=="/"?0:(n=d.exec(this.chunk))?(t=this.heregexToken(n),this.line+=W(n[0],"\n"),t):(r=V(this.tokens),r&&(s=r[0],Q.call(r.spaced?A:O,s)>=0)?0:(n=D.exec(this.chunk))?(o=n,n=o[0],i=o[1],e=o[2],i.slice(0,2)==="/*"&&this.error("regular expressions cannot begin with `*`"),i==="//"&&(i="/(?:)/"),this.token("REGEX",""+i+e),n.length):0)},e.prototype.heregexToken=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;r=e[0],t=e[1],n=e[2];if(0>t.indexOf("#{"))return i=t.replace(v,"").replace(/\//g,"\\/"),i.match(/^\*/)&&this.error("regular expressions cannot begin with `*`"),this.token("REGEX","/"+(i||"(?:)")+"/"+n),r.length;this.token("IDENTIFIER","RegExp"),this.tokens.push(["CALL_START","("]),o=[],l=this.interpolateString(t,{regex:!0});for(a=0,f=l.length;a<f;a++){c=l[a],s=c[0],u=c[1];if(s==="TOKENS")o.push.apply(o,u);else{if(!(u=u.replace(v,"")))continue;u=u.replace(/\\/g,"\\\\"),o.push(["STRING",this.makeString(u,'"',!0)])}o.push(["+","+"])}return o.pop(),((h=o[0])!=null?h[0]:void 0)!=="STRING"&&this.tokens.push(["STRING",'""'],["+","+"]),(p=this.tokens).push.apply(p,o),n&&this.tokens.push([",",","],["STRING",'"'+n+'"']),this.token(")",")"),r.length},e.prototype.lineToken=function(){var e,t,n,r,i,s;if(!(n=L.exec(this.chunk)))return 0;t=n[0],this.line+=W(t,"\n"),this.seenFor=!1,i=V(this.tokens,1),s=t.length-1-t.lastIndexOf("\n"),r=this.unfinished();if(s-this.indebt===this.indent)return r?this.suppressNewlines():this.newlineToken(),t.length;if(s>this.indent){if(r)return this.indebt=s-this.indent,this.suppressNewlines(),t.length;e=s-this.indent+this.outdebt,this.token("INDENT",e),this.indents.push(e),this.ends.push("OUTDENT"),this.outdebt=this.indebt=0}else this.indebt=0,this.outdentToken(this.indent-s,r);return this.indent=s,t.length},e.prototype.outdentToken=function(e,t){var n,r;while(e>0)r=this.indents.length-1,this.indents[r]===void 0?e=0:this.indents[r]===this.outdebt?(e-=this.outdebt,this.outdebt=0):this.indents[r]<this.outdebt?(this.outdebt-=this.indents[r],e-=this.indents[r]):(n=this.indents.pop()-this.outdebt,e-=n,this.outdebt=0,this.pair("OUTDENT"),this.token("OUTDENT",n));n&&(this.outdebt-=e);while(this.value()===";")this.tokens.pop();return this.tag()!=="TERMINATOR"&&!t&&this.token("TERMINATOR","\n"),this},e.prototype.whitespaceToken=function(){var e,t,n;return!(e=U.exec(this.chunk))&&!(t=this.chunk.charAt(0)==="\n")?0:(n=V(this.tokens),n&&(n[e?"spaced":"newLine"]=!0),e?e[0].length:0)},e.prototype.newlineToken=function(){while(this.value()===";")this.tokens.pop();return this.tag()!=="TERMINATOR"&&this.token("TERMINATOR","\n"),this},e.prototype.suppressNewlines=function(){return this.value()==="\\"&&this.tokens.pop(),this},e.prototype.literalToken=function(){var e,t,i,s,o,u,a,c;(e=_.exec(this.chunk))?(s=e[0],r.test(s)&&this.tagParameters()):s=this.chunk.charAt(0),i=s,t=V(this.tokens);if(s==="="&&t){!t[1].reserved&&(o=t[1],Q.call(w,o)>=0)&&this.error('reserved word "'+this.value()+"\" can't be assigned");if((u=t[1])==="||"||u==="&&")return t[0]="COMPOUND_ASSIGN",t[1]+="=",s.length}if(s===";")this.seenFor=!1,i="TERMINATOR";else if(Q.call(C,s)>=0)i="MATH";else if(Q.call(f,s)>=0)i="COMPARE";else if(Q.call(l,s)>=0)i="COMPOUND_ASSIGN";else if(Q.call(R,s)>=0)i="UNARY";else if(Q.call(j,s)>=0)i="SHIFT";else if(Q.call(T,s)>=0||s==="?"&&(t!=null?t.spaced:void 0))i="LOGIC";else if(t&&!t.spaced)if(s==="("&&(a=t[0],Q.call(n,a)>=0))t[0]==="?"&&(t[0]="FUNC_EXIST"),i="CALL_START";else if(s==="["&&(c=t[0],Q.call(g,c)>=0)){i="INDEX_START";switch(t[0]){case"?":t[0]="INDEX_SOAK"}}switch(s){case"(":case"{":case"[":this.ends.push(y[s]);break;case")":case"}":case"]":this.pair(s)}return this.token(i,s),s.length},e.prototype.sanitizeHeredoc=function(e,t){var n,r,i,s,o;i=t.indent,r=t.herecomment;if(r){h.test(e)&&this.error('block comment cannot contain "*/", starting');if(e.indexOf("\n")<=0)return e}else while(s=p.exec(e)){n=s[1];if(i===null||0<(o=n.length)&&o<i.length)i=n}return i&&(e=e.replace(RegExp("\\n"+i,"g"),"\n")),r||(e=e.replace(/^\n/,"")),e},e.prototype.tagParameters=function(){var e,t,n,r;if(this.tag()!==")")return this;t=[],r=this.tokens,e=r.length,r[--e][0]="PARAM_END";while(n=r[--e])switch(n[0]){case")":t.push(n);break;case"(":case"CALL_START":if(!t.length)return n[0]==="("?(n[0]="PARAM_START",this):this;t.pop()}return this},e.prototype.closeIndentation=function(){return this.outdentToken(this.indent)},e.prototype.balancedString=function(e,t){var n,r,i,s,o,u,a,f;n=0,u=[t];for(r=a=1,f=e.length;1<=f?a<f:a>f;r=1<=f?++a:--a){if(n){--n;continue}switch(i=e.charAt(r)){case"\\":++n;continue;case t:u.pop();if(!u.length)return e.slice(0,r+1||9e9);t=u[u.length-1];continue}t!=="}"||i!=='"'&&i!=="'"?t==="}"&&i==="/"&&(s=d.exec(e.slice(r))||D.exec(e.slice(r)))?n+=s[0].length-1:t==="}"&&i==="{"?u.push(t="}"):t==='"'&&o==="#"&&i==="{"&&u.push(t="}"):u.push(t=i),o=i}return this.error("missing "+u.pop()+", starting")},e.prototype.interpolateString=function(t,n){var r,i,s,o,u,f,l,c,h,p,d,v,m,g,y,b,w,E;n==null&&(n={}),i=n.heredoc,p=n.regex,v=[],h=0,s=-1;while(l=t.charAt(s+=1)){if(l==="\\"){s+=1;continue}if(l!=="#"||t.charAt(s+1)!=="{"||!(r=this.balancedString(t.slice(s+1),"}")))continue;h<s&&v.push(["NEOSTRING",t.slice(h,s)]),o=r.slice(1,-1);if(o.length){c=(new e).tokenize(o,{line:this.line,rewrite:!1}),c.pop(),((b=c[0])!=null?b[0]:void 0)==="TERMINATOR"&&c.shift();if(f=c.length)f>1&&(c.unshift(["(","(",this.line]),c.push([")",")",this.line])),v.push(["TOKENS",c])}s+=r.length,h=s+1}s>h&&h<t.length&&v.push(["NEOSTRING",t.slice(h)]);if(p)return v;if(!v.length)return this.token("STRING",'""');v[0][0]!=="NEOSTRING"&&v.unshift(["",""]),(u=v.length>1)&&this.token("(","(");for(s=g=0,y=v.length;g<y;s=++g)w=v[s],d=w[0],m=w[1],s&&this.token("+","+"),d==="TOKENS"?(E=this.tokens).push.apply(E,m):this.token("STRING",this.makeString(m,'"',i));return u&&this.token(")",")"),v},e.prototype.pair=function(e){var t,n;return e!==(n=V(this.ends))?("OUTDENT"!==n&&this.error("unmatched "+e),this.indent-=t=V(this.indents),this.outdentToken(t,!0),this.pair(e)):this.ends.pop()},e.prototype.token=function(e,t){return this.tokens.push([e,t,this.line])},e.prototype.tag=function(e,t){var n;return(n=V(this.tokens,e))&&(t?n[0]=t:n[0])},e.prototype.value=function(e,t){var n;return(n=V(this.tokens,e))&&(t?n[1]=t:n[1])},e.prototype.unfinished=function(){var e;return x.test(this.chunk)||(e=this.tag())==="\\"||e==="."||e==="?."||e==="UNARY"||e==="MATH"||e==="+"||e==="-"||e==="SHIFT"||e==="RELATION"||e==="COMPARE"||e==="LOGIC"||e==="THROW"||e==="EXTENDS"},e.prototype.escapeLines=function(e,t){return e.replace(k,t?"\\n":"")},e.prototype.makeString=function(e,t,n){return e?(e=e.replace(/\\([\s\S])/g,function(e,n){return n==="\n"||n===t?n:e}),e=e.replace(RegExp(""+t,"g"),"\\$&"),t+this.escapeLines(e,n)+t):t+t},e.prototype.error=function(e){throw SyntaxError(""+e+" on line "+(this.line+1))},e}(),E=["true","false","null","this","new","delete","typeof","in","instanceof","return","throw","break","continue","debugger","if","else","switch","for","while","do","try","catch","finally","class","extends","super"],o=["undefined","then","unless","until","loop","of","by","when"],s={and:"&&",or:"||",is:"==",isnt:"!=",not:"!",yes:"true",no:"false",on:"true",off:"false"},i=function(){var e;e=[];for(X in s)e.push(X);return e}(),o=o.concat(i),H=["case","default","function","var","void","with","const","let","enum","export","import","native","__hasProp","__extends","__slice","__bind","__indexOf","implements","interface","let","package","private","protected","public","static","yield"],I=["arguments","eval"],w=E.concat(H).concat(I),e.RESERVED=H.concat(E).concat(o).concat(I),e.STRICT_PROSCRIBED=I,m=/^([$A-Za-z_\x7f-\uffff][$\w\x7f-\uffff]*)([^\n\S]*:(?!:))?/,M=/^0b[01]+|^0o[0-7]+|^0x[\da-f]+|^\d*\.?\d+(?:e[+-]?\d+)?/i,c=/^("""|''')([\s\S]*?)(?:\n[^\n\S]*)?\1/,_=/^(?:[-=]>|[-+*\/%<>&|^!?=]=|>>>=?|([-+:])\1|([&|<>])\2=?|\?\.|\.{2,3})/,U=/^[^\n\S]+/,u=/^###([^#][\s\S]*?)(?:###[^\n\S]*|(?:###)?$)|^(?:\s*#(?!##[^#]).*)+/,r=/^[-=]>/,L=/^(?:\n[^\n\S]*)+/,F=/^'[^\\']*(?:\\.[^\\']*)*'/,b=/^`[^\\`]*(?:\\.[^\\`]*)*`/,D=/^(\/(?![\s=])[^[\/\n\\]*(?:(?:\\[\s\S]|\[[^\]\n\\]*(?:\\[\s\S][^\]\n\\]*)*])[^[\/\n\\]*)*\/)([imgy]{0,4})(?!\w)/,d=/^\/{3}([\s\S]+?)\/{3}([imgy]{0,4})(?!\w)/,v=/\s+(?:#.*)?/g,k=/\n/g,p=/\n+([^\n\S]*)/g,h=/\*\//,x=/^\s*(?:,|\??\.(?![.\d])|::)/,q=/\s+$/,l=["-=","+=","/=","*=","%=","||=","&&=","?=","<<=",">>=",">>>=","&=","^=","|="],R=["!","~","NEW","TYPEOF","DELETE","DO"],T=["&&","||","&","|","^"],j=["<<",">>",">>>"],f=["==","!=","<",">","<=",">="],C=["*","/","%"],P=["IN","OF","INSTANCEOF"],t=["TRUE","FALSE"],A=["NUMBER","REGEX","BOOL","NULL","UNDEFINED","++","--","]"],O=A.concat(")","}","THIS","IDENTIFIER","STRING"),n=["IDENTIFIER","STRING","REGEX",")","]","}","?","::","@","THIS","SUPER"],g=n.concat("NUMBER","BOOL","NULL","UNDEFINED"),S=["INDENT","OUTDENT","TERMINATOR"]}).call(this)},require["./parser"]=new function(){var e=this,t=function(){var e={trace:function(){},yy:{},symbols_:{error:2,Root:3,Body:4,Block:5,TERMINATOR:6,Line:7,Expression:8,Statement:9,Return:10,Comment:11,STATEMENT:12,Value:13,Invocation:14,Code:15,Operation:16,Assign:17,If:18,Try:19,While:20,For:21,Switch:22,Class:23,Throw:24,INDENT:25,OUTDENT:26,Identifier:27,IDENTIFIER:28,AlphaNumeric:29,NUMBER:30,STRING:31,Literal:32,JS:33,REGEX:34,DEBUGGER:35,UNDEFINED:36,NULL:37,BOOL:38,Assignable:39,"=":40,AssignObj:41,ObjAssignable:42,":":43,ThisProperty:44,RETURN:45,HERECOMMENT:46,PARAM_START:47,ParamList:48,PARAM_END:49,FuncGlyph:50,"->":51,"=>":52,OptComma:53,",":54,Param:55,ParamVar:56,"...":57,Array:58,Object:59,Splat:60,SimpleAssignable:61,Accessor:62,Parenthetical:63,Range:64,This:65,".":66,"?.":67,"::":68,Index:69,INDEX_START:70,IndexValue:71,INDEX_END:72,INDEX_SOAK:73,Slice:74,"{":75,AssignList:76,"}":77,CLASS:78,EXTENDS:79,OptFuncExist:80,Arguments:81,SUPER:82,FUNC_EXIST:83,CALL_START:84,CALL_END:85,ArgList:86,THIS:87,"@":88,"[":89,"]":90,RangeDots:91,"..":92,Arg:93,SimpleArgs:94,TRY:95,Catch:96,FINALLY:97,CATCH:98,THROW:99,"(":100,")":101,WhileSource:102,WHILE:103,WHEN:104,UNTIL:105,Loop:106,LOOP:107,ForBody:108,FOR:109,ForStart:110,ForSource:111,ForVariables:112,OWN:113,ForValue:114,FORIN:115,FOROF:116,BY:117,SWITCH:118,Whens:119,ELSE:120,When:121,LEADING_WHEN:122,IfBlock:123,IF:124,POST_IF:125,UNARY:126,"-":127,"+":128,"--":129,"++":130,"?":131,MATH:132,SHIFT:133,COMPARE:134,LOGIC:135,RELATION:136,COMPOUND_ASSIGN:137,$accept:0,$end:1},terminals_:{2:"error",6:"TERMINATOR",12:"STATEMENT",25:"INDENT",26:"OUTDENT",28:"IDENTIFIER",30:"NUMBER",31:"STRING",33:"JS",34:"REGEX",35:"DEBUGGER",36:"UNDEFINED",37:"NULL",38:"BOOL",40:"=",43:":",45:"RETURN",46:"HERECOMMENT",47:"PARAM_START",49:"PARAM_END",51:"->",52:"=>",54:",",57:"...",66:".",67:"?.",68:"::",70:"INDEX_START",72:"INDEX_END",73:"INDEX_SOAK",75:"{",77:"}",78:"CLASS",79:"EXTENDS",82:"SUPER",83:"FUNC_EXIST",84:"CALL_START",85:"CALL_END",87:"THIS",88:"@",89:"[",90:"]",92:"..",95:"TRY",97:"FINALLY",98:"CATCH",99:"THROW",100:"(",101:")",103:"WHILE",104:"WHEN",105:"UNTIL",107:"LOOP",109:"FOR",113:"OWN",115:"FORIN",116:"FOROF",117:"BY",118:"SWITCH",120:"ELSE",122:"LEADING_WHEN",124:"IF",125:"POST_IF",126:"UNARY",127:"-",128:"+",129:"--",130:"++",131:"?",132:"MATH",133:"SHIFT",134:"COMPARE",135:"LOGIC",136:"RELATION",137:"COMPOUND_ASSIGN"},productions_:[0,[3,0],[3,1],[3,2],[4,1],[4,3],[4,2],[7,1],[7,1],[9,1],[9,1],[9,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[8,1],[5,2],[5,3],[27,1],[29,1],[29,1],[32,1],[32,1],[32,1],[32,1],[32,1],[32,1],[32,1],[17,3],[17,4],[17,5],[41,1],[41,3],[41,5],[41,1],[42,1],[42,1],[42,1],[10,2],[10,1],[11,1],[15,5],[15,2],[50,1],[50,1],[53,0],[53,1],[48,0],[48,1],[48,3],[48,4],[48,6],[55,1],[55,2],[55,3],[56,1],[56,1],[56,1],[56,1],[60,2],[61,1],[61,2],[61,2],[61,1],[39,1],[39,1],[39,1],[13,1],[13,1],[13,1],[13,1],[13,1],[62,2],[62,2],[62,2],[62,1],[62,1],[69,3],[69,2],[71,1],[71,1],[59,4],[76,0],[76,1],[76,3],[76,4],[76,6],[23,1],[23,2],[23,3],[23,4],[23,2],[23,3],[23,4],[23,5],[14,3],[14,3],[14,1],[14,2],[80,0],[80,1],[81,2],[81,4],[65,1],[65,1],[44,2],[58,2],[58,4],[91,1],[91,1],[64,5],[74,3],[74,2],[74,2],[74,1],[86,1],[86,3],[86,4],[86,4],[86,6],[93,1],[93,1],[94,1],[94,3],[19,2],[19,3],[19,4],[19,5],[96,3],[24,2],[63,3],[63,5],[102,2],[102,4],[102,2],[102,4],[20,2],[20,2],[20,2],[20,1],[106,2],[106,2],[21,2],[21,2],[21,2],[108,2],[108,2],[110,2],[110,3],[114,1],[114,1],[114,1],[114,1],[112,1],[112,3],[111,2],[111,2],[111,4],[111,4],[111,4],[111,6],[111,6],[22,5],[22,7],[22,4],[22,6],[119,1],[119,2],[121,3],[121,4],[123,3],[123,5],[18,1],[18,3],[18,3],[18,3],[16,2],[16,2],[16,2],[16,2],[16,2],[16,2],[16,2],[16,2],[16,3],[16,3],[16,3],[16,3],[16,3],[16,3],[16,3],[16,3],[16,5],[16,3]],performAction:function(e,t,n,r,i,s,o){var u=s.length-1;switch(i){case 1:return this.$=new r.Block;case 2:return this.$=s[u];case 3:return this.$=s[u-1];case 4:this.$=r.Block.wrap([s[u]]);break;case 5:this.$=s[u-2].push(s[u]);break;case 6:this.$=s[u-1];break;case 7:this.$=s[u];break;case 8:this.$=s[u];break;case 9:this.$=s[u];break;case 10:this.$=s[u];break;case 11:this.$=new r.Literal(s[u]);break;case 12:this.$=s[u];break;case 13:this.$=s[u];break;case 14:this.$=s[u];break;case 15:this.$=s[u];break;case 16:this.$=s[u];break;case 17:this.$=s[u];break;case 18:this.$=s[u];break;case 19:this.$=s[u];break;case 20:this.$=s[u];break;case 21:this.$=s[u];break;case 22:this.$=s[u];break;case 23:this.$=s[u];break;case 24:this.$=new r.Block;break;case 25:this.$=s[u-1];break;case 26:this.$=new r.Literal(s[u]);break;case 27:this.$=new r.Literal(s[u]);break;case 28:this.$=new r.Literal(s[u]);break;case 29:this.$=s[u];break;case 30:this.$=new r.Literal(s[u]);break;case 31:this.$=new r.Literal(s[u]);break;case 32:this.$=new r.Literal(s[u]);break;case 33:this.$=new r.Undefined;break;case 34:this.$=new r.Null;break;case 35:this.$=new r.Bool(s[u]);break;case 36:this.$=new r.Assign(s[u-2],s[u]);break;case 37:this.$=new r.Assign(s[u-3],s[u]);break;case 38:this.$=new r.Assign(s[u-4],s[u-1]);break;case 39:this.$=new r.Value(s[u]);break;case 40:this.$=new r.Assign(new r.Value(s[u-2]),s[u],"object");break;case 41:this.$=new r.Assign(new r.Value(s[u-4]),s[u-1],"object");break;case 42:this.$=s[u];break;case 43:this.$=s[u];break;case 44:this.$=s[u];break;case 45:this.$=s[u];break;case 46:this.$=new r.Return(s[u]);break;case 47:this.$=new r.Return;break;case 48:this.$=new r.Comment(s[u]);break;case 49:this.$=new r.Code(s[u-3],s[u],s[u-1]);break;case 50:this.$=new r.Code([],s[u],s[u-1]);break;case 51:this.$="func";break;case 52:this.$="boundfunc";break;case 53:this.$=s[u];break;case 54:this.$=s[u];break;case 55:this.$=[];break;case 56:this.$=[s[u]];break;case 57:this.$=s[u-2].concat(s[u]);break;case 58:this.$=s[u-3].concat(s[u]);break;case 59:this.$=s[u-5].concat(s[u-2]);break;case 60:this.$=new r.Param(s[u]);break;case 61:this.$=new r.Param(s[u-1],null,!0);break;case 62:this.$=new r.Param(s[u-2],s[u]);break;case 63:this.$=s[u];break;case 64:this.$=s[u];break;case 65:this.$=s[u];break;case 66:this.$=s[u];break;case 67:this.$=new r.Splat(s[u-1]);break;case 68:this.$=new r.Value(s[u]);break;case 69:this.$=s[u-1].add(s[u]);break;case 70:this.$=new r.Value(s[u-1],[].concat(s[u]));break;case 71:this.$=s[u];break;case 72:this.$=s[u];break;case 73:this.$=new r.Value(s[u]);break;case 74:this.$=new r.Value(s[u]);break;case 75:this.$=s[u];break;case 76:this.$=new r.Value(s[u]);break;case 77:this.$=new r.Value(s[u]);break;case 78:this.$=new r.Value(s[u]);break;case 79:this.$=s[u];break;case 80:this.$=new r.Access(s[u]);break;case 81:this.$=new r.Access(s[u],"soak");break;case 82:this.$=[new r.Access(new r.Literal("prototype")),new r.Access(s[u])];break;case 83:this.$=new r.Access(new r.Literal("prototype"));break;case 84:this.$=s[u];break;case 85:this.$=s[u-1];break;case 86:this.$=r.extend(s[u],{soak:!0});break;case 87:this.$=new r.Index(s[u]);break;case 88:this.$=new r.Slice(s[u]);break;case 89:this.$=new r.Obj(s[u-2],s[u-3].generated);break;case 90:this.$=[];break;case 91:this.$=[s[u]];break;case 92:this.$=s[u-2].concat(s[u]);break;case 93:this.$=s[u-3].concat(s[u]);break;case 94:this.$=s[u-5].concat(s[u-2]);break;case 95:this.$=new r.Class;break;case 96:this.$=new r.Class(null,null,s[u]);break;case 97:this.$=new r.Class(null,s[u]);break;case 98:this.$=new r.Class(null,s[u-1],s[u]);break;case 99:this.$=new r.Class(s[u]);break;case 100:this.$=new r.Class(s[u-1],null,s[u]);break;case 101:this.$=new r.Class(s[u-2],s[u]);break;case 102:this.$=new r.Class(s[u-3],s[u-1],s[u]);break;case 103:this.$=new r.Call(s[u-2],s[u],s[u-1]);break;case 104:this.$=new r.Call(s[u-2],s[u],s[u-1]);break;case 105:this.$=new r.Call("super",[new r.Splat(new r.Literal("arguments"))]);break;case 106:this.$=new r.Call("super",s[u]);break;case 107:this.$=!1;break;case 108:this.$=!0;break;case 109:this.$=[];break;case 110:this.$=s[u-2];break;case 111:this.$=new r.Value(new r.Literal("this"));break;case 112:this.$=new r.Value(new r.Literal("this"));break;case 113:this.$=new r.Value(new r.Literal("this"),[new r.Access(s[u])],"this");break;case 114:this.$=new r.Arr([]);break;case 115:this.$=new r.Arr(s[u-2]);break;case 116:this.$="inclusive";break;case 117:this.$="exclusive";break;case 118:this.$=new r.Range(s[u-3],s[u-1],s[u-2]);break;case 119:this.$=new r.Range(s[u-2],s[u],s[u-1]);break;case 120:this.$=new r.Range(s[u-1],null,s[u]);break;case 121:this.$=new r.Range(null,s[u],s[u-1]);break;case 122:this.$=new r.Range(null,null,s[u]);break;case 123:this.$=[s[u]];break;case 124:this.$=s[u-2].concat(s[u]);break;case 125:this.$=s[u-3].concat(s[u]);break;case 126:this.$=s[u-2];break;case 127:this.$=s[u-5].concat(s[u-2]);break;case 128:this.$=s[u];break;case 129:this.$=s[u];break;case 130:this.$=s[u];break;case 131:this.$=[].concat(s[u-2],s[u]);break;case 132:this.$=new r.Try(s[u]);break;case 133:this.$=new r.Try(s[u-1],s[u][0],s[u][1]);break;case 134:this.$=new r.Try(s[u-2],null,null,s[u]);break;case 135:this.$=new r.Try(s[u-3],s[u-2][0],s[u-2][1],s[u]);break;case 136:this.$=[s[u-1],s[u]];break;case 137:this.$=new r.Throw(s[u]);break;case 138:this.$=new r.Parens(s[u-1]);break;case 139:this.$=new r.Parens(s[u-2]);break;case 140:this.$=new r.While(s[u]);break;case 141:this.$=new r.While(s[u-2],{guard:s[u]});break;case 142:this.$=new r.While(s[u],{invert:!0});break;case 143:this.$=new r.While(s[u-2],{invert:!0,guard:s[u]});break;case 144:this.$=s[u-1].addBody(s[u]);break;case 145:this.$=s[u].addBody(r.Block.wrap([s[u-1]]));break;case 146:this.$=s[u].addBody(r.Block.wrap([s[u-1]]));break;case 147:this.$=s[u];break;case 148:this.$=(new r.While(new r.Literal("true"))).addBody(s[u]);break;case 149:this.$=(new r.While(new r.Literal("true"))).addBody(r.Block.wrap([s[u]]));break;case 150:this.$=new r.For(s[u-1],s[u]);break;case 151:this.$=new r.For(s[u-1],s[u]);break;case 152:this.$=new r.For(s[u],s[u-1]);break;case 153:this.$={source:new r.Value(s[u])};break;case 154:this.$=function(){return s[u].own=s[u-1].own,s[u].name=s[u-1][0],s[u].index=s[u-1][1],s[u]}();break;case 155:this.$=s[u];break;case 156:this.$=function(){return s[u].own=!0,s[u]}();break;case 157:this.$=s[u];break;case 158:this.$=s[u];break;case 159:this.$=new r.Value(s[u]);break;case 160:this.$=new r.Value(s[u]);break;case 161:this.$=[s[u]];break;case 162:this.$=[s[u-2],s[u]];break;case 163:this.$={source:s[u]};break;case 164:this.$={source:s[u],object:!0};break;case 165:this.$={source:s[u-2],guard:s[u]};break;case 166:this.$={source:s[u-2],guard:s[u],object:!0};break;case 167:this.$={source:s[u-2],step:s[u]};break;case 168:this.$={source:s[u-4],guard:s[u-2],step:s[u]};break;case 169:this.$={source:s[u-4],step:s[u-2],guard:s[u]};break;case 170:this.$=new r.Switch(s[u-3],s[u-1]);break;case 171:this.$=new r.Switch(s[u-5],s[u-3],s[u-1]);break;case 172:this.$=new r.Switch(null,s[u-1]);break;case 173:this.$=new r.Switch(null,s[u-3],s[u-1]);break;case 174:this.$=s[u];break;case 175:this.$=s[u-1].concat(s[u]);break;case 176:this.$=[[s[u-1],s[u]]];break;case 177:this.$=[[s[u-2],s[u-1]]];break;case 178:this.$=new r.If(s[u-1],s[u],{type:s[u-2]});break;case 179:this.$=s[u-4].addElse(new r.If(s[u-1],s[u],{type:s[u-2]}));break;case 180:this.$=s[u];break;case 181:this.$=s[u-2].addElse(s[u]);break;case 182:this.$=new r.If(s[u],r.Block.wrap([s[u-2]]),{type:s[u-1],statement:!0});break;case 183:this.$=new r.If(s[u],r.Block.wrap([s[u-2]]),{type:s[u-1],statement:!0});break;case 184:this.$=new r.Op(s[u-1],s[u]);break;case 185:this.$=new r.Op("-",s[u]);break;case 186:this.$=new r.Op("+",s[u]);break;case 187:this.$=new r.Op("--",s[u]);break;case 188:this.$=new r.Op("++",s[u]);break;case 189:this.$=new r.Op("--",s[u-1],null,!0);break;case 190:this.$=new r.Op("++",s[u-1],null,!0);break;case 191:this.$=new r.Existence(s[u-1]);break;case 192:this.$=new r.Op("+",s[u-2],s[u]);break;case 193:this.$=new r.Op("-",s[u-2],s[u]);break;case 194:this.$=new r.Op(s[u-1],s[u-2],s[u]);break;case 195:this.$=new r.Op(s[u-1],s[u-2],s[u]);break;case 196:this.$=new r.Op(s[u-1],s[u-2],s[u]);break;case 197:this.$=new r.Op(s[u-1],s[u-2],s[u]);break;case 198:this.$=function(){return s[u-1].charAt(0)==="!"?(new r.Op(s[u-1].slice(1),s[u-2],s[u])).invert():new r.Op(s[u-1],s[u-2],s[u])}();break;case 199:this.$=new r.Assign(s[u-2],s[u],s[u-1]);break;case 200:this.$=new r.Assign(s[u-4],s[u-1],s[u-3]);break;case 201:this.$=new r.Extends(s[u-2],s[u])}},table:[{1:[2,1],3:1,4:2,5:3,7:4,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,5],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[3]},{1:[2,2],6:[1,74]},{6:[1,75]},{1:[2,4],6:[2,4],26:[2,4],101:[2,4]},{4:77,7:4,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,26:[1,76],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,7],6:[2,7],26:[2,7],101:[2,7],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,8],6:[2,8],26:[2,8],101:[2,8],102:90,103:[1,65],105:[1,66],108:91,109:[1,68],110:69,125:[1,89]},{1:[2,12],6:[2,12],25:[2,12],26:[2,12],49:[2,12],54:[2,12],57:[2,12],62:93,66:[1,95],67:[1,96],68:[1,97],69:98,70:[1,99],72:[2,12],73:[1,100],77:[2,12],80:92,83:[1,94],84:[2,107],85:[2,12],90:[2,12],92:[2,12],101:[2,12],103:[2,12],104:[2,12],105:[2,12],109:[2,12],117:[2,12],125:[2,12],127:[2,12],128:[2,12],131:[2,12],132:[2,12],133:[2,12],134:[2,12],135:[2,12],136:[2,12]},{1:[2,13],6:[2,13],25:[2,13],26:[2,13],49:[2,13],54:[2,13],57:[2,13],62:102,66:[1,95],67:[1,96],68:[1,97],69:98,70:[1,99],72:[2,13],73:[1,100],77:[2,13],80:101,83:[1,94],84:[2,107],85:[2,13],90:[2,13],92:[2,13],101:[2,13],103:[2,13],104:[2,13],105:[2,13],109:[2,13],117:[2,13],125:[2,13],127:[2,13],128:[2,13],131:[2,13],132:[2,13],133:[2,13],134:[2,13],135:[2,13],136:[2,13]},{1:[2,14],6:[2,14],25:[2,14],26:[2,14],49:[2,14],54:[2,14],57:[2,14],72:[2,14],77:[2,14],85:[2,14],90:[2,14],92:[2,14],101:[2,14],103:[2,14],104:[2,14],105:[2,14],109:[2,14],117:[2,14],125:[2,14],127:[2,14],128:[2,14],131:[2,14],132:[2,14],133:[2,14],134:[2,14],135:[2,14],136:[2,14]},{1:[2,15],6:[2,15],25:[2,15],26:[2,15],49:[2,15],54:[2,15],57:[2,15],72:[2,15],77:[2,15],85:[2,15],90:[2,15],92:[2,15],101:[2,15],103:[2,15],104:[2,15],105:[2,15],109:[2,15],117:[2,15],125:[2,15],127:[2,15],128:[2,15],131:[2,15],132:[2,15],133:[2,15],134:[2,15],135:[2,15],136:[2,15]},{1:[2,16],6:[2,16],25:[2,16],26:[2,16],49:[2,16],54:[2,16],57:[2,16],72:[2,16],77:[2,16],85:[2,16],90:[2,16],92:[2,16],101:[2,16],103:[2,16],104:[2,16],105:[2,16],109:[2,16],117:[2,16],125:[2,16],127:[2,16],128:[2,16],131:[2,16],132:[2,16],133:[2,16],134:[2,16],135:[2,16],136:[2,16]},{1:[2,17],6:[2,17],25:[2,17],26:[2,17],49:[2,17],54:[2,17],57:[2,17],72:[2,17],77:[2,17],85:[2,17],90:[2,17],92:[2,17],101:[2,17],103:[2,17],104:[2,17],105:[2,17],109:[2,17],117:[2,17],125:[2,17],127:[2,17],128:[2,17],131:[2,17],132:[2,17],133:[2,17],134:[2,17],135:[2,17],136:[2,17]},{1:[2,18],6:[2,18],25:[2,18],26:[2,18],49:[2,18],54:[2,18],57:[2,18],72:[2,18],77:[2,18],85:[2,18],90:[2,18],92:[2,18],101:[2,18],103:[2,18],104:[2,18],105:[2,18],109:[2,18],117:[2,18],125:[2,18],127:[2,18],128:[2,18],131:[2,18],132:[2,18],133:[2,18],134:[2,18],135:[2,18],136:[2,18]},{1:[2,19],6:[2,19],25:[2,19],26:[2,19],49:[2,19],54:[2,19],57:[2,19],72:[2,19],77:[2,19],85:[2,19],90:[2,19],92:[2,19],101:[2,19],103:[2,19],104:[2,19],105:[2,19],109:[2,19],117:[2,19],125:[2,19],127:[2,19],128:[2,19],131:[2,19],132:[2,19],133:[2,19],134:[2,19],135:[2,19],136:[2,19]},{1:[2,20],6:[2,20],25:[2,20],26:[2,20],49:[2,20],54:[2,20],57:[2,20],72:[2,20],77:[2,20],85:[2,20],90:[2,20],92:[2,20],101:[2,20],103:[2,20],104:[2,20],105:[2,20],109:[2,20],117:[2,20],125:[2,20],127:[2,20],128:[2,20],131:[2,20],132:[2,20],133:[2,20],134:[2,20],135:[2,20],136:[2,20]},{1:[2,21],6:[2,21],25:[2,21],26:[2,21],49:[2,21],54:[2,21],57:[2,21],72:[2,21],77:[2,21],85:[2,21],90:[2,21],92:[2,21],101:[2,21],103:[2,21],104:[2,21],105:[2,21],109:[2,21],117:[2,21],125:[2,21],127:[2,21],128:[2,21],131:[2,21],132:[2,21],133:[2,21],134:[2,21],135:[2,21],136:[2,21]},{1:[2,22],6:[2,22],25:[2,22],26:[2,22],49:[2,22],54:[2,22],57:[2,22],72:[2,22],77:[2,22],85:[2,22],90:[2,22],92:[2,22],101:[2,22],103:[2,22],104
:[2,22],105:[2,22],109:[2,22],117:[2,22],125:[2,22],127:[2,22],128:[2,22],131:[2,22],132:[2,22],133:[2,22],134:[2,22],135:[2,22],136:[2,22]},{1:[2,23],6:[2,23],25:[2,23],26:[2,23],49:[2,23],54:[2,23],57:[2,23],72:[2,23],77:[2,23],85:[2,23],90:[2,23],92:[2,23],101:[2,23],103:[2,23],104:[2,23],105:[2,23],109:[2,23],117:[2,23],125:[2,23],127:[2,23],128:[2,23],131:[2,23],132:[2,23],133:[2,23],134:[2,23],135:[2,23],136:[2,23]},{1:[2,9],6:[2,9],26:[2,9],101:[2,9],103:[2,9],105:[2,9],109:[2,9],125:[2,9]},{1:[2,10],6:[2,10],26:[2,10],101:[2,10],103:[2,10],105:[2,10],109:[2,10],125:[2,10]},{1:[2,11],6:[2,11],26:[2,11],101:[2,11],103:[2,11],105:[2,11],109:[2,11],125:[2,11]},{1:[2,75],6:[2,75],25:[2,75],26:[2,75],40:[1,103],49:[2,75],54:[2,75],57:[2,75],66:[2,75],67:[2,75],68:[2,75],70:[2,75],72:[2,75],73:[2,75],77:[2,75],83:[2,75],84:[2,75],85:[2,75],90:[2,75],92:[2,75],101:[2,75],103:[2,75],104:[2,75],105:[2,75],109:[2,75],117:[2,75],125:[2,75],127:[2,75],128:[2,75],131:[2,75],132:[2,75],133:[2,75],134:[2,75],135:[2,75],136:[2,75]},{1:[2,76],6:[2,76],25:[2,76],26:[2,76],49:[2,76],54:[2,76],57:[2,76],66:[2,76],67:[2,76],68:[2,76],70:[2,76],72:[2,76],73:[2,76],77:[2,76],83:[2,76],84:[2,76],85:[2,76],90:[2,76],92:[2,76],101:[2,76],103:[2,76],104:[2,76],105:[2,76],109:[2,76],117:[2,76],125:[2,76],127:[2,76],128:[2,76],131:[2,76],132:[2,76],133:[2,76],134:[2,76],135:[2,76],136:[2,76]},{1:[2,77],6:[2,77],25:[2,77],26:[2,77],49:[2,77],54:[2,77],57:[2,77],66:[2,77],67:[2,77],68:[2,77],70:[2,77],72:[2,77],73:[2,77],77:[2,77],83:[2,77],84:[2,77],85:[2,77],90:[2,77],92:[2,77],101:[2,77],103:[2,77],104:[2,77],105:[2,77],109:[2,77],117:[2,77],125:[2,77],127:[2,77],128:[2,77],131:[2,77],132:[2,77],133:[2,77],134:[2,77],135:[2,77],136:[2,77]},{1:[2,78],6:[2,78],25:[2,78],26:[2,78],49:[2,78],54:[2,78],57:[2,78],66:[2,78],67:[2,78],68:[2,78],70:[2,78],72:[2,78],73:[2,78],77:[2,78],83:[2,78],84:[2,78],85:[2,78],90:[2,78],92:[2,78],101:[2,78],103:[2,78],104:[2,78],105:[2,78],109:[2,78],117:[2,78],125:[2,78],127:[2,78],128:[2,78],131:[2,78],132:[2,78],133:[2,78],134:[2,78],135:[2,78],136:[2,78]},{1:[2,79],6:[2,79],25:[2,79],26:[2,79],49:[2,79],54:[2,79],57:[2,79],66:[2,79],67:[2,79],68:[2,79],70:[2,79],72:[2,79],73:[2,79],77:[2,79],83:[2,79],84:[2,79],85:[2,79],90:[2,79],92:[2,79],101:[2,79],103:[2,79],104:[2,79],105:[2,79],109:[2,79],117:[2,79],125:[2,79],127:[2,79],128:[2,79],131:[2,79],132:[2,79],133:[2,79],134:[2,79],135:[2,79],136:[2,79]},{1:[2,105],6:[2,105],25:[2,105],26:[2,105],49:[2,105],54:[2,105],57:[2,105],66:[2,105],67:[2,105],68:[2,105],70:[2,105],72:[2,105],73:[2,105],77:[2,105],81:104,83:[2,105],84:[1,105],85:[2,105],90:[2,105],92:[2,105],101:[2,105],103:[2,105],104:[2,105],105:[2,105],109:[2,105],117:[2,105],125:[2,105],127:[2,105],128:[2,105],131:[2,105],132:[2,105],133:[2,105],134:[2,105],135:[2,105],136:[2,105]},{6:[2,55],25:[2,55],27:109,28:[1,73],44:110,48:106,49:[2,55],54:[2,55],55:107,56:108,58:111,59:112,75:[1,70],88:[1,113],89:[1,114]},{5:115,25:[1,5]},{8:116,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:118,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:119,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{13:121,14:122,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:123,44:63,58:47,59:48,61:120,63:25,64:26,65:27,75:[1,70],82:[1,28],87:[1,58],88:[1,59],89:[1,57],100:[1,56]},{13:121,14:122,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:123,44:63,58:47,59:48,61:124,63:25,64:26,65:27,75:[1,70],82:[1,28],87:[1,58],88:[1,59],89:[1,57],100:[1,56]},{1:[2,72],6:[2,72],25:[2,72],26:[2,72],40:[2,72],49:[2,72],54:[2,72],57:[2,72],66:[2,72],67:[2,72],68:[2,72],70:[2,72],72:[2,72],73:[2,72],77:[2,72],79:[1,128],83:[2,72],84:[2,72],85:[2,72],90:[2,72],92:[2,72],101:[2,72],103:[2,72],104:[2,72],105:[2,72],109:[2,72],117:[2,72],125:[2,72],127:[2,72],128:[2,72],129:[1,125],130:[1,126],131:[2,72],132:[2,72],133:[2,72],134:[2,72],135:[2,72],136:[2,72],137:[1,127]},{1:[2,180],6:[2,180],25:[2,180],26:[2,180],49:[2,180],54:[2,180],57:[2,180],72:[2,180],77:[2,180],85:[2,180],90:[2,180],92:[2,180],101:[2,180],103:[2,180],104:[2,180],105:[2,180],109:[2,180],117:[2,180],120:[1,129],125:[2,180],127:[2,180],128:[2,180],131:[2,180],132:[2,180],133:[2,180],134:[2,180],135:[2,180],136:[2,180]},{5:130,25:[1,5]},{5:131,25:[1,5]},{1:[2,147],6:[2,147],25:[2,147],26:[2,147],49:[2,147],54:[2,147],57:[2,147],72:[2,147],77:[2,147],85:[2,147],90:[2,147],92:[2,147],101:[2,147],103:[2,147],104:[2,147],105:[2,147],109:[2,147],117:[2,147],125:[2,147],127:[2,147],128:[2,147],131:[2,147],132:[2,147],133:[2,147],134:[2,147],135:[2,147],136:[2,147]},{5:132,25:[1,5]},{8:133,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,134],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,95],5:135,6:[2,95],13:121,14:122,25:[1,5],26:[2,95],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:123,44:63,49:[2,95],54:[2,95],57:[2,95],58:47,59:48,61:137,63:25,64:26,65:27,72:[2,95],75:[1,70],77:[2,95],79:[1,136],82:[1,28],85:[2,95],87:[1,58],88:[1,59],89:[1,57],90:[2,95],92:[2,95],100:[1,56],101:[2,95],103:[2,95],104:[2,95],105:[2,95],109:[2,95],117:[2,95],125:[2,95],127:[2,95],128:[2,95],131:[2,95],132:[2,95],133:[2,95],134:[2,95],135:[2,95],136:[2,95]},{8:138,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,47],6:[2,47],8:139,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,26:[2,47],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],101:[2,47],102:39,103:[2,47],105:[2,47],106:40,107:[1,67],108:41,109:[2,47],110:69,118:[1,42],123:37,124:[1,64],125:[2,47],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,48],6:[2,48],25:[2,48],26:[2,48],54:[2,48],77:[2,48],101:[2,48],103:[2,48],105:[2,48],109:[2,48],125:[2,48]},{1:[2,73],6:[2,73],25:[2,73],26:[2,73],40:[2,73],49:[2,73],54:[2,73],57:[2,73],66:[2,73],67:[2,73],68:[2,73],70:[2,73],72:[2,73],73:[2,73],77:[2,73],83:[2,73],84:[2,73],85:[2,73],90:[2,73],92:[2,73],101:[2,73],103:[2,73],104:[2,73],105:[2,73],109:[2,73],117:[2,73],125:[2,73],127:[2,73],128:[2,73],131:[2,73],132:[2,73],133:[2,73],134:[2,73],135:[2,73],136:[2,73]},{1:[2,74],6:[2,74],25:[2,74],26:[2,74],40:[2,74],49:[2,74],54:[2,74],57:[2,74],66:[2,74],67:[2,74],68:[2,74],70:[2,74],72:[2,74],73:[2,74],77:[2,74],83:[2,74],84:[2,74],85:[2,74],90:[2,74],92:[2,74],101:[2,74],103:[2,74],104:[2,74],105:[2,74],109:[2,74],117:[2,74],125:[2,74],127:[2,74],128:[2,74],131:[2,74],132:[2,74],133:[2,74],134:[2,74],135:[2,74],136:[2,74]},{1:[2,29],6:[2,29],25:[2,29],26:[2,29],49:[2,29],54:[2,29],57:[2,29],66:[2,29],67:[2,29],68:[2,29],70:[2,29],72:[2,29],73:[2,29],77:[2,29],83:[2,29],84:[2,29],85:[2,29],90:[2,29],92:[2,29],101:[2,29],103:[2,29],104:[2,29],105:[2,29],109:[2,29],117:[2,29],125:[2,29],127:[2,29],128:[2,29],131:[2,29],132:[2,29],133:[2,29],134:[2,29],135:[2,29],136:[2,29]},{1:[2,30],6:[2,30],25:[2,30],26:[2,30],49:[2,30],54:[2,30],57:[2,30],66:[2,30],67:[2,30],68:[2,30],70:[2,30],72:[2,30],73:[2,30],77:[2,30],83:[2,30],84:[2,30],85:[2,30],90:[2,30],92:[2,30],101:[2,30],103:[2,30],104:[2,30],105:[2,30],109:[2,30],117:[2,30],125:[2,30],127:[2,30],128:[2,30],131:[2,30],132:[2,30],133:[2,30],134:[2,30],135:[2,30],136:[2,30]},{1:[2,31],6:[2,31],25:[2,31],26:[2,31],49:[2,31],54:[2,31],57:[2,31],66:[2,31],67:[2,31],68:[2,31],70:[2,31],72:[2,31],73:[2,31],77:[2,31],83:[2,31],84:[2,31],85:[2,31],90:[2,31],92:[2,31],101:[2,31],103:[2,31],104:[2,31],105:[2,31],109:[2,31],117:[2,31],125:[2,31],127:[2,31],128:[2,31],131:[2,31],132:[2,31],133:[2,31],134:[2,31],135:[2,31],136:[2,31]},{1:[2,32],6:[2,32],25:[2,32],26:[2,32],49:[2,32],54:[2,32],57:[2,32],66:[2,32],67:[2,32],68:[2,32],70:[2,32],72:[2,32],73:[2,32],77:[2,32],83:[2,32],84:[2,32],85:[2,32],90:[2,32],92:[2,32],101:[2,32],103:[2,32],104:[2,32],105:[2,32],109:[2,32],117:[2,32],125:[2,32],127:[2,32],128:[2,32],131:[2,32],132:[2,32],133:[2,32],134:[2,32],135:[2,32],136:[2,32]},{1:[2,33],6:[2,33],25:[2,33],26:[2,33],49:[2,33],54:[2,33],57:[2,33],66:[2,33],67:[2,33],68:[2,33],70:[2,33],72:[2,33],73:[2,33],77:[2,33],83:[2,33],84:[2,33],85:[2,33],90:[2,33],92:[2,33],101:[2,33],103:[2,33],104:[2,33],105:[2,33],109:[2,33],117:[2,33],125:[2,33],127:[2,33],128:[2,33],131:[2,33],132:[2,33],133:[2,33],134:[2,33],135:[2,33],136:[2,33]},{1:[2,34],6:[2,34],25:[2,34],26:[2,34],49:[2,34],54:[2,34],57:[2,34],66:[2,34],67:[2,34],68:[2,34],70:[2,34],72:[2,34],73:[2,34],77:[2,34],83:[2,34],84:[2,34],85:[2,34],90:[2,34],92:[2,34],101:[2,34],103:[2,34],104:[2,34],105:[2,34],109:[2,34],117:[2,34],125:[2,34],127:[2,34],128:[2,34],131:[2,34],132:[2,34],133:[2,34],134:[2,34],135:[2,34],136:[2,34]},{1:[2,35],6:[2,35],25:[2,35],26:[2,35],49:[2,35],54:[2,35],57:[2,35],66:[2,35],67:[2,35],68:[2,35],70:[2,35],72:[2,35],73:[2,35],77:[2,35],83:[2,35],84:[2,35],85:[2,35],90:[2,35],92:[2,35],101:[2,35],103:[2,35],104:[2,35],105:[2,35],109:[2,35],117:[2,35],125:[2,35],127:[2,35],128:[2,35],131:[2,35],132:[2,35],133:[2,35],134:[2,35],135:[2,35],136:[2,35]},{4:140,7:4,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,141],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:142,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,146],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],86:144,87:[1,58],88:[1,59],89:[1,57],90:[1,143],93:145,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,111],6:[2,111],25:[2,111],26:[2,111],49:[2,111],54:[2,111],57:[2,111],66:[2,111],67:[2,111],68:[2,111],70:[2,111],72:[2,111],73:[2,111],77:[2,111],83:[2,111],84:[2,111],85:[2,111],90:[2,111],92:[2,111],101:[2,111],103:[2,111],104:[2,111],105:[2,111],109:[2,111],117:[2,111],125:[2,111],127:[2,111],128:[2,111],131:[2,111],132:[2,111],133:[2,111],134:[2,111],135:[2,111],136:[2,111]},{1:[2,112],6:[2,112],25:[2,112],26:[2,112],27:148,28:[1,73],49:[2,112],54:[2,112],57:[2,112],66:[2,112],67:[2,112],68:[2,112],70:[2,112],72:[2,112],73:[2,112],77:[2,112],83:[2,112],84:[2,112],85:[2,112],90:[2,112],92:[2,112],101:[2,112],103:[2,112],104:[2,112],105:[2,112],109:[2,112],117:[2,112],125:[2,112],127:[2,112],128:[2,112],131:[2,112],132:[2,112],133:[2,112],134:[2,112],135:[2,112],136:[2,112]},{25:[2,51]},{25:[2,52]},{1:[2,68],6:[2,68],25:[2,68],26:[2,68],40:[2,68],49:[2,68],54:[2,68],57:[2,68],66:[2,68],67:[2,68],68:[2,68],70:[2,68],72:[2,68],73:[2,68],77:[2,68],79:[2,68],83:[2,68],84:[2,68],85:[2,68],90:[2,68],92:[2,68],101:[2,68],103:[2,68],104:[2,68],105:[2,68],109:[2,68],117:[2,68],125:[2,68],127:[2,68],128:[2,68],129:[2,68],130:[2,68],131:[2,68],132:[2,68],133:[2,68],134:[2,68],135:[2,68],136:[2,68],137:[2,68]},{1:[2,71],6:[2,71],25:[2,71],26:[2,71],40:[2,71],49:[2,71],54:[2,71],57:[2,71],66:[2,71],67:[2,71],68:[2,71],70:[2,71],72:[2,71],73:[2,71],77:[2,71],79:[2,71],83:[2,71],84:[2,71],85:[2,71],90:[2,71],92:[2,71],101:[2,71],103:[2,71],104:[2,71],105:[2,71],109:[2,71],117:[2,71],125:[2,71],127:[2,71],128:[2,71],129:[2,71],130:[2,71],131:[2,71],132:[2,71],133:[2,71],134:[2,71],135:[2,71],136:[2,71],137:[2,71]},{8:149,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:150,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:151,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{5:152,8:153,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,5],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{27:158,28:[1,73],44:159,58:160,59:161,64:154,75:[1,70],88:[1,113],89:[1,57],112:155,113:[1,156],114:157},{111:162,115:[1,163],116:[1,164]},{6:[2,90],11:168,25:[2,90],27:169,28:[1,73],29:170,30:[1,71],31:[1,72],41:166,42:167,44:171,46:[1,46],54:[2,90],76:165,77:[2,90],88:[1,113]},{1:[2,27],6:[2,27],25:[2,27],26:[2,27],43:[2,27],49:[2,27],54:[2,27],57:[2,27],66:[2,27],67:[2,27],68:[2,27],70:[2,27],72:[2,27],73:[2,27],77:[2,27],83:[2,27],84:[2,27],85:[2,27],90:[2,27],92:[2,27],101:[2,27],103:[2,27],104:[2,27],105:[2,27],109:[2,27],117:[2,27],125:[2,27],127:[2,27],128:[2,27],131:[2,27],132:[2,27],133:[2,27],134:[2,27],135:[2,27],136:[2,27]},{1:[2,28],6:[2,28],25:[2,28],26:[2,28],43:[2,28],49:[2,28],54:[2,28],57:[2,28],66:[2,28],67:[2,28],68:[2,28],70:[2,28],72:[2,28],73:[2,28],77:[2,28],83:[2,28],84:[2,28],85:[2,28],90:[2,28],92:[2,28],101:[2,28],103:[2,28],104:[2,28],105:[2,28],109:[2,28],117:[2,28],125:[2,28],127:[2,28],128:[2,28],131:[2,28],132:[2,28],133:[2,28],134:[2,28],135:[2,28],136:[2,28]},{1:[2,26],6:[2,26],25:[2,26],26:[2,26],40:[2,26],43:[2,26],49:[2,26],54:[2,26],57:[2,26],66:[2,26],67:[2,26],68:[2,26],70:[2,26],72:[2,26],73:[2,26],77:[2,26],79:[2,26],83:[2,26],84:[2,26],85:[2,26],90:[2,26],92:[2,26],101:[2,26],103:[2,26],104:[2,26],105:[2,26],109:[2,26],115:[2,26],116:[2,26],117:[2,26],125:[2,26],127:[2,26],128:[2,26],129:[2,26],130:[2,26],131:[2,26],132:[2,26],133:[2,26],134:[2,26],135:[2,26],136:[2,26],137:[2,26]},{1:[2,6],6:[2,6],7:172,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,26:[2,6],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],101:[2,6],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,3]},{1:[2,24],6:[2,24],25:[2,24],26:[2,24],49:[2,24],54:[2,24],57:[2,24],72:[2,24],77:[2,24],85:[2,24],90:[2,24],92:[2,24],97:[2,24],98:[2,24],101:[2,24],103:[2,24],104:[2,24],105:[2,24],109:[2,24],117:[2,24],120:[2,24],122:[2,24],125:[2,24],127:[2,24],128:[2,24],131:[2,24],132:[2,24],133:[2,24],134:[2,24],135:[2,24],136:[2,24]},{6:[1,74],26:[1,173]},{1:[2,191],6:[2,191],25:[2,191],26:[2,191],49:[2,191],54:[2,191],57:[2,191],72:[2,191],77:[2,191],85:[2,191],90:[2,191],92:[2,191],101:[2,191],103:[2,191],104:[2,191],105:[2,191],109:[2,191],117:[2,191],125:[2,191],127:[2,191],128:[2,191],131:[2,191],132:[2,191],133:[2,191],134:[2,191],135:[2,191],136:[2,191]},{8:174,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:175,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:176,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:177,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:178,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:179,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:180,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:181,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,146],6:[2,146],25:[2,146],26:[2,146],49:[2,146],54:[2,146],57:[2,146],72:[2,146],77:[2,146],85:[2,146],90:[2,146],92:[2,146],101:[2,146],103:[2,146],104:[2,146],105:[2,146],109:[2,146],117:[2,146],125:[2,146],127:[2,146],128:[2,146],131:[2,146],132:[2,146],133:[2,146],134:[2,146],135:[2,146],136:[2,146]},{1:[2,151],6:[2,151],25:[2,151],26:[2,151],49:[2,151],54:[2,151],57:[2,151],72:[2,151],77:[2,151],85:[2,151],90:[2,151],92:[2,151],101:[2,151],103:[2,151],104:[2,151],105:[2,151],109:[2,151],117:[2,151],125:[2,151],127:[2,151],128:[2,151],131:[2,151],132:[2,151],133:[2,151],134:[2,151],135:[2,151],136:[2,151]},{8:182,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,145],6:[2,145],25:[2,145],26:[2,145],49:[2,145],54:[2,145],57:[2,145],72:[2,145],77:[2,145],85:[2,145],90:[2,145],92:[2,145],101:[2,145],103:[2,145],104:[2,145],105:[2,145],109:[2,145],117:[2,145],125:[2,145],127:[2,145],128:[2,145],131:[2,145],132:[2,145],133:[2,145],134:[2,145],135:[2,145],136:[2,145]},{1:[2,150],6:[2,150],25:[2,150],26:[2,150],49:[2,150],54:[2,150],57:[2,150],72:[2,150],77:[2,150],85:[2,150],90:[2,150],92:[2,150],101:[2,150],103:[2,150],104:[2,150],105:[2,150],109:[2,150],117:[2,150],125:[2,150],127:[2,150],128:[2,150],131:[2,150],132:[2,150],133:[2,150],134:[2,150],135:[2,150],136:[2,150]},{81:183,84:[1,105]},{1:[2,69],6:[2,69],25:[2,69],26:[2,69],40:[2,69],49:[2,69],54:[2,69],57:[2,69],66:[2,69],67:[2,69],68:[2,69],70:[2,69],72:[2,69],73:[2,69],77:[2,69],79:[2,69],83:[2,69],84:[2,69],85:[2,69],90:[2,69],92:[2,69],101:[2,69],103:[2,69],104:[2,69],105:[2,69],109:[2,69],117:[2,69],125:[2,69],127:[2,69],128:[2,69],129:[2,69],130:[2,69],131:[2,69],132:[2,69],133:[2,69],134:[2,69],135:[2,69],136:[2,69],137:[2,69]},{84:[2,108]},{27:184,28:[1,73]},{27:185,28:[1,73]},{1:[2,83],6:[2,83],25:[2,83],26:[2,83],27:186,28:[1,73],40:[2,83],49:[2,83],54:[2,83],57:[2,83],66:[2,83],67:[2,83],68:[2,83],70:[2,83],72:[2,83],73:[2,83],77:[2,83],79:[2,83],83:[2,83],84:[2,83],85:[2,83],90:[2,83],92:[2,83],101:[2,83],103:[2,83],104:[2,83],105:[2,83],109:[2,83],117:[2,83],125:[2,83],127:[2,83],128:[2,83],129:[2,83],130:[2,83],131:[2,83],132:[2,83],133:[2,83],134:[2,83],135:[2,83],136:[2,83],137:[2,83]},{1:[2,84],6:[2,84],25:[2,84],26:[2,84],40:[2,84],49:[2,84],54:[2,84],57:[2,84],66:[2,84],67:[2,84],68:[2,84],70:[2,84],72:[2,84],73:[2,84],77:[2,84],79:[2,84],83:[2,84],84:[2,84],85:[2,84],90:[2,84],92:[2,84],101:[2,84],103:[2,84],104:[2,84],105:[2,84],109:[2,84],117:[2,84],125:[2,84],127:[2,84],128:[2,84],129:[2,84],130:[2,84],131:[2,84],132:[2,84],133:[2,84],134:[2,84],135:[2,84],136:[2,84],137:[2,84]},{8:188,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],57:[1,192],58:47,59:48,61:36,63:25,64:26,65:27,71:187,74:189,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],91:190,92:[1,191],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{69:193,70:[1,99],73:[1,100]},{81:194,84:[1,105]},{1:[2,70],6:[2,70],25:[2,70],26:[2,70],40:[2,70],49:[2,70],54:[2,70],57:[2,70],66:[2,70],67:[2,70],68:[2,70],70:[2,70],72:[2,70],73:[2,70],77:[2,70],79:[2,70],83:[2,70],84:[2,70],85:[2,70],90:[2,70],92:[2,70],101:[2,70],103:[2,70],104:[2,70],105:[2,70],109:[2,70],117:[2,70],125:[2,70],127:[2,70],128:[2,70],129:[2,70],130:[2,70],131:[2,70],132:[2,70],133:[2,70],134:[2,70],135:[2,70],136:[2,70],137:[2,70]},{6:[1,196],8:195,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,197],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,106],6:[2,106],25:[2,106],26:[2,106],49:[2,106],54:[2,106],57:[2,106],66:[2,106],67:[2,106],68:[2,106],70:[2,106],72:[2,106],73:[2,106],77:[2,106],83:[2,106],84:[2,106],85:[2,106],90:[2,106],92:[2,106],101:[2,106],103:[2,106],104:[2,106],105:[2,106],109:[2,106],117:[2,106],125:[2,106],127:[2,106],128:[2,106],131:[2,106],132:[2,106],133:[2,106],134:[2,106],135:[2,106],136:[2,106]},{8:200,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,146],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],85:[1,198],86:199,87:[1,58],88:[1,59],89:[1,57],93:145,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,53],25:[2,53],49:[1,201],53:203,54:[1,202]},{6:[2,56],25:[2,56],26:[2,56],49:[2,56],54:[2,56]},{6:[2,60],25:[2,60],26:[2,60],40:[1,205],49:[2,60],54:[2,60],57:[1,204]},{6:[2,63],25:[2,63],26:[2,63],40:[2,63],49:[2,63],54:[2,63],57:[2,63]},{6:[2,64],25:[2,64],26:[2,64],40:[2,64],49:[2,64],54:[2,64],57:[2,64]},{6:[2,65],25:[2,65],26:[2,65],40:[2,65],49:[2,65],54:[2,65],57:[2,65]},{6:[2,66],25:[2,66],26:[2,66],40:[2,66],49:[2,66],54:[2,66],57:[2,66]},{27:148,28:[1,73]},{8:200,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,146],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],86:144,87:[1,58],88:[1,59],89:[1,57],90:[1,143],93:145,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,50],6:[2,50],25:[2,50],26:[2,50],49:[2,50],54:[2,50],57:[2,50],72:[2,50],77:[2,50],85:[2,50],90:[2,50],92:[2,50],101:[2,50],103:[2,50],104:[2,50],105:[2,50],109:[2,50],117:[2,50],125:[2,50],127:[2,50],128:[2,50],131:[2,50],132:[2,50],133:[2,50],134:[2,50],135:[2,50],136:[2,50]},{1:[2,184],6:[2,184],25:[2,184],26:[2,184],49:[2,184],54:[2,184],57:[2,184],72:[2,184],77:[2,184],85:[2,184],90:[2,184],92:[2,184],101:[2,184],102:87,103:[2,184],104:[2,184],105:[2,184],108:88,109:[2,184],110:69,117:[2,184],125:[2,184],127:[2,184],128:[2,184],131:[1,78],132:[2,184],133:[2,184],134:[2,184],135:[2,184],136:[2,184]},{102:90,103:[1,65],105:[1,66],108:91,109:[1,68],110:69,125:[1,89]},{1:[2,185],6:[2,185],25:[2,185],26:[2,185],49:[2,185],54:[2,185],57:[2,185],72:[2,185],77:[2,185],85:[2,185],90:[2,185],92:[2,185],101:[2,185],102:87,103:[2,185],104:[2,185],105:[2,185],108:88,109:[2,185],110:69,117:[2,185],125:[2,185],127:[2,185],128:[2,185],131:[1,78],132:[2,185],133:[2,185],134:[2,185],135:[2,185],136:[2,185]},{1:[2,186],6:[2,186],25:[2,186],26:[2,186],49:[2,186],54:[2,186],57:[2,186],72:[2,186],77:[2,186],85:[2,186],90:[2,186],92:[2,186],101:[2,186],102:87,103:[2,186],104:[2,186],105:[2,186],108:88,109:[2,186],110:69,117:[2,186],125:[2,186],127:[2,186],128:[2,186],131:[1,78],132:[2,186],133:[2,186],134:[2,186],135:[2,186],136:[2,186]},{1:[2,187],6:[2,187],25:[2,187],26:[2,187],49:[2,187],54:[2,187],57:[2,187],66:[2,72],67:[2,72],68:[2,72],70:[2,72],72:[2,187],73:[2,72],77:[2,187],83:[2,72],84:[2,72],85:[2,187],90:[2,187],92:[2,187],101:[2,187],103:[2,187],104:[2,187],105:[2,187],109:[2,187],117:[2,187],125:[2,187],127:[2,187],128:[2,187],131:[2,187],132:[2,187
],133:[2,187],134:[2,187],135:[2,187],136:[2,187]},{62:93,66:[1,95],67:[1,96],68:[1,97],69:98,70:[1,99],73:[1,100],80:92,83:[1,94],84:[2,107]},{62:102,66:[1,95],67:[1,96],68:[1,97],69:98,70:[1,99],73:[1,100],80:101,83:[1,94],84:[2,107]},{66:[2,75],67:[2,75],68:[2,75],70:[2,75],73:[2,75],83:[2,75],84:[2,75]},{1:[2,188],6:[2,188],25:[2,188],26:[2,188],49:[2,188],54:[2,188],57:[2,188],66:[2,72],67:[2,72],68:[2,72],70:[2,72],72:[2,188],73:[2,72],77:[2,188],83:[2,72],84:[2,72],85:[2,188],90:[2,188],92:[2,188],101:[2,188],103:[2,188],104:[2,188],105:[2,188],109:[2,188],117:[2,188],125:[2,188],127:[2,188],128:[2,188],131:[2,188],132:[2,188],133:[2,188],134:[2,188],135:[2,188],136:[2,188]},{1:[2,189],6:[2,189],25:[2,189],26:[2,189],49:[2,189],54:[2,189],57:[2,189],72:[2,189],77:[2,189],85:[2,189],90:[2,189],92:[2,189],101:[2,189],103:[2,189],104:[2,189],105:[2,189],109:[2,189],117:[2,189],125:[2,189],127:[2,189],128:[2,189],131:[2,189],132:[2,189],133:[2,189],134:[2,189],135:[2,189],136:[2,189]},{1:[2,190],6:[2,190],25:[2,190],26:[2,190],49:[2,190],54:[2,190],57:[2,190],72:[2,190],77:[2,190],85:[2,190],90:[2,190],92:[2,190],101:[2,190],103:[2,190],104:[2,190],105:[2,190],109:[2,190],117:[2,190],125:[2,190],127:[2,190],128:[2,190],131:[2,190],132:[2,190],133:[2,190],134:[2,190],135:[2,190],136:[2,190]},{8:206,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,207],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:208,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{5:209,25:[1,5],124:[1,210]},{1:[2,132],6:[2,132],25:[2,132],26:[2,132],49:[2,132],54:[2,132],57:[2,132],72:[2,132],77:[2,132],85:[2,132],90:[2,132],92:[2,132],96:211,97:[1,212],98:[1,213],101:[2,132],103:[2,132],104:[2,132],105:[2,132],109:[2,132],117:[2,132],125:[2,132],127:[2,132],128:[2,132],131:[2,132],132:[2,132],133:[2,132],134:[2,132],135:[2,132],136:[2,132]},{1:[2,144],6:[2,144],25:[2,144],26:[2,144],49:[2,144],54:[2,144],57:[2,144],72:[2,144],77:[2,144],85:[2,144],90:[2,144],92:[2,144],101:[2,144],103:[2,144],104:[2,144],105:[2,144],109:[2,144],117:[2,144],125:[2,144],127:[2,144],128:[2,144],131:[2,144],132:[2,144],133:[2,144],134:[2,144],135:[2,144],136:[2,144]},{1:[2,152],6:[2,152],25:[2,152],26:[2,152],49:[2,152],54:[2,152],57:[2,152],72:[2,152],77:[2,152],85:[2,152],90:[2,152],92:[2,152],101:[2,152],103:[2,152],104:[2,152],105:[2,152],109:[2,152],117:[2,152],125:[2,152],127:[2,152],128:[2,152],131:[2,152],132:[2,152],133:[2,152],134:[2,152],135:[2,152],136:[2,152]},{25:[1,214],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{119:215,121:216,122:[1,217]},{1:[2,96],6:[2,96],25:[2,96],26:[2,96],49:[2,96],54:[2,96],57:[2,96],72:[2,96],77:[2,96],85:[2,96],90:[2,96],92:[2,96],101:[2,96],103:[2,96],104:[2,96],105:[2,96],109:[2,96],117:[2,96],125:[2,96],127:[2,96],128:[2,96],131:[2,96],132:[2,96],133:[2,96],134:[2,96],135:[2,96],136:[2,96]},{8:218,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,99],5:219,6:[2,99],25:[1,5],26:[2,99],49:[2,99],54:[2,99],57:[2,99],66:[2,72],67:[2,72],68:[2,72],70:[2,72],72:[2,99],73:[2,72],77:[2,99],79:[1,220],83:[2,72],84:[2,72],85:[2,99],90:[2,99],92:[2,99],101:[2,99],103:[2,99],104:[2,99],105:[2,99],109:[2,99],117:[2,99],125:[2,99],127:[2,99],128:[2,99],131:[2,99],132:[2,99],133:[2,99],134:[2,99],135:[2,99],136:[2,99]},{1:[2,137],6:[2,137],25:[2,137],26:[2,137],49:[2,137],54:[2,137],57:[2,137],72:[2,137],77:[2,137],85:[2,137],90:[2,137],92:[2,137],101:[2,137],102:87,103:[2,137],104:[2,137],105:[2,137],108:88,109:[2,137],110:69,117:[2,137],125:[2,137],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,46],6:[2,46],26:[2,46],101:[2,46],102:87,103:[2,46],105:[2,46],108:88,109:[2,46],110:69,125:[2,46],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[1,74],101:[1,221]},{4:222,7:4,8:6,9:7,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,128],25:[2,128],54:[2,128],57:[1,224],90:[2,128],91:223,92:[1,191],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,114],6:[2,114],25:[2,114],26:[2,114],40:[2,114],49:[2,114],54:[2,114],57:[2,114],66:[2,114],67:[2,114],68:[2,114],70:[2,114],72:[2,114],73:[2,114],77:[2,114],83:[2,114],84:[2,114],85:[2,114],90:[2,114],92:[2,114],101:[2,114],103:[2,114],104:[2,114],105:[2,114],109:[2,114],115:[2,114],116:[2,114],117:[2,114],125:[2,114],127:[2,114],128:[2,114],131:[2,114],132:[2,114],133:[2,114],134:[2,114],135:[2,114],136:[2,114]},{6:[2,53],25:[2,53],53:225,54:[1,226],90:[2,53]},{6:[2,123],25:[2,123],26:[2,123],54:[2,123],85:[2,123],90:[2,123]},{8:200,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,146],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],86:227,87:[1,58],88:[1,59],89:[1,57],93:145,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,129],25:[2,129],26:[2,129],54:[2,129],85:[2,129],90:[2,129]},{1:[2,113],6:[2,113],25:[2,113],26:[2,113],40:[2,113],43:[2,113],49:[2,113],54:[2,113],57:[2,113],66:[2,113],67:[2,113],68:[2,113],70:[2,113],72:[2,113],73:[2,113],77:[2,113],79:[2,113],83:[2,113],84:[2,113],85:[2,113],90:[2,113],92:[2,113],101:[2,113],103:[2,113],104:[2,113],105:[2,113],109:[2,113],115:[2,113],116:[2,113],117:[2,113],125:[2,113],127:[2,113],128:[2,113],129:[2,113],130:[2,113],131:[2,113],132:[2,113],133:[2,113],134:[2,113],135:[2,113],136:[2,113],137:[2,113]},{5:228,25:[1,5],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,140],6:[2,140],25:[2,140],26:[2,140],49:[2,140],54:[2,140],57:[2,140],72:[2,140],77:[2,140],85:[2,140],90:[2,140],92:[2,140],101:[2,140],102:87,103:[1,65],104:[1,229],105:[1,66],108:88,109:[1,68],110:69,117:[2,140],125:[2,140],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,142],6:[2,142],25:[2,142],26:[2,142],49:[2,142],54:[2,142],57:[2,142],72:[2,142],77:[2,142],85:[2,142],90:[2,142],92:[2,142],101:[2,142],102:87,103:[1,65],104:[1,230],105:[1,66],108:88,109:[1,68],110:69,117:[2,142],125:[2,142],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,148],6:[2,148],25:[2,148],26:[2,148],49:[2,148],54:[2,148],57:[2,148],72:[2,148],77:[2,148],85:[2,148],90:[2,148],92:[2,148],101:[2,148],103:[2,148],104:[2,148],105:[2,148],109:[2,148],117:[2,148],125:[2,148],127:[2,148],128:[2,148],131:[2,148],132:[2,148],133:[2,148],134:[2,148],135:[2,148],136:[2,148]},{1:[2,149],6:[2,149],25:[2,149],26:[2,149],49:[2,149],54:[2,149],57:[2,149],72:[2,149],77:[2,149],85:[2,149],90:[2,149],92:[2,149],101:[2,149],102:87,103:[1,65],104:[2,149],105:[1,66],108:88,109:[1,68],110:69,117:[2,149],125:[2,149],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,153],6:[2,153],25:[2,153],26:[2,153],49:[2,153],54:[2,153],57:[2,153],72:[2,153],77:[2,153],85:[2,153],90:[2,153],92:[2,153],101:[2,153],103:[2,153],104:[2,153],105:[2,153],109:[2,153],117:[2,153],125:[2,153],127:[2,153],128:[2,153],131:[2,153],132:[2,153],133:[2,153],134:[2,153],135:[2,153],136:[2,153]},{115:[2,155],116:[2,155]},{27:158,28:[1,73],44:159,58:160,59:161,75:[1,70],88:[1,113],89:[1,114],112:231,114:157},{54:[1,232],115:[2,161],116:[2,161]},{54:[2,157],115:[2,157],116:[2,157]},{54:[2,158],115:[2,158],116:[2,158]},{54:[2,159],115:[2,159],116:[2,159]},{54:[2,160],115:[2,160],116:[2,160]},{1:[2,154],6:[2,154],25:[2,154],26:[2,154],49:[2,154],54:[2,154],57:[2,154],72:[2,154],77:[2,154],85:[2,154],90:[2,154],92:[2,154],101:[2,154],103:[2,154],104:[2,154],105:[2,154],109:[2,154],117:[2,154],125:[2,154],127:[2,154],128:[2,154],131:[2,154],132:[2,154],133:[2,154],134:[2,154],135:[2,154],136:[2,154]},{8:233,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:234,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,53],25:[2,53],53:235,54:[1,236],77:[2,53]},{6:[2,91],25:[2,91],26:[2,91],54:[2,91],77:[2,91]},{6:[2,39],25:[2,39],26:[2,39],43:[1,237],54:[2,39],77:[2,39]},{6:[2,42],25:[2,42],26:[2,42],54:[2,42],77:[2,42]},{6:[2,43],25:[2,43],26:[2,43],43:[2,43],54:[2,43],77:[2,43]},{6:[2,44],25:[2,44],26:[2,44],43:[2,44],54:[2,44],77:[2,44]},{6:[2,45],25:[2,45],26:[2,45],43:[2,45],54:[2,45],77:[2,45]},{1:[2,5],6:[2,5],26:[2,5],101:[2,5]},{1:[2,25],6:[2,25],25:[2,25],26:[2,25],49:[2,25],54:[2,25],57:[2,25],72:[2,25],77:[2,25],85:[2,25],90:[2,25],92:[2,25],97:[2,25],98:[2,25],101:[2,25],103:[2,25],104:[2,25],105:[2,25],109:[2,25],117:[2,25],120:[2,25],122:[2,25],125:[2,25],127:[2,25],128:[2,25],131:[2,25],132:[2,25],133:[2,25],134:[2,25],135:[2,25],136:[2,25]},{1:[2,192],6:[2,192],25:[2,192],26:[2,192],49:[2,192],54:[2,192],57:[2,192],72:[2,192],77:[2,192],85:[2,192],90:[2,192],92:[2,192],101:[2,192],102:87,103:[2,192],104:[2,192],105:[2,192],108:88,109:[2,192],110:69,117:[2,192],125:[2,192],127:[2,192],128:[2,192],131:[1,78],132:[1,81],133:[2,192],134:[2,192],135:[2,192],136:[2,192]},{1:[2,193],6:[2,193],25:[2,193],26:[2,193],49:[2,193],54:[2,193],57:[2,193],72:[2,193],77:[2,193],85:[2,193],90:[2,193],92:[2,193],101:[2,193],102:87,103:[2,193],104:[2,193],105:[2,193],108:88,109:[2,193],110:69,117:[2,193],125:[2,193],127:[2,193],128:[2,193],131:[1,78],132:[1,81],133:[2,193],134:[2,193],135:[2,193],136:[2,193]},{1:[2,194],6:[2,194],25:[2,194],26:[2,194],49:[2,194],54:[2,194],57:[2,194],72:[2,194],77:[2,194],85:[2,194],90:[2,194],92:[2,194],101:[2,194],102:87,103:[2,194],104:[2,194],105:[2,194],108:88,109:[2,194],110:69,117:[2,194],125:[2,194],127:[2,194],128:[2,194],131:[1,78],132:[2,194],133:[2,194],134:[2,194],135:[2,194],136:[2,194]},{1:[2,195],6:[2,195],25:[2,195],26:[2,195],49:[2,195],54:[2,195],57:[2,195],72:[2,195],77:[2,195],85:[2,195],90:[2,195],92:[2,195],101:[2,195],102:87,103:[2,195],104:[2,195],105:[2,195],108:88,109:[2,195],110:69,117:[2,195],125:[2,195],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[2,195],134:[2,195],135:[2,195],136:[2,195]},{1:[2,196],6:[2,196],25:[2,196],26:[2,196],49:[2,196],54:[2,196],57:[2,196],72:[2,196],77:[2,196],85:[2,196],90:[2,196],92:[2,196],101:[2,196],102:87,103:[2,196],104:[2,196],105:[2,196],108:88,109:[2,196],110:69,117:[2,196],125:[2,196],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[2,196],135:[2,196],136:[1,85]},{1:[2,197],6:[2,197],25:[2,197],26:[2,197],49:[2,197],54:[2,197],57:[2,197],72:[2,197],77:[2,197],85:[2,197],90:[2,197],92:[2,197],101:[2,197],102:87,103:[2,197],104:[2,197],105:[2,197],108:88,109:[2,197],110:69,117:[2,197],125:[2,197],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[2,197],136:[1,85]},{1:[2,198],6:[2,198],25:[2,198],26:[2,198],49:[2,198],54:[2,198],57:[2,198],72:[2,198],77:[2,198],85:[2,198],90:[2,198],92:[2,198],101:[2,198],102:87,103:[2,198],104:[2,198],105:[2,198],108:88,109:[2,198],110:69,117:[2,198],125:[2,198],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[2,198],135:[2,198],136:[2,198]},{1:[2,183],6:[2,183],25:[2,183],26:[2,183],49:[2,183],54:[2,183],57:[2,183],72:[2,183],77:[2,183],85:[2,183],90:[2,183],92:[2,183],101:[2,183],102:87,103:[1,65],104:[2,183],105:[1,66],108:88,109:[1,68],110:69,117:[2,183],125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,182],6:[2,182],25:[2,182],26:[2,182],49:[2,182],54:[2,182],57:[2,182],72:[2,182],77:[2,182],85:[2,182],90:[2,182],92:[2,182],101:[2,182],102:87,103:[1,65],104:[2,182],105:[1,66],108:88,109:[1,68],110:69,117:[2,182],125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,103],6:[2,103],25:[2,103],26:[2,103],49:[2,103],54:[2,103],57:[2,103],66:[2,103],67:[2,103],68:[2,103],70:[2,103],72:[2,103],73:[2,103],77:[2,103],83:[2,103],84:[2,103],85:[2,103],90:[2,103],92:[2,103],101:[2,103],103:[2,103],104:[2,103],105:[2,103],109:[2,103],117:[2,103],125:[2,103],127:[2,103],128:[2,103],131:[2,103],132:[2,103],133:[2,103],134:[2,103],135:[2,103],136:[2,103]},{1:[2,80],6:[2,80],25:[2,80],26:[2,80],40:[2,80],49:[2,80],54:[2,80],57:[2,80],66:[2,80],67:[2,80],68:[2,80],70:[2,80],72:[2,80],73:[2,80],77:[2,80],79:[2,80],83:[2,80],84:[2,80],85:[2,80],90:[2,80],92:[2,80],101:[2,80],103:[2,80],104:[2,80],105:[2,80],109:[2,80],117:[2,80],125:[2,80],127:[2,80],128:[2,80],129:[2,80],130:[2,80],131:[2,80],132:[2,80],133:[2,80],134:[2,80],135:[2,80],136:[2,80],137:[2,80]},{1:[2,81],6:[2,81],25:[2,81],26:[2,81],40:[2,81],49:[2,81],54:[2,81],57:[2,81],66:[2,81],67:[2,81],68:[2,81],70:[2,81],72:[2,81],73:[2,81],77:[2,81],79:[2,81],83:[2,81],84:[2,81],85:[2,81],90:[2,81],92:[2,81],101:[2,81],103:[2,81],104:[2,81],105:[2,81],109:[2,81],117:[2,81],125:[2,81],127:[2,81],128:[2,81],129:[2,81],130:[2,81],131:[2,81],132:[2,81],133:[2,81],134:[2,81],135:[2,81],136:[2,81],137:[2,81]},{1:[2,82],6:[2,82],25:[2,82],26:[2,82],40:[2,82],49:[2,82],54:[2,82],57:[2,82],66:[2,82],67:[2,82],68:[2,82],70:[2,82],72:[2,82],73:[2,82],77:[2,82],79:[2,82],83:[2,82],84:[2,82],85:[2,82],90:[2,82],92:[2,82],101:[2,82],103:[2,82],104:[2,82],105:[2,82],109:[2,82],117:[2,82],125:[2,82],127:[2,82],128:[2,82],129:[2,82],130:[2,82],131:[2,82],132:[2,82],133:[2,82],134:[2,82],135:[2,82],136:[2,82],137:[2,82]},{72:[1,238]},{57:[1,192],72:[2,87],91:239,92:[1,191],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{72:[2,88]},{8:240,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,72:[2,122],75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{12:[2,116],28:[2,116],30:[2,116],31:[2,116],33:[2,116],34:[2,116],35:[2,116],36:[2,116],37:[2,116],38:[2,116],45:[2,116],46:[2,116],47:[2,116],51:[2,116],52:[2,116],72:[2,116],75:[2,116],78:[2,116],82:[2,116],87:[2,116],88:[2,116],89:[2,116],95:[2,116],99:[2,116],100:[2,116],103:[2,116],105:[2,116],107:[2,116],109:[2,116],118:[2,116],124:[2,116],126:[2,116],127:[2,116],128:[2,116],129:[2,116],130:[2,116]},{12:[2,117],28:[2,117],30:[2,117],31:[2,117],33:[2,117],34:[2,117],35:[2,117],36:[2,117],37:[2,117],38:[2,117],45:[2,117],46:[2,117],47:[2,117],51:[2,117],52:[2,117],72:[2,117],75:[2,117],78:[2,117],82:[2,117],87:[2,117],88:[2,117],89:[2,117],95:[2,117],99:[2,117],100:[2,117],103:[2,117],105:[2,117],107:[2,117],109:[2,117],118:[2,117],124:[2,117],126:[2,117],127:[2,117],128:[2,117],129:[2,117],130:[2,117]},{1:[2,86],6:[2,86],25:[2,86],26:[2,86],40:[2,86],49:[2,86],54:[2,86],57:[2,86],66:[2,86],67:[2,86],68:[2,86],70:[2,86],72:[2,86],73:[2,86],77:[2,86],79:[2,86],83:[2,86],84:[2,86],85:[2,86],90:[2,86],92:[2,86],101:[2,86],103:[2,86],104:[2,86],105:[2,86],109:[2,86],117:[2,86],125:[2,86],127:[2,86],128:[2,86],129:[2,86],130:[2,86],131:[2,86],132:[2,86],133:[2,86],134:[2,86],135:[2,86],136:[2,86],137:[2,86]},{1:[2,104],6:[2,104],25:[2,104],26:[2,104],49:[2,104],54:[2,104],57:[2,104],66:[2,104],67:[2,104],68:[2,104],70:[2,104],72:[2,104],73:[2,104],77:[2,104],83:[2,104],84:[2,104],85:[2,104],90:[2,104],92:[2,104],101:[2,104],103:[2,104],104:[2,104],105:[2,104],109:[2,104],117:[2,104],125:[2,104],127:[2,104],128:[2,104],131:[2,104],132:[2,104],133:[2,104],134:[2,104],135:[2,104],136:[2,104]},{1:[2,36],6:[2,36],25:[2,36],26:[2,36],49:[2,36],54:[2,36],57:[2,36],72:[2,36],77:[2,36],85:[2,36],90:[2,36],92:[2,36],101:[2,36],102:87,103:[2,36],104:[2,36],105:[2,36],108:88,109:[2,36],110:69,117:[2,36],125:[2,36],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{8:241,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:242,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,109],6:[2,109],25:[2,109],26:[2,109],49:[2,109],54:[2,109],57:[2,109],66:[2,109],67:[2,109],68:[2,109],70:[2,109],72:[2,109],73:[2,109],77:[2,109],83:[2,109],84:[2,109],85:[2,109],90:[2,109],92:[2,109],101:[2,109],103:[2,109],104:[2,109],105:[2,109],109:[2,109],117:[2,109],125:[2,109],127:[2,109],128:[2,109],131:[2,109],132:[2,109],133:[2,109],134:[2,109],135:[2,109],136:[2,109]},{6:[2,53],25:[2,53],53:243,54:[1,226],85:[2,53]},{6:[2,128],25:[2,128],26:[2,128],54:[2,128],57:[1,244],85:[2,128],90:[2,128],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{50:245,51:[1,60],52:[1,61]},{6:[2,54],25:[2,54],26:[2,54],27:109,28:[1,73],44:110,55:246,56:108,58:111,59:112,75:[1,70],88:[1,113],89:[1,114]},{6:[1,247],25:[1,248]},{6:[2,61],25:[2,61],26:[2,61],49:[2,61],54:[2,61]},{8:249,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,199],6:[2,199],25:[2,199],26:[2,199],49:[2,199],54:[2,199],57:[2,199],72:[2,199],77:[2,199],85:[2,199],90:[2,199],92:[2,199],101:[2,199],102:87,103:[2,199],104:[2,199],105:[2,199],108:88,109:[2,199],110:69,117:[2,199],125:[2,199],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{8:250,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,201],6:[2,201],25:[2,201],26:[2,201],49:[2,201],54:[2,201],57:[2,201],72:[2,201],77:[2,201],85:[2,201],90:[2,201],92:[2,201],101:[2,201],102:87,103:[2,201],104:[2,201],105:[2,201],108:88,109:[2,201],110:69,117:[2,201],125:[2,201],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,181],6:[2,181],25:[2,181],26:[2,181],49:[2,181],54:[2,181],57:[2,181],72:[2,181],77:[2,181],85:[2,181],90:[2,181],92:[2,181],101:[2,181],103:[2,181],104:[2,181],105:[2,181],109:[2,181],117:[2,181],125:[2,181],127:[2,181],128:[2,181],131:[2,181],132:[2,181],133:[2,181],134:[2,181],135:[2,181],136:[2,181]},{8:251,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,133],6:[2,133],25:[2,133],26:[2,133],49:[2,133],54:[2,133],57:[2,133],72:[2,133],77:[2,133],85:[2,133],90:[2,133],92:[2,133],97:[1,252],101:[2,133],103:[2,133],104:[2,133],105:[2,133],109:[2,133],117:[2,133],125:[2,133],127:[2,133],128:[2,133],131:[2,133],132:[2,133],133:[2,133],134:[2,133],135:[2,133],136:[2,133]},{5:253,25:[1,5]},{27:254,28:[1,73]},{119:255,121:216,122:[1,217]},{26:[1,256],120:[1,257],121:258,122:[1,217]},{26:[2,174],120:[2,174],122:[2,174]},{8:260,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],94:259,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,97],5:261,6:[2,97],25:[1,5],26:[2,97],49:[2,97],54:[2,97],57:[2,97],72:[2,97],77:[2,97],85:[2,97],90:[2,97],92:[2,97],101:[2,97],102:87,103:[1,65],104:[2,97],105:[1,66],108:88,109:[1,68],110:69,117:[2,97],125:[2,97],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,100],6:[2,100],25:[2,100],26:[2,100],49:[2,100],54:[2,100],57:[2,100],72:[2,100],77:[2,100],85:[2,100],90:[2,100],92:[2,100],101:[2,100],103:[2,100],104:[2,100],105:[2,100],109:[2,100],117:[2,100],125:[2,100],127:[2,100],128:[2,100],131:[2,100],132:[2,100],133:[2,100],134:[2,100],135:[2,100],136:[2,100]},{8:262,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,138],6:[2,138],25:[2,138],26:[2,138],49:[2,138],54:[2,138],57:[2,138],66:[2,138],67:[2,138],68:[2,138],70:[2,138],72:[2,138],73:[2,138],77:[2,138],83:[2,138],84:[2,138],85:[2,138],90:[2,138],92:[2,138],101:[2,138],103:[2,138],104:[2,138],105:[2,138],109:[2,138],117:[2,138],125:[2,138],127:[2,138],128:[2,138],131:[2,138],132:[2,138],133:[2,138],134:[2,138],135:[2,138],136:[2,138]},{6:[1,74],26:[1,263]},{8:264,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,67],12:[2,117],25:[2,67],28:[2,117],30:[2,117],31:[2,117],33:[2,117],34:[2,117],35:[2,117],36:[2,117],37:[2,117],38:[2,117],45:[2,117],46:[2,117],47:[2,117],51:[2,117],52:[2,117],54:[2,67],75:[2,117],78:[2,117],82:[2,117],87:[2,117],88:[2,117],89:[2,117],90:[2,67],95:[2,117],99:[2,117],100:[2,117],103:[2,117],105:[2,117],107:[2,117],109:[2,117],118:[2,117],124:[2,117],126:[2,117],127:[2,117],128:[2,117],129:[2,117],130:[2,117]},{6:[1,266],25:[1,267],90:[1,265]},{6:[2,54],8:200,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[2,54],26:[2,54],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],85:[2,54],87:[1,58],88:[1,59],89:[1,57],90:[2,54],93:268,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,53],25:[2,53],26:[2,53],53:269,54:[1,226]},{1:[2,178],6:[2,178],25:[2,178],26:[2,178],49:[2,178],54:[2,178],57:[2,178],72:[2,178],77:[2,178],85:[2,178],90:[2,178],92:[2,178],101:[2,178],103:[2,178],104:[2,178],105:[2,178],109:[2,178],117:[2,178],120:[2,178],125:[2,178],127:[2,178],128:[2,178],131:[2,178],132:[2,178],133:[2,178],134:[2,178],135:[2,178],136:[2,178]},{8:270,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:271,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{115:[2,156],116:[2,156]},{27:158,28:[1,73],44:159,58:160,59:161,75:[1,70],88:[1,113],89:[1,114],114:272},{1:[2,163],6:[2,163],25:[2,163],26:[2,163],49:[2,163],54:[2,163],57:[2,163],72:[2,163],77:[2,163],85:[2,163],90:[2,163],92:[2,163],101:[2,163],102:87,103:[2,163],104:[1,273],105:[2,163],108:88,109:[2,163],110:69,117:[1,274],125:[2,163],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,164],6:[2,164],25:[2,164],26:[2,164],49:[2,164],54:[2,164],57:[2,164],72:[2,164],77:[2,164],85:[2,164],90:[2,164],92:[2,164],101:[2,164],102:87,103:[2,164],104:[1,275],105:[2,164],108:88,109:[2,164],110:69,117:[2,164],125:[2,164],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[1,277],25:[1,278],77:[1,276]},{6:[2,54],11:168,25:[2,54],26:[2,54],27:169,28:[1,73],29:170,30:[1,71],31:[1,72],41:279,42:167,44:171,46:[1,46],77:[2,54],88:[1,113]},{8:280,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,281],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,85],6:[2,85],25:[2,85],26:[2,85],40:[2,85],49:[2,85],54:[2,85],57:[2,85],66:[2,85],67:[2,85],68:[2,85],70:[2,85],72:[2,85],73:[2,85],77:[2,85],79:[2,85],83:[2,85],84:[2,85],85:[2,85],90:[2,85],92:[2,85],101:[2,85],103:[2,85],104:[2,85],105:[2,85],109:[2,85],117:[2,85],125:[2,85],127:[2,85],128:[2,85],129:[2,85],130:[2,85],131:[2,85],132:[2,85],133:[2,85],134:[2,85],135:[2,85],136:[2,85],137:[2,85]},{8:282,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,72:[2,120],75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{72:[2,121],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,37],6:[2,37],25:[2,37],26:[2,37],49:[2,37],54:[2,37],57:[2,37],72:[2,37],77:[2,37],85:[2,37],90:[2,37],92:[2,37],101:[2,37],102:87,103:[2,37],104:[2,37],105:[2,37],108:88,109:[2,37],110:69,117:[2,37
],125:[2,37],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{26:[1,283],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[1,266],25:[1,267],85:[1,284]},{6:[2,67],25:[2,67],26:[2,67],54:[2,67],85:[2,67],90:[2,67]},{5:285,25:[1,5]},{6:[2,57],25:[2,57],26:[2,57],49:[2,57],54:[2,57]},{27:109,28:[1,73],44:110,55:286,56:108,58:111,59:112,75:[1,70],88:[1,113],89:[1,114]},{6:[2,55],25:[2,55],26:[2,55],27:109,28:[1,73],44:110,48:287,54:[2,55],55:107,56:108,58:111,59:112,75:[1,70],88:[1,113],89:[1,114]},{6:[2,62],25:[2,62],26:[2,62],49:[2,62],54:[2,62],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{26:[1,288],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{5:289,25:[1,5],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{5:290,25:[1,5]},{1:[2,134],6:[2,134],25:[2,134],26:[2,134],49:[2,134],54:[2,134],57:[2,134],72:[2,134],77:[2,134],85:[2,134],90:[2,134],92:[2,134],101:[2,134],103:[2,134],104:[2,134],105:[2,134],109:[2,134],117:[2,134],125:[2,134],127:[2,134],128:[2,134],131:[2,134],132:[2,134],133:[2,134],134:[2,134],135:[2,134],136:[2,134]},{5:291,25:[1,5]},{26:[1,292],120:[1,293],121:258,122:[1,217]},{1:[2,172],6:[2,172],25:[2,172],26:[2,172],49:[2,172],54:[2,172],57:[2,172],72:[2,172],77:[2,172],85:[2,172],90:[2,172],92:[2,172],101:[2,172],103:[2,172],104:[2,172],105:[2,172],109:[2,172],117:[2,172],125:[2,172],127:[2,172],128:[2,172],131:[2,172],132:[2,172],133:[2,172],134:[2,172],135:[2,172],136:[2,172]},{5:294,25:[1,5]},{26:[2,175],120:[2,175],122:[2,175]},{5:295,25:[1,5],54:[1,296]},{25:[2,130],54:[2,130],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,98],6:[2,98],25:[2,98],26:[2,98],49:[2,98],54:[2,98],57:[2,98],72:[2,98],77:[2,98],85:[2,98],90:[2,98],92:[2,98],101:[2,98],103:[2,98],104:[2,98],105:[2,98],109:[2,98],117:[2,98],125:[2,98],127:[2,98],128:[2,98],131:[2,98],132:[2,98],133:[2,98],134:[2,98],135:[2,98],136:[2,98]},{1:[2,101],5:297,6:[2,101],25:[1,5],26:[2,101],49:[2,101],54:[2,101],57:[2,101],72:[2,101],77:[2,101],85:[2,101],90:[2,101],92:[2,101],101:[2,101],102:87,103:[1,65],104:[2,101],105:[1,66],108:88,109:[1,68],110:69,117:[2,101],125:[2,101],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{101:[1,298]},{90:[1,299],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,115],6:[2,115],25:[2,115],26:[2,115],40:[2,115],49:[2,115],54:[2,115],57:[2,115],66:[2,115],67:[2,115],68:[2,115],70:[2,115],72:[2,115],73:[2,115],77:[2,115],83:[2,115],84:[2,115],85:[2,115],90:[2,115],92:[2,115],101:[2,115],103:[2,115],104:[2,115],105:[2,115],109:[2,115],115:[2,115],116:[2,115],117:[2,115],125:[2,115],127:[2,115],128:[2,115],131:[2,115],132:[2,115],133:[2,115],134:[2,115],135:[2,115],136:[2,115]},{8:200,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],93:300,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:200,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,25:[1,146],27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,60:147,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],86:301,87:[1,58],88:[1,59],89:[1,57],93:145,95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[2,124],25:[2,124],26:[2,124],54:[2,124],85:[2,124],90:[2,124]},{6:[1,266],25:[1,267],26:[1,302]},{1:[2,141],6:[2,141],25:[2,141],26:[2,141],49:[2,141],54:[2,141],57:[2,141],72:[2,141],77:[2,141],85:[2,141],90:[2,141],92:[2,141],101:[2,141],102:87,103:[1,65],104:[2,141],105:[1,66],108:88,109:[1,68],110:69,117:[2,141],125:[2,141],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,143],6:[2,143],25:[2,143],26:[2,143],49:[2,143],54:[2,143],57:[2,143],72:[2,143],77:[2,143],85:[2,143],90:[2,143],92:[2,143],101:[2,143],102:87,103:[1,65],104:[2,143],105:[1,66],108:88,109:[1,68],110:69,117:[2,143],125:[2,143],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{115:[2,162],116:[2,162]},{8:303,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:304,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:305,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,89],6:[2,89],25:[2,89],26:[2,89],40:[2,89],49:[2,89],54:[2,89],57:[2,89],66:[2,89],67:[2,89],68:[2,89],70:[2,89],72:[2,89],73:[2,89],77:[2,89],83:[2,89],84:[2,89],85:[2,89],90:[2,89],92:[2,89],101:[2,89],103:[2,89],104:[2,89],105:[2,89],109:[2,89],115:[2,89],116:[2,89],117:[2,89],125:[2,89],127:[2,89],128:[2,89],131:[2,89],132:[2,89],133:[2,89],134:[2,89],135:[2,89],136:[2,89]},{11:168,27:169,28:[1,73],29:170,30:[1,71],31:[1,72],41:306,42:167,44:171,46:[1,46],88:[1,113]},{6:[2,90],11:168,25:[2,90],26:[2,90],27:169,28:[1,73],29:170,30:[1,71],31:[1,72],41:166,42:167,44:171,46:[1,46],54:[2,90],76:307,88:[1,113]},{6:[2,92],25:[2,92],26:[2,92],54:[2,92],77:[2,92]},{6:[2,40],25:[2,40],26:[2,40],54:[2,40],77:[2,40],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{8:308,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{72:[2,119],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,38],6:[2,38],25:[2,38],26:[2,38],49:[2,38],54:[2,38],57:[2,38],72:[2,38],77:[2,38],85:[2,38],90:[2,38],92:[2,38],101:[2,38],103:[2,38],104:[2,38],105:[2,38],109:[2,38],117:[2,38],125:[2,38],127:[2,38],128:[2,38],131:[2,38],132:[2,38],133:[2,38],134:[2,38],135:[2,38],136:[2,38]},{1:[2,110],6:[2,110],25:[2,110],26:[2,110],49:[2,110],54:[2,110],57:[2,110],66:[2,110],67:[2,110],68:[2,110],70:[2,110],72:[2,110],73:[2,110],77:[2,110],83:[2,110],84:[2,110],85:[2,110],90:[2,110],92:[2,110],101:[2,110],103:[2,110],104:[2,110],105:[2,110],109:[2,110],117:[2,110],125:[2,110],127:[2,110],128:[2,110],131:[2,110],132:[2,110],133:[2,110],134:[2,110],135:[2,110],136:[2,110]},{1:[2,49],6:[2,49],25:[2,49],26:[2,49],49:[2,49],54:[2,49],57:[2,49],72:[2,49],77:[2,49],85:[2,49],90:[2,49],92:[2,49],101:[2,49],103:[2,49],104:[2,49],105:[2,49],109:[2,49],117:[2,49],125:[2,49],127:[2,49],128:[2,49],131:[2,49],132:[2,49],133:[2,49],134:[2,49],135:[2,49],136:[2,49]},{6:[2,58],25:[2,58],26:[2,58],49:[2,58],54:[2,58]},{6:[2,53],25:[2,53],26:[2,53],53:309,54:[1,202]},{1:[2,200],6:[2,200],25:[2,200],26:[2,200],49:[2,200],54:[2,200],57:[2,200],72:[2,200],77:[2,200],85:[2,200],90:[2,200],92:[2,200],101:[2,200],103:[2,200],104:[2,200],105:[2,200],109:[2,200],117:[2,200],125:[2,200],127:[2,200],128:[2,200],131:[2,200],132:[2,200],133:[2,200],134:[2,200],135:[2,200],136:[2,200]},{1:[2,179],6:[2,179],25:[2,179],26:[2,179],49:[2,179],54:[2,179],57:[2,179],72:[2,179],77:[2,179],85:[2,179],90:[2,179],92:[2,179],101:[2,179],103:[2,179],104:[2,179],105:[2,179],109:[2,179],117:[2,179],120:[2,179],125:[2,179],127:[2,179],128:[2,179],131:[2,179],132:[2,179],133:[2,179],134:[2,179],135:[2,179],136:[2,179]},{1:[2,135],6:[2,135],25:[2,135],26:[2,135],49:[2,135],54:[2,135],57:[2,135],72:[2,135],77:[2,135],85:[2,135],90:[2,135],92:[2,135],101:[2,135],103:[2,135],104:[2,135],105:[2,135],109:[2,135],117:[2,135],125:[2,135],127:[2,135],128:[2,135],131:[2,135],132:[2,135],133:[2,135],134:[2,135],135:[2,135],136:[2,135]},{1:[2,136],6:[2,136],25:[2,136],26:[2,136],49:[2,136],54:[2,136],57:[2,136],72:[2,136],77:[2,136],85:[2,136],90:[2,136],92:[2,136],97:[2,136],101:[2,136],103:[2,136],104:[2,136],105:[2,136],109:[2,136],117:[2,136],125:[2,136],127:[2,136],128:[2,136],131:[2,136],132:[2,136],133:[2,136],134:[2,136],135:[2,136],136:[2,136]},{1:[2,170],6:[2,170],25:[2,170],26:[2,170],49:[2,170],54:[2,170],57:[2,170],72:[2,170],77:[2,170],85:[2,170],90:[2,170],92:[2,170],101:[2,170],103:[2,170],104:[2,170],105:[2,170],109:[2,170],117:[2,170],125:[2,170],127:[2,170],128:[2,170],131:[2,170],132:[2,170],133:[2,170],134:[2,170],135:[2,170],136:[2,170]},{5:310,25:[1,5]},{26:[1,311]},{6:[1,312],26:[2,176],120:[2,176],122:[2,176]},{8:313,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{1:[2,102],6:[2,102],25:[2,102],26:[2,102],49:[2,102],54:[2,102],57:[2,102],72:[2,102],77:[2,102],85:[2,102],90:[2,102],92:[2,102],101:[2,102],103:[2,102],104:[2,102],105:[2,102],109:[2,102],117:[2,102],125:[2,102],127:[2,102],128:[2,102],131:[2,102],132:[2,102],133:[2,102],134:[2,102],135:[2,102],136:[2,102]},{1:[2,139],6:[2,139],25:[2,139],26:[2,139],49:[2,139],54:[2,139],57:[2,139],66:[2,139],67:[2,139],68:[2,139],70:[2,139],72:[2,139],73:[2,139],77:[2,139],83:[2,139],84:[2,139],85:[2,139],90:[2,139],92:[2,139],101:[2,139],103:[2,139],104:[2,139],105:[2,139],109:[2,139],117:[2,139],125:[2,139],127:[2,139],128:[2,139],131:[2,139],132:[2,139],133:[2,139],134:[2,139],135:[2,139],136:[2,139]},{1:[2,118],6:[2,118],25:[2,118],26:[2,118],49:[2,118],54:[2,118],57:[2,118],66:[2,118],67:[2,118],68:[2,118],70:[2,118],72:[2,118],73:[2,118],77:[2,118],83:[2,118],84:[2,118],85:[2,118],90:[2,118],92:[2,118],101:[2,118],103:[2,118],104:[2,118],105:[2,118],109:[2,118],117:[2,118],125:[2,118],127:[2,118],128:[2,118],131:[2,118],132:[2,118],133:[2,118],134:[2,118],135:[2,118],136:[2,118]},{6:[2,125],25:[2,125],26:[2,125],54:[2,125],85:[2,125],90:[2,125]},{6:[2,53],25:[2,53],26:[2,53],53:314,54:[1,226]},{6:[2,126],25:[2,126],26:[2,126],54:[2,126],85:[2,126],90:[2,126]},{1:[2,165],6:[2,165],25:[2,165],26:[2,165],49:[2,165],54:[2,165],57:[2,165],72:[2,165],77:[2,165],85:[2,165],90:[2,165],92:[2,165],101:[2,165],102:87,103:[2,165],104:[2,165],105:[2,165],108:88,109:[2,165],110:69,117:[1,315],125:[2,165],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,167],6:[2,167],25:[2,167],26:[2,167],49:[2,167],54:[2,167],57:[2,167],72:[2,167],77:[2,167],85:[2,167],90:[2,167],92:[2,167],101:[2,167],102:87,103:[2,167],104:[1,316],105:[2,167],108:88,109:[2,167],110:69,117:[2,167],125:[2,167],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,166],6:[2,166],25:[2,166],26:[2,166],49:[2,166],54:[2,166],57:[2,166],72:[2,166],77:[2,166],85:[2,166],90:[2,166],92:[2,166],101:[2,166],102:87,103:[2,166],104:[2,166],105:[2,166],108:88,109:[2,166],110:69,117:[2,166],125:[2,166],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[2,93],25:[2,93],26:[2,93],54:[2,93],77:[2,93]},{6:[2,53],25:[2,53],26:[2,53],53:317,54:[1,236]},{26:[1,318],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[1,247],25:[1,248],26:[1,319]},{26:[1,320]},{1:[2,173],6:[2,173],25:[2,173],26:[2,173],49:[2,173],54:[2,173],57:[2,173],72:[2,173],77:[2,173],85:[2,173],90:[2,173],92:[2,173],101:[2,173],103:[2,173],104:[2,173],105:[2,173],109:[2,173],117:[2,173],125:[2,173],127:[2,173],128:[2,173],131:[2,173],132:[2,173],133:[2,173],134:[2,173],135:[2,173],136:[2,173]},{26:[2,177],120:[2,177],122:[2,177]},{25:[2,131],54:[2,131],102:87,103:[1,65],105:[1,66],108:88,109:[1,68],110:69,125:[1,86],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[1,266],25:[1,267],26:[1,321]},{8:322,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{8:323,9:117,10:20,11:21,12:[1,22],13:8,14:9,15:10,16:11,17:12,18:13,19:14,20:15,21:16,22:17,23:18,24:19,27:62,28:[1,73],29:49,30:[1,71],31:[1,72],32:24,33:[1,50],34:[1,51],35:[1,52],36:[1,53],37:[1,54],38:[1,55],39:23,44:63,45:[1,45],46:[1,46],47:[1,29],50:30,51:[1,60],52:[1,61],58:47,59:48,61:36,63:25,64:26,65:27,75:[1,70],78:[1,43],82:[1,28],87:[1,58],88:[1,59],89:[1,57],95:[1,38],99:[1,44],100:[1,56],102:39,103:[1,65],105:[1,66],106:40,107:[1,67],108:41,109:[1,68],110:69,118:[1,42],123:37,124:[1,64],126:[1,31],127:[1,32],128:[1,33],129:[1,34],130:[1,35]},{6:[1,277],25:[1,278],26:[1,324]},{6:[2,41],25:[2,41],26:[2,41],54:[2,41],77:[2,41]},{6:[2,59],25:[2,59],26:[2,59],49:[2,59],54:[2,59]},{1:[2,171],6:[2,171],25:[2,171],26:[2,171],49:[2,171],54:[2,171],57:[2,171],72:[2,171],77:[2,171],85:[2,171],90:[2,171],92:[2,171],101:[2,171],103:[2,171],104:[2,171],105:[2,171],109:[2,171],117:[2,171],125:[2,171],127:[2,171],128:[2,171],131:[2,171],132:[2,171],133:[2,171],134:[2,171],135:[2,171],136:[2,171]},{6:[2,127],25:[2,127],26:[2,127],54:[2,127],85:[2,127],90:[2,127]},{1:[2,168],6:[2,168],25:[2,168],26:[2,168],49:[2,168],54:[2,168],57:[2,168],72:[2,168],77:[2,168],85:[2,168],90:[2,168],92:[2,168],101:[2,168],102:87,103:[2,168],104:[2,168],105:[2,168],108:88,109:[2,168],110:69,117:[2,168],125:[2,168],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{1:[2,169],6:[2,169],25:[2,169],26:[2,169],49:[2,169],54:[2,169],57:[2,169],72:[2,169],77:[2,169],85:[2,169],90:[2,169],92:[2,169],101:[2,169],102:87,103:[2,169],104:[2,169],105:[2,169],108:88,109:[2,169],110:69,117:[2,169],125:[2,169],127:[1,80],128:[1,79],131:[1,78],132:[1,81],133:[1,82],134:[1,83],135:[1,84],136:[1,85]},{6:[2,94],25:[2,94],26:[2,94],54:[2,94],77:[2,94]}],defaultActions:{60:[2,51],61:[2,52],75:[2,3],94:[2,108],189:[2,88]},parseError:function(e,t){throw new Error(e)},parse:function(e){function t(){var e;return e=r.lexer.lex()||1,typeof e!="number"&&(e=r.symbols_[e]||e),e}function n(e){i.length=i.length-2*e,s.length=s.length-e,o.length=o.length-e}var r=this,i=[0],s=[null],o=[],u=this.table,a="",f=0,l=0,c=0,h=2,p=1;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var d=this.lexer.yylloc;o.push(d),typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var v,m,g,y,b,w,E={},S,x,T,N;for(;;){g=i[i.length-1],this.defaultActions[g]?y=this.defaultActions[g]:(v==null&&(v=t()),y=u[g]&&u[g][v]);if(typeof y=="undefined"||!y.length||!y[0]){if(!c){N=[];for(S in u[g])this.terminals_[S]&&S>2&&N.push("'"+this.terminals_[S]+"'");var C="";this.lexer.showPosition?C="Parse error on line "+(f+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+N.join(", ")+", got '"+this.terminals_[v]+"'":C="Parse error on line "+(f+1)+": Unexpected "+(v==1?"end of input":"'"+(this.terminals_[v]||v)+"'"),this.parseError(C,{text:this.lexer.match,token:this.terminals_[v]||v,line:this.lexer.yylineno,loc:d,expected:N})}if(c==3){if(v==p)throw new Error(C||"Parsing halted.");l=this.lexer.yyleng,a=this.lexer.yytext,f=this.lexer.yylineno,d=this.lexer.yylloc,v=t()}for(;;){if(h.toString()in u[g])break;if(g==0)throw new Error(C||"Parsing halted.");n(1),g=i[i.length-1]}m=v,v=h,g=i[i.length-1],y=u[g]&&u[g][h],c=3}if(y[0]instanceof Array&&y.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+v);switch(y[0]){case 1:i.push(v),s.push(this.lexer.yytext),o.push(this.lexer.yylloc),i.push(y[1]),v=null,m?(v=m,m=null):(l=this.lexer.yyleng,a=this.lexer.yytext,f=this.lexer.yylineno,d=this.lexer.yylloc,c>0&&c--);break;case 2:x=this.productions_[y[1]][1],E.$=s[s.length-x],E._$={first_line:o[o.length-(x||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(x||1)].first_column,last_column:o[o.length-1].last_column},w=this.performAction.call(E,a,l,f,this.yy,y[1],s,o);if(typeof w!="undefined")return w;x&&(i=i.slice(0,-1*x*2),s=s.slice(0,-1*x),o=o.slice(0,-1*x)),i.push(this.productions_[y[1]][0]),s.push(E.$),o.push(E._$),T=u[i[i.length-2]][i[i.length-1]],i.push(T);break;case 3:return!0}}return!0}};return undefined,e}();typeof require!="undefined"&&typeof e!="undefined"&&(e.parser=t,e.parse=function(){return t.parse.apply(t,arguments)},e.main=function(t){if(!t[1])throw new Error("Usage: "+t[0]+" FILE");if(typeof process!="undefined")var n=require("fs").readFileSync(require("path").join(process.cwd(),t[1]),"utf8");else var r=require("file").path(require("file").cwd()),n=r.join(t[1]).read({charset:"utf-8"});return e.parser.parse(n)},typeof module!="undefined"&&require.main===module&&e.main(typeof process!="undefined"?process.argv.slice(1):require("system").args))},require["./scope"]=new function(){var e=this;(function(){var t,n,r,i;i=require("./helpers"),n=i.extend,r=i.last,e.Scope=t=function(){function e(t,n,r){this.parent=t,this.expressions=n,this.method=r,this.variables=[{name:"arguments",type:"arguments"}],this.positions={},this.parent||(e.root=this)}return e.root=null,e.prototype.add=function(e,t,n){return this.shared&&!n?this.parent.add(e,t,n):Object.prototype.hasOwnProperty.call(this.positions,e)?this.variables[this.positions[e]].type=t:this.positions[e]=this.variables.push({name:e,type:t})-1},e.prototype.namedMethod=function(){return this.method.name||!this.parent?this.method:this.parent.namedMethod()},e.prototype.find=function(e){return this.check(e)?!0:(this.add(e,"var"),!1)},e.prototype.parameter=function(e){if(!this.shared||!this.parent.check(e,!0))return this.add(e,"param")},e.prototype.check=function(e){var t;return!!(this.type(e)||((t=this.parent)!=null?t.check(e):void 0))},e.prototype.temporary=function(e,t){return e.length>1?"_"+e+(t>1?t-1:""):"_"+(t+parseInt(e,36)).toString(36).replace(/\d/g,"a")},e.prototype.type=function(e){var t,n,r,i;i=this.variables;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.name===e)return t.type}return null},e.prototype.freeVariable=function(e,t){var n,r;t==null&&(t=!0),n=0;while(this.check(r=this.temporary(e,n)))n++;return t&&this.add(r,"var",!0),r},e.prototype.assign=function(e,t){return this.add(e,{value:t,assigned:!0},!0),this.hasAssignments=!0},e.prototype.hasDeclarations=function(){return!!this.declaredVariables().length},e.prototype.declaredVariables=function(){var e,t,n,r,i,s;e=[],t=[],s=this.variables;for(r=0,i=s.length;r<i;r++)n=s[r],n.type==="var"&&(n.name.charAt(0)==="_"?t:e).push(n.name);return e.sort().concat(t.sort())},e.prototype.assignedVariables=function(){var e,t,n,r,i;r=this.variables,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],e.type.assigned&&i.push(""+e.name+" = "+e.type.value);return i},e}()}).call(this)},require["./nodes"]=new function(){var e=this;(function(){var t,n,r,i,s,o,u,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct={}.hasOwnProperty,ht=function(e,t){function n(){this.constructor=e}for(var r in t)ct.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},pt=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};q=require("./scope").Scope,ft=require("./lexer"),H=ft.RESERVED,I=ft.STRICT_PROSCRIBED,lt=require("./helpers"),Y=lt.compact,nt=lt.flatten,tt=lt.extend,it=lt.merge,Z=lt.del,ot=lt.starts,et=lt.ends,rt=lt.last,e.extend=tt,G=function(){return!0},O=function(){return!1},X=function(){return this},A=function(){return this.negated=!this.negated,this},e.Base=i=function(){function e(){}return e.prototype.compile=function(e,t){var n;return e=tt({},e),t&&(e.level=t),n=this.unfoldSoak(e)||this,n.tab=e.indent,e.level===C||!n.isStatement(e)?n.compileNode(e):n.compileClosure(e)},e.prototype.compileClosure=function(e){if(this.jumps())throw SyntaxError("cannot use a pure statement in an expression.");return e.sharedScope=!0,f.wrap(this).compileNode(e)},e.prototype.cache=function(e,t,n){var i,s;return this.isComplex()?(i=new k(n||e.scope.freeVariable("ref")),s=new r(i,this),t?[s.compile(e,t),i.value]:[s,i]):(i=t?this.compile(e,t):this,[i,i])},e.prototype.compileLoopReference=function(e,t){var n,r;return n=r=this.compile(e,x),-Infinity<+n&&+n<Infinity||v.test(n)&&e.scope.check(n,!0)||(n=""+(r=e.scope.freeVariable(t))+" = "+n),[n,r]},e.prototype.makeReturn=function(e){var t;return t=this.unwrapAll(),e?new o(new k(""+e+".push"),[t]):new j(t)},e.prototype.contains=function(e){var t;return t=!1,this.traverseChildren(!1,function(n){if(e(n))return t=!0,!1}),t},e.prototype.containsType=function(e){return this instanceof e||this.contains(function(t){return t instanceof e})},e.prototype.lastNonComment=function(e){var t;t=e.length;while(t--)if(!(e[t]instanceof c))return e[t];return null},e.prototype.toString=function(e,t){var n;return e==null&&(e=""),t==null&&(t=this.constructor.name),n="\n"+e+t,this.soak&&(n+="?"),this.eachChild(function(t){return n+=t.toString(e+W)}),n},e.prototype.eachChild=function(e){var t,n,r,i,s,o,u,a;if(!this.children)return this;u=this.children;for(r=0,s=u.length;r<s;r++){t=u[r];if(this[t]){a=nt([this[t]]);for(i=0,o=a.length;i<o;i++){n=a[i];if(e(n)===!1)return this}}}return this},e.prototype.traverseChildren=function(e,t){return this.eachChild(function(n){return t(n)===!1?!1:n.traverseChildren(e,t)})},e.prototype.invert=function(){return new _("!",this)},e.prototype.unwrapAll=function(){var e;e=this;while(e!==(e=e.unwrap()))continue;return e},e.prototype.children=[],e.prototype.isStatement=O,e.prototype.jumps=O,e.prototype.isComplex=G,e.prototype.isChainable=O,e.prototype.isAssignable=O,e.prototype.unwrap=X,e.prototype.unfoldSoak=O,e.prototype.assigns=O,e}(),e.Block=s=function(e){function t(e){this.expressions=Y(nt(e||[]))}return ht(t,e),t.prototype.children=["expressions"],t.prototype.push=function(e){return this.expressions.push(e),this},t.prototype.pop=function(){return this.expressions.pop()},t.prototype.unshift=function(e){return this.expressions.unshift(e),this},t.prototype.unwrap=function(){return this.expressions.length===1?this.expressions[0]:this},t.prototype.isEmpty=function(){return!this.expressions.length},t.prototype.isStatement=function(e){var t,n,r,i;i=this.expressions;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.isStatement(e))return!0}return!1},t.prototype.jumps=function(e){var t,n,r,i;i=this.expressions;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.jumps(e))return t}},t.prototype.makeReturn=function(e){var t,n;n=this.expressions.length;while(n--){t=this.expressions[n];if(!(t instanceof c)){this.expressions[n]=t.makeReturn(e),t instanceof j&&!t.expression&&this.expressions.splice(n,1);break}}return this},t.prototype.compile=function(e,n){return e==null&&(e={}),e.scope?t.__super__.compile.call(this,e,n):this.compileRoot(e)},t.prototype.compileNode=function(e){var n,r,i,s,o,u,a;this.tab=e.indent,s=e.level===C,r=[],a=this.expressions;for(o=0,u=a.length;o<u;o++)i=a[o],i=i.unwrapAll(),i=i.unfoldSoak(e)||i,i instanceof t?r.push(i.compileNode(e)):s?(i.front=!0,n=i.compile(e),i.isStatement(e)||(n=""+this.tab+n+";",i instanceof k&&(n=""+n+"\n")),r.push(n)):r.push(i.compile(e,x));return s?this.spaced?"\n"+r.join("\n\n")+"\n":r.join("\n"):(n=r.join(", ")||"void 0",r.length>1&&e.level>=x?"("+n+")":n)},t.prototype.compileRoot=function(e){var t,n,r,i,s,o;return e.indent=e.bare?"":W,e.scope=new q(null,this,null),e.level=C,this.spaced=!0,i="",e.bare||(s=function(){var e,t,i,s;i=this.expressions,s=[];for(r=e=0,t=i.length;e<t;r=++e){n=i[r];if(!(n.unwrap()instanceof c))break;s.push(n)}return s}.call(this),o=this.expressions.slice(s.length),this.expressions=s,s.length&&(i=""+this.compileNode(it(e,{indent:""}))+"\n"),this.expressions=o),t=this.compileWithDeclarations(e),e.bare?t:""+i+"(function() {\n"+t+"\n}).call(this);\n"},t.prototype.compileWithDeclarations=function(e){var t,n,r,i,s,o,u,a,f,l,h,p,d,v;n=o="",p=this.expressions;for(s=l=0,h=p.length;l<h;s=++l){i=p[s],i=i.unwrap();if(!(i instanceof c||i instanceof k))break}e=it(e,{level:C}),s&&(u=this.expressions.splice(s,9e9),d=[this.spaced,!1],f=d[0],this.spaced=d[1],v=[this.compileNode(e),f],n=v[0],this.spaced=v[1],this.expressions=u),o=this.compileNode(e),a=e.scope;if(a.expressions===this){r=e.scope.hasDeclarations(),t=a.hasAssignments;if(r||t)s&&(n+="\n"),n+=""+this.tab+"var ",r&&(n+=a.declaredVariables().join(", ")),t&&(r&&(n+=",\n"+(this.tab+W)),n+=a.assignedVariables().join(",\n"+(this.tab+W))),n+=";\n"}return n+o},t.wrap=function(e){return e.length===1&&e[0]instanceof t?e[0]:new t(e)},t}(i),e.Literal=k=function(e){function t(e){this.value=e}return ht(t,e),t.prototype.makeReturn=function(){return this.isStatement()?this:t.__super__.makeReturn.apply(this,arguments)},t.prototype.isAssignable=function(){return v.test(this.value)},t.prototype.isStatement=function(){var e;return(e=this.value)==="break"||e==="continue"||e==="debugger"},t.prototype.isComplex=O,t.prototype.assigns=function(e){return e===this.value},t.prototype.jumps=function(e){if(this.value==="break"&&!((e!=null?e.loop:void 0)||(e!=null?e.block:void 0)))return this;if(this.value==="continue"&&(e!=null?!e.loop:!void 0))return this},t.prototype.compileNode=function(e){var t,n;return t=this.value==="this"?((n=e.scope.method)!=null?n.bound:void 0)?e.scope.method.context:this.value:this.value.reserved?'"'+this.value+'"':this.value,this.isStatement()?""+this.tab+t+";":t},t.prototype.toString=function(){return' "'+this.value+'"'},t}(i),e.Undefined=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return ht(t,e),t.prototype.isAssignable=O,t.prototype.isComplex=O,t.prototype.compileNode=function(e){return e.level>=E?"(void 0)":"void 0"},t}(i),e.Null=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return ht(t,e),t.prototype.isAssignable=O,t.prototype.isComplex=O,t.prototype.compileNode=function(){return"null"},t}(i),e.Bool=function(e){function t(e){this.val=e}return ht(t,e),t.prototype.isAssignable=O,t.prototype.isComplex=O,t.prototype.compileNode=function(){return this.val},t}(i),e.Return=j=function(e){function t(e){e&&!e.unwrap().isUndefined&&(this.expression=e)}return ht(t,e),t.prototype.children=["expression"],t.prototype.isStatement=G,t.prototype.makeReturn=X,t.prototype.jumps=X,t.prototype.compile=function(e,n){var r,i;return r=(i=this.expression)!=null?i.makeReturn():void 0,!r||r instanceof t?t.__super__.compile.call(this,e,n):r.compile(e,n)},t.prototype.compileNode=function(e){return this.tab+("return"+[this.expression?" "+this.expression.compile(e,N):void 0]+";")},t}(i),e.Value=K=function(e){function t(e,n,r){return!n&&e instanceof t?e:(this.base=e,this.properties=n||[],r&&(this[r]=!0),this)}return ht(t,e),t.prototype.children=["base","properties"],t.prototype.add=function(e){return this.properties=this.properties.concat(e),this},t.prototype.hasProperties=function(){return!!this.properties.length},t.prototype.isArray=function(){return!this.properties.length&&this.base instanceof n},t.prototype.isComplex=function(){return this.hasProperties()||this.base.isComplex()},t.prototype.isAssignable=function(){return this.hasProperties()||this.base.isAssignable()},t.prototype.isSimpleNumber=function(){return this.base instanceof k&&F.test(this.base.value)},t.prototype.isString=function(){return this.base instanceof k&&g.test(this.base.value)},t.prototype.isAtomic=function(){var e,t,n,r;r=this.properties.concat(this.base);for(t=0,n=r.length;t<n;t++){e=r[t];if(e.soak||e instanceof o)return!1}return!0},t.prototype.isStatement=function(e){return!this.properties.length&&this.base.isStatement(e)},t.prototype.assigns=function(e){return!this.properties.length&&this.base.assigns(e)},t.prototype.jumps=function(e){return!this.properties.length&&this.base.jumps(e)},t.prototype.isObject=function(e){return this.properties.length?!1:this.base instanceof M&&(!e||this.base.generated)},t.prototype.isSplice=function(){return rt(this.properties)instanceof R},t.prototype.unwrap=function(){return this.properties.length?this:this.base},t.prototype.cacheReference=function(e){var n,i,s,o;return s=rt(this.properties),this.properties.length<2&&!this.base.isComplex()&&(s!=null?!s.isComplex():!void 0)?[this,this]:(n=new t(this.base,this.properties.slice(0,-1)),n.isComplex()&&(i=new k(e.scope.freeVariable("base")),n=new t(new P(new r(i,n)))),s?(s.isComplex()&&(o=new k(e.scope.freeVariable("name")),s=new w(new r(o,s.index)),o=new w(o)),[n.add(s),new t(i||n.base,[o||s])]):[n,i])},t.prototype.compileNode=function(e){var t,n,r,i,s;this.base.front=this.front,r=this.properties,t=this.base.compile(e,r.length?E:null),(this.base instanceof P||r.length)&&F.test(t)&&(t=""+t+".");for(i=0,s=r.length;i<s;i++)n=r[i],t+=n.compile(e);return t},t.prototype.unfoldSoak=function(e){var n,i=this;return this.unfoldedSoak!=null?this.unfoldedSoak:(n=function(){var n,s,o,u,f,l,c,p,d;if(o=i.base.unfoldSoak(e))return Array.prototype.push.apply(o.body.properties,i.properties),o;d=i.properties;for(s=c=0,p=d.length;c<p;s=++c){u=d[s];if(!u.soak)continue;return u.soak=!1,n=new t(i.base,i.properties.slice(0,s)),l=new t(i.base,i.properties.slice(s)),n.isComplex()&&(f=new k(e.scope.freeVariable("ref")),n=new P(new r(f,n)),l.base=f),new y(new h(n),l,{soak
:!0})}return null}(),this.unfoldedSoak=n||!1)},t}(i),e.Comment=c=function(e){function t(e){this.comment=e}return ht(t,e),t.prototype.isStatement=G,t.prototype.makeReturn=X,t.prototype.compileNode=function(e,t){var n;return n="/*"+st(this.comment,this.tab)+("\n"+this.tab+"*/\n"),(t||e.level)===C&&(n=e.indent+n),n},t}(i),e.Call=o=function(e){function n(e,t,n){this.args=t!=null?t:[],this.soak=n,this.isNew=!1,this.isSuper=e==="super",this.variable=this.isSuper?null:e}return ht(n,e),n.prototype.children=["variable","args"],n.prototype.newInstance=function(){var e,t;return e=((t=this.variable)!=null?t.base:void 0)||this.variable,e instanceof n&&!e.isNew?e.newInstance():this.isNew=!0,this},n.prototype.superReference=function(e){var n,r,i;r=e.scope.namedMethod();if(!r)throw SyntaxError("cannot call super outside of a function.");i=r.name;if(i==null)throw SyntaxError("cannot call super on an anonymous function.");return r.klass?(n=[new t(new k("__super__"))],r["static"]&&n.push(new t(new k("constructor"))),n.push(new t(new k(i))),(new K(new k(r.klass),n)).compile(e)):""+i+".__super__.constructor"},n.prototype.superThis=function(e){var t;return t=e.scope.method,t&&!t.klass&&t.context||"this"},n.prototype.unfoldSoak=function(e){var t,r,i,s,o,u,a,f,l;if(this.soak){if(this.variable){if(r=ut(e,this,"variable"))return r;f=(new K(this.variable)).cacheReference(e),i=f[0],o=f[1]}else i=new k(this.superReference(e)),o=new K(i);return o=new n(o,this.args),o.isNew=this.isNew,i=new k("typeof "+i.compile(e)+' === "function"'),new y(i,new K(o),{soak:!0})}t=this,s=[];for(;;){if(t.variable instanceof n){s.push(t),t=t.variable;continue}if(!(t.variable instanceof K))break;s.push(t);if(!((t=t.variable.base)instanceof n))break}l=s.reverse();for(u=0,a=l.length;u<a;u++)t=l[u],r&&(t.variable instanceof n?t.variable=r:t.variable.base=r),r=ut(e,t,"variable");return r},n.prototype.filterImplicitObjects=function(e){var t,n,i,s,o,u,a,f,l,h;n=[];for(u=0,f=e.length;u<f;u++){t=e[u];if(!((typeof t.isObject=="function"?t.isObject():void 0)&&t.base.generated)){n.push(t);continue}i=null,h=t.base.properties;for(a=0,l=h.length;a<l;a++)s=h[a],s instanceof r||s instanceof c?(i||n.push(i=new M(o=[],!0)),o.push(s)):(n.push(s),i=null)}return n},n.prototype.compileNode=function(e){var t,n,r,i;return(i=this.variable)!=null&&(i.front=this.front),(r=U.compileSplattedArray(e,this.args,!0))?this.compileSplat(e,r):(n=this.filterImplicitObjects(this.args),n=function(){var r,i,s;s=[];for(r=0,i=n.length;r<i;r++)t=n[r],s.push(t.compile(e,x));return s}().join(", "),this.isSuper?this.superReference(e)+(".call("+this.superThis(e)+(n&&", "+n)+")"):(this.isNew?"new ":"")+this.variable.compile(e,E)+("("+n+")"))},n.prototype.compileSuper=function(e,t){return""+this.superReference(t)+".call("+this.superThis(t)+(e.length?", ":"")+e+")"},n.prototype.compileSplat=function(e,t){var n,r,i,s,o;return this.isSuper?""+this.superReference(e)+".apply("+this.superThis(e)+", "+t+")":this.isNew?(i=this.tab+W,"(function(func, args, ctor) {\n"+i+"ctor.prototype = func.prototype;\n"+i+"var child = new ctor, result = func.apply(child, args), t = typeof result;\n"+i+'return t == "object" || t == "function" ? result || child : child;\n'+this.tab+"})("+this.variable.compile(e,x)+", "+t+", function(){})"):(n=new K(this.variable),(s=n.properties.pop())&&n.isComplex()?(o=e.scope.freeVariable("ref"),r="("+o+" = "+n.compile(e,x)+")"+s.compile(e)):(r=n.compile(e,E),F.test(r)&&(r="("+r+")"),s?(o=r,r+=s.compile(e)):o="null"),""+r+".apply("+o+", "+t+")")},n}(i),e.Extends=p=function(e){function t(e,t){this.child=e,this.parent=t}return ht(t,e),t.prototype.children=["child","parent"],t.prototype.compile=function(e){return(new o(new K(new k(at("extends"))),[this.child,this.parent])).compile(e)},t}(i),e.Access=t=function(e){function t(e,t){this.name=e,this.name.asKey=!0,this.soak=t==="soak"}return ht(t,e),t.prototype.children=["name"],t.prototype.compile=function(e){var t;return t=this.name.compile(e),v.test(t)?"."+t:"["+t+"]"},t.prototype.isComplex=O,t}(i),e.Index=w=function(e){function t(e){this.index=e}return ht(t,e),t.prototype.children=["index"],t.prototype.compile=function(e){return"["+this.index.compile(e,N)+"]"},t.prototype.isComplex=function(){return this.index.isComplex()},t}(i),e.Range=B=function(e){function t(e,t,n){this.from=e,this.to=t,this.exclusive=n==="exclusive",this.equals=this.exclusive?"":"="}return ht(t,e),t.prototype.children=["from","to"],t.prototype.compileVariables=function(e){var t,n,r,i,s;e=it(e,{top:!0}),n=this.from.cache(e,x),this.fromC=n[0],this.fromVar=n[1],r=this.to.cache(e,x),this.toC=r[0],this.toVar=r[1];if(t=Z(e,"step"))i=t.cache(e,x),this.step=i[0],this.stepVar=i[1];s=[this.fromVar.match(F),this.toVar.match(F)],this.fromNum=s[0],this.toNum=s[1];if(this.stepVar)return this.stepNum=this.stepVar.match(F)},t.prototype.compileNode=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;return this.fromVar||this.compileVariables(e),e.index?(u=this.fromNum&&this.toNum,s=Z(e,"index"),o=Z(e,"name"),f=o&&o!==s,h=""+s+" = "+this.fromC,this.toC!==this.toVar&&(h+=", "+this.toC),this.step!==this.stepVar&&(h+=", "+this.step),p=[""+s+" <"+this.equals,""+s+" >"+this.equals],a=p[0],i=p[1],n=this.stepNum?+this.stepNum>0?""+a+" "+this.toVar:""+i+" "+this.toVar:u?(d=[+this.fromNum,+this.toNum],r=d[0],c=d[1],d,r<=c?""+a+" "+c:""+i+" "+c):(t=""+this.fromVar+" <= "+this.toVar,""+t+" ? "+a+" "+this.toVar+" : "+i+" "+this.toVar),l=this.stepVar?""+s+" += "+this.stepVar:u?f?r<=c?"++"+s:"--"+s:r<=c?""+s+"++":""+s+"--":f?""+t+" ? ++"+s+" : --"+s:""+t+" ? "+s+"++ : "+s+"--",f&&(h=""+o+" = "+h),f&&(l=""+o+" = "+l),""+h+"; "+n+"; "+l):this.compileArray(e)},t.prototype.compileArray=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;if(this.fromNum&&this.toNum&&Math.abs(this.fromNum-this.toNum)<=20)return f=function(){v=[];for(var e=p=+this.fromNum,t=+this.toNum;p<=t?e<=t:e>=t;p<=t?e++:e--)v.push(e);return v}.apply(this),this.exclusive&&f.pop(),"["+f.join(", ")+"]";o=this.tab+W,s=e.scope.freeVariable("i"),l=e.scope.freeVariable("results"),a="\n"+o+l+" = [];",this.fromNum&&this.toNum?(e.index=s,n=this.compileNode(e)):(c=""+s+" = "+this.fromC+(this.toC!==this.toVar?", "+this.toC:""),r=""+this.fromVar+" <= "+this.toVar,n="var "+c+"; "+r+" ? "+s+" <"+this.equals+" "+this.toVar+" : "+s+" >"+this.equals+" "+this.toVar+"; "+r+" ? "+s+"++ : "+s+"--"),u="{ "+l+".push("+s+"); }\n"+o+"return "+l+";\n"+e.indent,i=function(e){return e!=null?e.contains(function(e){return e instanceof k&&e.value==="arguments"&&!e.asKey}):void 0};if(i(this.from)||i(this.to))t=", arguments";return"(function() {"+a+"\n"+o+"for ("+n+")"+u+"}).apply(this"+(t!=null?t:"")+")"},t}(i),e.Slice=R=function(e){function t(e){this.range=e,t.__super__.constructor.call(this)}return ht(t,e),t.prototype.children=["range"],t.prototype.compileNode=function(e){var t,n,r,i,s,o;return o=this.range,i=o.to,n=o.from,r=n&&n.compile(e,N)||"0",t=i&&i.compile(e,N),i&&(!!this.range.exclusive||+t!==-1)&&(s=", "+(this.range.exclusive?t:F.test(t)?""+(+t+1):(t=i.compile(e,E),""+t+" + 1 || 9e9"))),".slice("+r+(s||"")+")"},t}(i),e.Obj=M=function(e){function t(e,t){this.generated=t!=null?t:!1,this.objects=this.properties=e||[]}return ht(t,e),t.prototype.children=["properties"],t.prototype.compileNode=function(e){var t,n,i,s,o,u,a,f,l,h,p,d,v,m,g,y;p=this.properties,h=[],y=this.properties;for(d=0,m=y.length;d<m;d++){f=y[d],f.isComplex()&&(f=f.variable);if(f!=null){l=f.unwrapAll().value.toString();if(pt.call(h,l)>=0)throw SyntaxError('multiple object literal properties named "'+l+'"');h.push(l)}}if(!p.length)return this.front?"({})":"{}";if(this.generated)for(v=0,g=p.length;v<g;v++){u=p[v];if(u instanceof K)throw new Error("cannot have an implicit value in an implicit object")}return n=e.indent+=W,o=this.lastNonComment(this.properties),p=function(){var u,a,l;l=[];for(t=u=0,a=p.length;u<a;t=++u)f=p[t],s=t===p.length-1?"":f===o||f instanceof c?"\n":",\n",i=f instanceof c?"":n,f instanceof K&&f["this"]&&(f=new r(f.properties[0].name,f,"object")),f instanceof c||(f instanceof r||(f=new r(f,f,"object")),(f.variable.base||f.variable).asKey=!0),l.push(i+f.compile(e,C)+s);return l}(),p=p.join(""),a="{"+(p&&"\n"+p+"\n"+this.tab)+"}",this.front?"("+a+")":a},t.prototype.assigns=function(e){var t,n,r,i;i=this.properties;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.assigns(e))return!0}return!1},t}(i),e.Arr=n=function(e){function t(e){this.objects=e||[]}return ht(t,e),t.prototype.children=["objects"],t.prototype.filterImplicitObjects=o.prototype.filterImplicitObjects,t.prototype.compileNode=function(e){var t,n,r;return this.objects.length?(e.indent+=W,r=this.filterImplicitObjects(this.objects),(t=U.compileSplattedArray(e,r))?t:(t=function(){var t,i,s;s=[];for(t=0,i=r.length;t<i;t++)n=r[t],s.push(n.compile(e,x));return s}().join(", "),t.indexOf("\n")>=0?"[\n"+e.indent+t+"\n"+this.tab+"]":"["+t+"]")):"[]"},t.prototype.assigns=function(e){var t,n,r,i;i=this.objects;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.assigns(e))return!0}return!1},t}(i),e.Class=u=function(e){function n(e,t,n){this.variable=e,this.parent=t,this.body=n!=null?n:new s,this.boundFuncs=[],this.body.classBody=!0}return ht(n,e),n.prototype.children=["variable","parent","body"],n.prototype.determineName=function(){var e,n;if(!this.variable)return null;e=(n=rt(this.variable.properties))?n instanceof t&&n.name.value:this.variable.base.value;if(pt.call(I,e)>=0)throw SyntaxError("variable name may not be "+e);return e&&(e=v.test(e)&&e)},n.prototype.setContext=function(e){return this.body.traverseChildren(!1,function(t){if(t.classBody)return!1;if(t instanceof k&&t.value==="this")return t.value=e;if(t instanceof l){t.klass=e;if(t.bound)return t.context=e}})},n.prototype.addBoundFunctions=function(e){var n,r,i,s,o,u;if(this.boundFuncs.length){o=this.boundFuncs,u=[];for(i=0,s=o.length;i<s;i++)n=o[i],r=(new K(new k("this"),[new t(n)])).compile(e),u.push(this.ctor.body.unshift(new k(""+r+" = "+at("bind")+"("+r+", this)")));return u}},n.prototype.addProperties=function(e,n,i){var s,o,u,a,f;return f=e.base.properties.slice(0),u=function(){var e;e=[];while(s=f.shift()){if(s instanceof r){o=s.variable.base,delete s.context,a=s.value;if(o.value==="constructor"){if(this.ctor)throw new Error("cannot define more than one constructor in a class");if(a.bound)throw new Error("cannot define a constructor as a bound function");a instanceof l?s=this.ctor=a:(this.externalCtor=i.scope.freeVariable("class"),s=new r(new k(this.externalCtor),a))}else s.variable["this"]?(a["static"]=!0,a.bound&&(a.context=n)):(s.variable=new K(new k(n),[new t(new k("prototype")),new t(o)]),a instanceof l&&a.bound&&(this.boundFuncs.push(o),a.bound=!1))}e.push(s)}return e}.call(this),Y(u)},n.prototype.walkBody=function(e,t){var r=this;return this.traverseChildren(!1,function(i){var o,u,f,l,c,h;if(i instanceof n)return!1;if(i instanceof s){h=o=i.expressions;for(u=l=0,c=h.length;l<c;u=++l)f=h[u],f instanceof K&&f.isObject(!0)&&(o[u]=r.addProperties(f,e,t));return i.expressions=o=nt(o)}})},n.prototype.hoistDirectivePrologue=function(){var e,t,n;t=0,e=this.body.expressions;while((n=e[t])&&n instanceof c||n instanceof K&&n.isString())++t;return this.directives=e.splice(0,t)},n.prototype.ensureConstructor=function(e){return this.ctor||(this.ctor=new l,this.parent&&this.ctor.body.push(new k(""+e+".__super__.constructor.apply(this, arguments)")),this.externalCtor&&this.ctor.body.push(new k(""+this.externalCtor+".apply(this, arguments)")),this.ctor.body.makeReturn(),this.body.expressions.unshift(this.ctor)),this.ctor.ctor=this.ctor.name=e,this.ctor.klass=null,this.ctor.noReturn=!0},n.prototype.compileNode=function(e){var t,n,i,s,o,u,a;return n=this.determineName(),o=n||"_Class",o.reserved&&(o="_"+o),s=new k(o),this.hoistDirectivePrologue(),this.setContext(o),this.walkBody(o,e),this.ensureConstructor(o),this.body.spaced=!0,this.ctor instanceof l||this.body.expressions.unshift(this.ctor),this.body.expressions.push(s),(a=this.body.expressions).unshift.apply(a,this.directives),this.addBoundFunctions(e),t=f.wrap(this.body),this.parent&&(this.superClass=new k(e.scope.freeVariable("super",!1)),this.body.expressions.unshift(new p(s,this.superClass)),t.args.push(this.parent),u=t.variable.params||t.variable.base.params,u.push(new D(this.superClass))),i=new P(t,!0),this.variable&&(i=new r(this.variable,i)),i.compile(e)},n}(i),e.Assign=r=function(e){function n(e,t,n,r){var i,s,o;this.variable=e,this.value=t,this.context=n,this.param=r&&r.param,this.subpattern=r&&r.subpattern,i=(o=s=this.variable.unwrapAll().value,pt.call(I,o)>=0);if(i&&this.context!=="object")throw SyntaxError('variable name may not be "'+s+'"')}return ht(n,e),n.prototype.children=["variable","value"],n.prototype.isStatement=function(e){return(e!=null?e.level:void 0)===C&&this.context!=null&&pt.call(this.context,"?")>=0},n.prototype.assigns=function(e){return this[this.context==="object"?"value":"variable"].assigns(e)},n.prototype.unfoldSoak=function(e){return ut(e,this,"variable")},n.prototype.compileNode=function(e){var t,n,r,i,s,o,u,a,f;if(t=this.variable instanceof K){if(this.variable.isArray()||this.variable.isObject())return this.compilePatternMatch(e);if(this.variable.isSplice())return this.compileSplice(e);if((o=this.context)==="||="||o==="&&="||o==="?=")return this.compileConditional(e)}r=this.variable.compile(e,x);if(!this.context){if(!(s=this.variable.unwrapAll()).isAssignable())throw SyntaxError('"'+this.variable.compile(e)+'" cannot be assigned.');if(typeof s.hasProperties=="function"?!s.hasProperties():!void 0)this.param?e.scope.add(r,"var"):e.scope.find(r)}return this.value instanceof l&&(n=L.exec(r))&&(n[1]&&(this.value.klass=n[1]),this.value.name=(u=(a=(f=n[2])!=null?f:n[3])!=null?a:n[4])!=null?u:n[5]),i=this.value.compile(e,x),this.context==="object"?""+r+": "+i:(i=r+(" "+(this.context||"=")+" ")+i,e.level<=x?i:"("+i+")")},n.prototype.compilePatternMatch=function(e){var r,i,s,o,u,a,f,l,c,h,p,d,m,g,y,b,E,S,N,L,A,O,M,_,D,B,j;y=e.level===C,E=this.value,h=this.variable.base.objects;if(!(p=h.length))return s=E.compile(e),e.level>=T?"("+s+")":s;a=this.variable.isObject();if(y&&p===1&&!((c=h[0])instanceof U)){c instanceof n?(A=c,O=A.variable,u=O.base,c=A.value):c.base instanceof P?(M=(new K(c.unwrapAll())).cacheReference(e),c=M[0],u=M[1]):u=a?c["this"]?c.properties[0].name:c:new k(0),r=v.test(u.unwrap().value||0),E=new K(E),E.properties.push(new(r?t:w)(u));if(_=c.unwrap().value,pt.call(H,_)>=0)throw new SyntaxError("assignment to a reserved word: "+c.compile(e)+" = "+E.compile(e));return(new n(c,E,null,{param:this.param})).compile(e,C)}S=E.compile(e,x),i=[],g=!1;if(!v.test(S)||this.variable.assigns(S))i.push(""+(d=e.scope.freeVariable("ref"))+" = "+S),S=d;for(o=N=0,L=h.length;N<L;o=++N){c=h[o],u=o,a&&(c instanceof n?(D=c,B=D.variable,u=B.base,c=D.value):c.base instanceof P?(j=(new K(c.unwrapAll())).cacheReference(e),c=j[0],u=j[1]):u=c["this"]?c.properties[0].name:c);if(!g&&c instanceof U)l=c.name.unwrap().value,c=c.unwrap(),b=""+p+" <= "+S+".length ? "+at("slice")+".call("+S+", "+o,(m=p-o-1)?(f=e.scope.freeVariable("i"),b+=", "+f+" = "+S+".length - "+m+") : ("+f+" = "+o+", [])"):b+=") : []",b=new k(b),g=""+f+"++";else{l=c.unwrap().value;if(c instanceof U)throw c=c.name.compile(e),new SyntaxError("multiple splats are disallowed in an assignment: "+c+"...");typeof u=="number"?(u=new k(g||u),r=!1):r=a&&v.test(u.unwrap().value||0),b=new K(new k(S),[new(r?t:w)(u)])}if(l!=null&&pt.call(H,l)>=0)throw new SyntaxError("assignment to a reserved word: "+c.compile(e)+" = "+b.compile(e));i.push((new n(c,b,null,{param:this.param,subpattern:!0})).compile(e,x))}return!y&&!this.subpattern&&i.push(S),s=i.join(", "),e.level<x?s:"("+s+")"},n.prototype.compileConditional=function(e){var t,r,i;i=this.variable.cacheReference(e),t=i[0],r=i[1];if(!t.properties.length&&t.base instanceof k&&t.base.value!=="this"&&!e.scope.check(t.base.value))throw new Error('the variable "'+t.base.value+"\" can't be assigned with "+this.context+" because it has not been defined.");return pt.call(this.context,"?")>=0&&(e.isExistentialEquals=!0),(new _(this.context.slice(0,-1),t,new n(r,this.value,"="))).compile(e)},n.prototype.compileSplice=function(e){var t,n,r,i,s,o,u,a,f,l,c,h;return l=this.variable.properties.pop().range,r=l.from,u=l.to,n=l.exclusive,o=this.variable.compile(e),c=(r!=null?r.cache(e,T):void 0)||["0","0"],i=c[0],s=c[1],u?(r!=null?r.isSimpleNumber():void 0)&&u.isSimpleNumber()?(u=+u.compile(e)- +s,n||(u+=1)):(u=u.compile(e,E)+" - "+s,n||(u+=" + 1")):u="9e9",h=this.value.cache(e,x),a=h[0],f=h[1],t="[].splice.apply("+o+", ["+i+", "+u+"].concat("+a+")), "+f,e.level>C?"("+t+")":t},n}(i),e.Code=l=function(e){function t(e,t,n){this.params=e||[],this.body=t||new s,this.bound=n==="boundfunc",this.bound&&(this.context="_this")}return ht(t,e),t.prototype.children=["params","body"],t.prototype.isStatement=function(){return!!this.ctor},t.prototype.jumps=O,t.prototype.compileNode=function(e){var t,i,s,o,u,a,f,l,c,h,p,d,v,m,g,b,w,S,x,T,N,C,L,A,O,M,D,P,H,B,j,F,I;e.scope=new q(e.scope,this.body,this),e.scope.shared=Z(e,"sharedScope"),e.indent+=W,delete e.bare,delete e.isExistentialEquals,c=[],i=[],D=this.paramNames();for(g=0,x=D.length;g<x;g++)a=D[g],e.scope.check(a)||e.scope.parameter(a);P=this.params;for(b=0,T=P.length;b<T;b++){l=P[b];if(!l.splat)continue;H=this.params;for(w=0,N=H.length;w<N;w++)f=H[w].name,f["this"]&&(f=f.properties[0].name),f.value&&e.scope.add(f.value,"var",!0);p=new r(new K(new n(function(){var t,n,r,i;r=this.params,i=[];for(t=0,n=r.length;t<n;t++)f=r[t],i.push(f.asReference(e));return i}.call(this))),new K(new k("arguments")));break}B=this.params;for(S=0,C=B.length;S<C;S++)l=B[S],l.isComplex()?(v=h=l.asReference(e),l.value&&(v=new _("?",h,l.value)),i.push(new r(new K(l.name),v,"=",{param:!0}))):(h=l,l.value&&(u=new k(h.name.value+" == null"),v=new r(new K(l.name),l.value,"="),i.push(new y(u,v)))),p||c.push(h);m=this.body.isEmpty(),p&&i.unshift(p),i.length&&(j=this.body.expressions).unshift.apply(j,i);for(s=O=0,L=c.length;O<L;s=++O)f=c[s],e.scope.parameter(c[s]=f.compile(e));d=[],F=this.paramNames();for(M=0,A=F.length;M<A;M++){a=F[M];if(pt.call(d,a)>=0)throw SyntaxError("multiple parameters named '"+a+"'");d.push(a)}return!m&&!this.noReturn&&this.body.makeReturn(),this.bound&&(((I=e.scope.parent.method)!=null?I.bound:void 0)?this.bound=this.context=e.scope.parent.method.context:this["static"]||e.scope.parent.assign("_this","this")),o=e.indent,t="function",this.ctor&&(t+=" "+this.name),t+="("+c.join(", ")+") {",this.body.isEmpty()||(t+="\n"+this.body.compileWithDeclarations(e)+"\n"+this.tab),t+="}",this.ctor?this.tab+t:this.front||e.level>=E?"("+t+")":t},t.prototype.paramNames=function(){var e,t,n,r,i;e=[],i=this.params;for(n=0,r=i.length;n<r;n++)t=i[n],e.push.apply(e,t.names());return e},t.prototype.traverseChildren=function(e,n){if(e)return t.__super__.traverseChildren.call(this,e,n)},t}(i),e.Param=D=function(e){function t(e,t,n){var r;this.name=e,this.value=t,this.splat=n;if(r=e=this.name.unwrapAll().value,pt.call(I,r)>=0)throw SyntaxError('parameter name "'+e+'" is not allowed')}return ht(t,e),t.prototype.children=["name","value"],t.prototype.compile=function(e){return this.name.compile(e,x)},t.prototype.asReference=function(e){var t;return this.reference?this.reference:(t=this.name,t["this"]?(t=t.properties[0].name,t.value.reserved&&(t=new k(e.scope.freeVariable(t.value)))):t.isComplex()&&(t=new k(e.scope.freeVariable("arg"))),t=new K(t),this.splat&&(t=new U(t)),this.reference=t)},t.prototype.isComplex=function(){return this.name.isComplex()},t.prototype.names=function(e){var t,n,i,s,o,u;e==null&&(e=this.name),t=function(e){var t;return t=e.properties[0].name.value,t.reserved?[]:[t]};if(e instanceof k)return[e.value];if(e instanceof K)return t(e);n=[],u=e.objects;for(s=0,o=u.length;s<o;s++){i=u[s];if(i instanceof r)n.push(i.value.unwrap().value);else if(i instanceof U)n.push(i.name.unwrap().value);else{if(!(i instanceof K))throw SyntaxError("illegal parameter "+i.compile());i.isArray()||i.isObject()?n.push.apply(n,this.names(i.base)):i["this"]?n.push.apply(n,t(i)):n.push(i.base.value)}}return n},t}(i),e.Splat=U=function(e){function t(e){this.name=e.compile?e:new k(e)}return ht(t,e),t.prototype.children=["name"],t.prototype.isAssignable=G,t.prototype.assigns=function(e){return this.name.assigns(e)},t.prototype.compile=function(e){return this.index!=null?this.compileParam(e):this.name.compile(e)},t.prototype.unwrap=function(){return this.name},t.compileSplattedArray=function(e,n,r){var i,s,o,u,a,f,l,c;a=-1;while((f=n[++a])&&!(f instanceof t))continue;if(a>=n.length)return"";if(n.length===1)return o=n[0].compile(e,x),r?o:""+at("slice")+".call("+o+")";i=n.slice(a);for(u=l=0,c=i.length;l<c;u=++l)f=i[u],o=f.compile(e,x),i[u]=f instanceof t?""+at("slice")+".call("+o+")":"["+o+"]";return a===0?i[0]+(".concat("+i.slice(1).join(", ")+")"):(s=function(){var t,r,i,s;i=n.slice(0,a),s=[];for(t=0,r=i.length;t<r;t++)f=i[t],s.push(f.compile(e,x));return s}(),"["+s.join(", ")+"].concat("+i.join(", ")+")")},t}(i),e.While=Q=function(e){function t(e,t){this.condition=(t!=null?t.invert:void 0)?e.invert():e,this.guard=t!=null?t.guard:void 0}return ht(t,e),t.prototype.children=["condition","guard","body"],t.prototype.isStatement=G,t.prototype.makeReturn=function(e){return e?t.__super__.makeReturn.apply(this,arguments):(this.returns=!this.jumps({loop:!0}),this)},t.prototype.addBody=function(e){return this.body=e,this},t.prototype.jumps=function(){var e,t,n,r;e=this.body.expressions;if(!e.length)return!1;for(n=0,r=e.length;n<r;n++){t=e[n];if(t.jumps({loop:!0}))return t}return!1},t.prototype.compileNode=function(e){var t,n,r,i;return e.indent+=W,i="",t=this.body,t.isEmpty()?t="":(this.returns&&(t.makeReturn(r=e.scope.freeVariable("results")),i=""+this.tab+r+" = [];\n"),this.guard&&(t.expressions.length>1?t.expressions.unshift(new y((new P(this.guard)).invert(),new k("continue"))):this.guard&&(t=s.wrap([new y(this.guard,t)]))),t="\n"+t.compile(e,C)+"\n"+this.tab),n=i+this.tab+("while ("+this.condition.compile(e,N)+") {"+t+"}"),this.returns&&(n+="\n"+this.tab+"return "+r+";"),n},t}(i),e.Op=_=function(e){function t(e,t,r,i){if(e==="in")return new b(t,r);if(e==="do")return this.generateDo(t);if(e==="new"){if(t instanceof o&&!t["do"]&&!t.isNew)return t.newInstance();if(t instanceof l&&t.bound||t["do"])t=new P(t)}return this.operator=n[e]||e,this.first=t,this.second=r,this.flip=!!i,this}var n,i;return ht(t,e),n={"==":"===","!=":"!==",of:"in"},i={"!==":"===","===":"!=="},t.prototype.children=["first","second"],t.prototype.isSimpleNumber=O,t.prototype.isUnary=function(){return!this.second},t.prototype.isComplex=function(){var e;return!this.isUnary()||(e=this.operator)!=="+"&&e!=="-"||this.first.isComplex()},t.prototype.isChainable=function(){var e;return(e=this.operator)==="<"||e===">"||e===">="||e==="<="||e==="==="||e==="!=="},t.prototype.invert=function(){var e,n,r,s,o;if(this.isChainable()&&this.first.isChainable()){e=!0,n=this;while(n&&n.operator)e&&(e=n.operator in i),n=n.first;if(!e)return(new P(this)).invert();n=this;while(n&&n.operator)n.invert=!n.invert,n.operator=i[n.operator],n=n.first;return this}return(s=i[this.operator])?(this.operator=s,this.first.unwrap()instanceof t&&this.first.invert(),this):this.second?(new P(this)).invert():this.operator==="!"&&(r=this.first.unwrap())instanceof t&&((o=r.operator)==="!"||o==="in"||o==="instanceof")?r:new t("!",this)},t.prototype.unfoldSoak=function(e){var t;return((t=this.operator)==="++"||t==="--"||t==="delete")&&ut(e,this,"first")},t.prototype.generateDo=function(e){var t,n,i,s,u,a,f,c;s=[],n=e instanceof r&&(u=e.value.unwrap())instanceof l?u:e,c=n.params||[];for(a=0,f=c.length;a<f;a++)i=c[a],i.value?(s.push(i.value),delete i.value):s.push(i);return t=new o(e,s),t["do"]=!0,t},t.prototype.compileNode=function(e){var t,n,r,i;n=this.isChainable()&&this.first.isChainable(),n||(this.first.front=this.front);if(this.operator==="delete"&&e.scope.check(this.first.unwrapAll().value))throw SyntaxError("delete operand may not be argument or var");if(((r=this.operator)==="--"||r==="++")&&(i=this.first.unwrapAll().value,pt.call(I,i)>=0))throw SyntaxError("prefix increment/decrement may not have eval or arguments operand");return this.isUnary()?this.compileUnary(e):n?this.compileChain(e):this.operator==="?"?this.compileExistence(e):(t=this.first.compile(e,T)+" "+this.operator+" "+this.second.compile(e,T),e.level<=T?t:"("+t+")")},t.prototype.compileChain=function(e){var t,n,r,i;return i=this.first.second.cache(e),this.first.second=i[0],r=i[1],n=this.first.compile(e,T),t=""+n+" "+(this.invert?"&&":"||")+" "+r.compile(e)+" "+this.operator+" "+this.second.compile(e,T),"("+t+")"},t.prototype.compileExistence=function(e){var t,n;return this.first.isComplex()?(n=new k(e.scope.freeVariable("ref")),t=new P(new r(n,this.first))):(t=this.first,n=t),(new y(new h(t),n,{type:"if"})).addElse(this.second).compile(e)},t.prototype.compileUnary=function(e){var n,r,i;if(e.level>=E)return(new P(this)).compile(e);r=[n=this.operator],i=n==="+"||n==="-",(n==="new"||n==="typeof"||n==="delete"||i&&this.first instanceof t&&this.first.operator===n)&&r.push(" ");if(i&&this.first instanceof t||n==="new"&&this.first.isStatement(e))this.first=new P(this.first);return r.push(this.first.compile(e,T)),this.flip&&r.reverse(),r.join("")},t.prototype.toString=function(e){return t.__super__.toString.call(this,e,this.constructor.name+" "+this.operator)},t}(i),e.In=b=function(e){function t(e,t){this.object=e,this.array=t}return ht(t,e),t.prototype.children=["object","array"],t.prototype.invert=A,t.prototype.compileNode=function(e){var t,n,r,i,s;if(this.array instanceof K&&this.array.isArray()){s=this.array.base.objects;for(r=0,i=s.length;r<i;r++){n=s[r];if(n instanceof U){t=!0;break}continue}if(!t)return this.compileOrTest(e)}return this.compileLoopTest(e)},t.prototype.compileOrTest=function(e){var t,n,r,i,s,o,u,a,f;return this.array.base.objects.length===0?""+!!this.negated:(a=this.object.cache(e,T),o=a[0],s=a[1],f=this.negated?[" !== "," && "]:[" === "," || "],t=f[0],n=f[1],u=function(){var n,u,a,f;a=this.array.base.objects,f=[];for(r=n=0,u=a.length;n<u;r=++n)i=a[r],f.push((r?s:o)+t+i.compile(e,E));return f}.call(this),u=u.join(n),e.level<T?u:"("+u+")")},t.prototype.compileLoopTest=function(e){var t,n,r,i;return i=this.object.cache(e,x),r=i[0],n=i[1],t=at("indexOf")+(".call("+this.array.compile(e,x)+", "+n+") ")+(this.negated?"< 0":">= 0"),r===n?t:(t=r+", "+t,e.level<x?t:"("+t+")")},t.prototype.toString=function(e){return t.__super__.toString.call(this,e,this.constructor.name+(this.negated?"!":""))},t}(i),e.Try=$=function(e){function t(e,t,n,r){this.attempt=e,this.error=t,this.recovery=n,this.ensure=r}return ht(t,e),t.prototype.children=["attempt","recovery","ensure"],t.prototype.isStatement=G,t.prototype.jumps=function(e){var t;return this.attempt.jumps(e)||((t=this.recovery)!=null?t.jumps(e):void 0)},t.prototype.makeReturn=function(e){return this.attempt&&(this.attempt=this.attempt.makeReturn(e)),this.recovery&&(this.recovery=this.recovery.makeReturn(e)),this},t.prototype.compileNode=function(e){var t,n,r,i;return e.indent+=W,r=this.error?" ("+this.error.compile(e)+") ":" ",i=this.attempt.compile(e,C),t=function(){var t;if(this.recovery){if(t=this.error.value,pt.call(I,t)>=0)throw SyntaxError('catch variable may not be "'+this.error.value+'"');return e.scope.check(this.error.value)||e.scope.add(this.error.value,"param")," catch"+r+"{\n"+this.recovery.compile(e,C)+"\n"+this.tab+"}"}if(!this.ensure&&!this.recovery)return" catch (_error) {}"}.call(this),n=this.ensure?" finally {\n"+this.ensure.compile(e,C)+"\n"+this.tab+"}":"",""+this.tab+"try {\n"+i+"\n"+this.tab+"}"+(t||"")+n},t}(i),e.Throw=V=function(e){function t(e){this.expression=e}return ht(t,e),t.prototype.children=["expression"],t.prototype.isStatement=G,t.prototype.jumps=O,t.prototype.makeReturn=X,t.prototype.compileNode=function(e){return this.tab+("throw "+this.expression.compile(e)+";")},t}(i),e.Existence=h=function(e){function t(e){this.expression=e}return ht(t,e),t.prototype.children=["expression"],t.prototype.invert=A,t.prototype.compileNode=function(e){var t,n,r,i;return this.expression.front=this.front,r=this.expression.compile(e,T),v.test(r)&&!e.scope.check(r)?(i=this.negated?["===","||"]:["!==","&&"],t=i[0],n=i[1],r="typeof "+r+" "+t+' "undefined" '+n+" "+r+" "+t+" null"):r=""+r+" "+(this.negated?"==":"!=")+" null",e.level<=S?r:"("+r+")"},t}(i),e.Parens=P=function(e){function t(e){this.body=e}return ht(t,e),t.prototype.children=["body"],t.prototype.unwrap=function(){return this.body},t.prototype.isComplex=function(){return this.body.isComplex()},t.prototype.compileNode=function(e){var t,n,r;return r=this.body.unwrap(),r instanceof K&&r.isAtomic()?(r.front=this.front,r.compile(e)):(n=r.compile(e,N),t=e.level<T&&(r instanceof _||r instanceof o||r instanceof d&&r.returns),t?n:"("+n+")")},t}(i),e.For=d=function(e){function t(e,t){var n;this.source=t.source,this.guard=t.guard,this.step=t.step,this.name=t.name,this.index=t.index,this.body=s.wrap([e]),this.own=!!t.own,this.object=!!t.object,this.object&&(n=[this.index,this.name],this.name=n[0],this.index=n[1]);if(this.index instanceof K)throw SyntaxError("index cannot be a pattern matching expression");this.range=this.source instanceof K&&this.source.base instanceof B&&!this.source.properties.length,this.pattern=this.name instanceof K;if(this.range&&this.index)throw SyntaxError("indexes do not apply to range loops");if(this.range&&this.pattern)throw SyntaxError("cannot pattern match over range loops");this.returns=!1}return ht(t,e),t.prototype.children=["body","source","guard","step"],t.prototype.compileNode=function(e){var t,n,i,o,u,a,f,l,c,h,p,d,m,g,b,w,E,S,N,L,A,O,M,_,D;return t=s.wrap([this.body]),p=(D=rt(t.expressions))!=null?D.jumps():void 0,p&&p instanceof j&&(this.returns=!1),L=this.range?this.source.base:this.source,N=e.scope,m=this.name&&this.name.compile(e,x),f=this.index&&this.index.compile(e,x),m&&!this.pattern&&N.find(m),f&&N.find(f),this.returns&&(S=N.freeVariable("results")),l=this.object&&f||N.freeVariable("i"),c=this.range&&m||f||l,h=c!==l?""+c+" = ":"",this.step&&!this.range&&(O=N.freeVariable("step")),this.pattern&&(m=l),_="",u="",n="",a=this.tab+W,this.range?i=L.compile(it(e,{index:l,name:m,step:this.step})):(M=this.source.compile(e,x),(m||this.own)&&!v.test(M)&&(n=""+this.tab+(b=N.freeVariable("ref"))+" = "+M+";\n",M=b),m&&!this.pattern&&(g=""+m+" = "+M+"["+c+"]"),this.object||(d=N.freeVariable("len"),o=""+h+l+" = 0, "+d+" = "+M+".length",this.step&&(o+=", "+O+" = "+this.step.compile(e,T)),A=""+h+(this.step?""+l+" += "+O:c!==l?"++"+l:""+l+"++"),i=""+o+"; "+l+" < "+d+"; "+A)),this.returns&&(w=""+this.tab+S+" = [];\n",E="\n"+this.tab+"return "+S+";",t.makeReturn(S)),this.guard&&(t.expressions.length>1?t.expressions.unshift(new y((new P(this.guard)).invert(),new k("continue"))):this.guard&&(t=s.wrap([new y(this.guard,t)]))),this.pattern&&t.expressions.unshift(new r(this.name,new k(""+M+"["+c+"]"))),n+=this.pluckDirectCall(e,t),g&&(_="\n"+a+g+";"),this.object&&(i=""+c+" in "+M,this.own&&(u="\n"+a+"if (!"+at("hasProp")+".call("+M+", "+c+")) continue;")),t=t.compile(it(e,{indent:a}),C),t&&(t="\n"+t+"\n"),""+n+(w||"")+this.tab+"for ("+i+") {"+u+_+t+this.tab+"}"+(E||"")},t.prototype.pluckDirectCall=function(e,t){var n,i,s,u,a,f,c,h,p,d,v,m,g,y,b;i="",d=t.expressions;for(a=h=0,p=d.length;h<p;a=++h){s=d[a],s=s.unwrapAll();if(!(s instanceof o))continue;c=s.variable.unwrapAll();if(!(c instanceof l||c instanceof K&&((v=c.base)!=null?v.unwrapAll():void 0)instanceof l&&c.properties.length===1&&((m=(g=c.properties[0].name)!=null?g.value:void 0)==="call"||m==="apply")))continue;u=((y=c.base)!=null?y.unwrapAll():void 0)||c,f=new k(e.scope.freeVariable("fn")),n=new K(f),c.base&&(b=[n,c],c.base=b[0],n=b[1]),t.expressions[a]=new o(n,s.args),i+=this.tab+(new r(f,u)).compile(e,C)+";\n"}return i},t}(Q),e.Switch=z=function(e){function t(e,t,n){this.subject=e,this.cases=t,this.otherwise=n}return ht(t,e),t.prototype.children=["subject","cases","otherwise"],t.prototype.isStatement=G,t.prototype.jumps=function(e){var t,n,r,i,s,o,u;e==null&&(e={block:!0}),s=this.cases;for(r=0,i=s.length;r<i;r++){o=s[r],n=o[0],t=o[1];if(t.jumps(e))return t}return(u=this.otherwise)!=null?u.jumps(e):void 0},t.prototype.makeReturn=function(e){var t,n,r,i,o;i=this.cases;for(n=0,r=i.length;n<r;n++)t=i[n],t[1].makeReturn(e);return e&&(this.otherwise||(this.otherwise=new s([new k("void 0")]))),(o=this.otherwise)!=null&&o.makeReturn(e),this},t.prototype.compileNode=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;a=e.indent+W,f=e.indent=a+W,r=this.tab+("switch ("+(((d=this.subject)!=null?d.compile(e,N):void 0)||!1)+") {\n"),v=this.cases;for(u=
l=0,h=v.length;l<h;u=++l){m=v[u],s=m[0],t=m[1],g=nt([s]);for(c=0,p=g.length;c<p;c++)i=g[c],this.subject||(i=i.invert()),r+=a+("case "+i.compile(e,N)+":\n");if(n=t.compile(e,C))r+=n+"\n";if(u===this.cases.length-1&&!this.otherwise)break;o=this.lastNonComment(t.expressions);if(o instanceof j||o instanceof k&&o.jumps()&&o.value!=="debugger")continue;r+=f+"break;\n"}return this.otherwise&&this.otherwise.expressions.length&&(r+=a+("default:\n"+this.otherwise.compile(e,C)+"\n")),r+this.tab+"}"},t}(i),e.If=y=function(e){function t(e,t,n){this.body=t,n==null&&(n={}),this.condition=n.type==="unless"?e.invert():e,this.elseBody=null,this.isChain=!1,this.soak=n.soak}return ht(t,e),t.prototype.children=["condition","body","elseBody"],t.prototype.bodyNode=function(){var e;return(e=this.body)!=null?e.unwrap():void 0},t.prototype.elseBodyNode=function(){var e;return(e=this.elseBody)!=null?e.unwrap():void 0},t.prototype.addElse=function(e){return this.isChain?this.elseBodyNode().addElse(e):(this.isChain=e instanceof t,this.elseBody=this.ensureBlock(e)),this},t.prototype.isStatement=function(e){var t;return(e!=null?e.level:void 0)===C||this.bodyNode().isStatement(e)||((t=this.elseBodyNode())!=null?t.isStatement(e):void 0)},t.prototype.jumps=function(e){var t;return this.body.jumps(e)||((t=this.elseBody)!=null?t.jumps(e):void 0)},t.prototype.compileNode=function(e){return this.isStatement(e)?this.compileStatement(e):this.compileExpression(e)},t.prototype.makeReturn=function(e){return e&&(this.elseBody||(this.elseBody=new s([new k("void 0")]))),this.body&&(this.body=new s([this.body.makeReturn(e)])),this.elseBody&&(this.elseBody=new s([this.elseBody.makeReturn(e)])),this},t.prototype.ensureBlock=function(e){return e instanceof s?e:new s([e])},t.prototype.compileStatement=function(e){var n,r,i,s,o;return r=Z(e,"chainChild"),s=Z(e,"isExistentialEquals"),s?(new t(this.condition.invert(),this.elseBodyNode(),{type:"if"})).compile(e):(i=this.condition.compile(e,N),e.indent+=W,n=this.ensureBlock(this.body),o="if ("+i+") {\n"+n.compile(e)+"\n"+this.tab+"}",r||(o=this.tab+o),this.elseBody?o+" else "+(this.isChain?(e.indent=this.tab,e.chainChild=!0,this.elseBody.unwrap().compile(e,C)):"{\n"+this.elseBody.compile(e,C)+"\n"+this.tab+"}"):o)},t.prototype.compileExpression=function(e){var t,n,r,i;return i=this.condition.compile(e,S),n=this.bodyNode().compile(e,x),t=this.elseBodyNode()?this.elseBodyNode().compile(e,x):"void 0",r=""+i+" ? "+n+" : "+t,e.level>=S?"("+r+")":r},t.prototype.unfoldSoak=function(){return this.soak&&this},t}(i),f={wrap:function(e,n,r){var i,u,a,f,c;if(e.jumps())return e;a=new l([],s.wrap([e])),i=[];if((f=e.contains(this.literalArgs))||e.contains(this.literalThis))c=new k(f?"apply":"call"),i=[new k("this")],f&&i.push(new k("arguments")),a=new K(a,[new t(c)]);return a.noReturn=r,u=new o(a,i),n?s.wrap([u]):u},literalArgs:function(e){return e instanceof k&&e.value==="arguments"&&!e.asKey},literalThis:function(e){return e instanceof k&&e.value==="this"&&!e.asKey||e instanceof l&&e.bound||e instanceof o&&e.isSuper}},ut=function(e,t,n){var r;if(!!(r=t[n].unfoldSoak(e)))return t[n]=r.body,r.body=new K(t),r},J={"extends":function(){return"function(child, parent) { for (var key in parent) { if ("+at("hasProp")+".call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; }"},bind:function(){return"function(fn, me){ return function(){ return fn.apply(me, arguments); }; }"},indexOf:function(){return"[].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; }"},hasProp:function(){return"{}.hasOwnProperty"},slice:function(){return"[].slice"}},C=1,N=2,x=3,S=4,T=5,E=6,W="  ",m="[$A-Za-z_\\x7f-\\uffff][$\\w\\x7f-\\uffff]*",v=RegExp("^"+m+"$"),F=/^[+-]?\d+$/,L=RegExp("^(?:("+m+")\\.prototype(?:\\.("+m+")|\\[(\"(?:[^\\\\\"\\r\\n]|\\\\.)*\"|'(?:[^\\\\'\\r\\n]|\\\\.)*')\\]|\\[(0x[\\da-fA-F]+|\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\]))|("+m+")$"),g=/^['"]/,at=function(e){var t;return t="__"+e,q.root.assign(t,J[e]()),t},st=function(e,t){return e=e.replace(/\n/g,"$&"+t),e.replace(/\s+$/,"")}}).call(this)},require["./coffee-script"]=new function(){var e=this;(function(){var t,n,r,i,s,o,u,f,l,c={}.hasOwnProperty;i=require("fs"),u=require("path"),l=require("./lexer"),t=l.Lexer,n=l.RESERVED,o=require("./parser").parser,f=require("vm"),require.extensions?require.extensions[".coffee"]=function(e,t){var n;return n=r(i.readFileSync(t,"utf8"),{filename:t}),e._compile(n,t)}:require.registerExtension&&require.registerExtension(".coffee",function(e){return r(e)}),e.VERSION="1.3.3",e.RESERVED=n,e.helpers=require("./helpers"),e.compile=r=function(t,n){var r,i,u;n==null&&(n={}),u=e.helpers.merge;try{i=o.parse(s.tokenize(t)).compile(n);if(!n.header)return i}catch(f){throw n.filename&&(f.message="In "+n.filename+", "+f.message),f}return r="Generated by CoffeeScript "+this.VERSION,"// "+r+"\n"+i},e.tokens=function(e,t){return s.tokenize(e,t)},e.nodes=function(e,t){return typeof e=="string"?o.parse(s.tokenize(e,t)):o.parse(e)},e.run=function(e,t){var n;return t==null&&(t={}),n=require.main,n.filename=process.argv[1]=t.filename?i.realpathSync(t.filename):".",n.moduleCache&&(n.moduleCache={}),n.paths=require("module")._nodeModulePaths(u.dirname(i.realpathSync(t.filename))),u.extname(n.filename)!==".coffee"||require.extensions?n._compile(r(e,t),n.filename):n._compile(e,n.filename)},e.eval=function(e,t){var n,i,s,o,a,l,p,v,m,g,y,b,w,E;t==null&&(t={});if(!!(e=e.trim())){i=f.Script;if(i){if(t.sandbox!=null){if(t.sandbox instanceof i.createContext().constructor)p=t.sandbox;else{p=i.createContext(),b=t.sandbox;for(o in b){if(!c.call(b,o))continue;v=b[o],p[o]=v}}p.global=p.root=p.GLOBAL=p}else p=global;p.__filename=t.filename||"eval",p.__dirname=u.dirname(p.__filename);if(p===global&&!p.module&&!p.require){n=require("module"),p.module=y=new n(t.modulename||"eval"),p.require=E=function(e){return n._load(e,y,!0)},y.filename=p.__filename,w=Object.getOwnPropertyNames(require);for(m=0,g=w.length;m<g;m++)l=w[m],l!=="paths"&&(E[l]=require[l]);E.paths=y.paths=n._nodeModulePaths(process.cwd()),E.resolve=function(e){return n._resolveFilename(e,y)}}}a={};for(o in t){if(!c.call(t,o))continue;v=t[o],a[o]=v}return a.bare=!0,s=r(e,a),p===global?f.runInThisContext(s):f.runInContext(s,p)}},s=new t,o.lexer={lex:function(){var e,t;return t=this.tokens[this.pos++]||[""],e=t[0],this.yytext=t[1],this.yylineno=t[2],e},setInput:function(e){return this.tokens=e,this.pos=0},upcomingInput:function(){return""}},o.yy=require("./nodes")}).call(this)},require["./browser"]=new function(){var exports=this;(function(){var CoffeeScript,runScripts;CoffeeScript=require("./coffee-script"),CoffeeScript.require=require,CoffeeScript.eval=function(code,options){var _ref;return options==null&&(options={}),(_ref=options.bare)==null&&(options.bare=!0),eval(CoffeeScript.compile(code,options))},CoffeeScript.run=function(e,t){return t==null&&(t={}),t.bare=!0,Function(CoffeeScript.compile(e,t))()},typeof window!="undefined"&&window!==null&&(CoffeeScript.load=function(e,t){var n;return n=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP"),n.open("GET",e,!0),"overrideMimeType"in n&&n.overrideMimeType("text/plain"),n.onreadystatechange=function(){var r;if(n.readyState===4){if((r=n.status)!==0&&r!==200)throw new Error("Could not load "+e);CoffeeScript.run(n.responseText);if(t)return t()}},n.send(null)},runScripts=function(){var e,t,n,r,i,s;return s=document.getElementsByTagName("script"),e=function(){var e,t,n;n=[];for(e=0,t=s.length;e<t;e++)i=s[e],i.type==="text/coffeescript"&&n.push(i);return n}(),n=0,r=e.length,(t=function(){var r;r=e[n++];if((r!=null?r.type:void 0)==="text/coffeescript")return r.src?CoffeeScript.load(r.src,t):(CoffeeScript.run(r.innerHTML),t())})(),null},window.addEventListener?addEventListener("DOMContentLoaded",runScripts,!1):attachEvent("onload",runScripts))}).call(this)},require["./coffee-script"]}();typeof define=="function"&&define.amd?define("coffee-script",[],function(){return CoffeeScript}):root.CoffeeScript=CoffeeScript}(this),define("cs",["coffee-script"],function(e){"use strict";var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=function(){throw new Error("Environment unsupported.")},s={};return typeof process!="undefined"&&process.versions&&!!process.versions.node?(t=require.nodeRequire("fs"),i=function(e,n){n(t.readFileSync(e,"utf8"))}):typeof window!="undefined"&&window.navigator&&window.document||typeof importScripts!="undefined"?(n=function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(t=0;t<3;t++){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},i=function(e,t){var r=n();r.open("GET",e,!0),r.onreadystatechange=function(e){r.readyState===4&&t(r.responseText)},r.send(null)}):typeof Packages!="undefined"&&(i=function(e,t){var n="utf-8",r=new java.io.File(e),i=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),n)),o,u,a="";try{o=new java.lang.StringBuffer,u=s.readLine(),u&&u.length()&&u.charAt(0)===65279&&(u=u.substring(1)),o.append(u);while((u=s.readLine())!==null)o.append(i),o.append(u);a=String(o.toString())}finally{s.close()}t(a)}),{get:function(){return e},write:function(e,t,n){if(s.hasOwnProperty(t)){var r=s[t];n.asModule(e+"!"+t,r)}},version:"0.4.2",load:function(t,n,r,o){var u=n.toUrl(t+".coffee");i(u,function(i){try{i=e.compile(i,o.CoffeeScript)}catch(a){throw a.message="In "+u+", "+a.message,a}o.isBuild&&(s[t]=i),o.isBuild||(i+="\r\n//@ sourceURL="+u),r.fromText(t,i),n([t],function(e){r(e)})})}}}),define("md2d/models/aminoacids-props",[],function(){return[{fullName:"Alanine",abbreviation:"Ala",symbol:"A",molWeight:89.09,charge:0,hydrophobicityRB:2.15,pK:0,surface:115,volume:88.6,solubility:16.65,hydrophobicity:1,property:"Total aliphatic; hydrophobic"},{fullName:"Arginine",abbreviation:"Arg",symbol:"R",molWeight:174.2,charge:1,hydrophobicityRB:2.23,pK:12,surface:225,volume:173.4,solubility:15,hydrophobicity:-2,property:"Acidic side chains; strongly polar; cationic"},{fullName:"Asparagine",abbreviation:"Asn",symbol:"N",molWeight:132.12,charge:0,hydrophobicityRB:1.05,pK:0,surface:160,volume:114.1,solubility:3.53,hydrophobicity:-1,property:"Strongly polar"},{fullName:"Asparticacid",abbreviation:"Asp",symbol:"D",molWeight:133.1,charge:-1,hydrophobicityRB:1.13,pK:4.4,surface:150,volume:111.1,solubility:.778,hydrophobicity:-2,property:"Acidic side chains; strongly polar; anionic"},{fullName:"Cysteine",abbreviation:"Cys",symbol:"C",molWeight:121.15,charge:0,hydrophobicityRB:1.2,pK:8.5,surface:135,volume:108.5,solubility:1e3,hydrophobicity:1,property:"Polar side chains; semipolar"},{fullName:"Glutamine",abbreviation:"Gln",symbol:"Q",molWeight:146.15,charge:0,hydrophobicityRB:1.65,pK:0,surface:180,volume:143.8,solubility:2.5,hydrophobicity:-1,property:"Strongly polar"},{fullName:"Glutamicacid",abbreviation:"Glu",symbol:"E",molWeight:147.13,charge:-1,hydrophobicityRB:1.73,pK:4.4,surface:190,volume:138.4,solubility:.864,hydrophobicity:-2,property:"Acidic side chains; strongly polar; anionic"},{fullName:"Glycine",abbreviation:"Gly",symbol:"G",molWeight:75.07,charge:0,hydrophobicityRB:1.18,pK:0,surface:75,volume:60.1,solubility:24.99,hydrophobicity:1,property:"Semipolar"},{fullName:"Histidine",abbreviation:"His",symbol:"H",molWeight:155.16,charge:1,hydrophobicityRB:2.45,pK:6.5,surface:195,volume:153.2,solubility:4.19,hydrophobicity:-2,property:"Basic side chains; strongly polar; cationic"},{fullName:"Isoleucine",abbreviation:"Ile",symbol:"I",molWeight:131.17,charge:0,hydrophobicityRB:3.88,pK:0,surface:175,volume:166.7,solubility:4.117,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"},{fullName:"Leucine",abbreviation:"Leu",symbol:"L",molWeight:131.17,charge:0,hydrophobicityRB:4.1,pK:10,surface:170,volume:166.7,solubility:2.426,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"},{fullName:"Lysine",abbreviation:"Lys",symbol:"K",molWeight:146.19,charge:1,hydrophobicityRB:3.05,pK:0,surface:200,volume:168.6,solubility:1e3,hydrophobicity:-2,property:"Acidic side chains; strongly polar; cationic"},{fullName:"Methionine",abbreviation:"Met",symbol:"M",molWeight:149.21,charge:0,hydrophobicityRB:3.43,pK:0,surface:185,volume:162.9,solubility:3.81,hydrophobicity:1,property:"Totally alyphatic"},{fullName:"Phenylalanine",abbreviation:"Phe",symbol:"F",molWeight:165.19,charge:0,hydrophobicityRB:3.46,pK:0,surface:210,volume:189.9,solubility:2.965,hydrophobicity:2,property:"Totally aromatic"},{fullName:"Proline",abbreviation:"Pro",symbol:"P",molWeight:115.13,charge:0,hydrophobicityRB:3.1,pK:0,surface:145,volume:112.7,solubility:162.3,hydrophobicity:1,property:"Totally alyphatic"},{fullName:"Serine",abbreviation:"Ser",symbol:"S",molWeight:105.09,charge:0,hydrophobicityRB:1.4,pK:0,surface:115,volume:89,solubility:5.023,hydrophobicity:-1,property:"Semipolar"},{fullName:"Threonine",abbreviation:"Thr",symbol:"T",molWeight:119.12,charge:0,hydrophobicityRB:2.25,pK:0,surface:140,volume:116.1,solubility:1e3,hydrophobicity:-1,property:"Semipolar"},{fullName:"Tryptophan",abbreviation:"Trp",symbol:"W",molWeight:204.23,charge:0,hydrophobicityRB:4.11,pK:0,surface:255,volume:227.8,solubility:1.136,hydrophobicity:2,property:"Totally aromatic"},{fullName:"Tyrosine",abbreviation:"Tyr",symbol:"Y",molWeight:181.19,charge:0,hydrophobicityRB:2.81,pK:10,surface:230,volume:193.6,solubility:.045,hydrophobicity:1,property:"Hydrophobic; total aromatic"},{fullName:"Valine",abbreviation:"Val",symbol:"V",molWeight:117.15,charge:0,hydrophobicityRB:3.38,pK:0,surface:155,volume:140,solubility:8.85,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"}]}),function(){define("cs!md2d/models/aminoacids-helper",["require","md2d/models/aminoacids-props"],function(e){var t,n,r;return r=e("md2d/models/aminoacids-props"),t=5,n={UUU:"Phe",UUC:"Phe",UUA:"Leu",UUG:"Leu",CUU:"Leu",CUC:"Leu",CUA:"Leu",CUG:"Leu",AUU:"Ile",AUC:"Ile",AUA:"Ile",AUG:"Met",GUU:"Val",GUC:"Val",GUA:"Val",GUG:"Val",UCU:"Ser",UCC:"Ser",UCA:"Ser",UCG:"Ser",AGU:"Ser",AGC:"Ser",CCU:"Pro",CCC:"Pro",CCA:"Pro",CCG:"Pro",ACU:"Thr",ACC:"Thr",ACA:"Thr",ACG:"Thr",GCU:"Ala",GCC:"Ala",GCA:"Ala",GCG:"Ala",UAU:"Tyr",UAC:"Tyr",CAU:"His",CAC:"His",CAA:"Gln",CAG:"Gln",AAU:"Asn",AAC:"Asn",AAA:"Lys",AAG:"Lys",GAU:"Asp",GAC:"Asp",GAA:"Glu",GAG:"Glu",UGU:"Cys",UGC:"Cys",UGG:"Trp",CGU:"Arg",CGC:"Arg",CGA:"Arg",CGG:"Arg",AGA:"Arg",AGG:"Arg",GGU:"Gly",GGC:"Gly",GGA:"Gly",GGG:"Gly",UAA:"STOP",UAG:"STOP",UGA:"STOP"},{firstElementID:t,lastElementID:t+r.length-1,cysteineElement:9,abbrToElement:function(e){var t,n,i,s;for(n=i=0,s=r.length;i<s;n=++i){t=r[n];if(t.abbreviation===e)return n+this.firstElementID}},getAminoAcidByElement:function(e){return r[e-this.firstElementID]},isAminoAcid:function(e){return e>=this.firstElementID&&e<=this.lastElementID},getPolarAminoAcids:function(){var e,t,n,r,i;r=["Asn","Gln","Ser","Thr"],i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.abbrToElement(e));return i},codonToAbbr:function(e){return e.length!==3?"STOP":n[e]}}})}.call(this),define("md2d/models/engine/math/distributions",["require","exports","module"],function(e,t,n){t.normal=function(){var e=null;return function(t,n){t==null&&(t=0),n==null&&(n=1);var r,i,s,o,u;return e?(i=e,e=null,i):(o=Math.random(),u=Math.random(),s=2*Math.PI*o,r=Math.sqrt(-2*Math.log(u)),e=t+n*r*Math.sin(s),t+n*r*Math.cos(s))}}()}),define("md2d/models/engine/math/utils",["require","exports","module"],function(e,t,n){t.getWindowedAverager=function(e){e==null&&(e=1e3);var t=0,n=[],r=0;return function(s){return r-=n[t]||0,r+=s,n[t]=s,++t===e&&(t=0),n.length===e?r/e:NaN}}}),define("md2d/models/engine/math/minimizer",["require","exports","module","common/console"],function(e,t,n){var r=e("common/console");t.minimize=function(e,t,n){n=n||{},n.precision==null&&(n.precision=.01);var i=n.precision,s=n.bounds,o=n.maxiter||1e3,u=n.stopval||-Infinity,a=n.maxstep||.01,f=n.eps||.01,l=t.length,c,h,p,d,v,m,g,y,b,w;m=a*a,c=[];for(b=0;b<l;b++)c[b]=t[b];h=e.apply(null,c),p=h[0],v=h[1],y=0;do{if(p<=u)break;if(y>o)return r.log("maxiter reached"),{error:"maxiter reached",f:p,iter:o,x:c};g=0;for(b=0;b<l;b++)g+=v[b]*v[b];if(f*f*g>m){w=Math.sqrt(m/g)/f;for(b=0;b<l;b++)v[b]=w*v[b]}for(b=0;b<l;b++)c[b]-=f*v[b],s&&c[b]<s[b][0]&&(c[b]=s[b][0]),s&&c[b]>s[b][1]&&(c[b]=s[b][1]);d=p,h=e.apply(null,c),p=h[0],v=h[1],y++}while(Math.abs(p-d)>i);return[p,c]}}),define("md2d/models/engine/math/index",["require","exports","module","./distributions","./utils","./minimizer"],function(e,t,n){t.normal=e("./distributions").normal,t.getWindowedAverager=e("./utils").getWindowedAverager,t.minimize=e("./minimizer").minimize}),define("md2d/models/engine/potentials/coulomb",["require","exports","module","../constants/index"],function(e,t,n){var r=e("../constants/index"),i=r.unit,s=.346,o=r.COULOMB_CONSTANT.as(r.unit.METERS_PER_FARAD),u=r.ratio(i.NANOMETER,{per:i.METER}),a=Math.pow(r.ratio(i.COULOMB,{per:i.ELEMENTARY_CHARGE}),2),f=r.ratio(i.EV,{per:i.JOULE}),l=r.ratio(i.MW_FORCE_UNIT,{per:i.NEWTON}),c=s*o*a*u*f,h=s*o*a*u*u*l,p=t.potential=function(e,t,n,r,i){return i&&r>1&&e<1.2&&(r=1+(r-1)/(1+Math.exp(-12*e+7))),c*(t*n/e)/r},d=t.forceFromSquaredDistance=function(e,t,n,r,i){var s=Math.sqrt(e);return i&&r>1&&s<1.2&&(r=1+(r-1)/(1+Math.exp(-12*s+7))),-h*(t*n/e)/r},v=t.forceOverDistanceFromSquaredDistance=function(e,t,n,r,i){return d(e,t,n,r,i)/Math.sqrt(e)},m=t.force=function(e,t,n,r,i){return d(e*e,t,n,r,i)}}),define("md2d/models/engine/potentials/lennard-jones",["require","exports","module","../constants/index"],function(e,t,n){var r=e("../constants/index"),i=r.unit,s=r.ratio(i.NANOMETER,{per:i.METER}),o=r.ratio(i.MW_FORCE_UNIT,{per:i.NEWTON});t.pairwiseEpsilon=function(e,t){return.5*(e+t)},t.pairwiseSigma=function(e,t){return Math.sqrt(e*t)},t.rmin=function(e){return Math.pow(2,1/6)*e},t.radius=function(e){return.5*e},t.newLJCalculator=function(e,n){var u,a,f,l,c,h,p,d=!1,v=function(e,v){u=e,a=v,f=t.rmin(a),u!=null&&a!=null&&(l=4*u*Math.pow(a,12),c=4*u*Math.pow(a,6),h=12*r.convert(l,{from:i.EV,to:i.JOULE})*s*o,p=6*r.convert(c,{from:i.EV,to:i.JOULE})*s*o),d&&typeof n=="function"&&n(m(),this)},m=function(){return{epsilon:u,sigma:a,rmin:f}},g=function(e){if(e==null||parseFloat(e)!==e)throw new Error("lennardJones: epsilon value "+e+" is invalid")},y=function(e){if(e==null||parseFloat(e)!==e||e<=0)throw new Error("lennardJones: sigma value "+e+" is invalid")},b;return g(e.epsilon),y(e.sigma),v(e.epsilon,e.sigma),d=!0,b={getCoefficients:m,setEpsilon:function(e){g(e),v(e,a)},setSigma:function(e){y(e),v(u,e)},potentialFromSquaredDistance:function(e){return e?l*Math.pow(e,-6)-c*Math.pow(e,-3):-Infinity},potential:function(e){return b.potentialFromSquaredDistance(e*e)},forceOverDistanceFromSquaredDistance:function(e){var t=1/e,n=t*t*t,r=n*t,i=r*n;return h*i-p*r},force:function(e){return e*b.forceOverDistanceFromSquaredDistance(e*e)}}}}),define("md2d/models/engine/potentials/index",["require","exports","module","./coulomb","./lennard-jones"],function(e,t,n){t.coulomb=e("./coulomb"),t.lennardJones=e("./lennard-jones")}),define("md2d/models/metadata",[],function(){return{mainProperties:{type:{defaultValue:"md2d",immutable:!0},imagePath:{defaultValue:"",immutable:!0},minX:{serialize:!1},maxX:{serialize:!1},minY:{serialize:!1},maxY:{serialize:!1},width:{defaultValue:10,unitType:"length",immutable:!0},height:{defaultValue:10,unitType:"length",immutable:!0},unitsScheme:{defaultValue:"md2d"},lennardJonesForces:{defaultValue:!0,storeInTickHistory:!0},coulombForces:{defaultValue:!0,storeInTickHistory:!0},temperatureControl:{defaultValue:!1,storeInTickHistory:!0},targetTemperature:{defaultValue:300,unitType:"temperature",storeInTickHistory:!0},modelSampleRate:{defaultValue:"default"},gravitationalField:{defaultValue:!1,unitType:"acceleration",storeInTickHistory:!0},timeStep:{defaultValue:1,unitType:"time",storeInTickHistory:!0},dielectricConstant:{defaultValue:1},realisticDielectricEffect:{defaultValue:!0},solventForceFactor:{defaultValue:1.25},solventForceType:{defaultValue:0},additionalSolventForceMult:{defaultValue:4},additionalSolventForceThreshold:{defaultValue:10,unitType:"length"},polarAAEpsilon:{defaultValue:-2},viscosity:{defaultValue:1,storeInTickHistory:!0},timeStepsPerTick:{defaultValue:50,storeInTickHistory:!0},DNAState:{defaultValue:"dna"},DNA:{defaultValue:"",validate:function(e){/[agtc]/.test(e)&&(e=e.toUpperCase());if(/[^AGTC]/.test(e))throw new Error("DNA code on sense strand can be defined using only A, G, T or C characters.");return e}},DNAMutations:{defaultValue:!0},useQuantumDynamics:{"default":!1,serialize:!1}},viewOptions:{viewPortWidth:{unitType:"length",immutable:!0},viewPortHeight:{unitType:"length",immutable:!0},viewPortZoom:{defaultValue:1},viewPortX:{unitType:"length"},viewPortY:{unitType:"length"},viewPortDrag:{defaultValue:!1},backgroundColor:{defaultValue:"#eeeeee"},showClock:{defaultValue:!0,storeInTickHistory:!0},markColor:{defaultValue:"#f8b500"},keShading:{defaultValue:!1,storeInTickHistory:!0},chargeShading:{defaultValue:!1,storeInTickHistory:!0},useThreeLetterCode:{defaultValue:!0},aminoAcidColorScheme:{defaultValue:"hydrophobicity"},showChargeSymbols:{defaultValue:!0},showVDWLines:{defaultValue:!1,storeInTickHistory:!0},VDWLinesCutoff:{defaultValue:"medium"},showVelocityVectors:{defaultValue:!1,storeInTickHistory:!0},showForceVectors:{defaultValue:!1,storeInTickHistory:!0},showAtomTrace:{defaultValue:!1},atomTraceId:{defaultValue:0},images:{defaultValue:[]},imageMapping:{defaultValue:{}},textBoxes:{defaultValue:[]},xlabel:{defaultValue:!1},ylabel:{defaultValue:!1},xunits:{defaultValue:!1},yunits:{defaultValue:!1},controlButtons:{defaultValue:"play"},gridLines:{defaultValue:!1},atomNumbers:{defaultValue:!1},enableAtomTooltips:{defaultValue:!1},enableKeyboardHandlers:{defaultValue:!0},atomTraceColor:{defaultValue:"#6913c5"},velocityVectors:{defaultValue:{color:"#000",width:.01,length:2}},forceVectors:{defaultValue:{color:"#169C30",width:.01,length:2}}},atom:{x:{required:!0,unitType:"length"},y:{required:!0,unitType:"length"},element:{defaultValue:0},vx:{defaultValue:0,unitType:"velocity"},vy:{defaultValue:0,unitType:"velocity"},ax:{defaultValue:0,unitType:"acceleration",serialize:!1},ay:{defaultValue:0,unitType:"acceleration",serialize:!1},charge:{defaultValue:0,unitType:"charge"},friction:{defaultValue:0,unitType:"dampingCoefficient"},visible:{defaultValue:1},pinned:{defaultValue:0},marked:{defaultValue:0},draggable:{defaultValue:0},radius:{readOnly:!0,unitType:"length",serialize:!1},px:{readOnly:!0,unitType:"momentum",serialize:!1},py:{readOnly:!0,unitType:"momentum",serialize:!1},speed:{readOnly:!0,unitType:"velocity",serialize:!1},mass:{readOnly:!0,unitType:"mass",serialize:!1},excitation:{}},element:{mass:{defaultValue:120,unitType:"mass"},sigma:{defaultValue:.3,unitType:"length"},epsilon:{defaultValue:-0.1,unitType:"energy"},radius:{unitType:"length",readOnly:!0,serialize:!1},color:{defaultValue:-855310}},pairwiseLJProperties:{element1:{defaultValue:0},element2:{defaultValue:0},sigma:{unitType:"length"},epsilon:{unitType:"energy"}},obstacle:{width:{unitType:"length",required:!0},height:{unitType:"length",required:!0},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},mass:{defaultValue:Infinity,unitType:"mass"},vx:{defaultValue:0,unitType:"velocity"},vy:{defaultValue:0,unitType:"velocity"},externalAx:{defaultValue:0,unitType:"acceleration"},externalAy:{defaultValue:0,unitType:"accleration"},friction:{defaultValue:0,unitType:"inverseTime"},westProbe:{defaultValue:!1},westProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},northProbe:{defaultValue:!1},northProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},eastProbe:{defaultValue:!1},eastProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},southProbe:{defaultValue:!1},southProbeValue:{unitType:"pressure",readOnly:!0,serialize:!1},colorR:{defaultValue:128},colorG:{defaultValue:128},colorB:{defaultValue:128},visible:{defaultValue:!0}},rectangle:{width:{unitType:"length",required:!0},height:{unitType:"length",required:!0},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},fence:{defaultValue:!1},color:{defaultValue:"transparent"},lineColor:{defaultValue:"black"},lineDashes:{defaultValue:"none"},lineWeight:{defaultValue:1},layer:{defaultValue:1},visible:{defaultValue:!0}},radialBond:{atom1:{defaultValue:0},atom2:{defaultValue:0},length:{unitType:"length",required:!0},strength:{unitType:"stiffness",required:!0},type:{defaultValue:101}},angularBond:{atom1:{defaultValue:0},atom2:{defaultValue:0},atom3:{defaultValue:0},strength:{unitType:"rotationalStiffness",required:!0},angle:{unitType:"angle",required:!0}},restraint:{atomIndex:{required:!0},k:{defaultValue:2e3,unitType:"stiffness"},x0:{defaultValue:0,unitType:"length"},y0:{defaultValue:0,unitType:"length"}},textBox:{text:{defaultValue:""},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},anchor:{defaultValue:"lower-left"},layer:{defaultValue:1},width:{},height:{},frame:{},color:{},calloutPoint:{},backgroundColor:{defaultValue:"white"},strokeWidthEms:{defaultValue:.03},strokeOpacity:{defaultValue:1},rotate:{defaultValue:0},fontScale:{defaultValue:1},hostType:{},hostIndex:{},textAlign:{}},quantumDynamics:{elementEnergyLevels:{defaultValue:[]},photons:{defaultValue:{}},radiationlessEmissionProbability:{defaultValue:1}},photon:{x:{serialize:!0},y:{serialize:!0},vx:{defaultValue:0,serialize:!0},vy:{defaultValue:0,serialize:!0},angularFrequency:{serialize:!0}}}}),function(){var e={}.hasOwnProperty;define("cs!md2d/models/engine/pairwise-lj-properties",["require","md2d/models/metadata","common/validator"],function(t){var n,r,i;return r=t("md2d/models/metadata"),i=t("common/validator"),n=function(){function t(e){this._engine=e,this._data={}}return t.prototype.registerChangeHooks=function(e,t){return this._changePreHook=e,this._changePostHook=t},t.prototype.set=function(t,n,s){var o;s=i.validate(r.pairwiseLJProperties,s),this._changePreHook(),this._data[t]==null&&(this._data[t]={}),this._data[n]==null&&(this._data[n]={}),this._data[t][n]==null&&(this._data[t][n]=this._data[n][t]={});for(o in s){if(!e.call(s,o))continue;this._data[t][n][o]=s[o]}return this._engine.setPairwiseLJProperties(t,n),this._changePostHook()},t.prototype.remove=function(e,t){return this._changePreHook(),delete this._data[e][t],delete this._data[t][e],this._engine.setPairwiseLJProperties(e,t),this._changePostHook()},t.prototype.get=function(e,t){return this._data[e]&&this._data[e][t]?this._data[e][t]:void 0},t.prototype.deserialize=function(e){var t,n,s,o,u;for(o=0,u=e.length;o<u;o++)s=e[o],s=i.validateCompleteness(r.pairwiseLJProperties,s),t=s.element1,n=s.element2,delete s.element1,delete s.element2,this.set(t,n,s)},t.prototype.serialize=function(){var t,n,r,i,s,o;s=[],o=this._data;for(n in o){if(!e.call(o,n))continue;t=o[n];for(r in t){if(!e.call(t,r))continue;n<r&&(i=this.get(n,r),i.element1=Number(n),i.element2=Number(r),s.push(i))}}return s},t.prototype.clone=function(){return $.extend(!0,{},this._data)},t.prototype.restore=function(t){var n,r,i,s;this._data=t,s=this._data;for(r in s){if(!e.call(s,r))continue;n=s[r];for(i in n){if(!e.call(n,i))continue;r<i&&this._engine.setPairwiseLJProperties(r,i)}}},t}()})}.call(this),define("common/models/engines/clone-restore-wrapper",["require","arrays"],function(e){var t=e("arrays");return function(n){return{clone:function(){var e={},r;for(r in n)n.hasOwnProperty(r)&&(e[r]=t.clone(n[r]));return e},restore:function(e){var r;for(r in n)n.hasOwnProperty(r)&&t.copy(e[r],n[r])}}}}),define("md2d/models/engine/cell-list",[],function(){return function(t,n,r){var i,s,o,u,a,f=function(){var e;s=Math.ceil(t/r),o=Math.ceil(n/r),u=s*o,a=new Array(u);for(e=0;e<u;e++)a[e]=[]};return f(),i={reinitialize:function(e){e!==r&&(r=e,f())},addToCell:function(e,t,n){var i=Math.floor(n/r)*s+Math.floor(t/r);a[i].push(e)},getCell:function(e){return a[e]},getRowsNum:function(){return o},getColsNum:function(){return s},getNeighboringCells:function(e,t){var n=e*s+t,r=[];return t+1<s&&e+1<o&&r.push(a[n+s+1]),t+1<s&&r.push(a[n+1]),t+1<s&&e-1>=0&&r.push(a[n-s+1]),e-1>=0&&r.push(a[n-s]),r},clear:function(){var e;for(e=0;e<u;e++)a[e].length=0}},i}}),define("md2d/models/engine/neighbor-list",["require","arrays","common/array-types"],function(e){var t=e("arrays"),n=e("common/array-types");return function(r,i){var s,o,u,a,f,l,c,h,p,d,v=function(){o=r+10,u=0,a=o*(o-1)/2,d=!0,f=t.create(a,0,n.int16Type),l=t.create(o,-1,n.int16Type),c=t.create(o,-1,n.int16Type),h=t.create(o,Infinity,n.floatType),p=t.create(o,Infinity,n.floatType)};return v(),s={reinitialize:function(e,t){r=e,i=t,d=!0,r>o&&v()},clear:function(){var e;u=0;for(e=0;e<r;e++)l[e]=c[e]=-1},getList:function(){return f},markNeighbors:function(e,t){l[e]<0&&(l[e]=u),f[u]=t,u++,c[e]=u},getStartIdxFor:function(e){return l[e]},getEndIdxFor:function(e){return c[e]},saveAtomPosition:function(e,t,n){h[e]=t,p[e]=n},invalidate:function(){d=!0},shouldUpdate:function(e,t){var n=-Infinity,s=-Infinity,o;if(d)return d=!1,!0;for(o=0;o<r;o++)Math.abs(e[o]-h[o])>n&&(n=Math.abs(e[o]-h[o])),Math.abs(t[o]-p[o])>s&&(s=Math.abs(t[o]-p[o]));return Math.sqrt(n*n+s*s)>i}},s}}),define("common/models/plugin-controller",[],function(){return function(){var t=[];return{registerPlugin:function(e){t.push(e)},callPluginFunction:function(e,n,r){var i,s,o,u;for(i=0,s=t.length;i<s;i++)o=t[i][e],o&&(u=o.apply(t[i],n)),r&&r(u,i,t[i])}}}}),define("md2d/models/engine/utils",["require","arrays"],function(e){var t=e("arrays");return{extendArrays:function(e,n){var r,i;if(Array.isArray(e))for(r=0,i=e.length;r<i;r++)t.isArray(e[r])&&(e[r]=t.extend(e[r],n));else for(r in e)e.hasOwnProperty(r)&&t.isArray(e[r])&&(e[r]=t.extend(e[r],n))}}}),define("md2d/models/engine/md2d",["require","exports","module","arrays","common/array-types","common/console","./constants/index","cs!md2d/models/aminoacids-helper","./math/index","./potentials/index","./potentials/index","cs!./pairwise-lj-properties","common/models/engines/clone-restore-wrapper","./cell-list","./neighbor-list","common/models/plugin-controller","./utils"],function(e,t,n){var r=e("arrays"),i=e("common/array-types"),s=e("common/console"),o=e("./constants/index"),u=o.unit,a=e("cs!md2d/models/aminoacids-helper"),f=e("./math/index"),l=e("./potentials/index").coulomb,c=e("./potentials/index").lennardJones,h=e("cs!./pairwise-lj-properties"),p=e("common/models/engines/clone-restore-wrapper"),d=e("./cell-list"),v=e("./neighbor-list"),m=e("common/models/plugin-controller"),g=e("./utils"),y=-120*o.BOLTZMANN_CONSTANT.as(u.EV_PER_KELVIN),b=.34,w=39.95,E=o.convert(w,{from:u.DALTON,to:u.KILOGRAM}),S=o.BOLTZMANN_CONSTANT.as(u.JOULES_PER_KELVIN),x=function(e,t,n,r){return e*r-t*n},T=function(e,t){return e*e+t*t},N=function(e,t){var n=2*t,r=2/n*e,i=o.convert(r,{from:u.MW_ENERGY_UNIT,to:u.JOULE});return i/S},C=function(e,t){var n=2*t,r=e*S,i=o.convert(r,{from:u.JOULE,to:u.MW_ENERGY_UNIT}),s=i*n/2;return s},k=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("md2d: requested temperature "+e+" could not be understood.");if(t<0)throw new Error("md2d: requested temperature "+t+" was less than zero");if(t===Infinity)throw new Error("md2d: requested temperature was Infinity!")};t.createEngine=function(){var e,t=!1,n=new m,y=!1,b=1,w=!0,E=0,S=!1,L=1,A=25,O=3,M=!0,_=!1,D=1.67,P=!1,H=!1,B,j=.001,F=[10,10],I=0,q=0,R=10,U=10,z,W=0,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct=0,ht,pt,dt,vt,mt,gt,yt=0,bt=[],wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At=0,Ot,Mt,_t,Dt,Pt,Ht=0,Bt,jt,Ft,It,qt,Rt,Ut=0,zt,Wt,Xt,Vt,$t,Jt,Kt,Qt,Gt,Yt,Zt,en,tn,nn,rn,sn,on,un,an,fn,ln,cn,hn,pn,dn,vn=0,mn,gn,yn,bn,wn,En,Sn,xn,Tn,Nn,Cn,kn,Ln=0,An,On,Mn,_n,Dn,Pn,Hn,Bn,jn,Fn=0,In,qn,Rn,Un,zn,Wn,Xn,Vn,$n,Jn,Kn,Qn,Gn,Yn=2,Zn=[],er=2.5,tr=[],nr=[],rr=!1,ir=[],sr=[],or=function(){vr(0),mr(0),br(0),gr(0),yr(0),wr(0),Er(0),Sr(0),xr(0),wt=new h(e),Lt=[],kt=e.radialBondResults=[]},ur=function(){throw new Error("md2d: Don't change the epsilon or sigma parameters of the LJ calculator being used by MD2D. Use the setElementProperties method instead.")},ar=function(e,t){var n=pt[e],r=pt[t],i=dt[e],s=dt[t],o=wt.get(e,t),u,a;o&&o.epsilon!==undefined?u=o.epsilon:u=c.pairwiseEpsilon(n,r),o&&o.sigma!==undefined?a=o.sigma:a=c.pairwiseSigma(i,s),Zn[e][t]=Zn[t][e]=Yn*a*Yn*a,tr[e][t]=tr[t][e]=er*a*er*a,nr[e][t]=nr[t][e]=c.newLJCalculator({epsilon:u,sigma:a},ur)},fr=function(){
var e=0,t,n,r,i;for(r=0;r<yt;r++)for(i=0;i<=r;i++)bt[r]&&bt[i]&&(t=wt.get(r,i),t&&t.sigma!==undefined?n=t.sigma:n=c.pairwiseSigma(dt[r],dt[i]),er*n>e&&(e=er*n));return e||Math.max(F[0],F[1])},lr=function(){var e=Infinity,t,n,r,i;for(r=0;r<yt;r++)for(i=0;i<=r;i++)bt[r]&&bt[i]&&(t=wt.get(r,i),t&&t.sigma!==undefined?n=t.sigma:n=c.pairwiseSigma(dt[r],dt[i]),(er-Yn)*n<e&&(e=(er-Yn)*n));return e},cr=function(){In===undefined?In=new d(F[0],F[1],fr()):In.reinitialize(fr())},hr=function(){qn===undefined?qn=new v(ct,lr()):qn.reinitialize(ct,lr())},pr=function(){var e,t,n;Lt=[];for(e=0;e<At;e++)t=Et[e],n=St[e],Lt[t]=Lt[t]||[],Lt[t][n]=!0,Lt[n]=Lt[n]||[],Lt[n][t]=!0},dr={atoms:function(){$=lt.radius,J=lt.px,K=lt.py,Q=lt.x,G=lt.y,Y=lt.vx,Z=lt.vy,et=lt.speed,tt=lt.ax,nt=lt.ay,rt=lt.charge,st=lt.friction,it=lt.element,ot=lt.pinned,ut=lt.mass,at=lt.hydrophobicity,ft=lt.visited},radialBonds:function(){Et=Ct.atom1,St=Ct.atom2,xt=Ct.length,Tt=Ct.strength,Nt=Ct.type},restraints:function(){Ot=Pt.atomIndex,Mt=Pt.k,_t=Pt.x0,Dt=Pt.y0},angularBonds:function(){Bt=Rt.atom1,jt=Rt.atom2,Ft=Rt.atom3,It=Rt.angle,qt=Rt.strength},elements:function(){ht=gt.mass,pt=gt.epsilon,dt=gt.sigma,vt=gt.radius,mt=gt.color},obstacles:function(){zt=dn.x,Wt=dn.y,Xt=dn.width,Vt=dn.height,Yt=dn.mass,$t=dn.vx,Jt=dn.vy,Kt=dn.externalAx,Qt=dn.externalAy,Gt=dn.friction,Zt=dn.westProbe,en=dn.northProbe,tn=dn.eastProbe,nn=dn.southProbe,ln=dn.westProbeValue,cn=dn.northProbeValue,hn=dn.eastProbeValue,pn=dn.southProbeValue,an=dn.xPrev,fn=dn.yPrev,rn=dn.colorR,sn=dn.colorG,on=dn.colorB,un=dn.visible},rectangles:function(){mn=kn.x,gn=kn.y,yn=kn.width,bn=kn.height,wn=kn.fence,En=kn.color,Sn=kn.lineColor,xn=kn.lineDashes,Tn=kn.lineWeight,Nn=kn.layer,Cn=kn.visible},springForces:function(){Dn=jn[0],Pn=jn[1],Hn=jn[2],Bn=jn[3]},vdwPairs:function(){Mn=An.atom1,_n=An.atom2}},vr=function(t){gt=e.elements={},gt.mass=r.create(t,0,i.floatType),gt.epsilon=r.create(t,0,i.floatType),gt.sigma=r.create(t,0,i.floatType),gt.radius=r.create(t,0,i.floatType),gt.color=r.create(t,0,i.int32Type),dr.elements()},mr=function(e){lt={},lt.radius=r.create(e,0,i.floatType),lt.px=r.create(e,0,i.floatType),lt.py=r.create(e,0,i.floatType),lt.x=r.create(e,0,i.floatType),lt.y=r.create(e,0,i.floatType),lt.vx=r.create(e,0,i.floatType),lt.vy=r.create(e,0,i.floatType),lt.speed=r.create(e,0,i.floatType),lt.ax=r.create(e,0,i.floatType),lt.ay=r.create(e,0,i.floatType),lt.charge=r.create(e,0,i.floatType),lt.friction=r.create(e,0,i.floatType),lt.element=r.create(e,0,i.uint8Type),lt.pinned=r.create(e,0,i.uint8Type),lt.mass=r.create(e,0,i.floatType),lt.hydrophobicity=r.create(e,0,i.int8Type),lt.visited=r.create(e,0,i.uint8Type),lt.marked=r.create(e,0,i.uint8Type),lt.visible=r.create(e,0,i.uint8Type),lt.draggable=r.create(e,0,i.uint8Type),dr.atoms()},gr=function(t){Ct=e.radialBonds={},Ct.atom1=r.create(t,0,i.uint16Type),Ct.atom2=r.create(t,0,i.uint16Type),Ct.length=r.create(t,0,i.floatType),Ct.strength=r.create(t,0,i.floatType),Ct.type=r.create(t,0,i.uint8Type),dr.radialBonds()},yr=function(t){Pt=e.restraints={},Pt.atomIndex=r.create(t,0,i.uint16Type),Pt.k=r.create(t,0,i.floatType),Pt.x0=r.create(t,0,i.floatType),Pt.y0=r.create(t,0,i.floatType),dr.restraints()},br=function(t){Rt=e.angularBonds={},Rt.atom1=r.create(t,0,i.uint16Type),Rt.atom2=r.create(t,0,i.uint16Type),Rt.atom3=r.create(t,0,i.uint16Type),Rt.angle=r.create(t,0,i.floatType),Rt.strength=r.create(t,0,i.floatType),dr.angularBonds()},wr=function(t){An=e.vdwPairs={},An.count=0,An.atom1=r.create(t,0,i.uint16Type),An.atom2=r.create(t,0,i.uint16Type)},Er=function(t){jn=e.springForces=[],jn[0]=r.create(t,0,i.uint16Type),jn[1]=r.create(t,0,i.floatType),jn[2]=r.create(t,0,i.floatType),jn[3]=r.create(t,0,i.floatType),dr.springForces()},Sr=function(t){dn=e.obstacles={},dn.x=r.create(t,0,i.floatType),dn.y=r.create(t,0,i.floatType),dn.width=r.create(t,0,i.floatType),dn.height=r.create(t,0,i.floatType),dn.mass=r.create(t,0,i.floatType),dn.vx=r.create(t,0,i.floatType),dn.vy=r.create(t,0,i.floatType),dn.externalAx=r.create(t,0,i.floatType),dn.externalAy=r.create(t,0,i.floatType),dn.friction=r.create(t,0,i.floatType),dn.westProbe=r.create(t,0,i.uint8Type),dn.northProbe=r.create(t,0,i.uint8Type),dn.eastProbe=r.create(t,0,i.uint8Type),dn.southProbe=r.create(t,0,i.uint8Type),dn.westProbeValue=r.create(t,0,i.floatType),dn.northProbeValue=r.create(t,0,i.floatType),dn.eastProbeValue=r.create(t,0,i.floatType),dn.southProbeValue=r.create(t,0,i.floatType),dn.xPrev=r.create(t,0,i.floatType),dn.yPrev=r.create(t,0,i.floatType),dn.colorR=r.create(t,0,i.floatType),dn.colorG=r.create(t,0,i.floatType),dn.colorB=r.create(t,0,i.floatType),dn.visible=r.create(t,0,i.uint8Type),dr.obstacles()},xr=function(t){kn=e.rectangles={},kn.x=r.create(t,0,i.floatType),kn.y=r.create(t,0,i.floatType),kn.width=r.create(t,0,i.floatType),kn.height=r.create(t,0,i.floatType),kn.fence=[],kn.color=[],kn.lineColor=[],kn.lineDashes=[],kn.lineWeight=r.create(t,0,i.floatType),kn.layer=r.create(t,0,i.floatType),kn.visible=r.create(t,0,i.uint8Type),dr.rectangles()},Tr,Nr=function(){return y&&rr?1e3:1e3},Cr=function(){H=!0,Tr=f.getWindowedAverager(Nr())},kr=function(){var e=0,t;for(t=0;t<ct;t++)e+=ut[t]*(Y[t]*Y[t]+Z[t]*Z[t]);for(t=0;t<vn;t++)Yt[t]!==Infinity&&(e+=Yt[t]*($t[t]*$t[t]+Jt[t]*Jt[t]));return N(e/2,ct)},Lr=function(e){var t=0,n,r;for(n=0;n<e.length;n++)r=e[n],t+=ut[r]*(Y[r]*Y[r]+Z[r]*Z[r]);return N(t/2,e.length)},Ar=function(e,t,n){Y[e]+=t,Z[e]+=n,J[e]=Y[e]*ut[e],K[e]=Z[e]*ut[e]},Or=function(e,t){Y[e]-=t*(G[e]-zn),Z[e]+=t*(Q[e]-Un),J[e]=Y[e]*ut[e],K[e]=Z[e]*ut[e]},Mr=function(){for(var e=0;e<ct;e++)Ar(e,-Vn,-$n),Or(e,-Qn)},_r=function(){var t=0,n=0,r=0,i=0,s=e.getTotalMass(),o;for(o=0;o<ct;o++)t+=Q[o],n+=G[o],r+=J[o],i+=K[o];Un=t/ct,zn=n/ct,Wn=r,Xn=i,Vn=r/s,$n=i/s},Dr=function(){var e=0,t=0,n,r;for(r=0;r<ct;r++)n=ut[r],e+=n*x(Q[r]-Un,G[r]-zn,Y[r]-Vn,Z[r]-$n),t+=n*T(Q[r]-Un,G[r]-zn);Jn=e,Kn=t,Qn=Jn/Kn},Pr=function(){_r(),Dr()},Hr=function(e){var t=0,n=0,r=F[0],i=F[1],s=r-Xt[e],o=i-Vt[e];if(zt[e]<t){while(zt[e]<t-r)zt[e]+=r;zt[e]=t+(t-zt[e]),$t[e]*=-1}else if(zt[e]>s){while(zt[e]>s+r)zt[e]-=r;zt[e]=s-(zt[e]-s),$t[e]*=-1}if(Wt[e]<n){while(Wt[e]<n-i)Wt[e]+=i;Wt[e]=n+(n-Wt[e]),Jt[e]*=-1}else if(Wt[e]>o){while(Wt[e]>o+r)Wt[e]-=r;Wt[e]=o-(Wt[e]-o),Jt[e]*=-1}},Br=function(e){var t=$[e],n=t,r=t,i=F[0],s=F[1],o=i-t,u=s-t;if(Q[e]<n){while(Q[e]<n-i)Q[e]+=i;Q[e]=n+(n-Q[e]),Y[e]*=-1,J[e]*=-1}else if(Q[e]>o){while(Q[e]>o+i)Q[e]-=i;Q[e]=o-(Q[e]-o),Y[e]*=-1,J[e]*=-1}if(G[e]<r){while(G[e]<r-s)G[e]+=s;G[e]=r+(r-G[e]),Z[e]*=-1,K[e]*=-1}else if(G[e]>u){while(G[e]>u+s)G[e]-=s;G[e]=u-(G[e]-u),Z[e]*=-1,K[e]*=-1}},jr=function(e,t,n,r){if(vn<1)return;var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;i=$[e],s=Q[e],o=G[e];for(u=0;u<vn;u++)a=zt[u]-i,f=zt[u]+Xt[u]+i,l=Wt[u]+Vt[u]+i,c=Wt[u]-i,h=an[u]-i,p=an[u]+Xt[u]+i,d=fn[u]+Vt[u]+i,v=fn[u]-i,x=0,s>a&&s<f&&o>c&&o<l&&(t<=h?(Q[e]=a-(s-a),x=1):t>=p?(Q[e]=f+(f-s),x=2):n<=v?(G[e]=c-(o-c),x=-1):n>=d&&(G[e]=l+(l-o),x=-2)),E=Yt[u],x!==0&&(E!==Infinity?(w=ut[e],S=E+w,x>0?(m=Y[e],y=$t[u],Y[e]=(m*(w-E)+2*E*y)/S,$t[u]=(y*(E-w)+2*J[e])/S):(g=Z[e],b=Jt[u],Z[e]=(g*(w-E)+2*E*b)/S,Jt[u]=(b*(E-w)+2*K[e])/S)):x>0?Y[e]*=-1:Z[e]*=-1,r&&(Zt[u]&&x===1?ln[u]+=ut[e]*((m?m:-Y[e])-Y[e]):tn[u]&&x===2?hn[u]+=ut[e]*(Y[e]-(m?m:-Y[e])):nn[u]&&x===-1?pn[u]+=ut[e]*((g?g:-Z[e])-Z[e]):en[u]&&x===-2&&(cn[u]+=ut[e]*(Z[e]-(g?g:-Z[e])))))},Fr=function(e,t,n){if(Ln<1)return;var r,i,s,o,u,a,f,l,c,h,p,d;r=$[e],i=Q[e],s=G[e];for(o=0;o<Ln;o++){if(!wn[o])continue;c=mn[o]-r,h=mn[o]+yn[o]+r,p=gn[o]+bn[o]+r,d=gn[o]-r,u=mn[o]+r,a=mn[o]+yn[o]-r,f=gn[o]+bn[o]-r,l=gn[o]+r,i>c&&i<h&&s>d&&s<p&&(t<=c?(Q[e]=c-(i-c),Y[e]*=-1):t>=h?(Q[e]=h+(h-i),Y[e]*=-1):n<=d?(G[e]=d-(s-d),Z[e]*=-1):n>=p&&(G[e]=p+(p-s),Z[e]*=-1)),t>u&&t<a&&n>l&&n<f&&(i<=u?(Q[e]=u+(u-i),Y[e]*=-1):i>=a?(Q[e]=a-(i-a),Y[e]*=-1):s<=l?(G[e]=l+(l-s),Z[e]*=-1):s>=f&&(G[e]=f-(s-f),Z[e]*=-1))}},Ir=function(e,t){if(Lt&&Lt[e]&&Lt[e][t])return;var n=it[e],r=it[t],i=Q[t]-Q[e],s=G[t]-G[e],o=i*i+s*s,u,a,f;Rn&&o<tr[n][r]&&qn.markNeighbors(e,t),o<Zn[n][r]&&(u=nr[n][r].forceOverDistanceFromSquaredDistance(o),a=u*i,f=u*s,tt[e]+=a,nt[e]+=f,tt[t]-=a,nt[t]-=f)},qr=function(){if(!M)return;Rn?(s.time("cell lists"),Rr(),s.timeEnd("cell lists")):(s.time("neighbor list"),Ur(),s.timeEnd("neighbor list"))},Rr=function(){var e=In.getRowsNum(),t=In.getColsNum(),n,r,i,s,o,u,a,f,l,c,h,p,d,v;for(n=0;n<e;n++){i=n*t;for(r=0;r<t;r++){s=i+r,o=In.getCell(s),v=In.getNeighboringCells(n,r);for(a=0,c=o.length;a<c;a++){l=o[a];for(f=0;f<a;f++)Ir(l,o[f]);for(p=0,d=v.length;p<d;p++){u=v[p];for(f=0,h=u.length;f<h;f++)Ir(l,u[f])}}}}},Ur=function(){var e=qn.getList(),t,n,r,i;for(t=0;t<ct;t++)for(r=qn.getStartIdxFor(t),i=qn.getEndIdxFor(t);r<i;r++)n=e[r],Ir(t,n)},zr=function(){if(!y||!rr)return;var e,t,n,r,i,s,o,u,a,f,c,h,p;for(e=0,n=ir.length;e<n;e++){c=ir[e],f=rt[c],p=Lt&&Lt[c];for(t=0;t<e;t++){h=ir[t];if(p&&p[h])continue;r=Q[h]-Q[c],i=G[h]-G[c],s=r*r+i*i,o=l.forceOverDistanceFromSquaredDistance(s,f,rt[h],b,w),u=o*r,a=o*i,tt[c]+=u,nt[c]+=a,tt[h]-=u,nt[h]-=a}}},Wr=function(){if(!z)return;var e,t;for(e=0;e<ct;e++)t=z*st[e],tt[e]+=-Y[e]*t,nt[e]+=-Z[e]*t},Xr=function(){if(At<1)return;var e,t,n,r,i,s,a,f,l,c,h,p;for(e=0;e<At;e++)t=Et[e],n=St[e],r=Q[n]-Q[t],i=G[n]-G[t],s=r*r+i*i,a=Math.sqrt(s),f=Tt[e],l=xt[e],c=o.convert(f*(a-l),{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/a,h=c*r,p=c*i,tt[t]+=h,nt[t]+=p,tt[n]-=h,nt[n]-=p},Vr=function(){if(Ut<1)return;var e,t,n,r,i,s,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;for(e=0;e<Ut;e++)t=Bt[e],n=jt[e],r=Ft[e],v=It[e],d=qt[e],i=Q[t]-Q[r],a=Q[n]-Q[r],s=G[t]-G[r],f=G[n]-G[r],l=i*i+s*s,c=a*a+f*f,h=Math.sqrt(l),p=Math.sqrt(c),g=(i*a+s*f)/(h*p),g>1?g=1:g<-1&&(g=-1),y=Math.sqrt(1-g*g),m=Math.acos(g),y<1e-4&&(y=1e-4),x=o.convert(d*(m-v)/(y*h),{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/p,T=i*a+s*f,b=x*(a-T*i/l),w=x*(f-T*s/l),E=x*(i-T*a/c),S=x*(s-T*f/c),tt[t]+=b,nt[t]+=w,tt[n]+=E,nt[n]+=S,tt[r]-=b+E,nt[r]-=w+S},$r=function(){if(Ht<1)return;var e,t,n,r,i,s,a,f,l,c;for(e=0;e<Ht;e++){c=Ot[e],t=_t[e]-Q[c],n=Dt[e]-G[c];if(t===0&&n===0)continue;i=t*t+n*n,r=Math.sqrt(i),s=Mt[e],a=o.convert(s*r,{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/r,f=a*t,l=a*n,tt[c]+=f,nt[c]+=l}},Jr=function(){if(Fn<1)return;var e,t,n,r,i,s,a,f,l,c;for(e=0;e<Fn;e++){c=Dn[e],t=Pn[e]-Q[c],n=Hn[e]-G[c];if(t===0&&n===0)continue;i=t*t+n*n,r=Math.sqrt(i),s=Bn[e],a=o.convert(s*r,{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/r,f=a*t,l=a*n,tt[c]+=f,nt[c]+=l}},Kr=function(e){var t=0,n=0,r=0,i,s,o,u;for(o=0,u=e.length;o<u;o++)i=e[o],s=ut[i],t+=Q[i]*s,n+=G[i]*s,r+=s;return t/=r,n/=r,{x:t,y:n}},Qr=function(){if(E===0||L===0||ct<2)return;var t,n,r,i,s,o,u,a,f,l,c,h,p;for(c=0;c<ct;c++)ft[c]=0;i=6e-5*E*L;for(c=0;c<ct;c++){if(ft[c]===1)continue;t=e.getMoleculeAtoms(c),t.push(c),r=Kr(t);for(h=0,p=t.length;h<p;h++)n=t[h],ft[n]=1,at[n]!==0&&(s=Q[n]-r.x,o=G[n]-r.y,u=Math.sqrt(s*s+o*o),u>0&&(l=at[n]*i,l>0&&u<O&&(l*=(1-A)*u/O+A),a=l*s/u,f=l*o/u,tt[n]-=a,nt[n]-=f))}},Gr=function(){if(!P)return;var e;for(e=0;e<ct;e++)nt[e]-=P},Yr=function(){if(!S)return;var e,t;for(e=0;e<ct;e++)t=Math.min(1,2.2-G[e]),t>0&&(nt[e]+=1e-4*t,tt[e]-=3e-6)},Zr=function(){var e=a.cysteineElement,t,n;sr.length=0;for(n=0;n<ct;n++)it[n]===e&&sr.push(n);for(n=0;n<At;n++)it[Et[n]]===e&&it[St[n]]===e&&(t=sr.indexOf(Et[n]),t!==-1&&r.remove(sr,t),t=sr.indexOf(St[n]),t!==-1&&r.remove(sr,t))},ei=function(){var e,t;if(ct===0)return;for(e=0;e<ct;e++)tt[e]=nt[e]=0;Rn=qn.shouldUpdate(Q,G);if(Rn){In.clear(),qn.clear();for(e=0;e<ct;e++)In.addToCell(e,Q[e],G[e]),qn.saveAtomPosition(e,Q[e],G[e])}s.time("short-range forces"),qr(),s.timeEnd("short-range forces"),s.time("long-range forces"),zr(),s.timeEnd("long-range forces"),Xr(),Vr(),$r(),Jr(),Wr(),Qr();for(e=0;e<ct;e++)t=1/ut[e],tt[e]*=t,nt[e]*=t;Gr(),Yr()},ti=function(){var e,t;for(e=0;e<ct;e++)t=ut[e],Y[e]+=.5*tt[e]*X,J[e]=t*Y[e],Z[e]+=.5*nt[e]*X,K[e]=t*Z[e]},ni=function(){var e=F[0]*100,t=F[1]*100,n,r,i;for(i=0;i<ct;i++){n=Q[i],r=G[i],Q[i]+=Y[i]*X,G[i]+=Z[i]*X;if(isNaN(Q[i])||isNaN(G[i])||Math.abs(Q[i])>e||Math.abs(G[i])>t)throw new Error("Model has diverged!");Br(i),jr(i,n,r,!0),Fr(i,n,r)}},ri=function(){var e;for(e=0;e<ct;e++)ot[e]&&(Y[e]=Z[e]=tt[e]=nt[e]=0)},ii=function(){var e;for(e=0;e<ct;e++)et[e]=Math.sqrt(Y[e]*Y[e]+Z[e]*Z[e])},si=function(){var e,t,n,r,i,s,o,u;for(u=0;u<vn;u++){if(Yt[u]===Infinity)continue;n=$t[u],r=Jt[u],s=Kt[u],o=Qt[u];if(n||r||s||o||P)i=z*Gt[u],e=s-i*n,t=o-i*r-P,an[u]=zt[u],fn[u]=Wt[u],zt[u]+=n*X+.5*e*V,Wt[u]+=r*X+.5*t*V,$t[u]+=e*X,Jt[u]+=t*X,Hr(u)}},oi=function(){var t,n,r,i,s,o,u,a;for(o=0;o<ct;o++)ft[o]=0;for(o=0;o<ct;o++){if(ft[o]===1)continue;t=e.getMoleculeAtoms(o);if(t.length===0)continue;t.push(o),r=i=s=0;for(u=0,a=t.length;u<a;u++)n=t[u],ft[n]=1,ot[n]||(r+=Y[n]*ut[n],i+=Z[n]*ut[n],s+=ut[n]);s=1/s;for(u=0,a=t.length;u<a;u++)n=t[u],ot[n]||(Y[n]-=r*s,Z[n]-=i*s,J[n]=Y[n]*ut[n],K[n]=Z[n]*ut[n])}},ui=function(e,t){var n,r;e==null&&(e=B),Gn=kr();if(Gn===0){for(r=0;r<ct;r++)ot[r]===!1&&(Y[r]=Math.random()*.02-.01,Z[r]=Math.random()*.02-.01);Gn=kr();if(Gn===0)return}H&&Math.abs(Tr(Gn)-e)<=e*j&&(H=!1);if(t||_||H&&Gn>0){n=Math.sqrt(e/Gn);for(r=0;r<ct;r++)Y[r]*=n,Z[r]*=n,J[r]*=n,K[r]*=n;for(r=0;r<vn;r++)$t[r]*=n,Jt[r]*=n;Gn=e}},ai=function(){var t,n,i,s,o,u,a,f;for(u=0,f=sr.length;u<f;u++){t=sr[u];for(a=u+1;a<f;a++)n=sr[a],i=Q[t]-Q[n],s=G[t]-G[n],o=i*i+s*s,o<.07&&(e.addRadialBond({atom1:t,atom2:n,length:Math.sqrt(o),strength:1e4,type:109}),r.remove(sr,u),r.remove(sr,a),f=sr.length,t=sr[u],a=u+1)}},fi=function(){var e;for(e=0;e<vn;e++)en[e]&&(cn[e]=0),nn[e]&&(pn[e]=0),tn[e]&&(hn[e]=0),Zt[e]&&(ln[e]=0)},li=function(e){var t,n;t=13888.89/e;for(n=0;n<vn;n++)en[n]&&(cn[n]*=t/Xt[n]),nn[n]&&(pn[n]*=t/Xt[n]),tn[n]&&(hn[n]*=t/Vt[n]),Zt[n]&&(ln[n]*=t/Vt[n])};return e={addPlugin:function(e){e.initialize&&e.initialize({atoms:lt,elements:gt}),n.registerPlugin(e)},useCoulombInteraction:function(e){y=!!e},useLennardJonesInteraction:function(e){M=!!e},useThermostat:function(e){_=!!e},setVDWLinesRatio:function(e){typeof e=="number"&&e!==0&&(D=e)},setGravitationalField:function(e){typeof e=="number"&&e!==0?P=e:P=!1},setTemperatureOfAtoms:function(t,n){var r,i,s,o,u,a,f,l,c,h=t.length;u=(Lr(t)||n)*1e-4,a=C(u,1);for(r=0;r<h;r++)i=t[r],!ot[i]&&Y[i]===0&&Z[i]===0&&(s=Math.random()-.5,o=Math.random()-.5,l=Math.sqrt(2*a/ut[i]/(s*s+o*o)),Y[i]=s*l,Z[i]=o*l);Gn=kr(),c=Lr(t),f=Math.sqrt(n/c);for(r=0;r<h;r++)i=t[r],e.setAtomProperties(i,{vx:Y[i]*f,vy:Z[i]*f})},getTemperatureOfAtoms:function(e){return Lr(e)},setTargetTemperature:function(e){k(e),B=e},setDielectricConstant:function(e){b=e},setRealisticDielectricEffect:function(e){w=e},setSolventForceType:function(e){E=e},setDNAState:function(e){S=e.indexOf("translation:")===0},setSolventForceFactor:function(e){L=e},setAdditionalSolventForceMult:function(e){A=e},setAdditionalSolventForceThreshold:function(e){O=e},setTime:function(e){W=e},setDimensions:function(e){if(t)throw new Error("The molecular model's size has already been set, and cannot be reset.");I=e[0],q=e[1],R=e[2],U=e[3],F=[R-I,U-q],t=!0},getDimensions:function(){return[I,q,R,U]},getLJCalculator:function(){return nr},setAtomProperties:function(t,n){var r=a.cysteineElement,i,s,o,u,f;if(n.element!==undefined){if(n.element<0||n.element>=yt)throw new Error("md2d: Unknown element "+n.element+", an atom can't be created.");if(it[t]===r&&n.element!==r)for(f=0;f<At;f++)if((Et[f]===t||St[f]===t)&&Nt[f]===109){e.removeRadialBond(f);break}bt[n.element]=!0,n.mass=ht[n.element],n.radius=vt[n.element],a.isAminoAcid(n.element)&&(u=a.getAminoAcidByElement(n.element),n.charge=u.charge,n.hydrophobicity=u.hydrophobicity)}!rt[t]&&n.charge?ir.push(t):rt[t]&&n.charge===0&&(s=ir.indexOf(t),o=ir.slice(s+1),ir.length=s,Array.prototype.push.apply(ir,o)),rr=!!ir.length;for(i in n)n.hasOwnProperty(i)&&(lt[i][t]=n[i]);J[t]=Y[t]*ut[t],K[t]=Z[t]*ut[t],et[t]=Math.sqrt(Y[t]*Y[t]+Z[t]*Z[t])},setRadialBondProperties:function(e,t){var n,r,i;r=Et[e],i=St[e],Lt[r]&&Lt[r][i]&&(Lt[r][i]=!1),Lt[i]&&Lt[i][r]&&(Lt[i][r]=!1);for(n in t)t.hasOwnProperty(n)&&(Ct[n][e]=t[n],kt[e][n]=t[n]);r=Et[e],i=St[e],Lt[r]||(Lt[r]=[]),Lt[r][i]=!0,Lt[i]||(Lt[i]=[]),Lt[i][r]=!0},setAngularBondProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(Rt[n][e]=t[n])},setRestraintProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(Pt[n][e]=t[n])},setElementProperties:function(e,t){var n,r;if(t.mass!=null&&t.mass!==ht[e]){ht[e]=t.mass;for(n=0;n<ct;n++)it[n]===e&&(ut[n]=t.mass)}if(t.sigma!=null){dt[e]=t.sigma,r=c.radius(t.sigma);if(vt[e]!==r){vt[e]=r;for(n=0;n<ct;n++)it[n]===e&&($[n]=r)}}t.epsilon!=null&&(pt[e]=t.epsilon),t.color!=null&&(mt[e]=t.color);for(n=0;n<yt;n++)ar(e,n);cr(),hr()},setPairwiseLJProperties:function(e,t){ar(e,t),cr(),hr()},setObstacleProperties:function(t,n){var r;if(!e.canPlaceObstacle(n.x,n.y,n.width,n.height,t))throw new Error("Obstacle can't be placed at "+n.x+", "+n.y);n.x!==undefined&&(n.xPrev=n.x),n.y!==undefined&&(n.yPrev=n.y),typeof n.mass=="string"&&(n.mass=parseFloat(n.mass));for(r in n)n.hasOwnProperty(r)&&(dn[r][t]=n[r])},setRectangleProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(kn[n][e]=t[n])},addAtom:function(t){ct+1>lt.x.length&&(g.extendArrays(lt,ct+10),dr.atoms()),t.ax=t.ay=0,ct++,e.setAtomProperties(ct-1,t),cr(),hr()},removeAtom:function(t){var n,i,s,o,u,a;if(t>=ct)throw new Error("Atom "+t+" doesn't exist, so it can't be removed.");n=0;while(n<At)Et[n]===t||St[n]===t?e.removeRadialBond(n):n++;n=ir.indexOf(t),n!==-1&&r.remove(ir,n);for(n=t;n<ct;n++)for(s in lt)lt.hasOwnProperty(s)&&(n===ct-1?lt[s][n]=0:lt[s][n]=lt[s][n+1]);ct--,a=[ir,Et,St,Bt,jt,Ft];for(o=0;o<a.length;o++){u=a[o];for(n=0,i=u.length;n<i;n++)u[n]>t&&u[n]--}for(n=0,i=kt.length;n<i;n++)kt[n].atom1>t&&kt[n].atom1--,kt[n].atom2>t&&kt[n].atom2--;pr(),cr(),hr(),qn.invalidate(),ei()},addElement:function(e){var t;yt>=pt.length&&(g.extendArrays(gt,yt+10),dr.elements()),ht[yt]=e.mass,pt[yt]=e.epsilon,dt[yt]=e.sigma,vt[yt]=c.radius(e.sigma),mt[yt]=e.color,nr[yt]=[],Zn[yt]=[],tr[yt]=[];for(t=0;t<=yt;t++)ar(yt,t);yt++},addRadialBond:function(t){At+1>Et.length&&(g.extendArrays(Ct,At+10),dr.radialBonds()),At++,kt[At-1]={idx:At-1},e.setRadialBondProperties(At-1,t)},removeRadialBond:function(t){var n,i,s,o;if(t>=At)throw new Error("Radial bond "+t+" doesn't exist, so it can't be removed.");s=Et[t],o=St[t],n=0;while(n<Ut)Ft[n]===s||Ft[n]===o?e.removeAngularBond(n):n++;for(n=t;n<At;n++)for(i in Ct)Ct.hasOwnProperty(i)&&(n===At-1?Ct[i][n]=0:Ct[i][n]=Ct[i][n+1]);At--,r.remove(kt,t),pr()},addRestraint:function(t){Ht+1>Pt.atomIndex.length&&(g.extendArrays(Pt,Ht+10),dr.restraints()),Ht++,e.setRestraintProperties(Ht-1,t)},addAngularBond:function(t){Ut+1>Rt.atom1.length&&(g.extendArrays(Rt,Ut+10),dr.angularBonds()),Ut++,e.setAngularBondProperties(Ut-1,t)},removeAngularBond:function(e){var t,n;if(e>=Ut)throw new Error("Angular bond "+e+" doesn't exist, so it can't be removed.");for(t=e;t<Ut;t++)for(n in Rt)Rt.hasOwnProperty(n)&&(t===Ut-1?Rt[n][t]=0:Rt[n][t]=Rt[n][t+1]);Ut--},addSpringForce:function(e,t,n,r){return Fn+1>jn[0].length&&(g.extendArrays(jn,Fn+1),dr.springForces()),Dn[Fn]=e,Pn[Fn]=t,Hn[Fn]=n,Bn[Fn]=r,Fn++},updateSpringForce:function(e,t,n){Pn[e]=t,Hn[e]=n},removeSpringForce:function(e){var t,n;if(e>=Fn)throw new Error("Spring force "+e+" doesn't exist, so it can't be removed.");Fn--;for(t=e;t<Fn;t++)for(n=0;n<4;n++)jn[n][t]=jn[n][t+1]},springForceAtomIndex:function(e){return Dn[e]},addObstacle:function(t){if(!e.canPlaceObstacle(t.x,t.y,t.width,t.height))throw new Error("Obstacle can't be placed at "+t.x+", "+t.y+".");vn+1>dn.x.length&&(g.extendArrays(dn,vn+1),dr.obstacles()),vn++,e.setObstacleProperties(vn-1,t)},removeObstacle:function(e){var t,n;if(e>=vn)throw new Error("Obstacle "+e+" doesn't exist, so it can't be removed.");vn--;for(t=e;t<vn;t++)for(n in dn)dn.hasOwnProperty(n)&&(dn[n][t]=dn[n][t+1]);g.extendArrays(dn,vn),dr.obstacles()},addRectangle:function(t){Ln+1>kn.x.length&&(g.extendArrays(kn,Ln+1),dr.rectangles()),Ln++,e.setRectangleProperties(Ln-1,t)},removeRectangle:function(e){var t,n;if(e>=Ln)throw new Error("Rectangle "+e+" doesn't exist, so it can't be removed.");Ln--;for(t=e;t<Ln;t++)for(n in kn)kn.hasOwnProperty(n)&&(kn[n][t]=kn[n][t+1]);g.extendArrays(kn,Ln),dr.rectangles()},atomInBounds:function(e,t,n){var r=$[n],i;if(e<r||e>F[0]-r||t<r||t>F[1]-r)return!1;for(i=0;i<vn;i++)if(e>zt[i]-r&&e<zt[i]+Xt[i]+r&&t>Wt[i]-r&&t<Wt[i]+Vt[i]+r)return!1;return!0},canPlaceAtom:function(t,n,r,i){var s,o,u,a;if(!e.atomInBounds(n,r,i))return!1;for(a=0;a<vn;a++){testX=zt[a],testY=Wt[a],testXMax=testX+Xt[a],testYMax=testY+Vt[a];if(n>testX&&n<testXMax&&r>testY&&r<testYMax)return!1}return typeof i=="number"&&(s=Q[i],o=G[i],Q[i]=G[i]=Infinity),u=e.newPotentialCalculator(t,0,!1)(n,r),typeof i=="number"&&(Q[i]=s,G[i]=o),u<=0},canPlaceObstacle:function(e,t,n,r,i){var s=e+n,o=t+r,u,a,f,l,c,h;if(e<0||s>F[0]||t<0||o>F[0])return!1;for(h=0;h<ct;h++){c=$[h];if(Q[h]>e-c&&Q[h]<s+c&&G[h]>t-c&&G[h]<o+c)return!1}for(h=0;h<vn;h++){if(i!==undefined&&i===h)continue;u=zt[h],a=Wt[h],f=u+Xt[h],l=a+Vt[h];if(s>u&&e<f&&o>a&&t<l)return!1}return!0},setupAtomsRandomly:function(t){var n=t.temperature||100,r=Math.floor(Math.sqrt(ct)),i=Math.ceil(ct/r),s,o,u,a,l,c,h,p;k(n),l=F[0]/(1+i),a=F[1]/(1+r),s=-1;for(o=1;o<=r;o++)for(u=1;u<=i;u++){s++;if(s===ct)break;c=f.normal(1,.25),h=2*Math.random()*Math.PI,p={element:Math.floor(Math.random()*t.userElements),x:u*l,y:o*a,vx:c*Math.cos(h),vy:c*Math.sin(h),charge:2*(s%2)-1},e.setAtomProperties(s,p)}Pr(),Mr(),ui(n,!0)},getVdwPairsArray:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v=D*D;On=0;for(e=0;e<ct;e++){c=it[e],u=dt[c],a=dt[c],s=Q[e],o=G[e];for(t=e+1;t<ct;t++){if(At!==0&&Lt[e]&&Lt[e][t])continue;h=it[t],f=dt[h],l=dt[h],rt[e]*rt[t]<=0&&(n=Q[t]-s,r=G[t]-o,i=n*n+r*r,p=.5*(u+f),p*=p,d=a*l,i<p*v&&d>0&&(On+1>An.atom1.length&&(g.extendArrays(An,(On+1)*2),dr.vdwPairs()),Mn[On]=e,_n[On]=t,On++))}}return An.count=On,An},relaxToTemperature:function(t){t!=null&&(B=t),k(B),Cr();while(H)e.integrate()},integrate:function(e,t){var r,i,s=W;e===undefined&&(e=100),t===undefined&&(t=1),X=t,V=X*X,Zr(),W===0&&ei(),r=Math.floor(e/X),fi();for(i=1;i<=r;i++)W=s+i*X,ti(),ni(),ei(),ri(),ti(),ii(),si(),ui(),E!==0&&!S&&oi(),n.callPluginFunction("performActionWithinIntegrationLoop",[qn,X]);li(e),ai()},minimizeEnergy:function(){var e=.001,t=1e-4,n=3e3,r,i,s,o,u,a;ei(),ri(),r=0;for(u=0;u<ct;u++)r<Math.abs(tt[u])&&(r=Math.abs(tt[u])),r<Math.abs(nt[u])&&(r=Math.abs(nt[u]));a=0;while(r>t&&a<n){a++,i=e/r;for(u=0;u<ct;u++)s=Q[u],o=G[u],Q[u]+=tt[u]*i,G[u]+=nt[u]*i,Br(u),jr(u,s,o,!1),Fr(u,s,o);ei(),ri(),r=0;for(u=0;u<ct;u++)r<Math.abs(tt[u])&&(r=Math.abs(tt[u])),r<Math.abs(nt[u])&&(r=Math.abs(nt[u]))}},getRadialBondsForAtom:function(e){var t=[],n,r,i;for(n=0;n<At;n++)r=Et[n],i=St[n],(e==r||e==i)&&t.push(n);return t},getAngularBondsForAtom:function(e){var t=[],n,r,i,s;for(n=0;n<Ut;n++)r=Bt[n],i=jt[n],s=Ft[n],(e==r||e==i||e==s)&&t.push(n);return t},getTotalMass:function(){var e=0,t;for(t=0;t<ct;t++)e+=ut[t];return e},getRadiusOfElement:function(e){return vt[e]},getNumberOfAtoms:function(){return ct},getNumberOfElements:function(){return yt},getNumberOfObstacles:function(){return vn},getNumberOfRectangles:function(){return Ln},getNumberOfRadialBonds:function(){return At},getNumberOfAngularBonds:function(){return Ut},getNumberOfRestraints:function(){return Ht},getNumberOfSpringForces:function(){return Fn},computeOutputState:function(e){var t,n,r,i,s,a,f,c,h,p,d,v,m,g,E,S,x,T,C,k,L,A,O,_;_=0,O=0;for(t=0;t<ct;t++){P&&(A=ut[t]*P*G[t],_+=o.convert(A,{from:u.MW_ENERGY_UNIT,to:u.EV})),O+=.5*ut[t]*(Y[t]*Y[t]+Z[t]*Z[t]);for(n=t+1;n<ct;n++)c=Q[n]-Q[t],h=G[n]-G[t],S=c*c+h*h,M&&(_-=nr[it[t]][it[n]].potentialFromSquaredDistance(S)),y&&rr&&(_+=l.potential(Math.sqrt(S),rt[t],rt[n],b,w))}for(t=0;t<At;t++)r=Et[t],i=St[t],a=it[r],f=it[i],c=Q[i]-Q[r],h=G[i]-G[r],S=c*c+h*h,C=Tt[t],k=Math.sqrt(S)-xt[t],_+=.5*C*k*k,M&&(_+=nr[a][f].potentialFromSquaredDistance(S)),y&&rt[r]&&rt[i]&&(_-=l.potential(Math.sqrt(S),rt[r],rt[i],b,w)),kt[t].x1=Q[r],kt[t].y1=G[r],kt[t].x2=Q[i],kt[t].y2=G[i];for(t=0;t<Ut;t++)r=Bt[t],i=jt[t],s=Ft[t],p=Q[r]-Q[s],v=Q[i]-Q[s],d=G[r]-G[s],m=G[i]-G[s],x=Math.sqrt(p*p+d*d),T=Math.sqrt(v*v+m*m),g=(p*v+d*m)/(x*T),g>1?g=1:g<-1&&(g=-1),E=Math.acos(g),L=E-It[t],_+=.5*qt[t]*L*L;for(t=0;t<Ht;t++)r=Ot[t],a=it[r],c=_t[t]-Q[r],h=Dt[t]-G[r],S=c*c+h*h,C=Mt[t],k=Math.sqrt(S),_+=.5*C*k*k;for(t=0;t<vn;t++)Yt[t]!==Infinity&&(P&&(A=Yt[t]*P*Wt[t],_+=o.convert(A,{from:u.MW_ENERGY_UNIT,to:u.EV})),O+=.5*Yt[t]*($t[t]*$t[t]+Jt[t]*Jt[t]));Gn=N(O,ct),e.time=W,e.PE=_,e.KE=o.convert(O,{from:u.MW_ENERGY_UNIT,to:u.EV}),e.temperature=Gn,e.pCM=[Wn,Xn],e.CM=[Un,zn],e.vCM=[Vn,$n],e.omega_CM=Qn,e.atoms=lt},newPotentialCalculator:function(e,t,n){return function(r,i){var s=0,a=0,f=0,c,h,p=nr[e],d,v,m,g,E,S,x;for(d=0;d<ct;d++)v=r-Q[d],m=i-G[d],g=v*v+m*m,S=0,M&&(x=p[it[d]],s+=-x.potentialFromSquaredDistance(g,e,it[d]),n&&(S+=x.forceOverDistanceFromSquaredDistance(g))),y&&rr&&t&&(E=Math.sqrt(g),s+=-l.potential(E,t,rt[d],b,w),n&&(S+=l.forceOverDistanceFromSquaredDistance(g,t,rt[d],b,w))),S&&(a+=S*v,f+=S*m);return n?(c=o.convert(a,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),h=o.convert(f,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),[s,[c,h]]):s}},findMinimumPELocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=vt[t],u=f.minimize(s,[n,r],{bounds:[[o,F[0]-o],[o,F[1]-o]]});return u.error?!1:u[1]},findMinimumPESquaredLocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=function(e,t){var n,r,i;return n=s(e,t),r=n[0],i=n[1],i[0]*=2*r,i[1]*=2*r,[r*r,i]},u=vt[t],a=f.minimize(o,[n,r],{bounds:[[u,F[0]-u],[u,F[1]-u]],stopval:1e-4,precision:1e-6});return a.error?!1:a[1]},atomsInMolecule:[],depth:0,getMoleculeAtoms:function(e){this.atomsInMolecule.push(e);var t=[],n=this.getBondedAtoms(e),r=this.depth,i,s,o;this.depth++;for(i=0,s=n.length;i<s;i++)o=n[i],~this.atomsInMolecule.indexOf(o)||(t=t.concat(this.getMoleculeAtoms(o)));return r===0?(this.depth=0,this.atomsInMolecule=[]):t.push(e),t},getBondedAtoms:function(e){var t=[],n,r;if(Ct)for(n=0,r=At;n<r;n++)Et[n]===e&&t.push(St[n]),St[n]===e&&t.push(Et[n]);return t},getAtomKineticEnergy:function(e){var t=.5*ut[e]*(Y[e]*Y[e]+Z[e]*Z[e]);return o.convert(t,{from:u.MW_ENERGY_UNIT,to:u.EV})},getAtomNeighbors:function(e){var t=[],n=qn.getList(),r,i;for(r=qn.getStartIdxFor(e),i=qn.getEndIdxFor(e);r<i;r++)t.push(n[r]);return t},getNeighborList:function(){return qn},setViscosity:function(e){z=e},getState:function(){var e=[new p(gt),new p(lt),new p(dn),new p(kn),new p(Ct),new p(Rt),new p(Pt),new p(jn),wt,{clone:function(){return{time:W,N:ct,N_elements:yt,N_obstacles:vn,N_rectangles:Ln,N_radialBonds:At,N_angularBonds:Ut,N_restraints:Ht,N_springForces:Fn}},restore:function(e){W=e.time,ct=e.N,yt=e.N_elements,Ln=e.N_rectangles,At=e.N_radialBonds,Ut=e.N_angularBonds,Ht=e.N_restraints,Fn=e.N_springForces}}];return n.callPluginFunction("getState",[],function(t){e=e.concat(t)}),e},callPluginAccessor:function(e){var t;return n.callPluginFunction(e,[],function(e){t=e}),t}},or(),e.pairwiseLJProperties=wt,e}}),define("common/property-support",[],function(){function t(e,t,n){if(typeof n!==e)throw new TypeError(t+" must be a "+e+".")}function n(e){var t=[];return e.forEach(function(e){t.push(e)}),t}var e={get:{defaultValue:undefined,type:"function"},set:{defaultValue:undefined,type:"function"},validate:{defaultValue:undefined,type:"function"},beforeSetCallback:{defaultValue:undefined,type:"function"},afterSetCallback:{defaultValue:undefined,type:"function"},afterGetTransform:{defaultValue:undefined,type:"function"},beforeSetTransform:{defaultValue:undefined,type:"function"},writable:{defaultValue:!0,type:"boolean"},includeInHistoryState:{defaultValue:!1,type:"boolean"},invokeSetterAfterBulkRestore:{defaultValue:!0,type:"boolean"},type:{defaultValue:undefined,type:"propertyType"},description:{defaultValue:undefined}};return function(i){function g(){return d.filter(function(e){return o[e].observers.length>0})}function y(e){if(s.indexOf(e)<0)throw new TypeError(e+" is not a recognized property type.")}function b(n){var r={};return Object.keys(e).forEach(function(i){var s=e[i];if(n[i]!==undefined){r[i]=n[i];switch(s.type){case"boolean":r[i]=!!r[i];break;case"function":t("function",i,n[i]);break;case"string":t("string",i,n[i]);break;case"propertyType":y(n[i])}}else r[i]=s.defaultValue}),r}function w(e){var t=[];e.forEach(function(e){t.indexOf(e)<0&&(e(),t.push(e))})}function E(e){var t=[];f=!0,e(),f=!1,p.forEach(function(e){o[e].observers.forEach(function(e){t.push(e)})}),p=[],w(t)}function S(e){f?p.push(e):w(o[e].observers)}function x(e){var t=o[e];return t.descriptor.get?a?(t.hasCachedValue||(t.hasCachedValue=!0,t.cachedValue=t.descriptor.get()),t.cachedValue):t.descriptor.get():t.cachedValue}function T(e,t){var n=o[e];if(!n.descriptor.writable)throw new Error("Attempt to set read-only property "+e);n.descriptor.get&&!a?n.hasCachedValue=!1:(n.hasCachedValue=!0,n.cachedValue=t)}function N(e){u.all=undefined,e&&(u.byType[e]=undefined)}function C(e,t){var n=o[t];Object.defineProperty(e,t,{enumerable:!0,configurable:!1,get:function(){var e=x(t);return n.descriptor.afterGetTransform&&(e=n.descriptor.afterGetTransform(e)),e},set:function(e){n.descriptor.beforeSetCallback&&n.descriptor.beforeSetCallback(),n.descriptor.beforeSetTransform&&(e=n.descriptor.beforeSetTransform(e)),n.descriptor.validate&&(e=n.descriptor.validate(e)),T(t,e),n.descriptor.set&&n.descriptor.set(e),n.descriptor.afterSetCallback&&n.descriptor.afterSetCallback(),S(t)}})}function k(e){var t=e?u.byType[e]:u.all;return t||(t={},Object.keys(o).forEach(function(n){(!e||e===o[n].descriptor.type)&&C(t,n)}),Object.seal&&Object.seal(t),e?u.byType[e]=t:u.all=t),t}var s=i&&i.types&&n(i.types)||[],o={},u={all:undefined,byType:{}},a=!0,f=!1,l=d3.dispatch("beforeInvalidatingChange","afterInvalidatingChange","afterInvalidatingChangeSequence"),c=0,h=!1,p=[],d=[],v=[],m;return m={mixInto:function(e){Object.defineProperty(e,"properties",{configurable:!1,enumerable:!0,get:function(){return k()}}),e.propertiesOfType=function(e){return k(e)},e.set=function(t,n){var r;typeof t=="string"?e.properties[t]=n:(r=t,E(function(){Object.keys(r).forEach(function(t){e.properties[t]=r[t]})}))},e.get=function(t){return e.properties[t]},e.addObserver=function(e,t){if(!o[e])return;var n=o[e].observers;n.indexOf(t)<0&&n.push(t)},e.removeObserver=function(e,t){var n=o[e].observers,r=n.indexOf(t);r>0&&n.splice(r,1)},e.getPropertyDescription=function(e){return o[e].descriptor.description},e.getPropertyType=function(e){return o[e].descriptor.type},e.getPropertyValidateFunc=function(e){return o[e].descriptor.validate},e.makeInvalidatingChange=function(e){m.invalidatingChangePreHook(),e(),m.invalidatingChangePostHook()},e.addPropertiesListener=function(t,n){typeof t=="string"?e.addObserver(t,n):t.forEach(function(t){e.addObserver(t,n)})}},defineProperty:function(e,t){t=b(t||{}),o[e]={descriptor:t,observers:[],hasCachedValue:!1,cachedValue:undefined,previousValue:undefined},t.get&&d.push(e),t.includeInHistoryState&&v.push(e),N(t.type)},deleteComputedPropertyCachedValues:function(){d.forEach(function(e){o[e].hasCachedValue=!1,o[e].cachedValue=undefined})},storeComputedProperties:function(){g().forEach(function(e){o[e].previousValue=x(e)})},notifyChangedComputedProperties:function(){E(function(){g().forEach(function(e){x(e)!==o[e].previousValue&&S(e),o[e].previousValue=undefined})})},notifyAllComputedProperties:function(){E(function(){g().forEach(function(e){S(e)})})},get properties(){return k()},propertiesOfType:function(e){return k(e)},get enableCaching(){return a},set enableCaching(e){a=!!e},get historyStateRawValues(){var e={};return v.forEach(function(t){e[t]=x(t)}),e},get rawValues(){var e={};return Object.keys(o).forEach(function(t){e[t]=x(t)}),e},setRawValues:function(e){E(function(){Object.keys(e).forEach(function(t){var n=o[t];if(!n)return;x(t)!==e[t]&&S(t),T(t,e[t]),n.descriptor.invokeSetterAfterBulkRestore&&n.descriptor.set&&n.descriptor.set(x(t))})})},invalidatingChangePreHook:function(){if(h)return;c===0&&(m.storeComputedProperties(),m.deleteComputedPropertyCachedValues(),m.enableCaching=!1),c++,l.beforeInvalidatingChange()},invalidatingChangePostHook:function(){if(h)return;c--,l.afterInvalidatingChange(),c===0&&(m.enableCaching=!0,m.notifyChangedComputedProperties(),l.afterInvalidatingChangeSequence())},startBatch:function(){m.invalidatingChangePreHook(),h=!0},endBatch:function(){h=!1,m.invalidatingChangePostHook()},on:function(e,t){l.on(e,t)}},m}}),define("common/property-description",["require","underscore"],function(e){function n(e){return e===""}function r(e,t){var n;this._descriptionHash=t,this._label=t.label||"",this._unitName="",this._unitPluralName="",this._unitAbbreviation="";if(t.unitType){if(!(n=e.units[t.unitType]))throw new Error("PropertyDescription: couldn't find unitType "+
t.unitType+" in the supplied units definition.");this._unitType=t.unitType,this._unitName=n.name,this._unitPluralName=n.pluralName,this._unitAbbreviation=n.symbol}t.unitName&&(this._unitName=t.unitName),t.unitPluralName&&(this._unitPluralName=t.unitPluralName),t.unitAbbreviation&&(this._unitAbbreviation=t.unitAbbreviation),this.setFormat(t.format)}var t=e("underscore");return r.prototype.getHash=function(){return t.extend(t.reject({unitName:this.getUnitName(),unitPluralName:this.getUnitPluralName(),unitAbbreviation:this.getUnitAbbreviation()},n),this._descriptionHash)},r.prototype.getLabel=function(){return this._label},r.prototype.getUnitType=function(){return this._unitType},r.prototype.getUnitName=function(){return this._unitName},r.prototype.getUnitPluralName=function(){return this._unitPluralName},r.prototype.getUnitAbbreviation=function(){return this._unitAbbreviation},r.prototype.setFormat=function(e){e?this._formatter=d3.format(e):this._formatter=function(e){return e}},r.prototype.format=function(e,t){t=t||{};var n,r,i,s=!0;return t.format?t.format===this._lastFormat?n=this._lastFormatter:(n=d3.format(t.format),this._lastFormat=t.format,this._lastFormatter=n):n=this._formatter,r=n(e),t&&t.abbreviated!=null&&(s=t.abbreviated),s?r+" "+this._unitAbbreviation:(i=parseFloat(r)!==1,r+" "+(i?this._unitPluralName:this._unitName))},r}),define("common/parameter-support",["require","common/property-description"],function(e){var t=e("common/property-description");return function(n){var r=n.propertySupport,i=n.unitsDefinition||{};return{mixInto:function(e){e.defineParameter=function(n,s,o){var u={type:"parameter",includeInHistoryState:!0,invokeSetterAfterBulkRestore:!1,description:new t(i,s),beforeSetCallback:r.invalidatingChangePreHook,afterSetCallback:r.invalidatingChangePostHook};o&&(u.set=function(t){o.call(e,t)}),r.defineProperty(n,u)}}}}}),function(){define("cs!common/running-average-filter",["require"],function(e){var t;return t=function(){function e(e){this.periodLength=e,this._value=[],this._time=[],this._idx=-1,this._maxBufferLength=this.periodLength}return e.prototype.addSample=function(e,t){var n;if(this._time[this._idx]===e){this._value[this._idx]=t;return}if(this._time[this._idx]>e)throw new Error("RunningAverageFilter: cannot add sample with @_time less than previous sample.");this._idx++,this._value.push(t),this._time.push(e),n=[];while(this._value.length>this._maxBufferLength)this._time.shift(),this._value.shift(),n.push(this._idx--);return n},e.prototype.calculate=function(){var e,t,n,r,i,s;t=Math.max(this._time[this._idx]-this.periodLength,0),s=0,i=0,e=this._idx;while(e>0&&this._time[e-1]>=t)r=this._time[e]-this._time[e-1],i+=r,s+=r*(this._value[e-1]+this._value[e])/2,e--;return e>0&&this._time[e]>t&&this._time[e-1]<t&&(r=this._time[e]-t,i+=r,n=this._value[e-1]+(this._value[e]-this._value[e-1])*(t-this._time[e-1])/(this._time[e]-this._time[e-1]),s+=r*(this._value[e]+n)/2),i?s/i:this._value[0]||0},e.prototype.getCurrentBufferLength=function(){return this._value.length},e.prototype.setMaxBufferLength=function(e){return this._maxBufferLength=e},e.prototype.getCurrentTime=function(){return this._time[this._idx]},e.prototype.getCurrentStep=function(){return this._idx},e.prototype.setCurrentStep=function(e){if(e<-1||e>=this._value.length)throw new Error("RunningAverageFilter: cannot seek, location outside available range.");return this._idx=e},e.prototype.invalidate=function(e){return this._value.length=e+1,this._time.length=e+1,this._idx=e},e}()})}.call(this),define("common/output-support",["require","common/property-description","cs!common/running-average-filter"],function(e){var t=e("common/property-description"),n=e("cs!common/running-average-filter");return function(r){function a(){u.forEach(function(e){e.addSample()})}var i=r.propertySupport,s=r.unitsDefinition||{},o=r.tickHistory||null,u=[];return i.on("afterInvalidatingChange.output-support",a),{mixInto:function(e){e.defineOutput=function(e,n,r){i.defineProperty(e,{type:"output",writable:!1,get:r,includeInHistoryState:!1,description:new t(s,n)})},e.defineFilteredOutput=function(t,r,i,s,a){var f,l;if(s!=="RunningAverage")throw new Error("FilteredOutput: unknown filter type "+s+".");f=new n(a),l=e.properties[i];if(l===undefined||isNaN(Number(l)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");f.addSample(e.properties.time,l),o?o.registerExternalObject({push:function(){f.addSample(e.properties.time,e.properties[i])},extract:function(e){f.setCurrentStep(e)},invalidate:function(e){f.invalidate(e)},setHistoryLength:function(e){f.setMaxBufferLength(e)}}):u.push({addSample:function(){f.addSample(e.properties.time,e.properties[i])}}),r.property=i,r.type=s,r.period=a,e.defineOutput(t,r,function(){return f.calculate()})},e.updateAllOutputProperties=function(){i.deleteComputedPropertyCachedValues(),i.notifyAllComputedProperties(),a()}}}}}),define("common/dispatch-support",[],function(){function e(e){return[].slice.call(e)}return function(){function u(e){var t,s;i=e,r=d3.dispatch.apply(null,i);for(t=0,s=i.length;t<s;t++)n[i[t]]=a(i[t])}function a(e){return function(){s?o.add(e):r[e].apply(r,arguments)}}function f(e){return function(){r[e].apply(r,arguments)}}var n,r,i,s=!1,o=d3.set();return n={on:f("on"),mixInto:function(e){e.on=n.on,e.suppressEvents=n.suppressEvents},addEventTypes:function(){arguments.length&&u(i.concat(e(arguments)))},startBatch:function(){s=!0},endBatch:function(){s=!1,n.flush()},flush:function(){o.forEach(function(e){r[e]()}),o=d3.set()},suppressEvents:function(e){s=!0,e(),s=!1,o=d3.set()}},u(e(arguments)),n}}),define("common/playback-support",["require","common/console"],function(e){var t=e("common/console");return function(n){function f(e){var t,n=i&&i.modelSampleRate||"default";n==="default"?d3.timer(e):t=window.setInterval(function(){e()&&window.clearInterval(t)},1e3/n)}var r=n&&n.dispatch||null,i=n&&n.properties||null,s=function(){if(r){if(r.on&&r.addEventTypes)return r.addEventTypes("play","stop"),!0;throw new Error("[PlaybackSupport] Provided Dispatch object doesn't implement required interface!")}return!1}(),o=!0,u=!1,a=!1;return{mixInto:function(e){typeof e.tick!="function"&&(e.tick=function(){t.warn("[PlaybackSupport] .tick() method should be overwritten by target!")}),e.start=function(){return u=!1,a=!1,o?(o=!1,f(function(r){return t.timeEnd("gap between frames"),u?(o=!0,!0):a?(setTimeout(e.start,0),o=!0,!0):(e.tick(r),t.time("gap between frames"),!1)}),s&&r.play(),t.time("gap between frames"),e):e},e.restart=function(){return a=!0,e},e.stop=function(){return u=!0,s&&r.stop(),e},e.isStopped=function(){return o||u}}}}}),define("common/define-builtin-properties",["require","common/validator","common/property-description"],function(e){var t=e("common/validator"),n=e("common/property-description");return function(r){function l(e,r,a){var f,l,c,h;if(r==="mainProperty")f=s.mainProperties;else{if(r!=="viewOption")throw new Error(r+" is not a supported built-in property type");f=s.viewOptions}c=t.propertyChangeInvalidates(f[e]),l={type:r,writable:t.propertyIsWritable(f[e]),set:a,includeInHistoryState:!!f[e].storeInTickHistory,validate:function(n){return t.validateSingleProperty(f[e],e,n,!1)},beforeSetCallback:c?i.invalidatingChangePreHook:undefined,afterSetCallback:c?i.invalidatingChangePostHook:undefined},h=f[e].unitType,h&&(l.description=new n(o,{unitType:h}),u&&(l.beforeSetTransform=function(e){return u.translateToModelUnits(e,h)},l.afterGetTransform=function(e){return u.translateFromModelUnits(e,h)})),i.defineProperty(e,l)}var i=r.propertySupport,s=r.metadata,o=r.unitsDefinition||{},u=r.unitsTranslation||null,a=r.setters||{},f=r.initialProperties||null;(function(){var e,n;Object.keys(s.mainProperties).forEach(function(e){l(e,"mainProperty",a[e])}),Object.keys(s.viewOptions).forEach(function(e){l(e,"viewOption",a[e])}),f&&(e=t.validateCompleteness(s.mainProperties,f),i.setRawValues(e),n=t.validateCompleteness(s.viewOptions,f.viewOptions||{}),i.setRawValues(n))})()}}),define("common/lab-modeler-mixin",["require","common/property-support","common/parameter-support","common/output-support","common/dispatch-support","common/playback-support","common/define-builtin-properties"],function(e){var t=e("common/property-support"),n=e("common/parameter-support"),r=e("common/output-support"),i=e("common/dispatch-support"),s=e("common/playback-support"),o=e("common/define-builtin-properties");return function(u){var a,f=u.metadata,l=u.setters,c=u.unitsDefinition,h=u.unitsTranslation,p=u.initialProperties,d=u.tickHistory,v=new t({types:["output","parameter","mainProperty","viewOption"]}),m=new n({propertySupport:v,unitsDefinition:c}),g=new r({propertySupport:v,unitsDefinition:c,tickHistory:d}),y=new i,b=new s({dispatch:y,properties:v.properties});return y.addEventTypes("reset","stepForward","stepBack","seek","invalidation"),a={mixInto:function(e){v.mixInto(e),m.mixInto(e),g.mixInto(e),y.mixInto(e),b.mixInto(e),f&&o({propertySupport:v,metadata:f,unitsDefinition:c,unitsTranslation:h,setters:l,initialProperties:p})},get propertySupport(){return v},get parameterSupport(){return m},get outputSupport(){return g},get dispatchSupport(){return y},get playbackSupport(){return b}},a}}),define("common/models/tick-history",[],function(){return function(t,n,r){function c(){return{input:{},state:[],parameters:{}}}function h(){o=[],u={length:0,maxSize:r,index:-1,counter:-1,startCounter:0}}function p(e){var n,r,i,s,o;if(l)e.input=t.getProperties();else{for(n=0;n<t.input.length;n++)r=t.input[n],e.input[r]=t.getRawPropertyValue(r);s=t.parameters;for(o in s)s.hasOwnProperty(o)&&s[o].isDefined&&(e.parameters[o]=t.getRawPropertyValue(o))}i=t.state;for(n=0;n<i.length;n++)e.state[n]=i[n].clone()}function d(){var e=c(),t;p(e),o[u.index+1]=e,o.length>u.maxSize?(o.splice(0,1),u.startCounter++):u.index++,u.counter=u.index+u.startCounter;for(t=0;t<f.length;t++)f[t].push();v(),u.length=o.length}function v(){var e;o.length=u.index+1,u.length=o.length;for(e=0;e<f.length;e++)f[e].invalidate(u.index)}function m(e){var n,r;t.restoreProperties(e.input),l||t.restoreParameters(e.parameters),r=e.state;for(n=0;n<r.length;n++)t.state[n].restore(r[n]);for(n=0;n<f.length;n++)f[n].extract(u.index)}function g(e){if(e<0)throw new Error("TickHistory: extract index ["+e+"] less than 0");if(e>=o.length)throw new Error("TickHistory: extract index ["+e+"] greater than list.length: "+o.length);return e}var i={},s,o,u,a=1e3,f=[],l=!!t.getProperties;return i.isEmpty=function(){return u.index===0},i.push=function(){d()},i.returnTick=function(e){var t;return typeof e=="number"?t=e:t=u.index,g(t),o[t]},i.extract=function(e){var t;typeof e=="number"?t=e:t=u.index,g(t),m(o[t])},i.restoreInitialState=function(){h(),m(s),d()},i.reset=h,i.decrementExtract=function(){u.counter>u.startCounter&&(u.index--,u.counter--,m(o[u.index]))},i.incrementExtract=function(){u.index++,u.counter++,m(o[u.index])},i.seekExtract=function(e){e<u.startCounter&&(e=u.startCounter),e>=u.startCounter+u.length&&(e=u.startCounter+u.length-1),u.counter=e,u.index=e-u.startCounter,m(o[u.index])},i.invalidateFollowingState=v,i.get=function(e){return u[e]},i.set=function(e,t){return u[e]=t},i.registerExternalObject=function(e){e.setHistoryLength(u.maxSize),f.push(e)},r==null&&(r=a),s=c(),p(s),h(),d(),i}}),function(){define("cs!md2d/models/solvent",["require"],function(e){var t,n;return n={vacuum:{forceType:0,dielectricConstant:1,color:"#eee"},oil:{forceType:-1,dielectricConstant:10,color:"#f5f1dd"},water:{forceType:1,dielectricConstant:80,color:"#B8EBF0"}},t=function(){function e(e){var t,r,i;this.type=e,r=n[this.type];if(r==null)throw new Error("Solvent: unknown type. Use 'vacuum', 'oil' or 'water'.");for(t in r)i=r[t],this[t]=i}return e}()})}.call(this),define("common/serialize",["require","arrays"],function(e){var t=e("arrays"),n=function(e){var r,i;if(t.isArray(e)){for(r=0,i=e.length;r<i;r++)if(e[r]===Infinity||e[r]===-Infinity)e[r]=e[r].toString()}else for(r in e)if(e.hasOwnProperty(r)){if(e[r]===Infinity||e[r]===-Infinity)e[r]=e[r].toString();(typeof e[r]=="object"||t.isArray(e[r]))&&n(e[r])}};return function(r,i,s){var o={},u,a;for(u in r)r.hasOwnProperty(u)&&i[u]!==undefined&&r[u].serialize!==!1&&(a=i[u],t.isArray(a)?o[u]=s!==undefined?t.copy(t.extend(a,s),[]):t.copy(a,[]):typeof a=="object"?o[u]=$.extend(!0,{},a):o[u]=a);return n(o),o}}),define("md2d/views/nucleotide-paths",[],function(){return{outline:{A:"M20.7,0.4l-0.075-0.075C20.672,0.273,20.73,0.231,20.8,0.2             c0.122-0.049,0.247-0.058,0.375-0.025c0.031,0.002,0.064,0.011,0.1,0.025c0.151,0.054,0.26,0.154,0.325,0.3l6.35,14.15             c0.026,0.065,0.043,0.132,0.05,0.2c0.092,0.104,0.142,0.229,0.15,0.375c0.01,0.163-0.041,0.304-0.15,0.425l-9.025,9.85             c-1.65,1.667-3.292,3.55-4.925,5.65L0.2,15.65c-0.11-0.121-0.16-0.262-0.15-0.425c0.008-0.146,0.058-0.271,0.15-0.375             c0.005-0.068,0.021-0.134,0.05-0.2L6.6,0.5c0.074-0.146,0.19-0.246,0.35-0.3c0.151-0.064,0.301-0.064,0.45,0             c0.038,0.019,0.071,0.043,0.1,0.075C7.593,0.339,7.66,0.431,7.7,0.55c0.047,0.112-0.012,0.154-0.175,0.125             C7.461,0.656,7.386,0.63,7.3,0.6L1.65,15.125l12.4,13.625l12.6-13.725L20.7,0.4z",C:"M12.45,0c2.167,0.5,4.066,1.95,5.7,4.35             c2.033,2.967,3.05,6.533,3.05,10.7c0,3.8-0.867,7.117-2.6,9.95c-0.067,0.133-0.167,0.217-0.3,0.25c-0.133,0.067-0.267,0.067-0.4,0             c-0.133-0.033-0.233-0.117-0.3-0.25c-0.133-0.233-0.283-0.45-0.45-0.65V24.3c-1.8-2.667-3.983-4-6.55-4             c-2.567,0.034-4.767,1.383-6.6,4.05c-0.167,0.2-0.3,0.417-0.4,0.65c-0.1,0.133-0.217,0.217-0.35,0.25             c-0.133,0.067-0.267,0.067-0.4,0c-0.133-0.033-0.233-0.117-0.3-0.25C0.85,22.167,0,18.85,0,15.05c0-4.167,1-7.733,3-10.7             C4.633,1.95,6.55,0.5,8.75,0H12.45z M4,5.05V5C3.991,5.016,3.982,5.033,3.975,5.05C2.289,7.935,1.431,11.126,1.4,14.625             c-0.03,3.519,0.536,6.477,1.7,8.875c2.066-3.39,4.566-5.064,7.5-5.025c2.933,0.04,5.433,1.731,7.5,5.075             c1.088-2.518,1.605-5.559,1.55-9.125c-0.055-3.565-0.888-6.69-2.5-9.375V5c-1.8-2.397-3.983-3.589-6.55-3.575             C8.033,1.439,5.833,2.647,4,5.05z",G:"M8.75,0h3.675c2.191,0.504,4.1,1.963,5.725,4.375V4.35             c2.035,2.963,3.052,6.53,3.05,10.7c0.001,4.17-1.015,7.737-3.05,10.7v-0.025c-2.066,3.065-4.583,4.59-7.55,4.575             c-2.966,0.023-5.5-1.494-7.6-4.55v-0.025C0.999,22.77-0.001,19.211,0,15.05c-0.001-4.161,0.999-7.72,3-10.675V4.35             C4.647,1.953,6.564,0.503,8.75,0z M17.15,25.05c1.754-2.938,2.621-6.354,2.6-10.25c-0.022-3.895-0.889-7.145-2.6-9.75V5.025             c-1.8-2.269-3.984-3.402-6.55-3.4C8.033,1.63,5.833,2.771,4,5.05V5.025c-1.646,2.778-2.496,6.12-2.55,10.025             C1.396,18.955,2.246,22.297,4,25.075V25.05c1.583,2.593,3.667,3.985,6.25,4.175c2.583,0.189,4.883-1.194,6.9-4.15V25.05z",T:"M7.45,0.2H7.9C7.794,0.442,7.677,0.709,7.55,1             C6.388,3.721,4.504,8.396,1.9,15.025l6.9,8.35l1.025-1.35c1.258-1.424,2.55-2.816,3.875-4.175l0.025-0.025             c0.148-0.186,0.314-0.336,0.5-0.45c0.046-0.028,0.096-0.036,0.15-0.025c0.059,0.007,0.109,0.032,0.15,0.075l5.325,5.95l6.95-8.35             C24.252,8.584,22.369,3.909,21.15,1c-0.127-0.284-0.243-0.551-0.35-0.8h0.6h0.575c0.041,0.045,0.075,0.095,0.1,0.15l6.35,14.15             c0.028,0.066,0.053,0.133,0.075,0.2c0.087,0.129,0.137,0.279,0.15,0.45c0.01,0.238-0.065,0.447-0.225,0.625l-8.2,8.95             c-0.102,0.12-0.227,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-4.675-5.1l-4.625,5.1             c-0.101,0.121-0.226,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-8.15-8.95             c-0.16-0.178-0.235-0.387-0.225-0.625c0.014-0.168,0.063-0.318,0.15-0.45c0.019-0.066,0.044-0.133,0.075-0.2l6.35-14.15V0.325             C6.649,0.28,6.674,0.238,6.7,0.2H7.45z",U:"M20.8,0.2h0.6h0.575c0.041,0.045,0.075,0.095,0.1,0.15             l6.35,14.15c0.028,0.066,0.053,0.133,0.075,0.2c0.087,0.129,0.137,0.279,0.15,0.45c0.01,0.238-0.065,0.447-0.225,0.625l-8.2,8.95             c-0.102,0.12-0.227,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-4.675-5.1l-4.625,5.1             c-0.101,0.121-0.226,0.204-0.375,0.25c-0.167,0.043-0.334,0.043-0.5,0c-0.147-0.046-0.272-0.129-0.375-0.25l-8.15-8.95             c-0.16-0.178-0.235-0.387-0.225-0.625c0.014-0.168,0.063-0.318,0.15-0.45c0.019-0.066,0.044-0.133,0.075-0.2l6.35-14.15V0.325             C6.649,0.28,6.674,0.238,6.7,0.2h0.75H7.9C7.794,0.442,7.677,0.709,7.55,1C6.388,3.721,4.504,8.396,1.9,15.025l6.9,8.35             l1.025-1.35c1.258-1.424,2.55-2.816,3.875-4.175l0.025-0.025c0.148-0.186,0.314-0.336,0.5-0.45             c0.046-0.028,0.096-0.036,0.15-0.025c0.059,0.007,0.109,0.032,0.15,0.075l5.325,5.95l6.95-8.35C24.252,8.584,22.369,3.909,21.15,1             C21.023,0.716,20.907,0.449,20.8,0.2z"},interior:{A:"M21.175,0.175C21.046,0.143,20.921,0.151,20.8,0.2             c-0.069,0.031-0.128,0.073-0.175,0.125c-0.055,0.054-0.097,0.121-0.125,0.2c-0.063,0.16,0.003,0.118,0.2-0.125l5.95,14.625             L14.05,28.75L1.65,15.125L7.3,0.6c0.086,0.03,0.161,0.056,0.225,0.075C7.688,0.704,7.747,0.662,7.7,0.55             C7.66,0.431,7.593,0.339,7.5,0.275L7.6,0.2c4.8-0.067,7.283-0.1,7.45-0.1l6.1,0.05L21.175,0.175z",C:"M3.975,5.05H4c1.833-2.402,4.033-3.611,6.6-3.625             C13.167,1.411,15.35,2.603,17.15,5v0.05c1.612,2.685,2.445,5.81,2.5,9.375c0.055,3.566-0.461,6.607-1.55,9.125             c-2.067-3.344-4.567-5.035-7.5-5.075c-2.934-0.04-5.434,1.635-7.5,5.025c-1.164-2.398-1.73-5.356-1.7-8.875             C1.431,11.126,2.289,7.935,3.975,5.05z",G:"M17.15,25.05v0.025c-2.017,2.956-4.317,4.339-6.9,4.15             C7.667,29.035,5.583,27.643,4,25.05v0.025c-1.754-2.778-2.604-6.12-2.55-10.025C1.504,11.145,2.354,7.803,4,5.025V5.05             c1.833-2.278,4.033-3.42,6.6-3.425c2.566-0.002,4.75,1.131,6.55,3.4V5.05c1.711,2.605,2.578,5.855,2.6,9.75             C19.771,18.695,18.904,22.112,17.15,25.05z",T:"M21.4,0.2h-0.6c0.107,0.249,0.223,0.516,0.35,0.8             c1.219,2.909,3.103,7.584,5.65,14.025l-6.95,8.35l-5.325-5.95c-0.041-0.042-0.091-0.067-0.15-0.075             c-0.054-0.011-0.104-0.003-0.15,0.025c-0.186,0.114-0.352,0.264-0.5,0.45L13.7,17.85c-1.325,1.358-2.617,2.75-3.875,4.175             L8.8,23.375l-6.9-8.35C4.504,8.396,6.388,3.721,7.55,1C7.677,0.709,7.794,0.442,7.9,0.2H7.45c0.133-0.067,0.333-0.1,0.6-0.1             c0.406,0,1.606-0.008,3.6-0.025l-1.375,0.05C17.28,0.048,20.955,0.056,21.3,0.15C21.334,0.164,21.368,0.181,21.4,0.2z",U:"M7.9,0.2l0.15-0.1c0.406,0,1.606-0.008,3.6-0.025l-1.375,0.05             c6.009-0.066,9.568-0.066,10.675,0L20.8,0.2c0.107,0.249,0.223,0.516,0.35,0.8c1.219,2.909,3.103,7.584,5.65,14.025l-6.95,8.35             l-5.325-5.95c-0.041-0.042-0.091-0.067-0.15-0.075c-0.054-0.011-0.104-0.003-0.15,0.025c-0.186,0.114-0.352,0.264-0.5,0.45             L13.7,17.85c-1.325,1.358-2.617,2.75-3.875,4.175L8.8,23.375l-6.9-8.35C4.504,8.396,6.388,3.721,7.55,1             C7.677,0.709,7.794,0.442,7.9,0.2z"},letter:{A:{1:"M12.85,12.55h2.6l-1.3-3.95L12.85,12.55z M13,6.25h2.4l3.55,10.1               h-2.3L16,14.3h-3.7l-0.7,2.05H9.4L13,6.25z",2:"M18.7,5.95l-3.55,10.1h-2.4l-3.6-10.1h2.2L12.05,8h3.7l0.65-2.05               H18.7z M12.6,9.75l1.3,3.95l1.3-3.95H12.6z"},C:{1:"M10.45,6.4c1.667,0,2.883,0.55,3.65,1.65               c0.433,0.633,0.667,1.267,0.7,1.9h-2.1c-0.133-0.5-0.3-0.867-0.5-1.1c-0.4-0.434-0.967-0.65-1.7-0.65S9.183,8.5,8.75,9.1               C8.317,9.733,8.1,10.617,8.1,11.75c0,1.1,0.217,1.933,0.65,2.5c0.467,0.567,1.05,0.85,1.75,0.85c0.733,0,1.283-0.233,1.65-0.7               c0.233-0.267,0.417-0.667,0.55-1.2h2.05c-0.167,1.1-0.617,2-1.35,2.7c-0.733,0.7-1.683,1.05-2.85,1.05               c-1.433,0-2.566-0.467-3.4-1.4c-0.8-0.933-1.2-2.216-1.2-3.85c0-1.767,0.466-3.117,1.4-4.05C8.15,6.817,9.183,6.4,10.45,6.4z",2:"M15,12.35c-0.033,0.633-0.267,1.267-0.7,1.9               c-0.767,1.1-1.983,1.65-3.65,1.65c-1.267,0-2.3-0.417-3.1-1.25c-0.933-0.933-1.4-2.283-1.4-4.05c0-1.633,0.4-2.917,1.2-3.85               c0.833-0.933,1.967-1.4,3.4-1.4c1.167,0,2.117,0.35,2.85,1.05c0.733,0.7,1.183,1.6,1.35,2.7H12.9               c-0.133-0.533-0.316-0.934-0.55-1.2c-0.367-0.467-0.917-0.7-1.65-0.7c-0.7,0-1.284,0.283-1.75,0.85               c-0.434,0.567-0.65,1.4-0.65,2.5c0,1.133,0.217,2.017,0.65,2.65c0.433,0.6,1.017,0.9,1.75,0.9c0.733,0,1.3-0.217,1.7-0.65               c0.2-0.233,0.367-0.6,0.5-1.1H15z"},G:{1:"M14.8,10.8h-2.05c-0.167-0.667-0.567-1.133-1.2-1.4               c-0.333-0.167-0.716-0.25-1.15-0.25c-0.8,0-1.467,0.3-2,0.9c-0.5,0.633-0.75,1.567-0.75,2.8s0.283,2.1,0.85,2.6               c0.567,0.533,1.2,0.8,1.9,0.8c0.7,0,1.283-0.217,1.75-0.65c0.434-0.4,0.717-0.934,0.85-1.6h-2.35v-1.65h4.2v5.4h-1.4l-0.2-1.25               c-0.4,0.467-0.767,0.8-1.1,1C11.583,17.833,10.9,18,10.1,18c-1.333,0-2.434-0.467-3.3-1.4c-0.867-0.9-1.3-2.167-1.3-3.8               s0.45-2.933,1.35-3.9c0.867-1,2.05-1.5,3.55-1.5c1.267,0,2.3,0.333,3.1,1C14.267,9.033,14.7,9.833,14.8,10.8z",2:"M10.65,9.65c-0.7,0-1.333,0.267-1.9,0.8               c-0.567,0.5-0.85,1.367-0.85,2.6c0,1.233,0.25,2.167,0.75,2.8c0.533,0.6,1.2,0.9,2,0.9c0.434,0,0.817-0.083,1.15-0.25               c0.633-0.267,1.034-0.733,1.2-1.4h2.05c-0.1,0.967-0.533,1.767-1.3,2.4c-0.8,0.667-1.833,1-3.1,1c-1.5,0-2.683-0.5-3.55-1.5               c-0.9-0.967-1.35-2.267-1.35-3.9s0.433-2.9,1.3-3.8c0.867-0.933,1.967-1.4,3.3-1.4c0.8,0,1.483,0.167,2.05,0.5               c0.333,0.2,0.7,0.533,1.1,1l0.2-1.25h1.4v5.4h-4.2V11.9h2.35c-0.133-0.667-0.417-1.2-0.85-1.6C11.933,9.867,11.35,9.65,10.65,9.65z"},T:{1:"M10.3,5 L18.45,5 L18.45,6.8 L15.4,6.8 L15.4,15.1 L13.3,15.1               L13.3,6.8 L10.3,6.8z",2:"M10.2,14.65 L10.2,12.85 L13.2,12.85 L13.2,4.55 L15.3,4.55               L15.3,12.85 L18.35,12.85 L18.35,14.65z"},U:{1:"M10.15,10.8V4.6h2.15v6.2c0,0.7,0.083,1.217,0.25,1.55               c0.267,0.566,0.817,0.85,1.65,0.85c0.867,0,1.417-0.284,1.65-0.85c0.167-0.333,0.25-0.85,0.25-1.55V4.6h2.15v6.2               c0,1.067-0.167,1.9-0.5,2.5c-0.633,1.1-1.817,1.65-3.55,1.65c-1.733,0-2.917-0.55-3.55-1.65C10.317,12.7,10.15,11.867,10.15,10.8z",2:"M12.45,8.4v6.2H10.3V8.4c0-1.066,0.167-1.9,0.5-2.5               c0.633-1.1,1.817-1.65,3.55-1.65S17.267,4.8,17.9,5.9c0.333,0.6,0.5,1.434,0.5,2.5v6.2h-2.15V8.4c0-0.7-0.083-1.217-0.25-1.55               C15.767,6.283,15.217,6,14.35,6c-0.833,0-1.383,0.283-1.65,0.85C12.533,7.183,12.45,7.7,12.45,8.4z"}}}}),define("md2d/views/nucleotides",["require","md2d/views/nucleotide-paths"],function(e){function s(){function m(e){var t,n;e?(t=Math.random()>=.5?Math.PI*.25:Math.PI*1.25,t+=Math.random()*Math.PI*.5,n=s.HEIGHT*6,d=n*Math.cos(t),v=n*Math.sin(t)):d=v=0}function g(t){return"translate("+e(d+s.WIDTH*t.idx)+" "+e(v)+")"}function y(s){s.each(function(s,d){var v=d3.select(this),y=f?.9*i.BACKB:0,b=e(y+.5*i.A),w=e(y+i.A*.97),E=typeof o=="function"?o(s,d):o,S,x,T,N,C,k,L,A,O,M;typeof E=="string"&&(E=E.split(""),E.forEach(function(e,t){E[t]={id:t,idx:t,type:e}})),S=v.selectAll(".nucleotide").data(E,function(e){return e.id}),x=S.enter(),T=S.exit(),m(c),x=x.append("g").attr({transform:g}).style({opacity:c?0:1}),N=x.append("g").attr({"class":"scale",transform:"scale(1, "+(u===1?1:-1)+")"}),N.append("path").attr("class","bonds").style({"stroke-width":e(.01),stroke:"#fff"}),k=N.append("g").classed("nucleo-shape",!0).classed("clickable-nucleo",function(e){return e.region==="c"&&h}).on("click",function(){}),h&&k.append("image").attr({"class":"glow",y:e(y-.17*r.G_GLOW),preserveAspectRatio:"none"}),L=k.append("svg").attr({y:e(y),preserveAspectRatio:"none"}),L.append("path").attr({"class":"outline","fill-rule":"evenodd","clip-rule":"evenodd"}),L.append("path").attr({"class":"interior","fill-rule":"evenodd","clip-rule":"evenodd"}),L.append("path").attr({"class":"letter","fill-rule":"evenodd","clip-rule":"evenodd",d:function(e){return t.letter[e.type][u]}}),f&&(C=N.append("image").attr({"class":"backbone",x:0,y:0,width:e(r.BACKB),height:e(i.BACKB),preserveAspectRatio:"none","xlink:href":"resources/dna/Backbone_"+f+".svg"})),p&&(S=x),S.attr("class",function(e){var t="";switch(e.region){case"c":t="coding-region";break;case"j":t="junk-region";break;case"p":t="promoter-region";break;case"t":t="terminator-region"}return"nucleotide "+t}),S.select(".bonds").attr("d",function(t){return t.type==="C"||t.type==="G"?"M"+e(n*20)+" "+b+" L "+e(n*20)+" "+w+"M"+e(n*26)+" "+b+" L "+e(n*26)+" "+w+"M"+e(n*32)+" "+b+" L "+e(n*32)+" "+w:"M"+e(n*22)+" "+b+" L "+e(n*22)+" "+w+"M"+e(n*30)+" "+b+" L "+e(n*30)+" "+w}),S.select(".glow").attr({x:function(t){return e(r.BACKB)/2-e(r[t.type+"_GLOW"])/2},width:function(t){return e(r[t.type+"_GLOW"])},height:function(t){return e(i[t.type+"_GLOW"])},"xlink:href":function(e){return"resources/dna/NucleotideGlow_"+e.type+".svg"}}),A=S.select(".nucleo-shape > svg"),A.attr({"class":function(e){var t="type-"+e.type;return l&&l[e.idx]&&(t+=" stop-codon"),t},viewBox:function(e){return"0 0 "+r[e.type]/n+" "+i[e.type]/n},x:function(t){return e(r.BACKB)/2-e(r[t.type])/2},width:function(t){return e(r[t.type])},height:function(t){return e(i[t.type])}}),A.select("path.interior").attr("d",function(e){return t.interior[e.type]}),A.select("path.outline").attr("d",function(e){return t.outline[e.type]}),m(!1),O=d3.transition(S).attr("transform",g).style("opacity",1),O.select(".bonds").style("opacity",a),O.attrTween?(M="scale(1, "+(u===1?1:-1)+")",O.select("g.scale").attrTween("transform",function(e,t,n){return d3.interpolateString(n,M)}),O.select("path.letter").attrTween("d",function(e,n,r){return function(n){return n<.5?r:t.letter[e.type][u]}})):(S.select("g.scale").attr("transform","scale(1, "+(u===1?1:-1)+")"),S.select("path.letter").attr("d",function(e){return t.letter[e.type][u]})),m(!0),d3.transition(T).attr("transform",g).style("opacity",0).remove()})}var e=null,o="",u=1,a=1,f="DNA",l=null,c=!0,h=!1,p=!1,d=0,v=0;return y.sequence=function(e){return arguments.length?(o=e,y):o},y.model2px=function(t){return arguments.length?(e=t,y):e},y.direction=function(e){return arguments.length?(u=e,y):u},y.bonds=function(e){return arguments.length?(a=e,y):a},y.randomEnter=function(e){return arguments.length?(c=e,y):c},y.glow=function(e){return arguments.length?(h=e,y):h},y.backbone=function(e){return arguments.length?(f=e,y):f},y.stopCodonsHash=function(e){return arguments.length?(l=e,y):l},y.enterExitOnly=function(e){return arguments.length?(p=e,y):p},y}var t=e("md2d/views/nucleotide-paths"),n=.007,r={BACKB:52,A:28.151,C:21.2,G:21.2,T:28.651,U:28.651,A_GLOW:44.125,C_GLOW:37.2,G_GLOW:36.2,T_GLOW:45.566},i={BACKB:14,A:31.15,C:25.3,G:30.3,T:25.007,U:25.007,A_GLOW:44.55,C_GLOW:41.417,G_GLOW:45.3,T_GLOW:40.65};return function(){var e;for(e in r)r.hasOwnProperty(e)&&(r[e]*=n);for(e in i)i.hasOwnProperty(e)&&(i[e]*=n)}(),s.WIDTH=r.BACKB*.92,s.HEIGHT=(i.BACKB*.9+i.A)*.96,s}),define("md2d/models/engine/genetic-engine",["require","cs!md2d/models/aminoacids-helper","common/alert","md2d/views/nucleotides"],function(e){function d(e){return e.replace(/A/g,"t").replace(/G/g,"c").replace(/T/g,"a").replace(/C/g,"g").toUpperCase()}function v(e){var t=["A","G","T","C"],n=t.length,r="",i;for(i=0;i<e;i++)r+=t[Math.floor(Math.random()*n)];return r}function m(){return o++}var t=e("cs!md2d/models/aminoacids-helper"),n=e("common/alert"),r=e("md2d/views/nucleotides").WIDTH,i=["undefined","intro-cells","intro-zoom1","intro-zoom2","intro-zoom3","intro-polymerase","dna","transcription","transcription-end","after-transcription","before-translation","translation","translation-end"],s={},o=0,u="TGACCTCTCCGCGCCATCTATAAACCGAAGCGCTAGCTACA",a="ACCACAGGCCGCCAGTTCCGCTGGCGGCATTTT",f=d(u),l=d(a),c,h,p="change";return function(){var e,t;for(e=0,t=i.length;e<t;e++)s[i[e]]=e;c=v(50),h=d(c)}(),function(r){var o,v=p,g=[],y="",b="",w,E,S=d3.dispatch("change","transition"),x=function(){var e=N(0),t="";while(e)t+=e,e=N(t.length);return t},T=function(){var e,n,r;w={},E=null;for(n=0,r=b.length;n<r;n+=3)e=b.substr(n,3),t.codonToAbbr(e)==="STOP"&&(E===null&&(E=n/3),e.length===3&&(w[n]=w[n+1]=w[n+2]=!0));E===null&&(E=Math.floor(b.length/3))},N=function(e){if(e>=y.length)return null;switch(y[e]){case"A":return"U";case"G":return"C";case"T":return"A";case"C":return"G"}},C=function(e,t){var n,r,i;e.length=t.length;for(n=0,r=t.length;n<r;n++)i=e[n]||{},i.idx=n,i.type!==t[n]&&(i.type=t[n],i.id=m(),e[n]=i);return e},k=function(e,t,n){var r=n?h+f+t+l+h:c+u+t+a+c,i=c.length,s=i+u.length,o=s+t.length,p=o+a.length,d,v,g;e.length=r.length;for(d=0,v=r.length;d<v;d++)g=e[d]||{},g.idx=d,d<i?g.region="j":d<s?g.region="p":d<o?g.region="c":d<p?g.region="t":g.region="j",g.type!==r[d]&&(g.type=r[d],g.id=m(),e[d]=g);return e},L=function(){var e=r.get("DNA");k(o.viewModel.DNA,e,!1),y=d(e),k(o.viewModel.DNAComp,y,!0),b=x(),T(),o.stateBefore("transcription:0")?C(o.viewModel.mRNA,""):o.state().name==="transcription"?C(o.viewModel.mRNA,b.substr(0,o.state().step)):o.stateAfter("transcription")&&C(o.viewModel.mRNA,b),v!=="transition"&&(o.stateBefore("translation:1")?A():o.stateEqual("translation-end")&&O())},A=function(){var e;e=r.getNumberOfAtoms();if(e>0){r.startBatch();while(e>0)r.removeAtom(e-1),e--;r.endBatch()}r.stop()},O=function(){var e=[],n=0,i=t.codonToAbbr(o.codon(0));while(i!=="STOP")e.push(i),i=t.codonToAbbr(o.codon(++n));o.generateProtein(e,undefined,2.3,.3),o.centerProtein(),r.start()},M=function(e){var n=e.name,u,a;if(n==="transcription")return e.step<r.get("DNA").length-1?"transcription:"+(e.step+1):"transcription-end";if(n==="translation")return a=t.codonToAbbr(o.codon(e.step)),a!=="STOP"?"translation:"+(e.step+1):"translation-end";u=i[s[e.name]+1];if(u==="transcription"||u==="translation")u+=":0";return u},_=function(e){var t=e.name,n=e.step;return t==="transcription"&&n>0?"transcription:"+(n-1):t==="transcription-end"?"transcription:"+(r.get("DNA").length-1):t==="translation-end"||t==="translation"&&n>0?"translation:0":i[s[t]-1]},D=function(e,t){return e===t?0:(e=o.parseState(e),t=o.parseState(t),e.name===t.name?isNaN(e.step)||isNaN(t.step)?0:e.step<t.step?-1:1:s[e.name]<s[t.name]?-1:1)},P=function(e){if(typeof e=="undefined")return;g.length>0?g.push(e):(g.push(e),H(e))},H=function(e){F("DNAState",e,"transition")},B=function(e){F("DNA",e,"transition")},j=function(e){g.length=0,r.cancelTransitions(),S.change(e)},F=function(e,t,n){v=n||p,r.properties[e]=t,v=p},I=function(){var e=r.get("DNAState");if(v==="suppress")return;L();if(v==="transition")S.transition(e);else{if(o.stateAfter("translation:0")&&o.stateBefore("translation-end")){n("'"+e+"' cannot be set explicitly. "+"'translation:0' should be set and then animation to '"+e+"' should be triggered."),F("DNAState","translation:0");return}j()}},q=function(){if(v==="suppress")return;if(o.stateAfter("translation:0")&&o.stateBefore("translation-end")){F("DNAState","translation:0");return}L(),v==="transition"?S.transition("dna-updated",!0):j(!0)};return o={PRECODING_LEN:c.length+u.length,viewModel:{mRNA:[],DNA:[],DNAComp:[]},on:function(e,t){S.on(e,t)},mutate:function(e,t,n){var i=r.get("DNA"),s=e-o.PRECODING_LEN;if(s<0||s>=i.length)throw new Error("Mutation can be performed only on DNA coding region.");i=i.substr(0,s)+(n?d(t):t)+i.substr(s+1),F("DNA",i)},insert:function(e,t,n){var i={type:n?d(t):t,id:m(),region:"c"},s={type:n?t:d(t),id:m(),region:"c"},u={type:n?d(t):t,id:m(),region:"c"},a=r.get("DNA"),f=o.state(),l=e-o.PRECODING_LEN;if(l<0||l>=a.length)throw new Error("Mutation can be performed only on DNA coding region.");o.viewModel.DNA.splice(e,0,i),o.viewModel.DNAComp.splice(e,0,s),o.viewModel.mRNA.splice(l,0,u),a=a.substr(0,l)+i.type+a.substr(l),f.name==="transcription"&&l<f.step&&F("DNAState",f.name+":"+(f.step+1),"suppress"),B(a)},"delete":function(e){var t=r.get("DNA"),n=o.state(),i=e-o.PRECODING_LEN;if(i<0||i>=t.length)throw new Error("Mutation can be performed only on DNA coding region.");o.viewModel.DNA.splice(e,1),o.viewModel.DNAComp.splice(e,1),o.viewModel.mRNA.splice(i,1),t=t.substr(0,i)+t.substr(i+1),n.name==="transcription"&&i<n.step&&F("DNAState",_(n),"suppress"),B(t)},transitionToNextState:function(){o.stopTransition(),g.length===0&&P(M(o.lastState()))},stopTransition:function(){g.length>1&&(g.length=1)},jumpToNextState:function(){o.stateBefore("translation:0")?F("DNAState",M(o.state())):o.stateBefore("translation-end")&&F("DNAState","translation-end")},jumpToPrevState:function(){o.stateAfter("intro-cells")&&F("DNAState",_(o.state()))},transitionTo:function(e){while(o.lastStateBefore(e))P(M(o.lastState()))},transcribeStep:function(e){var t,n;t=o.state();if(t.name==="dna"&&typeof e=="undefined")o.transitionToNextState();else if(t.name==="transcription"){n=N(t.step);if(e&&e.toUpperCase()!==n)return;o.transitionToNextState()}},state:function(){return o.parseState(r.get("DNAState"))},stateBefore:function(e){return D(r
.get("DNAState"),e)===-1},stateEqual:function(e){return D(r.get("DNAState"),e)===0},stateAfter:function(e){return D(r.get("DNAState"),e)===1},lastState:function(){var e=g.length;return e>0?o.parseState(g[e-1]):o.state()},lastStateBefore:function(e){var t=g.length,n=t?g[t-1]:r.get("DNAState");return D(n,e)===-1?!0:!1},lastStateAfter:function(e){var t=g.length,n=t?g[t-1]:r.get("DNAState");return D(n,e)===1?!0:!1},parseState:function(e){return e=e.split(":"),{name:e[0],step:Number(e[1])}},codon:function(e){return b.substr(3*e,3)},codonComplement:function(e){return o.codon(e).replace(/A/g,"u").replace(/G/g,"c").replace(/U/g,"a").replace(/C/g,"g").toUpperCase()},translationStepStarted:function(e,n,i,s,u,a){var f=t.codonToAbbr(o.codon(e)),l=t.abbrToElement(f);u+=Math.random()*.02-.01,r.addAtom({x:n,y:i,element:l,visible:!0,pinned:!0},{suppressCheck:!0}),r.atomTransition().id(e).duration(a).prop("x",s),r.atomTransition().id(e).duration(a).prop("y",u),r.start()},shiftAminoAcids:function(e,t,n){if(e<1)return;var i,s,o;for(i=0;i<e;i++)s=r.getAtomProperties(i).x+t,o=r.getAtomProperties(i).y,r.atomTransition().id(i).duration(n).prop("x",s),r.atomTransition().id(i).duration(n).prop("y",o)},centerProtein:function(e){r.batch(function(){var t=o.proteinCenterOfMass(),n=r.properties.viewPortX+r.properties.viewPortWidth/2-t.x,i=r.properties.viewPortY+r.properties.viewPortHeight/2-t.y,s=r.properties.minX+.1,u=r.properties.maxX-.1,a=r.properties.minY+.1,f=r.properties.maxY-.1,l=r.getNumberOfAtoms(),c,h,p;for(c=0;c<l;c++)h=r.getAtomProperties(c).x,p=r.getAtomProperties(c).y,h+n>u&&(n=u-h),h+n<s&&(n=s-h),p+i>f&&(i=f-p),p+i<a&&(i=a-p);for(c=0;c<l;c++)h=r.getAtomProperties(c).x+n,p=r.getAtomProperties(c).y+i,e?(r.atomTransition().id(c).duration(e).prop("x",h),r.atomTransition().id(c).duration(e).prop("y",p)):r.setAtomProperties(c,{x:h,y:p})}),r.isStopped()&&r.minimizeEnergy()},connectAminoAcid:function(e){if(e<1)return;var t=r.getAtomProperties(e-1).radius,n=r.getAtomProperties(e).radius,i=(t+n)*1.25;r.addRadialBond({atom1:e,atom2:e-1,length:i,strength:1e4}),r.setAtomProperties(e-1,{pinned:!1})},translationCompleted:function(){var e=r.getNumberOfAtoms();e>0&&r.setAtomProperties(e-1,{pinned:!1})},transitionEnded:function(){g.shift(),g.length>0&&H(g[0])},stopCodonsHash:function(){return w},lastTranslationStep:function(){return E},proteinCenterOfMass:function(){var e=0,t=0,n=0,i=r.getNumberOfAtoms(),s,o;if(i===0)return null;for(o=0,i=r.getNumberOfAtoms();o<i;o++)s=r.getAtomProperties(o),t+=s.x*s.mass,n+=s.y*s.mass,e+=s.mass;return t/=e,n/=e,{x:t,y:n}},generateProtein:function(e,n,i,s){n=e?e.length:n,i=i||0,s=s||0;var o=r.properties.minX,u=r.properties.minY+s,a=r.properties.maxX,f=r.properties.maxY-i,l=0;return A(),r.batch(function(){var i={suppressCheck:!0},s=a-o,c=f-u,h=t.lastElementID-t.firstElementID+1,p,d,v,m,g,y,b,w,E,S,x=.6,T=function(e){return e>c-x||e<x?.1:.02-Math.random()*.04},N=.3,C=function(e,t){return t===0?e>.5*f?-0.1:.1:d>f-N||d<N?0:t},k=function(){return Math.floor(h*Math.random())+t.firstElementID};p=o+.1,d=u+.1,v=0,m=0,g=e?t.abbrToElement(e[0]):k(),b=r.getElementProperties(g).radius,y={x:p,y:d,element:g,visible:!0},r.addAtom(y,i),l+=1;for(S=1;S<n;S++){p=y.x,d=y.y,v=T(d),m=C(d,m),p+=v*1.7,d+=m*1.7;if(p>s-.1)return;g=e?t.abbrToElement(e[S]):k(),y={x:p,y:d,element:g,visible:!0},r.addAtom(y,i),l+=1,w=b,b=r.getElementProperties(g).radius,E=(b+w)*1.25,r.addRadialBond({atom1:S,atom2:S-1,length:E,strength:1e4})}}),r.batch(function(){var e=r.getAtomProperties(l-1).x,t=(e-o)/2,i=r.properties.viewPortX+r.properties.viewPortWidth/2,s=a-e,u=Math.max(0,Math.min(i-t,s)),f;for(f=0;f<n;f++)r.setAtomProperties(f,{x:r.getAtomProperties(f).x+u})}),r.minimizeEnergy(),l}},r.addPropertiesListener(["DNA"],q),r.addPropertiesListener(["DNAState"],I),L(),o}}),define("md2d/models/unit-definitions/md2d",[],function(){return{name:"md2d",translated:!1,units:{length:{name:"nanometer",pluralName:"nanometers",symbol:"nm"},mass:{name:"atomic mass unit",pluralName:"atomic mass units",symbol:"amu"},time:{name:"femtosecond",pluralName:"femtoseconds",symbol:"fs",displayValue:{unitsPerBaseUnit:.001,pluralName:"picoseconds",name:"picosecond",symbol:"ps"}},inverseTime:{name:"1/femtosecond",pluralName:"1/femtoseconds",symbol:"1/fs"},velocity:{name:"nanometer per femtosecond",pluralName:"nanometers per second",symbol:"nm/s"},acceleration:{name:"nanometer per femtosecond squared",pluralName:"nanometers per femtosecond squared",symbol:"nm/fs²"},momentum:{name:"amu nanometer per femtosecond",pluralName:"amu nanometers per femtosecond",symbol:"amu⋅nm/fs"},force:{name:"amu nanometer per femtosecond squared",pluralName:"amu nanometers per femtosecond squared",symbol:"amu⋅nm/fs²"},energy:{name:"electron volt",pluralName:"electron volts",symbol:"eV"},dampingCoefficient:{name:"amu per femtosecond",pluralName:"amu per femtoseconds",symbol:"amu/fs"},stiffness:{name:"electron volt per nanometer squared",pluralName:"electron volts per nanometer squared",symbol:"eV/nm²"},rotationalStiffness:{name:"electron volt per radian",pluralName:"electron volts per radian",symbol:"eV/rad"},charge:{name:"elementary charge",pluralName:"elementary charges",symbol:"e"},temperature:{name:"Kelvin",pluralName:"Kelvin",symbol:"K"},pressure:{name:"bar",pluralName:"bar",symbol:"bar"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}}}),define("md2d/models/unit-definitions/mks",[],function(){return{name:"mks",translated:!0,units:{length:{name:"meter",pluralName:"meters",symbol:"m",representationInMD2DUnits:1,valueInSIUnits:1},mass:{name:"kilogram",pluralName:"kilograms",symbol:"kg",representationInMD2DUnits:1,valueInSIUnits:1},time:{name:"second",pluralName:"seconds",symbol:"s",representationInMD2DUnits:1e4,valueInSIUnits:1},inverseTime:{name:"1/second",pluralName:"1/seconds",symbol:"1/s",valueInSIUnits:1},velocity:{name:"meter per second",pluralName:"meters per second",symbol:"m/s",valueInSIUnits:1},acceleration:{name:"meter per second squared",pluralName:"meters per second squared",symbol:"m/s²",valueInSIUnits:1},force:{name:"Newton",pluralName:"Newtons",symbol:"N",valueInSIUnits:1},energy:{name:"Joule",pluralName:"Joules",symbol:"J",valueInSIUnits:1},dampingCoefficient:{name:"Newton second per meter",pluralName:"Newton seconds per meter",symbol:"N⋅s/m",valueInSIUnits:1},stiffness:{name:"Newton per meter",pluralName:"Newtons per meter",symbol:"N/m",valueInSIUnits:1},rotationalStiffness:{name:"Newton-meter per radian",pluralName:"Newton-meters per radian",symbol:"N⋅m/rad",valueInSIUnits:1},charge:{name:"Coulomb",pluralName:"Coulombs",symbol:"C",valueInSIUnits:1}}}}),define("md2d/models/unit-definitions/index",["require","md2d/models/unit-definitions/md2d","md2d/models/unit-definitions/mks","underscore"],function(e){var t={md2d:e("md2d/models/unit-definitions/md2d"),mks:e("md2d/models/unit-definitions/mks")},n=e("underscore");return{get:function(e){var r;return e==="md2d"?t.md2d:(r=n.extend({},t[e]),r.units=n.extend({},t.md2d.units,t[e].units),r)}}}),define("md2d/models/units-translation",["require","underscore","md2d/models/engine/constants/index","md2d/models/engine/potentials/coulomb"],function(e){var t=e("underscore"),n=e("md2d/models/engine/constants/index"),r=e("md2d/models/engine/potentials/coulomb"),i=n.COULOMB_CONSTANT.as(n.unit.METERS_PER_FARAD),s=["length","mass","time"];return function(o){var u={},a={},f;return t.each(s,function(e){var t=o.units[e];u[e]=t.valueInSIUnits/t.representationInMD2DUnits}),u.inverseTime=1/u.time,u.velocity=u.length/u.time,u.acceleration=u.velocity/u.time,u.force=u.mass*u.acceleration,u.energy=n.ratio(n.unit.MW_ENERGY_UNIT,{per:n.unit.EV}),u.energy*=u.force*u.length,u.dampingCoefficient=u.force/u.velocity,u.stiffness=u.energy/u.length/u.length,u.rotationalStiffness=u.energy/u.length,f=r.force(1,-1,1,1),u.charge=Math.sqrt(f*u.force*u.length*u.length/i),t.each(t.keys(u),function(e){a[e]=u[e]/o.units[e].valueInSIUnits}),{translateToModelUnits:function(e,t){return a[t]==null?e:e/a[t]},translateFromModelUnits:function(e,t){return a[t]==null?e:e*a[t]}}}}),define("md2d/models/performance-optimizer",[],function(){function t(e){this._model=e,this._initialTimeStep=this._model.get("timeStep"),this._maxTimeStep=this._initialTimeStep*2,this._targetProgressRate=this._initialTimeStep*this._model.get("timeStepsPerTick")*60,this.enabled=!1}var e=2.5;return t.prototype._assessPerformance=function(){if(!this.enabled||this._model.isStopped())return;var t=this._model.getSimulationProgressRate(),n=this._model.getFPS(),r=this._model.get("timeStep"),i=this._model.get("timeStepsPerTick"),s=this._model.get("temperatureControl")?this._maxTimeStep*2.5:this._maxTimeStep;t<.9*this._targetProgressRate?1.1*r<s?this._model.set("timeStep",1.1*r):n>e&&this._model.set("timeStepsPerTick",Math.round(1.1*i+.5)):t>1.1*this._targetProgressRate&&this._model.set("timeStepsPerTick",Math.round(.9*i-.5)),setTimeout($.proxy(this._assessPerformance,this),250)},t.prototype.enable=function(){if(this.enabled)return;this._model.start(),this.enabled=!0,this._model.set("timeStepsPerTick",5),setTimeout($.proxy(this._assessPerformance,this),250)},t.prototype.disable=function(){this.enabled=!1},t}),define("common/models/property-transition",[],function(){function e(){this.isFinished=!1,this._duration=0,this._easeFunc=d3.ease("cubic-in-out"),this._elapsedTime=0,this._id=null,this._propName=null,this._endValue=null,this._interpolator=null;if(this.getObjectProperties==null)throw new Error("getObjectProperties method must be implemented by descendant!");if(this.setObjectProperties==null)throw new Error("setObjectProperties method must be implemented by descendant!")}return e.prototype.id=function(e){return this._id=e,this},e.prototype.prop=function(e,t){return this._propName=e,this._endValue=t,this},e.prototype.duration=function(e){return this._duration=e,this},e.prototype.delay=function(e){return this._elapsedTime=-e,this},e.prototype.ease=function(e){return this._easeFunc=d3.ease(e),this},e.prototype.process=function(e){if(this.isFinished||this._incompleteSpec())return;var t,n;this._elapsedTime+=e;if(this._elapsedTime<0)return;this._interpolator==null&&(this._interpolator=d3.interpolate(this.getObjectProperties(this._id)[this._propName],this._endValue)),t=Math.min(1,this._elapsedTime/this._duration),t=this._easeFunc(t),n={},n[this._propName]=this._interpolator(t),this.setObjectProperties(this._id,n),t>=1&&(this.isFinished=!0)},e.prototype.getObjectProperties=null,e.prototype.setObjectProperties=null,e.prototype._incompleteSpec=function(){return this._id==null||this._propName==null||this._endValue==null},e}),define("md2d/models/atom-transition",["require","common/inherit","common/models/property-transition"],function(e){function r(e){n.call(this),this._model=e}var t=e("common/inherit"),n=e("common/models/property-transition");return t(r,n),r.prototype.setObjectProperties=function(e,t){this._model.setAtomProperties(e,t)},r.prototype.getObjectProperties=function(e){return this._model.getAtomProperties(e)},r}),define("md2d/models/engine/plugins/quantum-dynamics",["require","common/models/engines/clone-restore-wrapper","../constants/index","../utils","arrays","common/array-types","md2d/models/metadata","common/validator"],function(e){var t=e("common/models/engines/clone-restore-wrapper"),n=e("../constants/index"),r=e("../utils"),i=n.convert(.2,{from:n.unit.EV,to:n.unit.MW_ENERGY_UNIT}),s=.002,o=2*Math.PI,u=1e3,a=1/u;return function(u,f){var l=e("arrays"),c=e("common/array-types"),h=e("md2d/models/metadata"),p=e("common/validator"),d=p.validateCompleteness(h.quantumDynamics,f),v,m=d.elementEnergyLevels,g=d.radiationlessEmissionProbability,y=u.getDimensions(),b,w,E,S=[],x=function(){var e=b.x.length;b.excitation=l.create(e,0,c.int8Type)},T=function(e){var t=0;e.x&&(t=Math.ceil(e.x.length/10)*10),E={x:l.create(t,0,c.floatType),y:l.create(t,0,c.floatType),vx:l.create(t,0,c.floatType),vy:l.create(t,0,c.floatType),angularFrequency:l.create(t,0,c.floatType)}},N=[],k,L,A,O,M,_,D,P,H=0,B=function(e){if(!e||!e.x)return;["x","y","vx","vy","angularFrequency"].forEach(function(t){l.copy(e[t],E[t])});for(var t=0;t<E.x.length;t++)(E.vx[t]||E.vy[t])&&H++},j=function(e){var t=u.getNumberOfAtoms(),n=e.getList(),r=[],i,s,o,a,f,l,c,h,p,d,v,g,y,E,S,x,T;if(!m)return;for(i=0;i<t;i++){p=b.x[i],d=b.y[i];for(o=e.getStartIdxFor(i),a=e.getEndIdxFor(i);o<a;o++){s=n[o],f=b.element[i],l=b.element[s],c=m[f],h=m[l];if(!c.length&&!h.length)continue;v=p-b.x[s],g=d-b.y[s],y=v*v+g*g,E=.5*(w.sigma[f]+w.sigma[l]),S=E*E;if(y>=S)continue;r[i]=s;if(N[i]===s)continue;x=F(i,s),x||(T=z(i,s));if(x||T)N[i]=s,N[s]=i}}for(i=0,a=N.length;i<a;i++)s=N[i],isNaN(s)||r[i]!==s&&r[s]!==i&&(delete N[i],delete N[s])},F=function(e,t){var n,r;return k=e,L=t,r=Math.random()<.5?k:L,n=I(r),n||(n=I(k+L-r)),n},I=function(e){var t=m[b.element[e]],n,r,i,s,o,u,a,f,l;if(!t)return;q(),i=R(),n=b.excitation[e],r=t[n];for(f=n+1,l=t.length;f<l;f++){s=t[f]-r;if(i<s)break;o=f}return o?(o-=n,u=Math.ceil(Math.random()*o)+n,b.excitation[e]=u,a=t[u]-r,U(a),!0):!1},q=function(){D=b.x[L]-b.x[k],P=b.y[L]-b.y[k];var e=1/Math.sqrt(D*D+P*P);D*=e,P*=e,A=b.vx[k]*D+b.vy[k]*P,M=b.vy[k]*D-b.vx[k]*P,O=b.vx[L]*D+b.vy[L]*P,_=b.vy[L]*D-b.vx[L]*P},R=function(){var e=O-A;return.5*e*e*b.mass[k]*b.mass[L]/(b.mass[k]+b.mass[L])},U=function(e){var t=b.mass[k],n=b.mass[L],r=t*A*A+n*O*O-e,i=t*A+n*O,s=(i-Math.sqrt(n/t*(r*(t+n)-i*i)))/(t+n),o=(i+Math.sqrt(t/n*(r*(t+n)-i*i)))/(t+n);b.vx[k]=s*D-M*P,b.vy[k]=s*P+M*D,b.vx[L]=o*D-_*P,b.vy[L]=o*P+_*D},z=function(e,t){var n,r=b.excitation[e],i=b.excitation[t];return k=e,L=t,!r&&!i?!1:(r?i?n=Math.random()<.5?k:L:n=k:n=L,W(n),!0)},W=function(e){var t=m[b.element[e]],n=b.excitation[e],r=Math.floor(Math.random()*n),i=t[r]-t[n];b.excitation[e]=r,Math.random()<g?(q(),U(i)):$(e,i)},X=function(){var e=E.x.length,t;H++;if(H>e)return r.extendArrays(E,e+10),H-1;for(t=0;t<e;t++)if(!E.vx[t]&&!E.vy[t])return t},V=function(e){H--,E.x[e]=E.y[e]=E.vx[e]=E.vy[e]=E.angularFrequency[e]=0},$=function(e,t){var n=Math.random()*o,r=Math.cos(n),u=Math.sin(n),a=w.sigma[b.element[e]],f=b.x[e]+a*.51*r,l=b.y[e]+a*.51*u,c=s*r,h=s*u,p=t/i,d=X();E.x[d]=f,E.y[d]=l,E.vx[d]=c,E.vy[d]=h,E.angularFrequency[d]=p},J=function(e){var t,n,r,i;for(t=0,n=E.x.length;t<n;t++){if(!E.vx[t]&&!E.vy[t])continue;r=E.x[t]+=E.vx[t]*e,i=E.y[t]+=E.vy[t]*e,(r<y[0]||r>y[2]||i<y[1]||i>y[3])&&V(t)}},K=function(e){if(!m)return;for(var t=0,n=u.getNumberOfAtoms();t<n;t++)Q(t,e)},Q=function(e,t){if(b.excitation[e]===0)return;if(Math.random()>t*a)return;var n=Math.random(),r=Math.random(),i,s,o,u=b.excitation[e],f=1/u;for(o=0;o<u;o++)if(o*f<=n&&n<(o+1)*f&&g<r){i=m[b.element[e]],s=i[u]-i[o],b.excitation[e]=o,$(e,s);return}};return v={initialize:function(e){b=e.atoms,w=e.elements,x(),T(d.photons),B(d.photons)},performActionWithinIntegrationLoop:function(e,t){j(e),K(t),J(t)},getPhotons:function(){return E},getNumPhotons:function(){return H},getViewPhotons:function(){var e=0,t=this.getPhotons(),n,r,i;for(r=0,i=t.x.length;r<i;r++)if(t.vx[r]||t.vy[r])S[e]||(S[e]={idx:e}),n=S[e],n.x=t.x[r],n.y=t.y[r],n.vx=t.vx[r],n.vy=t.vy[r],n.angularFrequency=t.angularFrequency[r],e++;return S.length=this.getNumPhotons(),S},getElementEnergyLevels:function(){return m},getRadiationlessEmissionProbability:function(){return g},getState:function(){return[new t(E),{clone:function(){return{numPhotons:H}},restore:function(e){H=e.numPhotons}}]}},v}}),define("md2d/models/modeler",["require","common/console","common/performance","md2d/models/engine/md2d","md2d/models/metadata","common/lab-modeler-mixin","common/output-support","common/models/tick-history","cs!md2d/models/solvent","common/serialize","common/validator","md2d/models/aminoacids-props","cs!md2d/models/aminoacids-helper","md2d/models/engine/genetic-engine","md2d/models/engine/constants/units","md2d/models/unit-definitions/index","md2d/models/units-translation","md2d/models/performance-optimizer","md2d/models/atom-transition","underscore","md2d/models/engine/plugins/quantum-dynamics"],function(e){var t=e("common/console"),n=e("common/performance"),r=e("md2d/models/engine/md2d"),i=e("md2d/models/metadata"),s=e("common/lab-modeler-mixin"),o=e("common/output-support"),u=e("common/models/tick-history"),a=e("cs!md2d/models/solvent"),f=e("common/serialize"),l=e("common/validator"),c=e("md2d/models/aminoacids-props"),h=e("cs!md2d/models/aminoacids-helper"),p=e("md2d/models/engine/genetic-engine"),d=e("md2d/models/engine/constants/units"),v=e("md2d/models/unit-definitions/index"),m=e("md2d/models/units-translation"),g=e("md2d/models/performance-optimizer"),y=e("md2d/models/atom-transition"),b=e("underscore"),w=e("md2d/models/engine/plugins/quantum-dynamics");return function(E){function et(e){var t,n;S.startBatch();for(t=0,n=F.length;t<n;t++)F[t].process(e);t=0;while(t<F.length)F[t].isFinished?F.splice(t,1):t++;S.endBatch()}function tt(e,t){e=b.extend({},e);for(var n in e)e.hasOwnProperty(n)&&(e[n]=t(n,e[n]));return e}function nt(e,t){return N?tt(e,function(e,n){return N.translateToModelUnits(n,t[e]&&t[e].unitType)}):e}function rt(e,t){return N?tt(e,function(e,n){return N.translateFromModelUnits(n,t[e]&&t[e].unitType)}):e}function st(){I.computeOutputState(B),K=I.callPluginAccessor("getViewPhotons"),ot(B.atoms)}function ut(){var e=I.getNumberOfElements(),t=Math.floor(Math.random()*e);while(h.isAminoAcid(t))t=Math.floor(Math.random()*e);return t}function at(){var e,t,n,r;for(n=I.getNumberOfElements();n<=h.lastElementID;n++)S.addElement({id:n});for(n=0,r=c.length;n<r;n++)e=18*Math.pow(c[n].volume/c[0].volume,.3333333333333),t=d.convert(e/10,{from:d.unit.ANGSTROM,to:d.unit.NANOMETER}),I.setElementProperties(h.firstElementID+n,{mass:c[n].molWeight,sigma:t})}function ft(e){var t=e.minX,n=e.minY,r=e.maxX,i=e.maxY;e.minX=t!=null?t:0,e.maxX=r!=null?r:e.width,e.minY=n!=null?n:0,e.maxY=i!=null?i:e.height}function lt(e,t){I.setDimensions([e.minX,e.minY,e.maxX,e.maxY]),t.quantumDynamics?(e.useQuantumDynamics=!0,I.addPlugin(new w(I,t.quantumDynamics))):e.useQuantumDynamics=!1,U=I.elements,X=I.radialBonds,Q=I.radialBondResults,V=I.angularBonds,$=I.restraints,z=I.obstacles,W=I.rectangles}function ct(e){var t={};return e.length===0?{}:(Object.keys(e[0]).forEach(function(e){t[e]=[]}),e.forEach(function(e){Object.keys(e).forEach(function(n){t[n].push(e[n])})}),t)}function ht(){var e=S.getPhotons();return{photons:f(i.photon,ct(e),e.length),elementEnergyLevels:I.callPluginAccessor("getElementEnergyLevels"),radiationlessEmissionProbability:I.callPluginAccessor("getRadiationlessEmissionProbability")}}this.constructor.type="md2d";var S={},x={targetTemperature:function(e){I.setTargetTemperature(e)},temperatureControl:function(e){I.useThermostat(e)},lennardJonesForces:function(e){I.useLennardJonesInteraction(e)},coulombForces:function(e){I.useCoulombInteraction(e)},solventForceType:function(e){I.setSolventForceType(e)},DNAState:function(e){I.setDNAState(e)},solventForceFactor:function(e){I.setSolventForceFactor(e)},additionalSolventForceMult:function(e){I.setAdditionalSolventForceMult(e)},additionalSolventForceThreshold:function(e){I.setAdditionalSolventForceThreshold(e)},dielectricConstant:function(e){I.setDielectricConstant(e)},realisticDielectricEffect:function(e){I.setRealisticDielectricEffect(e)},VDWLinesCutoff:function(e){var t=O[e];t&&I.setVDWLinesRatio(t)},gravitationalField:function(e){I.setGravitationalField(e)},modelSampleRate:function(){S.isStopped()||S.restart()},viscosity:function(e){I.setViscosity(e)},polarAAEpsilon:function(e){var t,n,r,i,s,o;t=h.getPolarAminoAcids();for(i=0,o=t.length;i<o;i++){n=t[i];for(s=i+1;s<o;s++)r=t[s],I.pairwiseLJProperties.set(n,r,{epsilon:e})}}},T=v.get(E.unitsScheme||"md2d"),N=function(){var e=E.unitsScheme||"md2d";return e!=="md2d"?new m(T):undefined}(),C=new s({metadata:i,setters:x,unitsDefinition:T,unitsTranslation:N,initialProperties:E}),k=function(){var e=C.dispatchSupport;return e.addEventTypes("tick","willReset","addAtom","removeAtom","addRadialBond","removeRadialBond","removeAngularBond","invalidation","textBoxesChanged"),e}(),L=C.propertySupport,A,O={"short":1.33,medium:1.67,"long":2},M=1e3,D=!1,P,H=[],B=window.state={},j,F=[],I=function(){var e=r.createEngine();return e.pairwiseLJProperties.registerChangeHooks(L.invalidatingChangePreHook,L.invalidatingChangePostHook),e}(),q,R,U,z,W,X,V,$,J=[],K,Q,G=null,Y,Z,it=function(){var e=[{getNum:"getNumberOfAtoms",addEvent:"addAtom",removeEvent:"removeAtom"},{getNum:"getNumberOfRadialBonds",addEvent:"addRadialBond",removeEvent:"removeRadialBond"}];return function(t){var n,r,i;for(n=0;n<e.length;n++)r=e[n],r.num=I[r.getNum]();t();for(n=0;n<e.length;n++)r=e[n],i=I[r.getNum](),i>r.num?k[r.addEvent]():i<r.num&&k[r.removeEvent]()}}(),ot=function(){var e=function(){return h.isAminoAcid(this.element)};return function(t){var n=I.getNumberOfAtoms(),r,i,s,o;J.length=n;for(r=0,n;r<n;r++){J[r]||(J[r]={idx:r}),o=J[r];for(i in t)t.hasOwnProperty(i)&&(o[i]=t[i][r]);o.isAminoAcid=e,o.isAminoAcid()&&(s=h.getAminoAcidByElement(t.element[r]),o.symbol=s.symbol,o.label=s.abbreviation)}}}();return S.stepCounter=function(){return j.get("counter")},S.stepStartCounter=function(){return j.get("startCounter")},S.steps=function(){return j.get("length")},S.isNewStep=function(){return D},S.seek=function(e){return arguments.length||(e=0),S.isStopped()||S.stop(),D=!1,it(function(){j.seekExtract(e),st(),S.updateAllOutputProperties(),k.seek()}),j.get("counter")},S.stepBack=function(e){return arguments.length||(e=1),S.isStopped()||S.stop(),D=!1,it(function(){var t,n;t=-1;while(++t<e)n=j.get("index"),n>0&&(j.decrementExtract(),st(),S.updateAllOutputProperties(),k.stepBack())}),j.get("counter")},S.stepForward=function(e){return arguments.length||(e=1),S.isStopped()||S.stop(),it(function(){var t,n,r;t=-1;while(++t<e)n=j.get("index"),r=j.get("length"),n<r-1?(j.incrementExtract(),st(),S.updateAllOutputProperties(),k.stepForward()):S.tick()}),j.get("counter")},S.createElements=function(e){var t,n,r,i;S.startBatch();if(e===undefined){S.addElement({id:0}),S.endBatch();return}for(t=0,n=e.mass.length;t<n;t++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][t]);S.addElement(i)}return S.endBatch(),S},S.createAtoms=function(e){var t={suppressCheck:!0},n,r,i,s;k.willReset(),S.startBatch(),r=e.x.length;for(n=0;n<r;n++){s={};for(i in e)e.hasOwnProperty(i)&&(s[i]=e[i][n]);S.addAtom(s,t)}S.endBatch(),k.reset()},S.createRadialBonds=function(e){var t=e.strength.length,n,r,i;S.startBatch();for(n=0;n<t;n++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][n]);S.addRadialBond(i)}return S.endBatch(),S},S.createAngularBonds=function(e){var t=e.strength.length,n,r,i;S.startBatch();for(n=0;n<t;n++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][n]);S.addAngularBond(i)}return S.endBatch(),S},S.createRestraints=function(e){var t=e.atomIndex.length,n,r,i;for(n=0;n<t;n++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][n]);S.addRestraint(i)}return S},S.createObstacles=function(e){var t=e.x.length,n,r,i;for(n=0;n<t;n++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][n]);S.addObstacle(i)}return S},S.createRectangles=function(e){var t=e.x.length,n,r,i;for(n=0;n<t;n++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][n]);S.addRectangle(i)}return S},S.reset=function(){k.willReset(),L.invalidatingChangePreHook(),I.setTime(0),j.restoreInitialState(),L.invalidatingChangePostHook(),k.reset()},S.getTotalMass=function(){return I.getTotalMass()},S.getAtomKineticEnergy=function(e){return I.getAtomKineticEnergy(e)},S.addRandomAtom=function(e,t){e==null&&(e=ut()),t==null&&(t=0);var n=S.get("width"),r=S.get("height"),i=S.get("minX"),s=S.get("minY"),o=I.getRadiusOfElement(e),u,a,f,l=0,c=10;do{u=i+Math.random()*n-2*o,a=s+Math.random()*r-2*o,f=I.findMinimumPELocation(e,u,a,0,0,t);if(f&&S.addAtom({element:e,x:f[0],y:f[1],charge:t}))return!0}while(++l<c);return!1},S.addAtom=function(e,t){var n=S.get("minX"),r=S.get("minY"),s=S.get("maxX"),o=S.get("maxY"),u;return t=t||{},e=l.validateCompleteness(i.atom,e),u=I.getRadiusOfElement(e.element),e.x<n+u&&(e.x=n+u),e.x>s-u&&(e.x=s-u),e.y<r+u&&(e.y=r+u),e.y>o-u&&(e.y=o-u),!t.suppressCheck&&!I.canPlaceAtom(e.element,e.x,e.y)?!1:(t.deserialization||L.invalidatingChangePreHook(),I.addAtom(e),t.deserialization||L.invalidatingChangePostHook(),t.suppressEvent||k.addAtom(),!0)},S.removeAtom=function(e,t){var n=I.getNumberOfRadialBonds(),r=I.getNumberOfAngularBonds();t=t||{},L.invalidatingChangePreHook(),I.removeAtom(e),J.length=0,L.invalidatingChangePostHook(),t.suppressEvent||(k.removeAtom(),I.getNumberOfRadialBonds()!==n&&k.removeRadialBond(),I.getNumberOfAngularBonds()!==r&&k.removeAngularBond())},S.addElement=function(e){e=l.validateCompleteness(i.element,e),I.addElement(e)},S.addObstacle=function(e){var t;e.color!==undefined&&e.colorR===undefined&&(e.colorR=e.color[0],e.colorG=e.color[1],e.colorB=e.color[2]),t=l.validateCompleteness(i.obstacle,e),L.invalidatingChangePreHook(),I.addObstacle(t),L.invalidatingChangePostHook()},S.addRectangle=function(e){var t;t=l.validateCompleteness(i.rectangle,e),L.invalidatingChangePreHook(),I.addRectangle(t),L.invalidatingChangePostHook()},S.removeObstacle=function(e){L.invalidatingChangePreHook(),I.removeObstacle(e),L.invalidatingChangePostHook()},S.removeRectangle=function(e){L.invalidatingChangePreHook(),I.removeRectangle(e),L.invalidatingChangePostHook()},S.addRadialBond=function(e,t){e=l.validateCompleteness(i.radialBond,e),(!t||!t.deserialization)&&L.invalidatingChangePreHook(),I.addRadialBond(e),(!t||!t.deserialization)&&L.invalidatingChangePostHook(),k.addRadialBond()},S.removeRadialBond=function(e){L.invalidatingChangePreHook(),I.removeRadialBond(e),L.invalidatingChangePreHook(),k.removeRadialBond()},S.addAngularBond=function(e,t){e=l.validateCompleteness(i.angularBond,e),(!t||!t.deserialization)&&L.invalidatingChangePreHook(),I.addAngularBond(e),(!t||!t.deserialization)&&L.invalidatingChangePostHook()},S.removeAngularBond=function(e){L.invalidatingChangePreHook(),I.removeAngularBond(e),L.invalidatingChangePostHook(),k.removeAngularBond()},S.addRestraint=function(e){e=l.validateCompleteness(i.restraint,e),L.invalidatingChangePreHook(),I.addRestraint(e),L.invalidatingChangePostHook()},S.getMoleculeBoundingBox=function(e){var t=B.atoms,n,r,i,s,o,u=-Infinity,a=Infinity,f=Infinity,l=-Infinity,c,h;n=I.getMoleculeAtoms(e),n.push(e);for(r=0;r<n.length;r++)i=t.x[n[r]],s=t.y[n[r]],o=t.radius[n[r]],i-o<a&&(a=i-o),i+o>l&&(l=i+o),s-o<f&&(f=s-o),s+o>u&&(u=s+o);return c=t.x[e],h=t.y[e],{top:u-h,left:a-c,bottom:f-h,right:l-c}},S.setTemperatureOfAtoms=function(e,t){L.invalidatingChangePreHook(),I.setTemperatureOfAtoms(e,t),L.invalidatingChangePostHook()},S.getTemperatureOfAtoms=function(e){return I.getTemperatureOfAtoms(e)},S.setAtomProperties=function(e,t,n,r){var s=B.atoms,o,u,a,f,c,h,p;t=l.validate(i.atom,t);if(r){o=I.getMoleculeAtoms(e);if(o.length>0){u=typeof t.x=="number"?t.x-s.x[e]:0,a=typeof t.y=="number"?t.y-s.y[e]:0;for(h=0,p=o.length;h<p;h++){f=s.x[o[h]]+u,c=s.y[o[h]]+a;if(!S.setAtomProperties(o[h],{x:f,y:c},n,!1))return!1}}}if(n){var d=typeof t.x=="number"?t.x:s.x[e],v=typeof t.y=="number"?t.y:s.y[e],m=typeof t.element=="number"?t.y:s.element[e];if(!I.canPlaceAtom(m,d,v,e))return!1}return L.invalidatingChangePreHook(),I.setAtomProperties(e,nt(t,i.atom)),L.invalidatingChangePostHook(),!0},S.getAtomProperties=function(e){var t=B.atoms,n=i.atom,r={},s;for(s in n)n.hasOwnProperty(s)&&t[s]&&(r[s]=t[s][e]);return rt(r,n)},S.getRadialBondsForAtom=function(e){return I.getRadialBondsForAtom(e)},S.getAngularBondsForAtom=function(e){return I.getAngularBondsForAtom(e)},S.getMoleculeAtoms=function(e){return I.getMoleculeAtoms(e)},S.setElementProperties=function(e,t){t=l.validate(i.element,t);if(h.isAminoAcid(e))throw new Error("Elements: elements with ID "+e+" cannot be edited, as they define amino acids.");L.invalidatingChangePreHook(),I.setElementProperties(e,nt(t,i.element)),L.invalidatingChangePostHook()},S.getElementProperties=function(e){var t=i.element,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=U[r][e]);return rt(n,t)},S.setObstacleProperties=function(e,t){t=l.validate(i.obstacle,t),L.invalidatingChangePreHook(),I.setObstacleProperties(e,nt(t,i.obstacle)),L.invalidatingChangePostHook()},S.getObstacleProperties=function(e){var t=i.obstacle,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=z[r][e]);return rt(n,t)},S.setRectangleProperties=function(e,t){t=l.validate(i.rectangle,t),L.invalidatingChangePreHook(),I.setRectangleProperties(e,nt(t,i.rectangle)),L.invalidatingChangePostHook()},S.getRectangleProperties=function(e){var t=i.rectangle,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=W[r][e]);return rt(n,t)},S.setRadialBondProperties=function(e,t){t=l.validate(i.radialBond,t),L.invalidatingChangePreHook(),I.setRadialBondProperties(e,nt(t,i.radialBond)),L.invalidatingChangePostHook()},S.getRadialBondProperties=function(e){var t=i.radialBond,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=X[r][e]);return rt(n,t)},S.setRestraintProperties=function(e,t){t=l.validate(i.restraint,t),L.invalidatingChangePreHook(),I.setRestraintProperties(e,nt(t,i.restraint)),L.invalidatingChangePostHook()},S.getRestraintProperties=function(e){var t=i.restraint,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=$[r][e]);return rt(n,t)},S.setAngularBondProperties=function(e,t){t=l.validate(i.angularBond,t),L.invalidatingChangePreHook(),I.setAngularBondProperties(e,nt(t,i.angularBond)),L.invalidatingChangePostHook()},S.getAngularBondProperties=function(e){var t=i.angularBond,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=V[r][e]);return rt(n,t)},S.setSolvent=function(e){var t=new a(e),n={solventForceType:t.forceType,dielectricConstant:t.dielectricConstant,backgroundColor:t.color};S.set(n)},S.addSpringForce=function(e,t,n,r){return r==null&&(r=500),N&&(r=N.translateToModelUnits(r,"stiffness")),I.addSpringForce(e,t,n,r)},S.updateSpringForce=function(e,t,n){I.updateSpringForce(e,t,n)},S.removeSpringForce=function(e){I.removeSpringForce(e)},S.addTextBox=function(e){e=l.validateCompleteness(i.textBox,e),S.get("textBoxes").push(e),k.textBoxesChanged()},S.removeTextBox=function(e){var t=S.get("textBoxes");if(!(e>=0&&e<t.length))throw new Error('Text box "'+e+'" does not exist, so it cannot be removed.');S.set("textBoxes",t.slice(0,e).concat(t.slice(e+1))),k.textBoxesChanged()},S.setTextBoxProperties=function(e,t){var n=S.get("textBoxes")[e],r;if(!n)throw new Error('Text box "'+e+'" does not exist, so it cannot have properties set.');t=l.validate(i.textBox,t);for(r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);k.textBoxesChanged()},S.liveDragStart=function(e,t,n){if(G!=null)return;t==null&&(t=B.atoms.x[e]),n==null&&(n=B.atoms.y[e]),Y=S.getAtomProperties(e).friction,S.setAtomProperties(e,{friction:S.LIVE_DRAG_FRICTION}),G=S.addSpringForce(e,t,n,500)},S.liveDrag=function(e,t){S.updateSpringForce(G,e,t)},S.liveDragEnd=function(){var e=I.springForceAtomIndex(G);S.setAtomProperties(e,{friction:Y}),S.removeSpringForce(G),G=null},S.getFPS=function(){var e=0,t=H.length,n=-1;while(++n<t)e+=H[n];return e/=t,e?1/e*1e3:0},S.getSimulationProgressRate=function(){return S.getFPS()*S.get("timeStep")*S.get("timeStepsPerTick")},S.get_elements=function(){return U},S.getAtoms=function(){return J},S.getPhotons=function(){return K},S.get_radial_bond_results=function(){return Q},S.getNumberOfAtoms=function(e){return e?J.reduce(function(t,n){return e(n)?t+1:t},0):J.length},S.get_obstacles=function(){return z},S.get_rectangles=function(){return W},S.get_rectangles=function(){return W},S.getNumberOfElements=function(){return I.getNumberOfElements()},S.getNumberOfObstacles=function(){return I.getNumberOfObstacles()},S.getNumberOfRectangles=function(){return I.getNumberOfRectangles()},S.getNumberOfRadialBonds=function(){return I.getNumberOfRadialBonds()},S.getNumberOfAngularBonds=function(){return I.getNumberOfAngularBonds()},S.getNumberOfSpringForces=function(){return I.getNumberOfSpringForces()},S.get_radial_bonds=function(){return X},S.get_restraints=function(){return $},S.getPairwiseLJProperties=function(){return I.pairwiseLJProperties},S.geneticEngine=function(){return q},S.get_vdw_pairs=function(){return I.getVdwPairsArray()},S.tickInPlace=function(){return k.tick(),S},S.tick=function(e){var r=S.get("timeStep"),i=I.getNumberOfRadialBonds(),s,o;N&&(r=N.translateToModelUnits(r,"time")),S.isStopped()||(s=n.now(),P?(o=s-P,P=s,H.push(o),H.splice(0,H.length-64),et(o)):P=s),t.time("integration"),I.integrate(S.get("timeStepsPerTick")*r,r),t.timeEnd("integration"),t.time("reading model state"),st(),S.updateAllOutputProperties(),t.timeEnd("reading model state"),t.time("tick history push"),j.push(),t.timeEnd("tick history push"),D=!0,i<I.getNumberOfRadialBonds()&&k.addRadialBond(),k.tick()},S.minimizeEnergy=function(){return L.invalidatingChangePreHook(),I.minimizeEnergy(),L.invalidatingChangePostHook
(),k.tick(),S},S.dimensions=function(){return I.getDimensions()},S.format=function(e,t){t=t||{};var n=S.getPropertyDescription(e);return n?n.format(S.get(e),t):d3.format(t.format||"g")(S.get(e))},S.getUnitDefinition=function(e){return T.units[e]},S.atomTransition=function(){var e=new y(S);return F.push(e),e},S.cancelTransitions=function(){F.length=0},S.startBatch=function(){L.startBatch(),k.startBatch()},S.endBatch=function(){L.endBatch(),k.endBatch()},S.batch=function(e){S.startBatch(),e(),S.endBatch()},S.serialize=function(){var e={},t,n,r,s=L.rawValues,o=function(t,n){e.atoms[t].every(function(e){return e===n})&&delete e.atoms[t]};e=f(i.mainProperties,s),e.viewOptions=f(i.viewOptions,s),e.atoms=f(i.atom,B.atoms,I.getNumberOfAtoms()),I.getNumberOfRadialBonds()&&(e.radialBonds=f(i.radialBond,X,I.getNumberOfRadialBonds())),I.getNumberOfAngularBonds()&&(e.angularBonds=f(i.angularBond,V,I.getNumberOfAngularBonds()));if(I.getNumberOfObstacles()){e.obstacles=f(i.obstacle,z,I.getNumberOfObstacles()),e.obstacles.color=[];for(n=0,r=e.obstacles.colorR.length;n<r;n++)e.obstacles.color.push([e.obstacles.colorR[n],e.obstacles.colorG[n],e.obstacles.colorB[n]]),e.obstacles.westProbe[n]=Boolean(e.obstacles.westProbe[n]),e.obstacles.northProbe[n]=Boolean(e.obstacles.northProbe[n]),e.obstacles.eastProbe[n]=Boolean(e.obstacles.eastProbe[n]),e.obstacles.southProbe[n]=Boolean(e.obstacles.southProbe[n]);delete e.obstacles.colorR,delete e.obstacles.colorG,delete e.obstacles.colorB}if(I.getNumberOfRectangles()){e.rectangles=f(i.rectangle,W,I.getNumberOfRectangles()),e.rectangles.color=[],e.rectangles.lineColor=[];for(n=0,r=e.rectangles.colorR.length;n<r;n++)e.rectangles.color.push([e.rectangles.colorR[n],e.rectangles.colorG[n],e.rectangles.colorB[n]]),e.rectangles.lineColor.push([e.rectangles.lineColorR[n],e.rectangles.lineColorG[n],e.rectangles.lineColorB[n]]);delete e.rectangles.colorR,delete e.rectangles.colorG,delete e.rectangles.colorB,delete e.rectangles.lineColorR,delete e.rectangles.lineColorR,delete e.rectangles.lineColorR}I.getNumberOfRestraints()>0&&(e.restraints=f(i.restraint,$,I.getNumberOfRestraints())),e.elements=f(i.element,U,5),e.pairwiseLJProperties=[],t=I.pairwiseLJProperties.serialize();for(n=0,r=t.length;n<r;n++)t[n].element1<=5&&t[n].element2<=5&&e.pairwiseLJProperties.push(t[n]);return e.temperatureControl===!1&&delete e.targetTemperature,e.viewOptions.showAtomTrace===!1&&delete e.viewOptions.atomTraceId,e.modelSampleRate==="default"&&delete e.modelSampleRate,S.properties.useQuantumDynamics&&(e.quantumDynamics=ht()),o("marked",i.atom.marked.defaultValue),o("visible",i.atom.visible.defaultValue),o("draggable",i.atom.draggable.defaultValue),e},S.LIVE_DRAG_FRICTION=10,E.DNA&&(E.width=200,E.height=5,E.viewOptions=E.viewOptions||{},E.viewOptions.viewPortX=0,E.viewOptions.viewPortY=0,E.viewOptions.viewPortWidth=5,E.viewOptions.viewPortHeight=3),function(){if(!E.viewOptions||!E.viewOptions.textBoxes)return;var e=E.viewOptions.textBoxes,t,n;for(t=0,n=e.length;t<n;t++)e[t]=l.validateCompleteness(i.textBox,e[t])}(),Z={quantumDynamics:E.quantumDynamics},R=E.elements,S.createElements(R),at(),C.mixInto(S),L.on("afterInvalidatingChange.read-model-state",st),L.on("afterInvalidatingChangeSequence.tick-history",function(){j&&j.invalidateFollowingState(),k.invalidation()}),ft(S.properties),lt(S.properties,Z),q=new p(S),S.set({polarAAEpsilon:S.get("polarAAEpsilon")}),E.atoms&&S.createAtoms(E.atoms),E.radialBonds&&S.createRadialBonds(E.radialBonds),E.angularBonds&&S.createAngularBonds(E.angularBonds),E.restraints&&S.createRestraints(E.restraints),E.obstacles&&S.createObstacles(E.obstacles),E.rectangles&&S.createRectangles(E.rectangles),E.pairwiseLJProperties&&I.pairwiseLJProperties.deserialize(E.pairwiseLJProperties),j=new u({getProperties:function(){return L.historyStateRawValues},restoreProperties:L.setRawValues,state:I.getState()},S,M),A=new o({propertySupport:L,unitsDefinition:T,tickHistory:j}),A.mixInto(S),D=!0,S.defineOutput("time",{label:"Time",unitType:"time",format:"f"},function(){var e=B.time;return N&&(e=N.translateFromModelUnits(e,"time")),e}),S.defineOutput("timePerTick",{label:"Model time per tick",unitType:"time",format:"f"},function(){return S.get("timeStep")*S.get("timeStepsPerTick")}),function(){var e;T.units.time.displayValue?e=T.units.time.displayValue:(e=b.extend({},T.units.time),e.unitsPerBaseUnit=1),S.defineOutput("displayTime",{label:"Time",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".1f"},function(){return S.get("time")*e.unitsPerBaseUnit}),S.defineOutput("displayTimePerTick",{label:"Model time per tick",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".3f"},function(){return S.get("timePerTick")*e.unitsPerBaseUnit})}(),S.defineOutput("tickCounter",{label:"Tick Counter",unitType:"",format:"4g"},function(){return j.get("counter")}),S.defineOutput("newStep",{label:"New Step",unitType:"",format:""},function(){return D}),S.defineOutput("kineticEnergy",{label:"Kinetic Energy",unitType:"energy",format:".4g"},function(){var e=B.KE;return N&&(e=N.translateFromModelUnits(e,"energy")),e}),S.defineOutput("potentialEnergy",{label:"Potential Energy",unitType:"energy",format:".4g"},function(){var e=B.PE;return N&&(e=N.translateFromModelUnits(e,"energy")),e}),S.defineOutput("totalEnergy",{label:"Total Energy",unitType:"energy",format:".4g"},function(){var e=B.KE+B.PE;return N&&(e=N.translateFromModelUnits(e,"energy")),e}),S.defineOutput("temperature",{label:"Temperature",unitType:"temperature",format:"f"},function(){var e=B.temperature;return N&&(e=N.translateFromModelUnits(e,"temperature")),e}),st(),S.updateAllOutputProperties(),S.performanceOptimizer=new g(S),S}}),define("common/views/tab-index",[],function(){var e=0;return function(){return e++}}),define("common/views/svg-container",["require","common/performance","common/views/tab-index","common/console"],function(e){var t=e("common/performance"),n=e("common/views/tab-index"),r=e("common/console");return function(i,s,o,u){function P(){return parseFloat(l.css("font-size"))||18}function H(){p=P(),h=p/18,w={top:0*h,right:0*h,bottom:0*h,left:0*h};if(i.get("xunits")||i.get("yunits"))w.bottom+=p*1.2,w.left+=p*1.3,w.top+=p/2,w.right+=p/2;if(i.get("xlabel")||i.get("ylabel"))w.bottom+=p*.8,w.left+=p*.8}function B(){var e=i.get("viewPortWidth"),t=i.get("viewPortHeight"),n=i.get("viewPortZoom")||1,r=i.get("viewPortX"),s=i.get("viewPortY"),o,u,a;S={minX:i.get("minX"),minY:i.get("minY"),maxX:i.get("maxX"),maxY:i.get("maxY")},x={width:e!=null?e:S.maxX-S.minX,height:t!=null?t:S.maxY-S.minY,x:r!=null?r:S.minX,y:s!=null?s:S.minY},x.scaledWidth=x.width/n,x.scaledHeight=x.height/n,f==="bottom-left"&&(x.y+=x.scaledHeight),o=x.width/x.height,H(),y=l.width(),u=y-w.left-w.right,a=u/o,b=a+w.top+w.bottom,c.style.height=b+"px",E={width:y-w.left-w.right,height:b-w.top-w.bottom},E={width:u,height:a},D=c.offsetTop+w.top,_=c.offsetLeft+w.left,T.domain([0,x.width]).range([0,E.width]),N.domain([x.height,0]).range(f==="bottom-left"?[0,E.height]:[E.height,0]),A&&A.x(T).y(N)}function j(){var e=d3.scale.linear().domain([x.x,x.x+x.scaledWidth]).range([0,E.width]),t=d3.scale.linear().domain([x.y,x.y-x.scaledHeight]).range([0,E.height]),n=function(t){return"translate("+e(t)+",0)"},r=function(e){return"translate(0,"+t(e)+")"},s=function(e){return e?"#ccc":"#666"},o=e.tickFormat(5),u=t.tickFormat(5),a=i.getUnitDefinition?i.getUnitDefinition("length"):"",f,l;d3.event&&d3.event.transform&&d3.event.transform(e,t);var c=C.selectAll("g.x").data(e.ticks(5),String).attr("transform",n).classed("axes",!0);c.select("text").text(o);var h=c.enter().insert("g","a").attr("class","x").attr("transform",n);i.get("gridLines")?h.append("line").attr("stroke",s).attr("y1",0).attr("y2",E.height):h.selectAll("line").remove(),i.get("xunits")?h.append("text").attr("class","xunits").attr("y",E.height).attr("dy",p*.8+"px").attr("text-anchor","middle").text(o):h.select("text.xunits").remove(),c.exit().remove(),f=v.selectAll("text.xlabel").data(i.get("xlabel")?[a.pluralName]:[]),f.enter().append("text").attr("class","axis").attr("class","xlabel").attr("x",E.width/2).attr("y",E.height).attr("dy",p*1.6+"px").style("text-anchor","middle"),f.text(String),f.exit().remove();var d=C.selectAll("g.y").data(t.ticks(5),String).attr("transform",r).classed("axes",!0);d.select("text").text(u);var m=d.enter().insert("g","a").attr("class","y").attr("transform",r).attr("background-fill","#FFEEB6");i.get("gridLines")?m.append("line").attr("stroke",s).attr("x1",0).attr("x2",E.width):m.selectAll("line").remove(),i.get("yunits")?m.append("text").attr("class","yunits").attr("x","-0.3em").attr("dy",p/6+"px").attr("text-anchor","end").text(u):h.select("text.yunits").remove(),d.exit().remove(),l=v.selectAll("text.ylabel").data(i.get("ylabel")?[a.pluralName]:[]),l.enter().append("text").attr("class","axis").attr("class","ylabel").style("text-anchor","middle").attr("transform","translate("+ -p*1.6+" "+E.height/2+") rotate(-90)"),l.text(String),l.exit().remove()}function F(){m.attr("fill",i.get("backgroundColor")||"rgba(0, 0, 0, 0)")}function I(){q()}function q(){i.get("enableKeyboardHandlers")&&c.focus()}function R(){var e;B(),v===undefined?(d=d3.select(c).append("svg").attr({xmlns:"http://www.w3.org/2000/svg","xmlns:xmlns:xlink":"http://www.w3.org/1999/xlink",overflow:"hidden"}),v=d.append("g").attr("class","particle-container-vis"),m=v.append("rect").attr("class","plot"),i.get("enableKeyboardHandlers")&&d3.select(c).attr("tabindex",0).on("mousedown",I),C=v.append("g").attr("class","grid-container"),g=v.append("svg").attr("class","viewport"),k=v.append("g").attr("class","brush-container")):(v.selectAll("g.x").remove(),v.selectAll("g.y").remove()),d.attr({width:y,height:b}).style({width:y+"px",height:b+"px"}),e=T(x.x)+" "+N(x.y)+" "+T(x.scaledWidth)+" "+T(x.scaledHeight),g.attr({viewBox:e,x:0,y:0,width:T(x.width),height:T(x.height)}),v.attr("transform","translate("+w.left+","+w.top+")"),v.select("rect.plot").attr({width:T(x.width),height:T(x.height),x:0,y:0}),j()}function U(){function h(){e.push(i.properties.viewPortX),n.push(i.properties.viewPortY),r.push(t.now()),e.length>s&&(e.shift(),n.shift(),r.shift())}function p(){if(o)return!0;var e=t.now(),n=e-l,r=-0.003*a,s=-0.003*f;return i.properties.viewPortX+=a*n+.5*r*n*n,i.properties.viewPortY+=f*n+.5*s*n*n,O.viewportDrag(),a+=r*n,f+=s*n,l=e,Math.abs(a)<1e-5&&Math.abs(f)<1e-5?!0:!1}var e=[],n=[],r=[],s=8,o=!1,u=i.properties.viewPortDrag||!1,a,f,l,c;if(u===!1){d.on("mousedown.drag",null).on("touchstart.drag",null).classed("draggable",!1);return}c=d3.behavior.drag(),c.on("dragstart",function(){o=!0,e.length=0,n.length=0,r.length=0,h()}).on("drag",function(){var e=u==="y"?0:T.invert(d3.event.dx),t=u==="x"?0:T.invert(d3.event.dy);i.properties.viewPortX-=e,i.properties.viewPortY+=t,O.viewportDrag(),h()}).on("dragend",function(){h();var t=e.length-1,i=r[t]-r[0];if(i<1e-5)return;if(r[t]-r[t-1]>100)return;a=(e[t]-e[0])/i,f=(n[t]-n[0])/i,l=r[t],o=!1,d3.timer(p)}),d.call(c).classed("draggable",!0)}function z(){var e;for(e in L)L.hasOwnProperty(e)&&v.selectAll(e).on("click.custom",null)}function W(){R(),U(),L={},i.addPropertiesListener(["backgroundColor"],a.repaint),i.addPropertiesListener(["gridLines","xunits","yunits","xlabel","ylabel","viewPortX","viewPortY","viewPortZoom"],R),i.addPropertiesListener(["viewPortDrag"],U)}var a,f=u&&u.origin||"bottom-left",l,c,h,p,d,v,m,g,y,b,w,E,S,x,T=d3.scale.linear(),N=d3.scale.linear(),C,k,L,A,O=d3.dispatch("viewportDrag"),M,_,D;return a={get $el(){return l},get node(){return c},get svg(){return d},get vis(){return v},get viewport(){return g},get model2px(){return T},get model2pxInv(){return N},get setFocus(){return q},get getFontSizeInPixels(){return P},get url(){return s},repaint:function(){F(),a.updateClickHandlers(),M.repaint&&M.repaint()},resize:function(){R(),a.repaint(),A&&k.select("g.select-area").call(A),M.resize&&M.resize()},setup:function(){M.setup&&M.setup()},update:function(){M.update&&M.update()},getHeightForWidth:function(e){var t=x.width/x.height;return e=e-w.left-w.right,e/t+w.top+w.bottom},bindModel:function(e,t){s=t||s,i=e||i,z(),a.setSelectHandler(null),W(),M.bindModel&&M.bindModel(e,t),a.repaint()},pos:function(){var e={bottom:0,top:0,height:0,left:0,right:0,width:0};return l&&(e.top=l.position().top,e.left=l.position().left,e.width=l.width(),e.height=l.height(),e.bottom=e.top+e.height,e.right=e.left+e.width),e},on:function(e,t){O.on(e,t)},setClickHandler:function(e,t){if(typeof t!="function")throw new Error("Click handler should be a function.");L[e]=t,a.updateClickHandlers()},updateClickHandlers:function(){function t(e){return function(t,n){var i=d3.mouse(m.node()),s=T.invert(i[0]),o=N.invert(i[1]);r.log("[view] click at ("+s.toFixed(3)+", "+o.toFixed(3)+")"),e(s,o,t,n)}}var e;for(e in L)L.hasOwnProperty(e)&&v.selectAll(e).on("click.custom",t(L[e]))},setSelectHandler:function(e){if(typeof e!="function"&&e!==null)throw new Error("Select handler should be a function or null.");k.select("g.select-area").remove();if(e===null){A=null;return}A=d3.svg.brush().x(T).y(N).on("brushend.select",function(){var t=A.extent(),n=t[0][0],i=t[0][1],s=t[1][0]-n,o=t[1][1]-i;r.log("[view] selection area ("+n.toFixed(3)+", "+i.toFixed(3)+"), width: "+s+", height: "+o),e(n,i,s,o),A.clear(),k.call(A)}),k.append("g").classed("select-area",!0).call(A)}},l=$("<div>").attr({id:"model-container","class":"container",tabindex:n}).css({width:"50px",height:"50px"}),c=l[0],W(),M=new o(a),M.bindModel(i),a}}),define("common/benchmark/benchmark",[],function(){function i(){var e=/ (Chrome)\/(.*?) /,n=/ (Firefox)\/([0123456789ab.]+)/,r=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,i=/ (MSIE) ([0123456789.]+);/,o=/^(Opera)\/.+? Version\/([0123456789.]+)$/,u=/.+?\((iPhone); CPU.+?OS .+?Version\/([0123456789._]+)/,a=/.+?\((iPad); CPU.+?OS .+?Version\/([0123456789._]+)/,f=/.+?\((iPod); CPU (iPhone.+?) like.+?Version\/([0123456789ab._]+)/,l=/.+?(Android) ([0123456789.]+).*?; (.+?)\).+? Chrome\/([0123456789.]+)/,c=/.+?(Android.+?\)).+? Firefox\/([0123456789.]+)/,h=/.+?(Android) ([0123456789ab.]+).*?; (.+?)\)/,p;p=navigator.userAgent.match(e);if(p&&p[1])return{browser:p[1],version:p[2],oscpu:s()};p=navigator.userAgent.match(n);if(p&&p[1]){var d=navigator.buildID,v="";return d&&d.length>=8&&(v="("+d.slice(0,4)+"-"+d.slice(4,6)+"-"+d.slice(6,8)+")"),{browser:p[1],version:p[2]+" "+v,oscpu:s()}}p=navigator.userAgent.match(l);if(p&&p[1])return{browser:"Chrome",version:p[4],oscpu:p[1]+"/"+p[2]+"/"+p[3]};p=navigator.userAgent.match(c);if(p&&p[1])return{browser:"Firefox",version:p[2],oscpu:p[1]};p=navigator.userAgent.match(h);if(p&&p[1])return{browser:"Android",version:p[2],oscpu:p[1]+"/"+p[2]+"/"+p[3]};p=navigator.userAgent.match(r);if(p&&p[3])return{browser:p[3],version:p[2]+"/"+p[1],oscpu:s()};p=navigator.userAgent.match(i);if(p&&p[1]){var m=navigator.userAgent.match(/\(.*?(Windows.+?); (.+?)[;)].*/);return{browser:p[1],version:p[2],oscpu:t[m[1]]+"/"+navigator.cpuClass+"/"+navigator.platform}}return p=navigator.userAgent.match(o),p&&p[1]?{browser:p[1],version:p[2],oscpu:s()}:(p=navigator.userAgent.match(u),p&&p[1]?{browser:"Mobile Safari",version:p[2],oscpu:p[1]+"/"+"iOS"+"/"+p[2]}:(p=navigator.userAgent.match(a),p&&p[1]?{browser:"Mobile Safari",version:p[2],oscpu:p[1]+"/"+"iOS"+"/"+p[2]}:(p=navigator.userAgent.match(f),p&&p[1]?{browser:"Mobile Safari",version:p[3],oscpu:p[1]+"/"+"iOS"+"/"+p[2]}:{browser:"",version:navigator.appVersion,oscpu:""})))}function s(){var e=navigator.userAgent.match(/\((.+?)[;)] (.+?)[;)].*/);if(!e)return"na";if(e[1]==="Macintosh")return e[2];if(e[1].match(/^Windows/)){var r=n[e[2]]||"32",i=navigator.userAgent.match(/\(.*?(Windows NT.+?)[;)]/);return t[i[1]]+"/"+r}}function o(e,t,n){function p(t){var n=e.getElementsByTagName("tr")[0],r=n.appendChild(document.createElement("th"));r.innerHTML=t,a[t]=u++}function d(t){t=t||0;var n=e.appendChild(document.createElement("tr")),r;for(r=0;r<t;r++)n.appendChild(document.createElement("td"));return n}function v(e,t,n){var r;n=n||s,r=n.getElementsByTagName("td")[a[e]],typeof t=="string"&&t.slice(0,1)==="<"?r.innerHTML=t:r.textContent=t}function m(){function m(e){return Math.floor(e)===e}var e,n,i,s,o=h.length,u,f,l=r.getElementsByTagName("td"),c,p,d=d3.format("5.1f"),v=d3.format("f");for(e=0;e<t.length;e++){i=t[e],f=a[i.name];if(i.numeric===!1)s=h[2],u=s.getElementsByTagName("td")[f],l[f].innerHTML=u.innerHTML;else{c=0;for(n=2;n<o;n++)s=h[n],u=s.getElementsByTagName("td")[f],c+=+u.textContent;p=c/(o-2),i.formatter?p=i.formatter(p):m(p)?p=v(c/(o-2)):p=d(c/(o-2)),l[f].textContent=p}}}var i=0,s,o,u=0,a={},f,l,c,h=e.getElementsByTagName("tr");e.style.display="";if(h.length===0){d(),p("browser"),p("version"),p("cpu/os"),p("date");for(i=0;i<t.length;i++)p(t[i].name);r=d(u),r.className="average"}else{f=h[0],l=f.getElementsByTagName("th");for(i=0,c=l.length;i<c;i++)a[l[i].innerHTML]=u++}s=d(u),s.className="sample";for(i=0;i<4;i++)o=n[i],v(o[0],o[1]),v(o[0],o[1],r);for(i=4;i<n.length;i++)o=n[i],v(o[0],o[1]);m()}function u(e,t,n,r){function f(e){function n(n){e.formatter?o.push([e.name,e.formatter(n)]):o.push([e.name,n]),s.length>0?f(s.shift()):(r&&r(),t&&t(o))}e.run(n)}var s=e.slice(),o=[],u=i(),a=d3.time.format("%Y-%m-%d %H:%M");return o.push(["browser",u.browser]),o.push(["version",u.version]),o.push(["cpu/os",u.oscpu]),o.push(["date",a(new Date)]),n&&n(),f(s.shift()),o}function a(e,t,n,r,i){var s;return u(e,function(r){o(t,e,r),n(r)},r,i),s}var e="0.0.1",t={"Windows NT 6.2":"Windows 8","Windows NT 6.1":"Windows 7","Windows NT 6.0":"Windows Vista","Windows NT 5.2":"Windows Server 2003; Windows XP x64 Edition","Windows NT 5.1":"Windows XP","Windows NT 5.01":"Windows 2000, Service Pack 1 (SP1)","Windows NT 5.0":"Windows 2000","Windows NT 4.0":"Microsoft Windows NT 4.0"},n={WOW64:"64/32","Win64; IA64":"64","Win64; x64":"64"},r;return{version:e,what_browser:function(){return i()},run:function(e,t,n,r,i){a(e,t,n,r,i)},bench:function(e,t,n,r){return u(e,t,n,r)},renderToTable:function(e,t,n){o(e,t,n)}}}),function(){define("cs!md2d/views/aminoacid-context-menu",["require","cs!md2d/models/aminoacids-helper"],function(e){var t,n,r,i,s,o,u,a,f,l;return f=e("cs!md2d/models/aminoacids-helper"),o="aminoacids-menu",i="hydrophobic",r="hydrophobic-category",n="hydrophilic",t="hydrophilic-category",a="pos-charge",u="neg-charge",s="marked",l=function(e,s){var o;return o={show:s?"slideDown":"show",hide:s?"slideUp":"hide"},e==="hydrophobic"?($("."+i)[o.show](),$("."+n)[o.hide](),$("."+r).addClass("expanded"),$("."+t).removeClass("expanded")):($("."+i)[o.hide](),$("."+n)[o.show](),$("."+r).removeClass("expanded"),$("."+t).addClass("expanded"))},{register:function(e,c,h){return $.contextMenu("destroy",h),$.contextMenu({selector:h,appendTo:"#responsive-content",className:o,animation:{show:"show",hide:"hide"},callback:function(t,n){var r,i,o;return o=d3.select(n.$trigger[0]).datum(),i=f.getAminoAcidByElement(o.element).abbreviation,n.items[i].$node.removeClass(s),r=f.abbrToElement(t),e.setAtomProperties(o.idx,{element:r}),c.repaint()},position:function(e,t,n){var r,i,s,o,u,a,f;r=$(window);if(!t&&!n){e.determinePosition.call(this,e.$menu);return}return t==="maintain"&&n==="maintain"?o=e.$menu.position():(a=e.$trigger.parents().andSelf().filter(function(){return $(this).css("position")==="fixed"}).length,a&&(n-=r.scrollTop(),t-=r.scrollLeft()),o={top:n,left:t}),i=r.scrollTop()+r.height(),u=r.scrollLeft()+r.width(),s=e.$menu[0].scrollHeight,f=e.$menu[0].scrollWidth,o.top+s>i&&(o.top-=s),o.left+f>u&&(o.left-=f),o.left+=1,e.$menu.css(o)},events:{show:function(e){var t,n,r;return r=d3.select(e.$trigger[0]).datum(),n=f.getAminoAcidByElement(r.element).abbreviation,t=e.items[n].$node,t.addClass(s),t.hasClass(i)?l("hydrophobic"):l("hydrophilic"),!0},hide:function(e){var t,n;return n=d3.select(e.$trigger[0]).datum(),t=f.getAminoAcidByElement(n.element).abbreviation,e.items[t].$node.removeClass(s),!0}},items:{Hydrophobic:{name:"Hydrophobic",className:""+r,callback:function(){return l("hydrophobic",!0),!1}},Gly:{name:"Glycine",className:""+i},Ala:{name:"Alanine",className:""+i},Val:{name:"Valine",className:""+i},Leu:{name:"Leucine",className:""+i},Ile:{name:"Isoleucine",className:""+i},Phe:{name:"Phenylalanine",className:""+i},Pro:{name:"Proline",className:""+i},Trp:{name:"Tryptophan",className:""+i},Met:{name:"Methionine",className:""+i},Cys:{name:"Cysteine",className:""+i},Tyr:{name:"Tyrosine",className:""+i},Hydrophilic:{name:"Hydrophilic",className:""+t,callback:function(){return l("hydrophilic",!0),!1}},Asn:{name:"Asparagine",className:""+n},Gln:{name:"Glutamine",className:""+n},Ser:{name:"Serine",className:""+n},Thr:{name:"Threonine",className:""+n},Asp:{name:"Asparticacid",className:""+n+" "+u},Glu:{name:"Glutamicacid",className:""+n+" "+u},Lys:{name:"Lysine",className:""+n+" "+a},Arg:{name:"Arginine",className:""+n+" "+a},His:{name:"Histidine",className:""+n+" "+a}}}),l("hydrophobic")}}})}.call(this),define("md2d/views/genetic-elements-renderer",["require","md2d/views/nucleotides"],function(e){function o(e){var t=e.select("defs");return t.empty()&&(t=e.append("defs")),t}function u(e){var t=o(e),n;t.select("#transcription-bg").empty()&&(n=t.append("linearGradient").attr("id","transcription-bg").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),n.append("stop").attr("stop-color","#C8DD69").attr("offset","0%"),n.append("stop").attr("stop-color","#778B3D").attr("offset","100%"))}function a(e,n,s,o){function a(e){return"scale("+e.scale+")"}function f(e){return e.opacity}function l(e){var t=e.translateX||0,r=e.translateY||0;return"translate("+n(t)+" "+s(r)+")"}function c(e){return l(e)+" "+a(e)}function h(e){var n=e?o.geneticEngine().PRECODING_LEN:0,r=Math.floor(o.properties.viewPortX/t.WIDTH)-2,i=Math.ceil((o.properties.viewPortX+o.properties.viewPortWidth)/t.WIDTH)+4;return[Math.max(0,r+n),i+n]}return{cells:function(e,t){var s=e.select(".background-layer").selectAll(".cells").data(t.cells);s.enter().append("image").attr({"class":"cells",x:n(r.CELLS*-0.567),y:n(i.CELLS*-0.445),width:n(r.CELLS),height:n(i.CELLS),preserveAspectRatio:"none","xlink:href":"resources/dna/Cells.svg",transform:c}).style("opacity",f),d3.transition(s).attr("transform",c).style("opacity",f),d3.transition(s.exit()).remove()},dna1:function(e,t){var s=e.select(".dna-layer").selectAll(".dna1").data(t.dna1);s.enter().append("image").attr({"class":"dna1",x:n(r.DNA1*-0.5),y:n(i.DNA1*-0.5),width:n(r.DNA1),height:n(i.DNA1),preserveAspectRatio:"none","xlink:href":"resources/dna/DNA_InsideNucleus_1.svg",transform:c}).style("opacity",f),d3.transition(s).attr("transform",c).style("opacity",f),d3.transition(s.exit()).remove()},dna2:function(e,t){var s=e.select(".dna-layer").selectAll(".dna2").data(t.dna2);s.enter().append("image").attr({"class":"dna2",x:n(r.DNA2*-0.5),y:n(i.DNA2*-0.404),width:n(r.DNA2),height:n(i.DNA2),preserveAspectRatio:"none","xlink:href":"resources/dna/DNA_InsideNucleus_2.svg",transform:c}).style("opacity",f),d3.transition(s).attr("transform",c).style("opacity",f),d3.transition(s.exit()).remove()},dna3:function(e,t){var s=14,o,u;o=e.select(".dna-layer").selectAll(".dna3").data(t.dna3),u=o.enter().append("g").attr({"class":"dna3 main-dna",transform:c}).style("opacity",f),u.selectAll("dna3-unit").data(new Array(s)).enter().append("image").attr({"class":"dna3-unit",x:function(e,t){return(t-s*.5)*n(r.DNA3)*.98},y:n(i.DNA3*-0.5),width:n(r.DNA3),height:n(i.DNA3),preserveAspectRatio:"none","xlink:href":"resources/dna/DoubleHelix_Unit.svg"}),d3.transition(o).attr("transform",c).style("opacity",f),d3.transition(o.exit()).remove()},dna:function(e,r,i){var s=o.geneticEngine().viewModel,u=h(!0),a=r.dna[0]?r.dna[0].bonds:0,f=t(),c=e.select(".dna-layer").selectAll(".dna");f.model2px(n).sequence(s.DNA.slice(u[0],u[1])).glow(o.get("DNAMutations")).bonds(a);if(i){c.call(f.enterExitOnly(!0));return}c=c.data(r.dna),c.enter().append("g").attr({"class":"dna",transform:l}),c.call(f),d3.transition(c).attr("transform",l),d3.transition(c.exit()).remove()},dnaComp:function(e,r,i){var s=o.geneticEngine().viewModel,u=h(!0),a=r.dnaComp[0]?r.dnaComp[0].bonds:0,f=t(),c=e.select(".dna-layer").selectAll(".dna-comp");f.model2px(n).sequence(s.DNAComp.slice(u[0],u[1])).direction(2).glow(o.get("DNAMutations")).bonds(a);if(i){c.call(f.enterExitOnly(!0));return}c=c.data(r.dnaComp),c.enter().append("g").attr({"class":"dna-comp",transform:l}),c.call(f),d3.transition(c).attr("transform",l),d3.transition(c.exit()).remove()},mrna:function(e,r,i){var s=o.geneticEngine(),u=s.viewModel.mRNA,a=h(),f=s.stopCodonsHash(),c=r.mrna[0]?r.mrna[0].bonds:0,p=r.mrna[0]?r.mrna[0].direction:1,d=t(),v=e.select(".dna-layer").selectAll(".mrna");d.model2px(n).sequence(u.slice(a[0],a[1])).backbone("RNA").direction(p).bonds(c).stopCodonsHash(f);if(i){v.call(d.enterExitOnly(!0));return}v=v.data(r.mrna),v.enter().append("g").attr({"class":"mrna",transform:l}),v.call(d),d3.transition(v).attr("transform",l),d3.transition(v.exit()).remove()},polymeraseUnder:function(e,t){var s=e.select(".under-dna-layer").selectAll(".polymerase-under").data(t.polymeraseUnder);s.enter().append("image").attr({"class":"polymerase-under",x:n(r.POLY_UNDER*-0.5),y:n(i.POLY_UNDER*-0.5),width:n(r.POLY_UNDER),height:n(i.POLY_UNDER),preserveAspectRatio:"none","xlink:href":"resources/dna/Polymerase_Under.svg",transform:c}).style("opacity",f),d3.transition(s).attr("transform",c).style("opacity",f),d3.transition(s.exit()).remove()},polymeraseOver:function(e,t){var s=e.select(".over-dna-layer").selectAll(".polymerase-over").data(t.polymeraseOver);s.enter().append("image").attr({"class":"polymerase-over",x:n(r.POLY_OVER*-0.5),y:n(i.POLY_OVER*-0.5),width:n(r.POLY_OVER),height:n(i.POLY_OVER),preserveAspectRatio:"none","xlink:href":"resources/dna/Polymerase_Over.svg",transform:c}).style("opacity",f),d3.transition(s).attr("transform",c).style("opacity",f),d3.transition(s.exit()).remove()},nucleus:function(e,t){var s=e.select(".background-layer").selectAll(".nucleus").data(t.nucleus);s.enter().append("image").attr({"class":"nucleus",x:n(r.NUCLEUS*-0.5),y:n(i.NUCLEUS*-0.5),width:n(r.NUCLEUS),height:n(i.NUCLEUS),preserveAspectRatio:"none","xlink:href":"resources/dna/BG_Nucleus.svg",transform:l}).style("opacity",f),d3.transition(s).attr("transform",l).style("opacity",f),d3.transition(s.exit()).remove()},ribosomeBottom:function(e,t){var s=e.select(".over-dna-layer").selectAll(".ribosome-bottom").data(t.ribosomeBottom);s.enter().append("image").attr({"class":"ribosome-bottom",x:n(r.RIBO_BOTTOM*-0.5),y:n(i.RIBO_BOTTOM*-0.5),width:n(r.RIBO_BOTTOM),height:n(i.RIBO_BOTTOM),preserveAspectRatio:"none","xlink:href":"resources/dna/Ribosome_bottom1.svg",transform:l}).style("opacity",0),d3.transition(s).attr("transform",l).style("opacity",f),d3.transition(s.exit()).style("opacity",0).remove()},ribosomeTop:function(e,t){var s=e.select(".over-dna-layer").selectAll(".ribosome-top").data(t.ribosomeTop);s.enter().append("image").attr({"class":"ribosome-top",x:n(r.RIBO_TOP*-0.5),y:n(i.RIBO_TOP*-0.5),width:n(r.RIBO_TOP),height:n(i.RIBO_TOP),preserveAspectRatio:"none","xlink:href":"resources/dna/Ribosome_top1.svg",transform:l}).style("opacity",0),d3.transition(s).attr("transform",l).style("opacity",f),d3.transition(s.exit()).style("opacity",0).remove()},ribosomeUnder:function(e,t){var s=e.select(".under-dna-layer").selectAll(".ribosome-under").data(t.ribosomeUnder);s.enter().append("image").attr({"class":"ribosome-under",x:n(r.RIBO_UNDER*-0.5),y:n(i.RIBO_UNDER*-0.5),width:n(r.RIBO_UNDER),height:n(i.RIBO_UNDER),preserveAspectRatio:"none","xlink:href":"resources/dna/Ribosome_under.png",transform:l}).style({opacity:f}),d3.transition(s).attr("transform",l).style("opacity",f),d3.transition(s.exit()).remove()},ribosomeOver:function(e,t){var s=e.select(".over-dna-layer").selectAll(".ribosome-over").data(t.ribosomeOver);s.enter().append("image").attr({"class":"ribosome-over",x:n(r.RIBO_OVER*-0.5),y:n(i.RIBO_OVER*-0.5),width:n(r.RIBO_OVER),height:n(i.RIBO_OVER),preserveAspectRatio:"none","xlink:href":"resources/dna/Ribosome_over.png",transform:l}).style("opacity",f),d3.transition(s).attr("transform",l).style("opacity",f),d3.transition(s.exit()).remove()},trna:function(e,s){var u=o.geneticEngine(),a=3*t.WIDTH,c=(a-r.TRNA)*.55,h,p,d,v;h=e.select(".top-layer").selectAll(".trna").data(s.trna,function(e){return e.index}),p=h.enter().append("g").attr({"class":"trna",display:function(e){return e.index<0?"none":"inline"},transform:function(e,r){return"translate("+n(t.HEIGHT*2)+", "+n(-2.78)+") "+l(e,r)+" rotate(30)"}}).style("opacity",f),p.append("g").attr("transform","translate(0, "+n(-i.A)+")").call(t().model2px(n).sequence(function(e){return u.codonComplement(e.index)}).backbone(!1).randomEnter(!1)),p.append("image").attr({"class":"trna-neck",x:n(.52*(a-r.TRNA_NECK)),y:n(-i.TRNA_NECK-i.TRNA*.95-i.A*.92),width:n(r.TRNA_NECK),height:n(i.TRNA_NECK),preserveAspectRatio:"none","xlink:href":"resources/dna/tRNA_neck.png"}),p.append("image").attr({"class":"trna-base",x:n(c),y:n(-i.TRNA-i.A*.92),width:n(r.TRNA),height:n(i.TRNA),preserveAspectRatio:"none","xlink:href":"resources/dna/tRNA_base.png"}),d=d3.transition(h).attr("transform",l).style("opacity",f),d.select(".trna-neck").style("opacity",function(e){return e.neck}),v=d3.transition(h.exit()).attr("transform",function(e,r){return"translate("+n(t.HEIGHT*-5)+", "+n(t.HEIGHT*-4)+") "+l(e,r)+" rotate(-30)"}).style("opacity",0),v.selectAll(".bonds").style("opacity",0),v.remove()},viewPort:function(n,r){var i=r.viewPort[0].position,s=r.viewPort[0].ease,u=r.viewPort[0].drag,a=d3.transition(e.select(".viewport"));o.set("viewPortDrag",u?"x":!1),a.duration?(a.ease(s),a.tween("model-update",function(){var e=d3.interpolate(Number(o.properties.viewPortX),i*t.WIDTH);return function(t){var n=e(t);Math.abs(o.properties.viewPortX-n)>.001&&(o.properties.viewPortX=n)}})):o.set("viewPortX",i*t.WIDTH)},background:function(t,n){u(t),d3.transition(e.select(".plot")).attr("fill",n.background[0].color)}}}var t=e("md2d/views/nucleotides"),n=.007,r={CELLS:720,DNA1:661,DNA2:720,DNA3:337.4,POLY_UNDER:426.15,POLY_OVER:402.525,NUCLEUS:729.45,RIBO_TOP:550.7,RIBO_BOTTOM:509.031,RIBO_UNDER:550.55,RIBO_OVER:550.7,TRNA:117.325,TRNA_NECK:15.925},i={CELLS:500,DNA1:550,DNA2:414.263,DNA3:89.824,POLY_UNDER:368.6,POLY_OVER:368.6,NUCLEUS:543.199,RIBO_TOP:250,RIBO_BOTTOM:147.15,RIBO_UNDER:311.6,RIBO_OVER:311.6,TRNA:67.9,TRNA_NECK:21.14,A:31.15},s=["background","cells","dna1","dna2","dna3","polymeraseUnder","polymeraseOver","polymeraseUnder","polymeraseOver","dna","dnaComp","mrna","nucleus","ribosomeBottom","ribosomeTop","ribosomeUnder","ribosomeOver","trna","viewPort"];return function(){var e;for(e in r)r.hasOwnProperty(e)&&(r[e]*=n);for(e in i)i.hasOwnProperty(e)&&(i[e]*=n)}(),a.W=r,a.H=i,a.OBJECT_NAMES=s,a}),define("common/views/state-manager",[],function(){return function(t){var n,r=[],i={};return n={newState:function(e,n){var s=$.extend(!0,{},n);t.forEach(function(e){typeof s[e]=="undefined"&&(s[e]=[])}),r.push(s),i[e]=s},extendLastState:function(e,n){var s=r[r.length-1],o={};t.forEach(function(e){o[e]=[],typeof n[e]!="undefined"&&n[e].forEach(function(t,n){o[e].push($.extend(!0,{},s[e][n],t))})}),r.push(o),i[e]=o},getState:function(e){var t=i[e],n=$.extend(!0,{},t),r;for(r in n)n.hasOwnProperty(r)&&n[r].forEach(function(e,n){var i;for(i in e)typeof e[i]=="function"&&(e[i]=t[r][n][i]())});return n}},n}}),define("md2d/views/genetic-anim-states",["require","md2d/views/nucleotides","md2d/views/genetic-elements-renderer","common/views/state-manager"],function(e){var t=e("md2d/views/nucleotides"),n=e("md2d/views/genetic-elements-renderer"),r=e("common/views/state-manager"),i=n.H,s=n.OBJECT_NAMES;return function(n){function p(){var e=u.state();return e.name==="translation-end"?n.geneticEngine().lastTranslationStep():(h=isNaN(e.step)?h:e.step,h)}function d(){return(1.65+Math.max(0,p()-2)*3)*t.WIDTH}function v(){return this.index()*3*t.WIDTH}var o=new r(s),u=n.geneticEngine(),a=n.get("viewPortWidth"),f=n.get("viewPortHeight"),l=a*.5,c=f*.5,h;return o.newState("intro-cells",{cells:[{translateX:l+.33,translateY:c,scale:1}],dna1:[{translateX:l+.33,translateY:c,scale:.13,opacity:0}],viewPort:[{position:0,ease:"cubic-in-out",drag:!1}],background:[{color:"#8492ef"}]}),o.extendLastState("intro-zoom1",{cells:[{translateX:l,scale:6}],dna1:[{translateX:l,scale:.78,opacity:5}],dna2:[{translateX:l,translateY:c,scale:.5,opacity:0}],viewPort:[{}],background:[{}]}),o.extendLastState("intro-zoom2",{cells:[{scale:24}],dna1:[{scale:3.12,opacity:0}],dna2:[{scale:2,opacity:1}],dna3:[{translateX:l,translateY:c,scale:.2,opacity:0}],viewPort:[{}],background
:[{}]}),o.extendLastState("intro-zoom3-s0",{cells:[{}],dna2:[{scale:3.8,opacity:0}],dna3:[{scale:.4,opacity:1}],viewPort:[{}],background:[{}]}),o.extendLastState("intro-zoom3",{cells:[{}],dna3:[{scale:.6}],polymeraseUnder:[{scale:.2,translateX:-2,translateY:4,opacity:1}],viewPort:[{}],background:[{}]}),o.extendLastState("intro-polymerase-s0",{cells:[{}],dna3:[{}],polymeraseUnder:[{scale:.8,translateX:l,translateY:c,opacity:1}],polymeraseOver:[{translateX:l,translateY:c,scale:.8,opacity:0}],viewPort:[{}],background:[{}]}),o.extendLastState("intro-polymerase",{cells:[{}],dna3:[{}],polymeraseUnder:[{scale:1}],polymeraseOver:[{scale:1,opacity:1}],viewPort:[{}],background:[{}]}),o.extendLastState("dna-s0",{cells:[{opacity:0}],dna3:[{scale:1.5}],polymeraseUnder:[{scale:2.5}],polymeraseOver:[{scale:2.5}],viewPort:[{}],background:[{}]}),o.extendLastState("dna",{polymeraseUnder:[{opacity:0}],polymeraseOver:[{opacity:0}],dna3:[{opacity:0}],dna:[{translateX:-n.geneticEngine().PRECODING_LEN*t.WIDTH,translateY:f/2+t.HEIGHT,bonds:1}],dnaComp:[{translateX:-n.geneticEngine().PRECODING_LEN*t.WIDTH,translateY:f/2-t.HEIGHT,bonds:1}],viewPort:[{position:-2,drag:!0}],background:[{color:"url(#transcription-bg)"}]}),o.extendLastState("transcription",{dna:[{translateY:f/2+2.5*t.HEIGHT,bonds:0}],dnaComp:[{translateY:f/2-2.5*t.HEIGHT,bonds:function(){var e=p()+n.geneticEngine().PRECODING_LEN;return function(t){return t.region==="c"&&t.idx<e?1:0}}}],mrna:[{translateY:f/2-.5*t.HEIGHT,bonds:1,direction:1}],viewPort:[{position:function(){return Math.max(0,Math.min(n.get("DNA").length-10,p()-6))-2},ease:"linear"}],background:[{}]}),o.extendLastState("transcription-end",{dna:[{}],dnaComp:[{bonds:function(){return function(e){return e.region==="c"?1:0}}}],mrna:[{}],polymeraseUnder:[{translateX:function(){return n.get("DNA").length*t.WIDTH},translateY:.5*f,scale:3.5,opacity:0}],polymeraseOver:[{translateX:function(){return n.get("DNA").length*t.WIDTH},translateY:.5*f,scale:3.5,opacity:0}],viewPort:[{position:function(){return Math.max(0,n.get("DNA").length-10)-2}}],background:[{}]}),o.extendLastState("after-transcription",{dna:[{}],dnaComp:[{}],mrna:[{}],polymeraseUnder:[{opacity:1}],polymeraseOver:[{opacity:1}],viewPort:[{}],background:[{}]}),o.extendLastState("before-translation-s0",{dna:[{}],dnaComp:[{}],mrna:[{}],polymeraseUnder:[{scale:1.4}],polymeraseOver:[{scale:1.4,opacity:0}],viewPort:[{}],background:[{color:"#8492ef"}]}),o.extendLastState("before-translation-s1",{dna:[{}],dnaComp:[{}],mrna:[{}],polymeraseUnder:[{translateX:function(){return n.get("viewPortX")+.5*a+5},translateY:.5*f-2,scale:.7}],viewPort:[{}],background:[{}]}),o.extendLastState("before-translation-s2",{dna:[{}],dnaComp:[{}],mrna:[{}],nucleus:[{translateX:.5*a-2*t.WIDTH,translateY:.5*f}],viewPort:[{position:-2,ease:"cubic-in-out"}],background:[{}]}),o.extendLastState("before-translation-s3",{dna:[{translateY:4*t.HEIGHT}],dnaComp:[{translateY:2*t.HEIGHT,bonds:0}],mrna:[{bonds:0}],nucleus:[{translateY:0}],viewPort:[{}],background:[{color:function(){return n.get("backgroundColor")}}]}),o.extendLastState("before-translation-s4",{dna:[{translateY:-1*t.HEIGHT}],dnaComp:[{translateY:-3*t.HEIGHT}],mrna:[{translateY:2.5*t.HEIGHT}],nucleus:[{translateY:i.NUCLEUS*-0.5}],viewPort:[{}],background:[{}]}),o.extendLastState("before-translation",{mrna:[{translateY:1.5*t.HEIGHT,direction:2,bonds:0}],ribosomeBottom:[{translateX:-3,translateY:c,opacity:0}],viewPort:[{}],background:[{}]}),o.extendLastState("translation-s0",{mrna:[{}],ribosomeBottom:[{translateX:d,translateY:1.75*t.HEIGHT,opacity:1}],ribosomeTop:[{translateX:-3,translateY:6,opacity:0}],viewPort:[{}],background:[{}]}),o.extendLastState("translation-s1",{mrna:[{}],ribosomeBottom:[{}],ribosomeTop:[{translateX:d,translateY:4.52*t.HEIGHT,opacity:1}],ribosomeUnder:[{translateX:d,translateY:3.7*t.HEIGHT,opacity:0}],ribosomeOver:[{translateX:d,translateY:3.7*t.HEIGHT,opacity:0}],viewPort:[{}],background:[{}]}),o.extendLastState("translation",{mrna:[{bonds:function(){var e=p();return function(t){return t.idx<3*(e-2)||t.idx>=3*e?0:1}}}],ribosomeUnder:[{opacity:1}],ribosomeOver:[{opacity:1}],trna:[{index:function(){return p()-2},translateX:v,translateY:2.5*t.HEIGHT,neck:0},{index:function(){return p()-1},translateX:v,translateY:2.5*t.HEIGHT,neck:1}],viewPort:[{position:function(){return Math.max(0,3*(p()-3))-2},ease:"linear"}],background:[{}]}),o.extendLastState("translation-step0",{mrna:[{bonds:function(){var e=p();return function(t){return t.idx<3*(e-3)||t.idx>=3*e?0:1}}}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{index:function(){return p()-3}},{index:function(){return p()-2}},{index:function(){return p()-1},translateX:v,translateY:2.5*t.HEIGHT,neck:1}],viewPort:[{}],background:[{}]}),o.extendLastState("translation-step1",{mrna:[{}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{},{neck:0},{}],viewPort:[{}],background:[{}]}),o.extendLastState("translation-end-s0",{mrna:[{}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{index:function(){return p()-2}},{index:function(){return p()-1},neck:0}],viewPort:[{}],background:[{}]}),o.extendLastState("translation-end-s1",{mrna:[{bonds:function(){var e=p();return function(t){return t.idx<3*(e-1)||t.idx>=3*e?0:1}}}],ribosomeUnder:[{}],ribosomeOver:[{}],trna:[{index:function(){return p()-1}}],viewPort:[{}],background:[{}]}),o.extendLastState("translation-end-s2",{mrna:[{bonds:0}],ribosomeUnder:[{}],ribosomeOver:[{}],viewPort:[{}],background:[{}]}),o.extendLastState("translation-end-s3",{mrna:[{}],ribosomeBottom:[{translateX:d,translateY:1.75*t.HEIGHT,opacity:1}],ribosomeTop:[{translateX:d,translateY:4.52*t.HEIGHT,opacity:1}],viewPort:[{}],background:[{}]}),o.extendLastState("translation-end-s4",{mrna:[{}],ribosomeBottom:[{translateY:1.75*t.HEIGHT-.3}],ribosomeTop:[{translateY:4.52*t.HEIGHT+.5}],viewPort:[{}],background:[{}]}),o.extendLastState("translation-end-s5",{mrna:[{}],ribosomeBottom:[{translateX:function(){return d()+8},translateY:1.75*t.HEIGHT-.5}],ribosomeTop:[{translateX:function(){return d()+8},translateY:4.52*t.HEIGHT+5}],viewPort:[{}],background:[{}]}),o.extendLastState("translation-end",{mrna:[{}],viewPort:[{}],background:[{}]}),o}}),function(){var e={}.hasOwnProperty;define("cs!md2d/views/mutations-context-menu",["require"],function(t){return{register:function(t,n,r){var i,s,o;i=null,o=function(t){var n,r,s;i=d3.select(t.$trigger[0]).datum().type,s=t.items.Substitution.items;for(r in s){if(!e.call(s,r))continue;n=s[r],r=r.split(":")[1],n.$node.addClass(""+i+"-to-"+r)}return d3.select(t.$trigger[0]).classed("glowing",!0),!0},s=function(t){var n,r,s;s=t.items.Substitution.items;for(r in s){if(!e.call(s,r))continue;n=s[r],r=r.split(":")[1],n.$node.removeClass(""+i+"-to-"+r)}return d3.select(t.$trigger[0]).classed("glowing",!1),!0},$.contextMenu("destroy",t),$.contextMenu({selector:t,appendTo:"#responsive-content",className:"mutations-menu",trigger:"left",events:{show:o,hide:s},callback:function(e,t){var i;e=e.split(":"),i=d3.select(t.$trigger[0]).datum();switch(e[0]){case"substitute":return n.geneticEngine().mutate(i.idx,e[1],r);case"insert":return n.geneticEngine().insert(i.idx,e[1],r);case"delete":return n.geneticEngine()["delete"](i.idx)}},items:{Substitution:{name:"Substitution mutation",className:"substitution-submenu",items:{"substitute:A":{name:""},"substitute:T":{name:""},"substitute:G":{name:""},"substitute:C":{name:""}}},Insertion:{name:"Insertion mutation",className:"insertion-submenu",items:{"insert:A":{name:"Insert",className:"A"},"insert:T":{name:"Insert",className:"T"},"insert:G":{name:"Insert",className:"G"},"insert:C":{name:"Insert",className:"C"}}},"delete":{name:"Deletion mutation"}}})}}})}.call(this),define("md2d/views/genetic-renderer",["require","md2d/views/nucleotides","md2d/views/genetic-elements-renderer","md2d/views/genetic-anim-states","cs!md2d/views/mutations-context-menu"],function(e){function o(e,o){function x(){o.geneticEngine().on("change",N),o.geneticEngine().on("transition",A),o.addPropertiesListener(["DNAMutations"],T),o.addPropertiesListener(["viewPortX"],function(){if(!h||!o.get("DNA"))return;var e=w.getState(b||d.name);E.mrna(h,e,!0),E.dna(h,e,!0),E.dnaComp(h,e,!0),!y&&d.name==="translation-end"&&o.getNumberOfAtoms()>0&&o.geneticEngine().centerProtein()}),i.register('[class~="dna"] [class~="clickable-nucleo"]',o,!1),i.register('[class~="dna-comp"] [class~="clickable-nucleo"]',o,!0)}function T(){d=o.geneticEngine().state(),L(),c.selectAll("g.genetics").remove(),h=null;if(!o.get("DNA"))return;h=c.insert("g",".image-container-below").attr("class","genetics"),h.append("g").attr("class","background-layer"),h.append("g").attr("class","under-dna-layer"),h.append("g").attr("class","dna-layer"),h.append("g").attr("class","over-dna-layer"),h.append("g").attr("class","top-layer"),N()}function N(e){g=e,d=o.geneticEngine().state(),L(),C(h,d.name,null,y),y=!1}function C(e,t,n,r){function u(e){var t=!!i[e].length,n=!!o&&!!o[e].length;return g&&e==="viewPort"?!1:r||t||n?!0:!1}function a(){e.each(function(){var e=d3.select(this);s.forEach(function(t){u(t)&&E[t](e,i)})}),n&&n(e)}var i=w.getState(t),o=v?w.getState(v):null;e.duration?(e.each("start.transition-name",function(){b=t,e.delay(0),a()}),e.each("end.transition-name",function(){b=null})):a(),v=t,m=d.step||0}function k(){var e;return p&&p.node().__transition__?e=p.transition():e=h.transition(),p=e,e}function L(){var e=a.select("g.genetics");!e.empty()&&e.node().__transition__&&(a.selectAll("g.genetics, g.genetics *").transition().delay(0),a.select(".plot").transition().delay(0),c.transition().delay(0),p=null,b=null)}function A(e,t){y=!0,g=t,d=o.geneticEngine().state(),Number(e.split(":")[1])>0&&(e=e.split(":")[0]),S[e](),p.each("end.trans-end",function(){y=!1,o.geneticEngine().transitionEnded()})}var u,a=e.svg,f=e.model2px,l=e.model2pxInv,c=a.select(".viewport"),h=null,p=null,d=null,v=null,m=null,g=!1,y=!1,b=null,w=new r(o),E=new n(a,f,l,o),S;return S={"dna-updated":function(){var t=k().ease("cubic-in-out").duration(800);C(t,d.name,null,!0)},"intro-zoom1":function(){var t=k().ease("cubic").duration(3e3);C(t,"intro-zoom1")},"intro-zoom2":function(){var t=k().ease("linear").duration(3e3);C(t,"intro-zoom2")},"intro-zoom3":function(){var t=k().ease("linear").duration(2e3);C(t,"intro-zoom3-s0"),t=k().ease("quad-out").duration(3300),C(t,"intro-zoom3")},"intro-polymerase":function(){var t=k().ease("quad-out").duration(3e3);C(t,"intro-polymerase-s0"),t=k().ease("cubic-in-out").duration(1e3),C(t,"intro-polymerase")},dna:function(){var t=k().duration(2e3);C(t,"dna-s0"),t=k().duration(1e3),C(t,"dna",function(e){e.selectAll(".nucleotide").duration(5),e.selectAll(".plot").duration(5)})},"transcription:0":function(){var t=k().duration(1500);C(t,"transcription",function(e){e.selectAll(".bonds").duration(250)})},transcription:function(){var t=k().duration(500);C(t,"transcription",function(e){e.selectAll(".bonds").ease("cubic")})},"transcription-end":function(){var t=k().duration(500);C(t,"transcription-end",function(e){e.selectAll(".bonds").ease("cubic")})},"after-transcription":function(){var t=k().ease("cubic-in-out").duration(700);C(t,"after-transcription")},"before-translation":function(){var t=k().ease("cubic-in-out").duration(1e3);C(t,"before-translation-s0",function(e){e.selectAll(".plot").duration(1)}),t=k().ease("cubic-in-out").duration(1500),C(t,"before-translation-s1"),t=k().ease("cubic-in-out").duration(1500),C(t,"before-translation-s2"),t=k().ease("cubic").duration(1e3),C(t,"before-translation-s3",function(e){e.selectAll(".bonds").duration(250),e.selectAll(".plot").duration(1)}),t=k().ease("cubic-out").duration(1e3),C(t,"before-translation-s4"),t=k().ease("cubic-out").duration(500),C(t,"before-translation")},"translation:0":function(){var t=k().ease("cubic-in-out").duration(1e3);C(t,"translation-s0"),t=k().ease("cubic-in-out").duration(1e3),C(t,"translation-s1"),t=k().ease("cubic-in-out").duration(500),C(t,"translation")},translation:function(){var n=o.geneticEngine(),r=d.step-1,i=1e3,s=500,u;u=k().duration(i),C(u,"translation-step0",function(e){e.selectAll(".bonds").ease("cubic"),n.translationStepStarted(r,1.45+r*3*t.WIDTH,3.95,.53+r*3*t.WIDTH,1.57,i)}),u=k().duration(s),C(u,"translation-step1",function(e){e.selectAll(".trna-neck").duration(150),n.shiftAminoAcids(r,2*t.WIDTH,s)}),u.each("end",function(){n.connectAminoAcid(r)}),r>0&&(u=k().duration(900),C(u,"translation",function(e){e.selectAll(".bonds").duration(150)}))},"translation-end":function(){var t=o.geneticEngine(),n=o.getNumberOfAtoms(),r;n>=1&&(r=k().duration(150),C(r,"translation-end-s0"),r.each("end",function(){t.translationCompleted()}),r=k().duration(800),C(r,"translation-end-s1",function(e){e.selectAll(".bonds").duration(150)}),r=k().duration(800),C(r,"translation-end-s2",function(e){e.selectAll(".bonds").duration(150)})),r=k().duration(500),C(r,"translation-end-s3"),r=k().duration(300),C(r,"translation-end-s4"),r=k().duration(1e3),C(r,"translation-end-s5"),r=k().duration(700),C(r,"translation-end",function(){t.centerProtein(700)})}},u={setup:T,render:N},x(),u}var t=e("md2d/views/nucleotides"),n=e("md2d/views/genetic-elements-renderer"),r=e("md2d/views/genetic-anim-states"),i=e("cs!md2d/views/mutations-context-menu"),s=n.OBJECT_NAMES;return o}),function(){define("cs!common/layout/wrap-svg-text",["require"],function(e){var t,n;return t="http://www.w3.org/2000/svg",n=window.wrapSVGText=function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;f=/-/gi,e.search("\n")>0?(S=e.split("\n"),p=!0,a=[]):(S=e.split(/[\s-]/),p=!1,a=function(){var t;t=[];while(v=f.exec(e))t.push(v.index);return t}()),u=0,o=0,d=1,b=0;for(l=x=0,T=S.length;x<T;l=++x)E=S[l],u+=E.length+1,l===0||p||r>0&&o>r?(l>0&&(p?(b=Math.max(y.getComputedTextLength(),b),d++):(m=y.firstChild.nodeValue,m.length>S[l-1].length+1?(c=m.slice(m.length-S[l-1].length-1),y.firstChild.nodeValue=m.slice(0,m.length-S[l-1].length-1)):m.length===S[l-1].length+1&&(y.firstChild.nodeValue=m.slice(0,m.length-1)),b=Math.max(y.getComputedTextLength(),b),d++)),y=document.createElementNS(t,"tspan"),y.setAttributeNS(null,"x",i),y.setAttributeNS(null,"dy",l===0?0:s),g=document.createTextNode(h),y.appendChild(g),n.appendChild(y),~a.indexOf(u-1)?h=E+"-":h=E+" ",l&&c&&(h=c+h)):~a.indexOf(u-1)?h+=E+"-":h+=E+" ",y.firstChild.nodeValue=h,o=y.getComputedTextLength(),p&&(b=Math.max(y.getComputedTextLength(),b)),p||l&&l===S.length-1&&r>0&&o>r&&(m=y.firstChild.nodeValue,y.firstChild.nodeValue=m.slice(0,m.length-S[l].length-1),y=document.createElementNS(t,"tspan"),y.setAttributeNS(null,"x",i),y.setAttributeNS(null,"dy",s),g=document.createTextNode(S[l]),y.appendChild(g),n.appendChild(y),d++);return b===0&&(b=n.childNodes[0].getComputedTextLength()),r>b?w=r:w=b,{lines:d,width:w,textWidth:b}}})}.call(this),define("common/views/gradients",[],function(){return{createRadialGradient:function(e,t,n,r,i){var s,o,u;return o=i.select("defs"),o.empty()&&(o=i.append("defs")),u=o.select("#"+e),u.empty()?u=o.append("radialGradient").attr("id",e).attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"):u.selectAll("stop").remove(),u.append("stop").attr("stop-color",t).attr("offset","0%"),u.append("stop").attr("stop-color",n).attr("offset","40%"),u.append("stop").attr("stop-color",r).attr("offset","80%"),u.append("stop").attr("stop-color",n).attr("offset","100%"),s="url(#"+e+")",this.mainColorOfGradient[s]=r,s},mainColorOfGradient:{}}}),define("md2d/views/renderer",["require","lab.config","common/alert","common/console","common/benchmark/benchmark","cs!md2d/views/aminoacid-context-menu","md2d/views/genetic-renderer","cs!common/layout/wrap-svg-text","common/views/gradients"],function(e){var t=e("lab.config"),n=e("common/alert"),r=e("common/console"),s=e("common/benchmark/benchmark"),o=e("cs!md2d/views/aminoacid-context-menu"),u=e("md2d/views/genetic-renderer"),a=e("cs!common/layout/wrap-svg-text"),f=e("common/views/gradients"),l={STANDARD_STICK:101,LONG_SPRING:102,BOND_SOLID_LINE:103,GHOST:104,UNICOLOR_STICK:105,SHORT_SPRING:106,DOUBLE_BOND:107,TRIPLE_BOND:108,DISULPHIDE_BOND:109};return function(c,h){function Ut(){return Q+K(h.get("displayTime"))+G}function zt(e,t,n,r,i){return h.setAtomProperties(e,{x:t,y:n},r,i)}function Wt(e){return"rgb("+tt.colorR[e]+","+tt.colorG[e]+","+tt.colorB[e]+")"}function Xt(e,t,n){var r=(t+Math.pow(2,24)).toString(16),i,s,o,u,a;for(a=r.length;a<6;a++)r=String(0)+r;return i=d3.rgb("#"+r),s=i.toString(),o=i.brighter(1).toString(),u=i.darker(1).toString(),f.createRadialGradient(e,o,s,u,n)}function Vt(){var e,t,n,r,i;for(e=0;e<4;e++)Xt("elem"+e+"-grad",v.color[e],C);r=h.get("markColor"),t=d3.rgb(r),n=t.brighter(1).toString(),i=t.darker(1).toString(),f.createRadialGradient("mark-grad",n,r,i,C)}function $t(){var e=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#F2F2F2","#FF8080"]),t=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#FF2020"]),n,r,i,s;for(s=0;s<H;s++)n="ke-shading-"+s,i=s/H,r=f.createRadialGradient(n,"#FFFFFF",e(i),t(i),C),P[s]=r;f.createRadialGradient("neutral-grad","#FFFFFF","#f2f2f2","#A4A4A4",C);var o=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#FFFFFF","#ffefff"]),u=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#f2f2f2","#9090FF"]),a=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#3030FF"]),l=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#FFFFFF","#dfffff"]),c=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#f2f2f2","#FF8080"]),h=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#FF2020"]),p;for(s=1;s<F;s++)n="pos-charge-shading-"+s,p=s/F,r=f.createRadialGradient(n,o(p),u(p),a(p),C),B[s]=r,n="neg-charge-shading-"+s,p=s/F,r=f.createRadialGradient(n,l(p),c(p),h(p),C),j[s]=r;f.createRadialGradient("green-grad","#dfffef","#75a643","#2a7216",C),f.createRadialGradient("orange-grad","#F0E6D1","#E0A21B","#AD7F1C",C)}function Jt(e,t){var n,r="Triangle-"+t,i;n=C.select("defs"),n.empty()&&(n=C.append("defs")),i=n.select("#"+r),i.empty()&&(i=n.append("marker").attr("id","Triangle-"+t).attr("viewBox","0 0 10 10").attr("refX","0").attr("refY","5").attr("markerUnits","strokeWidth").attr("markerWidth","4").attr("markerHeight","3").attr("orient","auto").attr("stroke",e).attr("fill",e),i.append("path").attr("d","M 0 0 L 10 5 L 0 10 z"))}function Kt(){var e,t;e=C.select("defs"),e.empty()&&(e=C.append("defs")),t=e.select("#glow"),t.empty()&&(t=e.append("filter").attr("id","glow").attr("x","-1").attr("y","-1").attr("width","400%").attr("height","400%"),t.append("feMorphology").attr("result","bigger").attr("in","SourceGraphic").attr("operator","dilate").attr("radius","6"),t.append("feGaussianBlur").attr("result","blurOut").attr("in","bigger").attr("stdDeviation","10"),t.append("feBlend").attr("in","SourceGraphic").attr("in2","blurOut").attr("mode","normal"))}function Qt(e){var t,n,r,i,s,o=h.get("aminoAcidColorScheme");if(e.marked)return"url(#mark-grad)";if(pt)return t=h.getAtomKineticEnergy(e.idx),n=Math.min(5*t,1),P[Math.round(n*(H-1))];if(ht||o==="charge"||o==="chargeAndHydro")r=e.charge,i=Math.round(Math.min(Math.abs(r)/3,1)*(F-1)),s=i===0?"url(#neutral-grad)":(r>=0?B:j)[i];if(ht||o==="charge"||o==="chargeAndHydro"&&i!==0)return s;if(!e.isAminoAcid())return D[e.element%4];switch(o){case"none":case"charge":return"url(#neutral-grad)";case"hydrophobicity":case"chargeAndHydro":return e.hydrophobicity>0?"url(#orange-grad)":"url(#green-grad)";default:throw new Error("ModelContainer: unknown amino acid color scheme.")}}function Gt(e){return ln(e)?"#888":f.mainColorOfGradient[I[e.atom1]]}function Yt(e){return ln(e)?"#888":f.mainColorOfGradient[I[e.atom2]]}function Zt(){var e="1%",t=Math.max(V,12);O.select("#heat-bath").empty()&&O.append("image").attr({id:"heat-bath",x:e,width:t*2,height:t*2,preserveAspectRatio:"xMinYMin","xlink:href":"resources/upstatement/heatbath.svg","class":"opaque-on-hover"}).append("title").text("Heatbath active"),O.select("#ke-gradient").empty()&&O.append("image").attr({id:"ke-gradient",x:"0",width:t*2.2,height:t*6,preserveAspectRatio:"xMinYMin","xlink:href":"resources/upstatement/ke-gradient.svg","class":"opaque-on-hover"}).append("title").text("Kinetic energy gradient")}function en(){var e=h.get("temperatureControl"),t,n,r=0,i=1,s=Math.max(V,12);e?(r+=i,t=O.select("#heat-bath").attr({y:r,width:s*2,height:s*2}).style("display",""),n=parseInt(t.attr("height"),10),r+=n):O.select("#heat-bath").style("display","none"),pt?(r+=i,O.select("#ke-gradient").attr({y:r,width:s*2.2,height:s*6}).style("display","")):O.select("#ke-gradient").style("display","none")}function tn(){C.selectAll("circle").data(d).attr("r",function(e){return b(e.radius)})}function nn(){R.enter().append("circle").attr({"class":function(e){return e.isAminoAcid()?"draggable atom amino-acid":"atom draggable"},r:function(e){return b(e.radius)},cx:function(e){return b(e.x)},cy:function(e){return w(e.y)},"fill-opacity":function(e){return e.visible?1:0},fill:function(e,t){return I[t]},filter:function(e,t){return e.excitation?"url(#glow)":null}}).on("mousedown",_n).on("mouseover",Mn).on("mouseout",Pn).call(d3.behavior.drag().on("dragstart",Vn).on("drag",Qn).on("dragend",Yn)),R.exit().remove()}function rn(e,t,n,r,i){e.enter().append("path").attr({"class":"vector-"+i,"marker-end":Rt?"":"url(#Triangle-"+i+")",d:t,"stroke-width":n,stroke:r,fill:"none"})}function sn(){Ht.enter().append("path").attr({"class":"atomTrace",d:Rn,"stroke-width":b(.01),stroke:Pt,fill:"none","stroke-dasharray":"6, 6"})}function on(){var e=et.enter().append("g");e.attr("class","obstacle").attr("transform",function(e,t){return"translate("+b(tt.x[t])+" "+w(tt.y[t]+tt.height[t])+")"}),e.append("rect").attr({"class":"obstacle-shape",x:0,y:0,width:function(e,t){return b(tt.width[t])},height:function(e,t){return b(tt.height[t])},fill:function(e,t){return tt.visible[t]?Wt(t):"rgba(128,128,128, 0)"},"stroke-width":function(e,t){return tt.visible[t]?.2:0},stroke:function(e,t){return tt.visible[t]?Wt(t):"rgba(128,128,128, 0)"}}),e.each(function(e,t){if(!tt.externalAx[t]&&!tt.externalAy[t])return;var n=d3.select(this),r=tt.height[t],i=tt.width[t],s=tt.externalAx[t],o=tt.externalAy[t],u=.06,a=.06,f,l;s&&(f=(r-2*a)/Math.round((r-2*a)/.2),l=d3.range(a,r,f),n.selectAll("path.obstacle-force-hor").data(l).enter().append("path").attr({"class":"obstacle-force-hor",d:function(e){return s<0?"M "+b(i+u+a)+","+b(e)+" L "+b(i+a)+","+b(e):"M "+b(-u-a)+","+b(e)+" L "+b(-a)+","+b(e)}})),o&&(f=(i-2*a)/Math.round((i-2*a)/.2),l=d3.range(a,i,f),n.selectAll("path.obstacle-force-vert").data(l).enter().append("path").attr({"class":"obstacle-force-vert",d:function(e){return o<0?"M "+b(e)+","+b(-u-a)+" L "+b(e)+","+b(-a):"M "+b(e)+","+b(r+u+a)+" L "+b(e)+","+b(r+a)}})),n.selectAll("path.obstacle-force-hor, path.obstacle-force-vert").attr({"marker-end":Rt?"":"url(#Triangle-"+Ft+")","stroke-width":b(St),stroke:Et,fill:"none"})})}function un(){var e=[it,st];for(i=0;i<e.length;i++){var t=e[i].enter().append("g");t.attr("class","rectangle").attr("transform",function(e,t){return"translate("+b(rt.x[e])+" "+w(rt.y[e]+rt.height[e])+")"}),t.append("rect").attr({"class":"rectangle-shape",x:0,y:0,width:function(e,t){return b(rt.width[e])},height:function(e,t){return b(rt.height[e])},fill:function(e,t){return rt.visible[e]?rt.color[e]:"rgba(128,128,128, 0)"},"stroke-width":function(e,t){return rt.lineWeight[e]},"stroke-dasharray":function(e,t){return rt.lineDashes[e]},stroke:function(e,t){return rt.visible[e]?rt.lineColor[e]:"rgba(128,128,128, 0)"}})}}function an(){at.enter().append("path").attr({d:function(e){return fn(e,1)},"stroke-width":function(e){return ln(e)?cn(e):b(Math.min(d[e.atom1].radius,d[e.atom2].radius))*.75},stroke:Gt,fill:"none"}).classed("radialbond1",!0).classed("disulphideBond",function(e){return e.type===l.DISULPHIDE_BOND}),ft.enter().append("path").attr({d:function(e){return fn(e,2)},"stroke-width":function(e){return ln(e)?cn(e):b(Math.min(d[e.atom1].radius,d[e.atom2].radius))*.75},stroke:Yt,fill:"none"}).classed("radialbond2",!0).classed("disulphideBond",function(e){return e.type===l.DISULPHIDE_BOND})}function fn(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,v,m,g,y,E,S,x,T,N,C,k,L,A,O;u=b(e.x1),f=w(e.y1),a=b(e.x2),l=w(e.y2),s=a-u,o=l-f,T=e.strength,x=Math.sqrt(s*s+o*o)/b(.01),N=Math.floor(e.length*24),C=x/N,E=s/x,S=o/x,k=E*C,L=S*C,A=E*N,O=S*N,c=b(d[e.atom1].radius)*E,h=b(d[e.atom2].radius)*E,v=b(d[e.atom1].radius)*S,m=b(d[e.atom2].radius)*S,p=c-h,g=v-m;if(ln(e)){y="M "+u+","+f+" ";for(i=0;i<N;i++)i%2===0?(n=u+(i+.5)*k-.5*O,r=f+(i+.5)*L+.5*A):(n=u+(i+.5)*k+.5*O,r=f+(i+.5)*L-.5*A),y+=" L "+n+","+r;return y+=" L "+a+","+l}return t===1?"M "+u+","+f+" L "+(a+u+p)/2+" , "+(l+f+g)/2:"M "+(a+u+p)/2+" , "+(l+f+g)/2+" L "+a+","+l}function ln(e){return e.type===l.SHORT_SPRING}function cn(e){return 1.25}function hn(){var e=b(.02),t=b(.03)+" "+b(.02);ct.attr({x1:function(e){return b(d[e[0]].x)},y1:function(e){return w(d[e[0]].y)},x2:function(e){return b(d[e[1]].x)},y2:function(e){return w(d[e[1]].y)}}),ct.enter().append("line").attr({"class":"attractionforce",x1:function(e){return b(d[e[0]].x)},y1:function(e){return w(d[e[0]].y)},x2:function(e){return b(d[e[1]].x)},y2:function(e){return w(d[e[1]].y)}}).style({"stroke-width":e,"stroke-dasharray":t}),ct.exit().remove()}function pn(e){return Mt+(kt[e.imageUri]||e.imageUri)}function dn(){var e=[],t,n,r,i,s=[],o=[];L.selectAll("image").remove(),S.selectAll("image").remove();if(!Ct)return;for(r=0;r<Ct.length;r++)e[r]=new Image,e[r].src=pn(Ct[r]),e[r].onload=function(r){return function(){t=Ct[r].imageLayer,i=t===1?s:o,i.push({i:r,zOrder:Ct[r].imageLayerPosition?Ct[r].imageLayerPosition:0}),i.sort(function(e,t){return d3.ascending(e.zOrder,t.zOrder)}),At[r]=[.01*e[r].width,.01*e[r].height],n=t===1?L:S,n.selectAll("image").remove(),n.selectAll("image").data(i,function(e){return e.i}).enter().append("image").attr("x",function(e){return Wn(e.i)[0]}).attr("y",function(e){return Wn(e.i)[1]}).attr("class",function(e){return"image_attach"+e.i+" draggable"}).attr("xlink:href",function(t){return e[t.i].src}).attr("width",function(e){return b(At[e.i][0])}).attr("height",function(e){return b(At[e.i][1])}).attr("pointer-events","none")}}(r)}function vn(e){var t,n,r,i,s,o,u,a,f,l,c=J*e.fontScale;return t=e.x,n=e.y,e.hostType&&(e.hostType==="Atom"?(r=d[e.hostIndex].x,i=d[e.hostIndex].y):(r=tt.x[e.hostIndex]+tt.width[e.hostIndex]/2,i=tt.y[e.hostIndex]+tt.height[e.hostIndex]/2)),e.hostType&&!e.calloutPoint&&(t=r,n=i),e.calloutPoint&&(e.hostType?(f=r,l=i):(f=e.calloutPoint[0],l=e.calloutPoint[1])),u=b(t),a=w(n),s=u+c*.75,o=a+c*1.2,f=b(f),l=w(l),[s,o,u,a,f,l]}function mn(e,t,n,r,i){var s=[parseFloat(e[0]),parseFloat(e[1])],o=[parseFloat(t.getAttribute("x"))+n/2,parseFloat(t.getAttribute("y"))+r/2],u=qt-Math.atan((s[0]-o[0])/(s[1]-o[1])),a=Math.min(i,r/2),f=Math.sin(u)*a,l=Math.cos(u)*a;return o[0]+f+", "+(o[1]-l)+" "+(o[0]-f)+", "+(o[1]+l)+" "+s}function gn(){var e=[A,x],t;t=function(t){var n=e[t-1],r=Ot.filter(function(e){return e.layer===t});n.selectAll("g.textBoxWrapper rect").data(r.filter(function(e){return e.frame})).attr({x:function(e){return vn(e)[2]},y:function(e){return vn(e)[3]},transform:function(e){var t=e.rotate,n=vn(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"}}),n.selectAll("g.textBoxWrapper text").data(r).attr({y:function(e){return $(this).find("tspan").attr("x",vn(e)[0]),vn(e)[1]}}),n.selectAll("g.textBoxWrapper polygon").data(r.filter(function(e){return e.calloutPoint})).attr({"callout-location-data":function(e){var t=vn(e);return t[4]+", "+t[5]}})},t(1),t(2),$(".textBox").each(function(){var e=$(this.parentNode),t=e.find("polygon"),n=e.find("rect")[0],r,i,s,o;if(!n||t.length===0)return;r=parseFloat(this.getAttributeNS(null,"font-size")),i=n.getAttribute("width"),s=n.getAttribute("height"),o=t.attr("callout-location-data").split(", "),t.attr("points",mn(o,n,i,s,r))})}function yn(){var e,n,i;Ot=h.get("textBoxes"),e=[h.get("width"),h.get("height")],n=[A,x],i=function(i){var s=n[i-1],o,u,a;s.selectAll("g.textBoxWrapper").remove(),u=Ot.filter(function(e){return e.layer===i}),a=s.selectAll("g.textBoxWrapper").data(u),o=a.enter().append("svg:g").attr("class","textBoxWrapper"),o.filter(function(e){return e.calloutPoint}).append("polygon").attr({points:"0,0 0,0 0,0",style:function(e){var t=e.backgroundColor,n=e.strokeWidthEms*V,r=e.strokeOpacity;return"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:#000000;stroke-width:"+n*2+";stroke-opacity:"+r},"callout-location-data":function(e){var t=vn(e);return t[4]+", "+t[5]}}),o.filter(function(e){return e.frame}).append("rect").attr({"class":function(e,t){return"textBoxFrame text-"+t},id:function(e,t){return"text-"+t},transform:function(e){var t=e.rotate,n=vn(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"},style:function(e){var t=e.backgroundColor,n=e.strokeWidthEms*V,r=e.strokeOpacity;return"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:#000000;stroke-width:"+n+";stroke-opacity:"+r},width:0,height:0,rx:function(e){return e.frame==="rounded rectangle"?J/2.5:0},ry:function(e){return e.frame==="rounded rectangle"?J/2:0},x:function(e){return vn(e)[2]},y:function(e){return vn(e)[3]}}),o.filter(function(e){return e.calloutPoint}).append("polygon").attr({points:"0,0 0,0 0,0",style:function(e){var t=e.backgroundColor;return"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:#000000;stroke-width:0;"}}),o.append("text").attr({"class":function(){return"textBox"+(AUTHORING?" draggable":"")},transform:function(e){var t=e.rotate,n=vn(e);return"rotate("+t+" "+n[0]+" "+n[1]+")"},"x-data":function(e){return vn(e)[0]},y:function(e){return vn(e)[1]},"width-data":function(e){return e.width},"height-data":function(e){return e.height},width:b(e[0]),height:b(e[1]),"xml:space":"preserve","font-family":"'"+t.fontface+"', sans-serif","font-size":function(e){return e.fontScale*J+"px"},fill:function(e){return e.color||"black"},"text-data":function(e){return e.text},"text-anchor":function(e){var t=e.textAlign||"left";return t==="center"&&(t="middle"),t},"has-host":function(e){return!!e.hostType}}).call(d3.behavior.drag().on("drag",Gn).on("dragend",function(e){r.log('"x": '+e.x+","),r.log('"y": '+e.y+",")})),a.exit().remove()},i(1),i(2),$(".textBox").each(function(){var e=this.getAttributeNS(null,"text-data"),t=this.getAttributeNS(null,"x-data"),n=this.getAttributeNS(null,"width-data"),r=this.getAttributeNS(null,"height-data"),i=parseFloat(this.getAttributeNS(null,"font-size")),s=this.getAttributeNS(null,"transform"),o=this.getAttributeNS(null,"has-host"),u=this.getAttributeNS(null,"text-anchor"),f=$(this.parentNode),l,c,h,p,d,v,m,g,y,w,E;m=i*1.2,l=+i*1.5,c=i/1.8,n===""?n=-1:n=b(n),r===""?r=-1:r=b(r);while(this.firstChild)this.removeChild(this.firstChild);h=a(e,this,n,t,m),f.find("rect").length>0&&(v=f.find("rect")[0],p=h.width+l,v.setAttributeNS(null,"width",p),r>0?d=r:d=h.lines*m+c,v.setAttributeNS(null,"height",d)),w=f.find("polygon"),v&&w.length>0&&(E=w.attr("callout-location-data").split(", "),w.attr("points",mn(E,v,p,d,i))),u==="middle"&&(g=h.width/2,r>0?y=r/2-c*1.5-(h.lines-1)*m/2:y=0,s=s+" translate("+g+","+y+")",$(this).attr("transform",s)),o==="true"&&w.length===0&&(g=h.width/-2-l/2,y=h.lines*m/-2-c/2,f.attr("transform","translate("+g+","+y+")"))})}function bn(){var e,t;ht=h.get("chargeShading"),pt=h.get("keShading"),I.length=d.length;for(e=0,t=d.length;e<t;e++)I[e]=Qt(d[e])}function wn(){var e=h.get("showChargeSymbols"),t=h.get("useThreeLetterCode");bn(),C.selectAll("circle").remove(),C.selectAll("g.label").remove(),R=C.selectAll("circle").data(d),tn(),nn(),U=C.selectAll("g.label").data(d),z=U.enter().append("g").attr("class","label").attr("transform",function(e){return"translate("+b(e.x)+","+w(e.y)+")"}),z.each(function(n){var r=d3.select(this),i,s;if(h.get("atomNumbers"))r.append("text").text(n.idx).style("font-size",b(1.4*n.radius)+"px");else if(t&&n.label)r.append("text").text(n.label).attr("class","shadow").style("font-size",b(n.radius)+"px"),r.append("text").text(n.label).style("font-size",b(n.radius)+"px");else if(!t&&n.symbol)r.append("text").text(n.symbol).attr("class","shadow").style("font-size",b(1.4*n.radius)+"px"),r.append("text").text(n.symbol).style("font-size",b(1.4*n.radius)+"px");else if(e){if(n.charge>0)i="+";else{if(!(n.charge<0))return;i="-"}r.append("text").text(i).style("font-size",b(1.6*n.radius)+"px")}s=r.selectAll("text"),s.node()&&(s.attr("pointer-events","none").style({"font-weight":"bold",opacity:.7}),s.attr({x:-s.node().getBBox().width/2,y:"0.31em"})),r.select("text.shadow").style({stroke:"#fff","stroke-width":.15*b(n.radius),"stroke-opacity":.7})})}function En(){tt=h.get_obstacles(),C.selectAll("g.obstacle").remove(),tt&&(nt.length=tt.x.length,et=C.selectAll("g.obstacle").data(nt),on())}function Sn(){rt=h.get_rectangles(),k.selectAll(".rectangle"
).remove(),E.selectAll(".rectangle").remove();if(rt){ot=[],ut=[];for(var e=0;e<rt.x.length;e++)rt.layer[e]===1?ot.push(e):ut.push(e);it=k.selectAll(".rectangle").data(ot),st=E.selectAll(".rectangle").data(ut),un()}}function xn(){T.selectAll("path.radialbond1").remove(),T.selectAll("path.radialbond2").remove(),Y=h.get_radial_bonds(),Z=h.get_radial_bond_results(),Z&&(at=T.selectAll("path.radialbond1").data(Z),ft=T.selectAll("path.radialbond2").data(Z),an())}function Tn(){N.selectAll("line.attractionforce").remove(),Nn(),vt=h.get("showVDWLines"),vt&&(ct=N.selectAll("line.attractionforce").data(lt),hn())}function Nn(){var e=h.get_vdw_pairs();for(var t=0;t<e.count;t++)lt[t]=[e.atom1[t],e.atom2[t]];lt.splice(e.count)}function Cn(){C.selectAll("path.vector-"+jt).remove(),C.selectAll("path.vector-"+Ft).remove(),mt=h.get("showVelocityVectors"),wt=h.get("showForceVectors"),mt&&(Tt=C.selectAll("path.vector-"+jt).data(d),rn(Tt,Bn,Fn,gt,jt)),wt&&(Nt=C.selectAll("path.vector-"+Ft).data(d),rn(Nt,jn,In,Et,Ft))}function kn(){C.selectAll("path.atomTrace").remove(),Bt="",_t=h.get("showAtomTrace"),Dt=h.get("atomTraceId"),_t&&(Ht=C.selectAll("path.atomTrace").data([d[Dt]]),sn())}function Ln(){Nn(),ct=N.selectAll("line.attractionforce").data(lt),hn()}function An(){On()}function On(){h.get("enableKeyboardHandlers")&&c.node.focus()}function Mn(e,t){h.get("enableAtomTooltips")&&q===!1&&Dn(t)}function _n(e,t){c.node.focus(),h.get("enableAtomTooltips")&&(q!==!1?(W.style("opacity",1e-6),W.style("display","none"),q=!1):(d3.event.shiftKey?q=t:q=!1,Dn(t)))}function Dn(e){var t=c.pos(),n=t.left+b(d[e].x),r=t.top+w(d[e].y);W.style("opacity",1).style("display","inline").style("background","rgba(100%, 100%, 100%, 0.7)").style("left",n+"px").style("top",r+"px").style("zIndex",100).transition().duration(250),X.text("atom: "+e+"\n"+"time: "+Ut()+"\n"+"speed: "+d3.format("+6.3e")(d[e].speed)+"\n"+"vx:    "+d3.format("+6.3e")(d[e].vx)+"\n"+"vy:    "+d3.format("+6.3e")(d[e].vy)+"\n"+"ax:    "+d3.format("+6.3e")(d[e].ax)+"\n"+"ay:    "+d3.format("+6.3e")(d[e].ay)+"\n")}function Pn(){!q&&q!==0&&W.style("opacity",1e-6).style(NaN)}function Hn(){R.attr({cx:function(e){return b(e.x)},cy:function(e){return w(e.y)}});if(pt||ht)bn(),R.attr("fill",function(e,t){return I[t]});dt&&R.attr("filter",function(e){return e.excitation?"url(#glow)":null}),U.attr("transform",function(e){return"translate("+b(e.x)+","+w(e.y)+")"}),(q===0||q>0)&&Dn(q)}function Bn(e){var t=b(e.x),n=w(e.y),r="M "+t+","+n,i=bt*100;return r+" L "+(t+b(e.vx*i))+","+(n-b(e.vy*i))}function jn(e){var t=b(e.x),n=w(e.y),r=e.mass,i=xt*100,s="M "+t+","+n;return s+" L "+(t+b(e.ax*r*i))+","+(n-b(e.ay*r*i))}function Fn(e){return Math.abs(e.vx)+Math.abs(e.vy)>1e-6?b(yt):0}function In(e){return Math.abs(e.ax)+Math.abs(e.ay)>1e-8?b(St):0}function qn(e,t,n){e.attr({d:t,"stroke-width":n})}function Rn(e){var t=Math.floor(b(e.x)*100)/100,n=Math.floor(w(e.y)*100)/100,r,i;return Bt?(Bt+=t+","+n+" ",Bt.length>4e3&&(r=Bt.indexOf("L"),i=Bt.indexOf(" "),Bt="M"+Bt.slice(r+1,i)+"L"+Bt.slice(i+1)),Bt):(Bt="M"+t+","+n+"L","M "+t+","+n)}function Un(){Ht.attr({d:Rn})}function zn(){at.attr("d",function(e){return fn(e,1)}),ft.attr("d",function(e){return fn(e,2)});if(pt||ht)at.attr("stroke",Gt),ft.attr("stroke",Yt)}function Wn(e){var t=Ct[e],n,r,i,s;return t.imageHostType?(t.imageHostType==="Atom"?(n=d[t.imageHostIndex].x,r=d[t.imageHostIndex].y):t.imageHostType==="RectangularObstacle"&&(n=tt.x[t.imageHostIndex]+tt.width[t.imageHostIndex]/2,r=tt.y[t.imageHostIndex]+tt.height[t.imageHostIndex]/2),i=At[e][0],s=At[e][1],n-=i/2,r+=s/2):(n=t.imageX,r=t.imageY),[b(n),w(r)]}function Xn(){var e,t,n,r,i;e=Ct.length;for(i=0;i<e;i++){if(!At||!At[i])continue;r=Wn(i),t=Ct[i].imageLayer,n=t===1?L:S,n.selectAll("image.image_attach"+i).attr("x",r[0]).attr("y",r[1])}}function Vn(e,t){h.isStopped()?M=[e.x,e.y]:e.draggable&&h.liveDragStart(t)}function $n(e,t,n){return n.left+e<0&&(e=0-n.left),n.right+e>m&&(e=m-n.right),n.bottom+t<0&&(t=0-n.bottom),n.top+t>g&&(t=g-n.top),{x:e,y:t}}function Jn(e,t,n){return e<t?t:e>n?n:e}function Kn(e,t){return{x:Jn(e,0,m),y:Jn(t,0,g)}}function Qn(e,t){var n=b.invert(d3.event.x),r=w.invert(d3.event.y),i;h.isStopped()?(i=$n(n,r,h.getMoleculeBoundingBox(t)),zt(t,i.x,i.y,!1,!0),ur()):e.draggable&&(i=Kn(n,r),h.liveDrag(i.x,i.y))}function Gn(e){var t=b.invert(d3.event.dx),n=b.invert(d3.event.dy);if(!AUTHORING||!h.isStopped())return;e.x=e.x+t,e.y=e.y-n,gn()}function Yn(e,t){h.isStopped()?(zt(t,e.x,e.y,!0,!0)||(n("You can't drop the atom there"),zt(t,M[0],M[1],!1,!0)),ur()):e.draggable&&h.liveDragEnd()}function Zn(){var e=d3.select("#model-container");W===undefined&&!e.empty()&&(W=e.append("div").attr("class","tooltip").style("opacity",1e-6),X=W.append("pre"))}function er(){var e,t,n,r,i=s.what_browser();i.browser==="Firefox"&&i.version>="18"&&i.version<"23"&&(e=$("#firefox-warning-pane"),t=c.pos(),n=t.bottom-e.height(),r=t.right-e.width(),e.css({display:"inline",top:n-5,left:r-15,"z-index":100}))}function tr(){Ct=h.get("images"),kt=h.get("imageMapping"),Lt=h.get("imagePath"),Lt?Mt=t.actualRoot+Lt:c.url&&(Mt=t.actualRoot+c.url.slice(0,c.url.lastIndexOf("/")+1)),gt=h.get("velocityVectors").color,yt=h.get("velocityVectors").width,bt=h.get("velocityVectors").length,Et=h.get("forceVectors").color,St=h.get("forceVectors").width,xt=h.get("forceVectors").length,Pt=h.get("atomTraceColor"),Jt(gt,jt),Jt(Et,Ft),dt=h.properties.useQuantumDynamics,dt&&Kt(),Zt(),$t(),o.register(h,p,'[class~="amino-acid"]'),_=new u(c,h)}function nr(e){var t=[],n=40,r=d3.svg.line().x(function(e){return b(.5/n*e.x)}).y(function(e){return b(.1*e.y)}),i=e.angularFrequency*2*Math.PI/n,s;for(s=0;s<n;s++)t.push({x:s-n/2,y:Math.sin(s*i)/(1+.01*(s-.5*n)*(s-.5*n))});return r(t)}function rr(){var e=h.getPhotons(),t=C.selectAll(".photon").data(e);t.enter().append("path").attr({"class":"photon",d:nr,"stroke-width":1,stroke:"black","fill-opacity":0}),t.exit().remove(),t.attr("transform",function(e){var t=-180*Math.atan2(e.vy,e.vx)/Math.PI;return"translate("+b(e.x)+", "+w(e.y)+") "+"rotate("+t+")"})}function ir(){function e(e){return function(){e(),c.updateClickHandlers()}}G=" ("+h.getPropertyDescription("displayTime").getUnitAbbreviation()+")",b=c.model2px,w=c.model2pxInv,V=c.getFontSizeInPixels(),J=V*.9,d=h.getAtoms(),v=h.get_elements(),m=h.get("width"),g=h.get("height"),y=m/g,tr(),h.addPropertiesListener(["temperatureControl"],en),h.addPropertiesListener(["keShading","chargeShading","showChargeSymbols","useThreeLetterCode","showVDWLines","VDWLinesCutoff","showVelocityVectors","showForceVectors","showAtomTrace","atomTraceId","aminoAcidColorScheme","backgroundColor","markColor"],e(or)),h.on("addAtom",e(wn)),h.on("removeAtom",e(or)),h.on("addRadialBond",e(xn)),h.on("removeRadialBond",e(xn)),h.on("textBoxesChanged",e(yn)),er()}function sr(e){h=e,ir()}function or(e,t){arguments.length&&(b=e,w=t),V=c.getFontSizeInPixels(),J=V*.9,Vt(),En(),Tn(),wn(),Sn(),xn(),_.setup(),Cn(),kn(),dn(),yn(),Zn(),en(),er(),dt&&rr()}function ur(){r.time("view update"),tt&&et.attr("transform",function(e,t){return"translate("+b(tt.x[t])+" "+w(tt.y[t]+tt.height[t])+")"}),rt&&(it.attr("transform",function(e,t){return"translate("+b(rt.x[e])+" "+w(rt.y[e]+rt.height[e])+")"}),st.attr("transform",function(e,t){return"translate("+b(rt.x[e])+" "+w(rt.y[e]+rt.height[e])+")"})),vt&&Ln(),Hn(),Z&&zn(),mt&&qn(Tt,Bn,Fn),wt&&qn(Nt,jn,In),_t&&Un(),Ct&&Ct.length!==0&&Xn(),Ot&&Ot.length>0&&gn(),dt&&rr(),r.timeEnd("view update")}var p={},d,v,m,g,y,b,w,E=c.viewport.append("g").attr("class","rectangle-container-below"),S=c.viewport.append("g").attr("class","image-container-below"),x=c.viewport.append("g").attr("class","text-container-below"),T=c.viewport.append("g").attr("class","radial-bonds-container"),N=c.viewport.append("g").attr("class","vdw-lines-container"),C=c.viewport.append("g").attr("class","main-container"),k=c.viewport.append("g").attr("class","rectangle-container-top"),L=c.viewport.append("g").attr("class","image-container-top"),A=c.viewport.append("g").attr("class","text-container-top"),O=c.vis.append("g").attr("class","icon-container"),M,_,D=["url(#elem0-grad)","url(#elem1-grad)","url(#elem2-grad)","url(#elem3-grad)"],P=[],H=25,B=[],j=[],F=25,I=[],q=!1,R,U,z,W,X,V,J,K=d3.format("5.1f"),Q="",G="",Y,Z,et,tt,nt=[],rt,it,st,ot=[],ut=[],at,ft,lt=[],ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At=[],Ot,Mt,_t,Dt,Pt,Ht,Bt,jt="velocity",Ft="force",It=s.what_browser(),qt=Math.PI/2,Rt=It.browser=="MSIE"&&It.version>="10.0";return p={update:ur,repaint:or,bindModel:sr,model2px:c.model2px,model2pxInv:c.model2pxInv},p}}),define("md2d/views/view",["require","common/views/svg-container","md2d/views/renderer"],function(e){var t=e("common/views/svg-container"),n=e("md2d/views/renderer");return function(e,r){return new t(e,r,n)}}),define("md2d/views/dna-edit-dialog",[],function(){return function(){var t,n,r,i,s,o=function(){n=$("<div></div>"),r=$('<input type="text" id="dna-sequence-input" size="55"></input>'),r.appendTo(n),i=$('<p class="error"></p>'),i.appendTo(n),n.dialog({dialogClass:"dna-edit-dialog",appendTo:"#responsive-content",title:"DNA Code on Sense Strand",autoOpen:!1,width:"35em",buttons:{Apply:function(){model.set({DNA:r.val()}),$(this).dialog("close")}}}),s=$(".dna-edit-dialog button:contains('Apply')"),r.on("input",function(){try{model.getPropertyValidateFunc("DNA")(r.val()),s.button("enable"),i.text("")}catch(e){s.button("disable"),i.text(e.message)}})};return t={open:function(){i.text(""),s.removeAttr("disabled"),r.val(model.get("DNA")),n.dialog("open")}},o(),t}}),define("md2d/controllers/scripting-api",["require","common/alert","md2d/views/dna-edit-dialog"],function(e){var t=e("common/alert"),n=e("md2d/views/dna-edit-dialog");return function(t){var r=new n,i=!1;return{getNumberOfAtoms:function(t){return model.getNumberOfAtoms(t)},getNumberOfObstacles:function(){return model.getNumberOfObstacles()},getNumberOfElements:function(){return model.getNumberOfElements()},getNumberOfRadialBonds:function(){return model.getNumberOfRadialBonds()},getNumberOfAngularBonds:function(){return model.getNumberOfAngularBonds()},addAtom:function(t,n){return n&&n.suppressRepaint&&(n.suppressEvent=!0),model.addAtom(t,n)},removeAtom:function(t,n){n&&n.suppressRepaint&&(n.suppressEvent=!0,delete n.suppressRepaint);try{model.removeAtom(t,n)}catch(r){if(!n||!n.silent)throw r}},removeRadialBond:function(n,r){try{model.removeRadialBond(n)}catch(i){if(!r||!r.silent)throw i}t.repaintIfReady()},removeAngularBond:function(n,r){try{model.removeAngularBond(n)}catch(i){if(!r||!r.silent)throw i}t.repaintIfReady()},addRandomAtom:function(){return model.addRandomAtom.apply(model,arguments)},adjustTemperature:function(t){model.set({targetTemperature:t*model.get("targetTemperature")})},setTemperatureOfAtoms:function(t,n){model.setTemperatureOfAtoms(t,n)},getTemperatureOfAtoms:function(t){return model.getTemperatureOfAtoms(t)},limitHighTemperature:function(t){model.get("targetTemperature")>t&&model.set({targetTemperature:t})},randomAtoms:function(n){var r=model.getNumberOfAtoms();n===null&&(n=1+t.randomInteger(r-1));if(!t.isInteger(n))throw new Error("randomAtoms: number of atoms requested, "+n+", is not an integer.");if(n<0)throw new Error("randomAtoms: number of atoms requested, "+n+", was less be greater than zero.");return n>r&&(n=r),t.choose(n,r)},atomsWithinCircle:function(e,t,n,r){var i=[],s,o,u,a;for(u=0,a=model.getNumberOfAtoms();u<a;u++){s=model.getAtomProperties(u);if(typeof r!="undefined"&&s.element!==r)continue;o=Math.sqrt(Math.pow(e-s.x,2)+Math.pow(t-s.y,2)),o<=n&&i.push(u)}return i},atomsWithinRect:function(e,t,n,r,i){var s=[],o,u,a,f,l,c;for(l=0,c=model.getNumberOfAtoms();l<c;l++){o=model.getAtomProperties(l);if(typeof i!="undefined"&&o.element!==i)continue;typeof r=="undefined"?(u=Math.sqrt(Math.pow(e-o.x,2)+Math.pow(t-o.y,2)),u<=n&&s.push(l)):(a=o.x>=e&&o.x<=e+n,f=o.y>=t&&o.y<=t+r,a&&f&&s.push(l))}return s},atomsWithinTriangle:function(e,t,n,r,i,s,o){function c(o,u){var a=[i-e,s-t],f=[n-e,r-t],l=[o-e,u-t],c=a[0]*a[0]+a[1]*a[1],h=a[0]*f[0]+a[1]*f[1],p=a[0]*l[0]+a[1]*l[1],d=f[0]*f[0]+f[1]*f[1],v=f[0]*l[0]+f[1]*l[1],m=1/(c*d-h*h),g=(d*p-h*v)*m,y=(c*v-h*p)*m;return g>=0&&y>=0&&g+y<1}var u=[],a,f,l;for(f=0,l=model.getNumberOfAtoms();f<l;f++){a=model.getAtomProperties(f);if(typeof o!="undefined"&&a.element!==o)continue;c(a.x,a.y)&&u.push(f)}return u},markAtoms:function(n){var r,i;if(arguments.length===0)return;t.isArray(arguments[0])||(n=arguments),t.unmarkAllAtoms();for(r=0,i=n.length;r<i;r++)model.setAtomProperties(n[r],{marked:1});t.repaintIfReady()},unmarkAllAtoms:function(){for(var n=0,r=model.getNumberOfAtoms();n<r;n++)model.setAtomProperties(n,{marked:0});t.repaintIfReady()},traceAtom:function(t){if(t===null)return;model.set({atomTraceId:t}),model.set({showAtomTrace:!0})},untraceAtom:function(){model.set({showAtomTrace:!1})},setAtomProperties:function(n,r,i,s,o){model.setAtomProperties(n,r,i,s),t.repaintIfReady(o)},atomTransition:function(){return model.atomTransition()},getAtomProperties:function(t){return model.getAtomProperties(t)},getRadialBondsForAtom:function(t){return model.getRadialBondsForAtom(t)},getAngularBondsForAtom:function(t){return model.getAngularBondsForAtom(t)},getMoleculeAtoms:function(t){return model.getMoleculeAtoms(t)},setElementProperties:function(n,r){model.setElementProperties(n,r),t.repaintIfReady()},setPairwiseLJProperties:function(t,n,r){model.getPairwiseLJProperties().set(t,n,r)},getElementProperties:function(t){return model.getElementProperties(t)},addObstacle:function(n,r){try{model.addObstacle(n)}catch(i){if(!r||!r.silent)throw i}t.repaintIfReady()},setObstacleProperties:function(n,r){model.setObstacleProperties(n,r),t.repaintIfReady()},getObstacleProperties:function(t){return model.getObstacleProperties(t)},removeObstacle:function(n,r){try{model.removeObstacle(n)}catch(i){if(!r||!r.silent)throw i}t.repaintIfReady()},setRectangleProperties:function(n,r){model.setRectangleProperties(n,r),t.repaintIfReady()},getRectangleProperties:function(t){return model.getRectangleProperties(t)},getAtomsWithinRectangle:function(t){var n=model.getRectangleProperties(t);return this.atomsWithinRect(n.x,n.y,n.width,n.height)},removeRectangle:function(n,r){try{model.removeRectangle(n)}catch(i){if(!r||!r.silent)throw i}t.repaintIfReady()},setRadialBondProperties:function(n,r){model.setRadialBondProperties(n,r),t.repaintIfReady()},getRadialBondProperties:function(t){return model.getRadialBondProperties(t)},setAngularBondProperties:function(n,r){model.setAngularBondProperties(n,r),t.repaintIfReady()},getAngularBondProperties:function(t){return model.getAngularBondProperties(t)},openDNADialog:function(){r.open()},jumpToNextDNAState:function(){model.geneticEngine().jumpToNextState()},jumpToPrevDNAState:function(){model.geneticEngine().jumpToPrevState()},DNAStateBefore:function(t){return model.geneticEngine().stateBefore(t)},DNAStateAfter:function(t){return model.geneticEngine().stateAfter(t)},animateToNextDNAState:function(){model.geneticEngine().transitionToNextState()},animateToDNAState:function(t){model.geneticEngine().transitionTo(t)},stopDNAAnimation:function(){model.geneticEngine().stopTransition()},transcribeDNAStep:function(t){var n=model.geneticEngine();n.stateBefore("dna")||n.stateAfter("transcription-end")?(model.set("DNAState","dna"),n.transitionTo("transcription:0"),n.transcribeStep(t)):model.get("DNAState")!=="transcription-end"&&n.transcribeStep(t)},translateDNAStep:function(){var t=model.geneticEngine();t.stateBefore("translation:0")||t.stateAfter("translation-end")?(model.set("DNAState","translation:0"),t.transitionTo("translation:1")):model.get("DNAState")!=="translation-end"&&t.transitionToNextState()},generateRandomProtein:function(e){var t=model.geneticEngine().generateProtein(undefined,e);if(t!==e)throw new Error("Generated protein was truncated due to limited area of the model. Only"+t+" amino acids were generated.")},setSolvent:function(t){model.setSolvent(t)},pe:function(){return model.get("potentialEnergy")},ke:function(){return model.get("kineticEnergy")},atomsKe:function(t){var n=0,r;for(r=0;r<t.length;r++)n+=model.getAtomKineticEnergy(t[r]);return n},minimizeEnergy:function(){model.minimizeEnergy(),t.repaintIfReady()},addTextBox:function(e){model.addTextBox(e)},removeTextBox:function(e){model.removeTextBox(e)},setTextBoxProperties:function(e,t){model.setTextBoxProperties(e,t)},repaintIfReady:function(e){i||e&&e.suppressRepaint||t.repaint()},batch:function(e){i=!0,model.startBatch(),e(),model.endBatch(),i=!1,t.repaintIfReady()}}}}),define("md2d/benchmarks/benchmarks",[],function(){return function(t){var n=[{name:"commit",numeric:!1,run:function(e){var t="<a href='"+Lab.version.repo.commit.url+"' class='opens-in-new-window' target='_blank'>"+Lab.version.repo.commit.short_sha+"</a>";Lab.version.repo.dirty&&(t+=" <i>dirty</i>"),e(t)}},{name:"atoms",numeric:!0,run:function(e){e(model.getNumberOfAtoms())}},{name:"temperature",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(model.get("temperature"))}},{name:"just graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n,r,i;model.stop(),r=+Date.now(),i=0;while(i++<100)t.modelContainer.update();n=Date.now()-r,e(100/n*1e3)}},{name:"model (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n;model.stop(),t=+Date.now(),model.suppressEvents(function(){var e=0;while(e++<100)model.tick()}),n=Date.now()-t,e(100/n*1e3)}},{name:"model+graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n,r;model.stop(),t=+Date.now(),r=0;while(r++<100)model.tick();n=Date.now()-t,e(100/n*1e3)}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(e){model.start(),setTimeout(function(){model.stop();var t=model.stepCounter();setTimeout(function(){model.start(),setTimeout(function(){model.stop(),e((model.stepCounter()-t)/2)},2e3)},100)},1e3)}},{name:"interactive",numeric:!1,run:function(e){e(window.location.pathname+window.location.hash)}}];return n}}),define("md2d/controllers/controller",["require","common/controllers/model-controller","md2d/models/modeler","md2d/views/view","md2d/controllers/scripting-api","md2d/benchmarks/benchmarks"],function(e){var t=e("common/controllers/model-controller"),n=e("md2d/models/modeler"),r=e("md2d/views/view"),i=e("md2d/controllers/scripting-api"),s=e("md2d/benchmarks/benchmarks");return function(e,o,u){return new t(e,o,u,n,r,i,s)}}),define("solar-system/models/engine/constants/units",["require","exports","module"],function(e,t,n){var r=86400,i=149597870700,s=5.97219e+24,o=332946,u={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",POWER:"power",FORCE:"force",VELOCITY:"velocity",ACCELERATION:"acceleration",GRAVITATIONAL_CONSTANT:"Gravitational Constant",AREA:"area",VOLUME:"volume",PRESSURE:"pressure"},a,f,l;t.unit=a={DAY:{name:"Day",value:1,type:u.TIME},SECOND:{name:"second",value:r,type:u.TIME},AU:{name:"au",value:1,type:u.LENGTH},METER:{name:"meter",value:i,type:u.LENGTH},EARTH_MASS:{name:"Earth Mass",value:1,type:u.MASS},KILOGRAM:{name:"kilogram",value:s,type:u.MASS},SOLAR_MASS:{name:"Solar Mass",value:o,type:u.MASS},JOULE:{name:"Joule",value:1/s*(1/i)*(1/i)/(1/r*(1/r)),type:u.ENERGY},WATT:{name:"Watt",value:1/s*(1/i)*(1/i)/(1/r*(1/r)*(1/r)),type:u.POWER},NEWTON:{name:"Newton",value:1,type:u.FORCE},METERS_PER_SECOND:{name:"meters per second",value:1/i*r,type:u.VELOCITY},METERS_PER_SECOND_PER_SECOND:{name:"meters per second per second",value:1/i*r*r,type:u.ACCELERATION},METERS_CUBED_PER_KILOGRAMS_TIMES_TIME_SQUARED:{name:"meters cubed per kilograms times second squared",value:1/i*(1/i)*(1/i)/(1/s*r*r),type:u.ACCELERATION},ASTRONOMICAL_FORCE:{name:" in Astronomical units (Earth Mass, AU, Day)",value:1*s,type:u.GRAVITATIONAL_CONSTANT},SI_GC:{name:"gravitational constant of proprtionality in SI units (kg, m, s)",value:1,type:u.GRAVITATIONAL_CONSTANT},ASTRONOMICAL_GC:{name:"gravitational constant of proprtionality in Astronomical units (Earth Mass, AU, Day)",value:1*s*r*r/(i*i*i),type:u.GRAVITATIONAL_CONSTANT}},t.ratio=f=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},t.convert=l=function(e,t){var n=t&&t.from,r=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!r)throw new Error('units.convert() did not receive a "to" argument');return e*f(r,{per:n})}}),define("solar-system/models/engine/constants/index",["require","exports","module","./units"],function(e,t,n){var r=e("./units"),i=r.unit,s=r.ratio,o=r.convert,u={SOLAR_LUMINOSITY:{value:3.839e+26,unit:i.WATT},ASTRONOMICAL_UNIT_DISTANCE:{value:149597870691,unit:i.METER},GRAVITATIONAL_CONSTANT:{value:6.67384e-11,unit:i.SI_GC}},a,f;t.unit=i,t.ratio=s,t.convert=o;for(a in u)u.hasOwnProperty(a)&&(f=u[a],t[a]=function(e){return{as:function(t){return r.convert(e.value,{from:e.unit,to:t})}}}(f))}),define("solar-system/models/engine/solar-system",["require","exports","module","arrays","common/array-types","./constants/index","common/console","common/models/engines/clone-restore-wrapper"],function(e,t,n){var r=e("arrays"),i=e("common/array-types"),s=e("./constants/index"),o=s.unit,u=e("common/console"),a=e("common/models/engines/clone-restore-wrapper"),f=s.GRAVITATIONAL_CONSTANT.as(s.unit.ASTRONOMICAL_GC);t.createEngine=function(){var e,t=f,n=!1,s=[50,50],o=-25,u=-25,c=25,h=25,p=0,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L=0,A,O,M=function(){P(0)},_=function(e,t){var n,i;if(Array.isArray(e))for(n=0,i=e.length;n<i;n++)r.isArray(e[n])&&(e[n]=r.extend(e[n],t));else for(n in e)e.hasOwnProperty(n)&&r.isArray(e[n])&&(e[n]=r.extend(e[n],t))},D={bodies:function(){m=k.radius,g=k.x,y=k.y,b=k.vx,w=k.vy,E=k.px,S=k.py,x=k.ax,T=k.ay,N=k.mass,C=k.speed,pinned=k.pinned}},P=function(t){k=e.bodies={},k.radius=r.create(t,0,i.float),k.x=r.create(t,0,i.float),k.y=r.create(t,0,i.float),k.vx=r.create(t,0,i.float),k.vy=r.create(t,0,i.float),k.px=r.create(t,0,i.float),k.py=r.create(t,0,i.float),k.ax=r.create(t,0,i.float),k.ay=r.create(t,0,i.float),k.mass=r.create(t,0,i.floatType),k.speed=r.create(t,0,i.float),k.pinned=r.create(t,0,i.uint8),k.marked=r.create(t,0,i.uint8),k.visible=r.create(t,0,i.uint8),D.bodies()},H=function(e){var t=m[e],n=o+t,r=u+t,i=c-t,a=h-t,f=s[0],l=s[1];if(A)g[e]+m[e]<n?g[e]+=f:g[e]-m[e]>i&&(g[e]-=f);else if(g[e]<n){while(g[e]<n-f)g[e]+=f;g[e]=n+(n-g[e]),b[e]*=-1,E[e]*=-1}else if(g[e]>i){while(g[e]>i+f)g[e]-=f;g[e]=i-(g[e]-i),b[e]*=-1,E[e]*=-1}if(O)y[e]+m[e]<r?y[e]+=l:y[e]-m[e]>a&&(y[e]-=l);else if(y[e]<r){while(y[e]<r-l)y[e]+=l;y[e]=r+(r-y[e]),w[e]*=-1,S[e]*=-1}else if(y[e]>a){while(y[e]>a+l)y[e]-=l;y[e]=a-(y[e]-a),w[e]*=-1,S[e]*=-1}},B=function(){var e,t;if(L===0)return;for(e=0;e<L;e++)x[e]=T[e]=0;j()},j=function(){var e,n,r,i,s,o,u,a;e=-1;while(++e<L){m1=N[e],n=e;while(++n<L)r=g[n]-g[e],i=y[n]-y[e],s=r*r+i*i,l=Math.sqrt(s),m2=N[n],o=t*m1*m2/s,u=r/l*o,a=i/l*o,x[e]+=u/m1,T[e]+=a/m1,x[n]-=u/m2,T[n]-=a/m2}},F=function(){var e,t;for(e=0;e<L;e++)t=N[e],b[e]+=.5*x[e]*d,E[e]=t*b[e],w[e]+=.5*T[e]*d,S[e]=t*w[e]},I=function(){var e=s[0]*100,t=s[1]*100,n,r,i;for(i=0;i<L;i++)n=g[i],r=y[i],g[i]+=b[i]*d,y[i]+=w[i]*d,H(i)},q=function(){var e;for(e=0;e<L;e++)pinned[e]&&(b[e]=w[e]=x[e]=T[e]=0)},R=function(){var e;for(e=0;e<L;e++)C[e]=Math.sqrt(b[e]*b[e]+w[e]*w[e])};return e={setTime:function(e){p=e},setDimensions:function(e){if(n)throw new Error("The SolarSystem model's size has already been set, and cannot be reset.");o=e[0],u=e[1],c=e[2],h=e[3],s=[c-o,h-u],n=!0},getDimensions:function(){return[o,c,u,h]},setHorizontalWrapping:function(e){A=!!e},setVerticalWrapping:function(e){O=!!e},setGravitationalConstant:function(e){typeof e=="number"&&e!==0?t=e:t=f},setBodyProperties:function(e,t){var n,r,i,s;for(n in t)t.hasOwnProperty(n)&&(k[n][e]=t[n]);C[e]=Math.sqrt(b[e]*b[e]+w[e]*w[e])},addBody:function(t){L+1>k.x.length&&(_(k,L+10),D.bodies()),t.ax=t.ay=0,L++,e.setBodyProperties(L-1,t)},removeBody:function(e){var t,n,r,i,s,o;if(e>=L)throw new Error("Body "+e+" doesn't exist, so it can't be removed.");for(t=e;t<L;t++)for(r in k)k.hasOwnProperty(r)&&(t===L-1?k[r][t]=0:k[r][t]=k[r][t+1]);L--,updateParticlesAccelerations()},setupBodiesRandomly:function(t){var n=Math.floor(Math.sqrt(L)),r=Math.ceil(L/n),i,o,u,a,f,l,c,h;f=s[0]/(1+r),a=s[1]/(1+n),i=-1;for(o=1;o<=n;o++)for(u=1;u<=r;u++){i++;if(i===L)break;l=math.normal(1,.25),c=2*Math.random()*Math.PI,h={x:u*f,y:o*a,mass:Math.random()*5,vx:l*Math.cos(c),vy:l*Math.sin(c)},h.radius=radiusFromMass(h.mass),e.setBodyProperties(i,h)}},radiusFromMass:function(e){var t=1e3,n=e/t,r;return r=Math.pow(n/(4/3*Math.PI),1/3),r},integrate:function(e,t){var n,r,i=p;e===undefined&&(e=100),t===undefined&&(t=.1),d=t,v=d*d,p===0&&B(),n=Math.floor(e/d);for(r=1;r<=n;r++)p=i+r*d,F(),q(),I(),B(),F(),R()},getNumberOfBodies:function(){return L},computeOutputState:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,d,v,m,g,y,b,w,E,S,x,T,N;e.time=p},getState:function(){return[new a(k),{clone:function(){return p},restore:function(t){e.setTime(t)}}]}},M(),e}}),define("solar-system/models/metadata",[],function(){return{mainProperties:{type:{defaultValue:"solar-system",immutable:!0},imagePath:{defaultValue:"",immutable:!0},minX:{defaultValue:-25,immutable:!0},maxX:{defaultValue:25,immutable:!0},minY:{defaultValue:-25,immutable:!0},maxY:{defaultValue:25,immutable:!0},width:{defaultValue:50},height:{defaultValue:50},unitsScheme:{defaultValue:"solar-system"},modelSampleRate:{defaultValue:"default"},timeStep:{defaultValue:.1,storeInTickHistory:!0},timeStepsPerTick:{defaultValue:50,storeInTickHistory:!0},horizontalWrapping:{defaultValue:!1},verticalWrapping:{defaultValue:!1}},viewOptions:{viewPortWidth:{unitType:"length",immutable:!0},viewPortHeight:{unitType:"length",immutable:!0},viewPortZoom:{defaultValue:1},viewPortX:{unitType:"length"},viewPortY:{unitType:"length"},viewPortDrag:{defaultValue:!1},showClock:{defaultValue:!0,storeInTickHistory:!0},showBodyTrace:{defaultValue:!1,storeInTickHistory:!0},bodyTraceId:{defaultValue:0,storeInTickHistory:!0},backgroundColor:{defaultValue:"#eeeeee"},bodyTraceColor:{defaultValue:"#ee8833"},markColor:{defaultValue:"#f8b500"},images:{defaultValue:[]},imageMapping:{defaultValue:{}},textBoxes:{defaultValue:[]},fitToParent:{defaultValue:!1},xlabel:{defaultValue:!1},ylabel:{defaultValue:!1},xunits:{defaultValue:!1},yunits:{defaultValue:!1},controlButtons:{defaultValue:"play"},gridLines:{defaultValue:!1},planetNumbers:{defaultValue:!1},enableBodyTooltips:{defaultValue:!1},enableKeyboardHandlers:{defaultValue:!0},planetTraceColor:{defaultValue:"#6913c5"}},body:{x:{required:!0},y:{required:!0},vx:{defaultValue:0},vy:{defaultValue:0},ax:{defaultValue:0,serialize:!1},ay:{defaultValue:0,serialize:!1},mass:{defaultValue:1},radius:{},pinned:{defaultValue:!1},visible:{defaultValue:1},marked:{defaultValue:0},px:{readOnly:!0,serialize:!1},py:{readOnly:!0,serialize:!1},speed:{readOnly:!0,serialize:!1}},textBox:{text:{defaultValue:""},x:{defaultValue:0,unitType:"length"},y:{defaultValue:0,unitType:"length"},anchor:{defaultValue:"lower-left"},layer:{defaultValue:1},width:{},height:{},frame:{},color:{},backgroundColor:{defaultValue:"white"},strokeWidthEms:{defaultValue:.03},strokeOpacity:{defaultValue:1},rotate:{defaultValue:0},fontScale:{defaultValue:1},hostType:{},hostIndex:{},textAlign:{}}}}),define("solar-system/models/unit-definitions/solar-system",[],function(){return{name:"solar-system",translated:!1,units:{length:{name:"Astronomical Unit",pluralName:"Astronomical Units",symbol:"AU"},mass:{name:"Earth Mass",pluralName:"Earth Masses",symbol:"M"},time:{name:"day",pluralName:"days",symbol:"D",displayValue:{unitsPerBaseUnit:1,name:"day",pluralName:"days",symbol:"D"}},velocity:{name:"Astronomical Unit per day",pluralName:"Astronomical Units per day",symbol:"AU/D"},acceleration:{name:"Astronomical Unit per day squared",pluralName:"Astronomical Units per day squared",symbol:"AU/D²"},momentum:{name:"Earth Mass Astronomical Unit per day",pluralName:"Earth Mass Astronomical Units per day",symbol:"M⋅AU/D"},force:{name:"Earth Mass Astronomical Unit per day squared",pluralName:"Earth Mass Astronomical Units per day squared",symbol:"M⋅AU/D²"},energy:{name:"joules",pluralName:"joules",symbol:"J"},temperature:{name:"Kelvin",pluralName:"Kelvin",symbol:"K"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}}}),define("solar-system/models/unit-definitions/index",["require","solar-system/models/unit-definitions/solar-system","underscore"],function(e){var t={solarSystem:e("solar-system/models/unit-definitions/solar-system")},n=e("underscore");return{get:function(e){var r;return e==="solar-system"?t.solarSystem:(r=n.extend({},t[e]),r.units=n.extend({},t.solarSystem.units,t[e].units),r)}}}),define("solar-system/models/modeler",["require","arrays","common/console","solar-system/models/engine/solar-system","solar-system/models/metadata","common/models/tick-history","common/property-support","common/serialize","common/validator","solar-system/models/engine/constants/units","common/property-description","solar-system/models/unit-definitions/index","underscore"],function(e){var t=e("arrays"),n=e("common/console"),r=e("solar-system/models/engine/solar-system"),i=e("solar-system/models/metadata"),s=e("common/models/tick-history"),o=e("common/property-support"),u=e("common/serialize"),a=e("common/validator"),f=e("solar-system/models/engine/constants/units"),l=e("common/property-description"),c=e("solar-system/models/unit-definitions/index"),h=e("underscore");return function(t){function H(e,t,n){var r,s,o;if(e==="mainProperty")r=i.mainProperties;else{if(e!=="viewOption")throw new Error(e+" is not a supported built-in property type");r=i.viewOptions}s={type:e,writable:a.propertyIsWritable(r[t]),set:n,includeInHistoryState:!!r[t].storeInTickHistory,validate:function(e){return a.validateSingleProperty(r[t],t,e,!1)}},d.defineProperty(t,s)}function B(e,t){var r=f.get("timeStep"),i,s;return n.time("integration"),x.integrate(f.get("timeStepsPerTick")*r,r),n.timeEnd("integration"),n.time("reading model state"),I(),n.timeEnd("reading model state"),n.time("tick history push"),S.push(),n.timeEnd("tick history push"),y=!0,t||p.tick(),m}function j(e){return properties[e]}function F(e,t){e=h.extend({},e);for(var n in e)e.hasOwnProperty(n)&&(e[n]=t(n,e[n]));return e}function I(){z(),d.deleteComputedPropertyCachedValues(),L.forEach(function(e){A[e].addSample()}),d.notifyAllComputedProperties()}function q(){if(C)return;k++,k===0&&(d.storeComputedProperties(),d.deleteComputedPropertyCachedValues(),d.enableCaching=!1),k++}function R(){if(C)return;k--,k===0&&(d.enableCaching=!0),x&&z(),L.forEach(function(e){A[e].addSample()}),k===0&&(d.enableCaching=!0,d.notifyChangedComputedProperties(),S&&S.invalidateFollowingState(),p.invalidation())}function z(){var e,t,n;x.computeOutputState(E),W();for(e=0,n=f.get_num_bodies();e<n;e++)for(t in T)T.hasOwnProperty(t)&&(N[e][t]=T[t][e])}function W(){var e,t;N||(N=[]);for(e=N.length,t=f.get_num_bodies();e<t;e++)N[e]||(N[e]={idx:e});N.length=t}this.constructor.type="solar-system";var f={},p=d3.dispatch("tick","play","stop","reset","stepForward","stepBack","seek","addBody","removeBody","invalidation","textBoxesChanged"),d=new o({types:["output","parameter","mainProperty","viewOption"]}),v=1e3,m=!0,g=!1,y=!1,b,w=[],E,S,x,T,N,C=!1,k=0,L=[],A={},O,M,D,P,U=function(){var e=[{getNum:"getNumberOfBodies",addEvent:"addBody",removeEvent:"removeBody"}];return function(t){var n,r,i;for(n=0;n<e.length;n++)r=e[n],r.num=x[r.getNum]();t();for(n=0;n<e.length;n++)r=e[n],i=x[r.getNum](),i>r.num?p[r.addEvent]():i<r.num&&p[r.removeEvent]()}}();return d.mixInto(f),M=f.set,f.set=function(e,t){x&&q(),M(e,t),x&&R()},f.addPropertiesListener=function(e,t){typeof e=="string"?f.addObserver(e,t):e.forEach(function(e){f.addObserver(e,t)})},f.defineOutput=function(e,t,n){d.defineProperty(e,{type:"output",writable:!1,get:n,includeInHistoryState:!1,description:new l(O,t)})},f.defineFilteredOutput=function(e,t,n,r,i){var s,o;if(r!=="RunningAverage")throw new Error("FilteredOutput: unknown filter type "+r+".");s=new RunningAverageFilter(i),o=f.get(n);if(o===undefined||isNaN(Number(o)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");s.addSample(f.get("time"),o),L.push(e),A[e]={addSample:function(){s.addSample(f.get("time"),f.get(n))}},S.registerExternalObject({push:function(){},extract:function(e){s.setCurrentStep(e)},invalidate:function(e){s.invalidate(e)},setHistoryLength:function(e){s.setMaxBufferLength(e)}}),t.property=n,t.type=r,t.period=i,f.
defineOutput(e,t,function(){return s.calculate()})},f.defineParameter=function(e,t,n){var r={type:"parameter",includeInHistoryState:!0,invokeSetterAfterBulkRestore:!1,description:new l(O,t)};n&&(r.set=function(e){n.call(f,e)}),d.defineProperty(e,r)},f.stepCounter=function(){return S.get("counter")},f.stepStartCounter=function(){return S.get("startCounter")},f.steps=function(){return S.get("length")},f.isNewStep=function(){return y},f.seek=function(e){return arguments.length||(e=0),f.isStopped()||f.stop(),y=!1,U(function(){S.seekExtract(e),I(),p.seek()}),S.get("counter")},f.stepBack=function(e){return arguments.length||(e=1),f.isStopped()||f.stop(),y=!1,U(function(){var t,n;t=-1;while(++t<e)n=S.get("index"),n>0&&(S.decrementExtract(),I(),p.stepBack())}),S.get("counter")},f.stepForward=function(e){return arguments.length||(e=1),f.isStopped()||f.stop(),U(function(){var t,n,r;t=-1;while(++t<e)n=S.get("index"),r=S.get("length"),n<r-1?(S.incrementExtract(),I(),p.stepForward()):B()}),S.get("counter")},f.initializeDimensions=function(){f.set({width:f.get("maxX")-f.get("minX")}),f.set({height:f.get("maxY")-f.get("minY")})},f.initializeEngine=function(){x=r.createEngine(),x.setDimensions([f.get("minX"),f.get("minY"),f.get("maxX"),f.get("maxY")]),x.setHorizontalWrapping(f.get("horizontalWrapping")),x.setVerticalWrapping(f.get("verticalWrapping")),window.state=E={},T=x.bodies},f.createBodies=function(e){var t={supressCheck:!0,deserialization:!0},n,r,i,s;q(),typeof e=="number"?r=e:e.num!==undefined?r=e.num:e.x&&(r=e.x.length);if(e.x&&e.y)for(n=0;n<r;n++){s={};for(i in e)e.hasOwnProperty(i)&&(s[i]=e[i][n]);s.radius||(s.radius=x.radiusFromMass(e.mass[n])),f.addBody(s,t)}else{for(n=0;n<r;n++)s={x:0,y:0},f.addBody(s,t);x.setupBodiesRandomly()}return R(),p.reset(),f},f.reset=function(){x.setTime(0),S.restoreInitialState(),p.reset()},f.addRandomBody=function(){var e=f.get("width"),t=f.get("height"),n=f.get("minX"),r=f.get("minY"),i={},s,o;return o=Math.random()*10,s=x.radiusFromMass(o),i={x:n+Math.random()*e-2*s,y:r+Math.random()*t-2*s,vx:(Math.random()-.5)/100,vy:(Math.random()-.5)/100,mass:o,radius:s},f.addBody(i),!1},f.addBody=function(e,t){var n=f.get("minX"),r=f.get("minY"),s=f.get("maxX"),o=f.get("maxY");return t=t||{},e=a.validateCompleteness(i.body,e),t.deserialization||q(),x.addBody(e),t.deserialization||R(),t.supressEvent||p.addBody(),!0},f.removeBody=function(e,t){t=t||{},q(),x.removeBody(e),N.length=0,R(),t.supressEvent||p.removeplanet()},f.setBodyProperties=function(e,t,n,r){var s,o,u,f,l,c;t=a.validate(i.body,t);if(n){var h=typeof t.x=="number"?t.x:T.x[e],p=typeof t.y=="number"?t.y:T.y[e];if(!x.canPlaceplanet(el,h,p,e))return!1}return q(),x.setBodyProperties(e,t),R(),!0},f.getBodyProperties=function(e){var t=i.body,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=T[r][e]);return n},f.addTextBox=function(e){e=a.validateCompleteness(i.textBox,e),f.get("textBoxes").push(e),p.textBoxesChanged()},f.removeTextBox=function(e){var t=f.get("textBoxes");if(!(e>=0&&e<t.length))throw new Error('Text box "'+e+'" does not exist, so it cannot be removed.');f.set("textBoxes",t.slice(0,e).concat(t.slice(e+1))),p.textBoxesChanged()},f.setTextBoxProperties=function(e,t){var n=f.get("textBoxes")[e],r;if(!n)throw new Error('Text box "'+e+'" does not exist, so it cannot have properties set.');t=a.validate(i.textBox,t);for(r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);p.textBoxesChanged()},f.isStopped=function(){return m},f.get_bodies=function(){return T},f.get_results=function(){return N},f.get_num_bodies=function(){return x.getNumberOfBodies()},f.on=function(e,t){return p.on(e,t),f},f.tickInPlace=function(){return p.tick(),f},f.tick=function(e,t){arguments.length||(e=1);var n=t&&t.dontDispatchTickEvent||!1,r=-1;while(++r<e)B(null,n);return f},f.start=function(){return f.resume()},f.restart=function(){g=!0},f.resume=function(){return n.time("gap between frames"),f.timer(function(t){return n.timeEnd("gap between frames"),m?!0:g?(setTimeout(f.resume,0),!0):(B(t,!1),n.time("gap between frames"),!1)}),g=!1,m&&(m=!1,p.play()),f},f.timer=function(e){var t,n=f.get("modelSampleRate");n==="default"?d3.timer(e):t=window.setInterval(function(){e()&&window.clearInterval(t)},1e3/n)},f.stop=function(){return m=!0,p.stop(),f},f.getUnitDefinition=function(e){return O.units[e]},f.serialize=function(){var e={},t,n,r,s=function(t,n){e.bodies[t].every(function(e){return e===n})&&delete e.bodies[t]};return e=u(i.mainProperties,properties),e.viewOptions=u(i.viewOptions,properties),e.bodies=u(i.body,T,x.getNumberOfBodies()),e.viewOptions.showBodyTrace===!1&&delete e.viewOptions.bodyTraceId,s("marked",i.body.marked.defaultValue),s("visible",i.body.visible.defaultValue),e},function(){if(!t.viewOptions||!t.viewOptions.textBoxes)return;var e=t.viewOptions.textBoxes,n,r;for(n=0,r=e.length;n<r;n++)e[n]=a.validateCompleteness(i.textBox,e[n])}(),P=a.validateCompleteness(i.viewOptions,t.viewOptions||{}),D=a.validateCompleteness(i.mainProperties,t),O=c.get(D.unitsScheme),function(){var e={modelSampleRate:function(){m||f.restart()}};Object.keys(i.mainProperties).forEach(function(t){H("mainProperty",t,e[t])}),d.setRawValues(D)}(),Object.keys(i.viewOptions).forEach(function(e){H("viewOption",e)}),d.setRawValues(P),f.initializeDimensions(),f.initializeEngine(),t.bodies&&f.createBodies(t.bodies),S=new s({getProperties:function(){return d.historyStateRawValues},restoreProperties:d.setRawValues,state:x.getState()},f,v),y=!0,mainPropertyUnitTypes={},h.each(i.mainProperties,function(e,t){e.unitType&&(mainPropertyUnitTypes[t]={unitType:e.unitType})}),f.defineOutput("time",{label:"Time",unitType:"time",format:"f"},function(){return E.time}),f.defineOutput("timePerTick",{label:"Model time per tick",unitType:"time",format:"f"},function(){return f.get("timeStep")*f.get("timeStepsPerTick")}),function(){var e;O.units.time.displayValue?e=O.units.time.displayValue:(e=h.extend({},O.units.time),e.unitsPerBaseUnit=1),f.defineOutput("displayTime",{label:"Time",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".1f"},function(){return f.get("time")*e.unitsPerBaseUnit}),f.defineOutput("displayTimePerTick",{label:"Model time per tick",unitName:e.name,unitPluralName:e.pluralName,unitAbbreviation:e.symbol,format:".3f"},function(){return f.get("timePerTick")*e.unitsPerBaseUnit})}(),f.defineOutput("tickCounter",{label:"Tick Counter",unitType:"",format:"4g"},function(){return S.get("counter")}),f.defineOutput("newStep",{label:"New Step",unitType:"",format:""},function(){return y}),I(),f}}),define("solar-system/views/renderer",["require","lab.config","common/console","cs!common/layout/wrap-svg-text","common/views/gradients"],function(e){var t=e("lab.config"),n=e("common/console"),r=e("cs!common/layout/wrap-svg-text"),i=e("common/views/gradients");return function(r,s){function W(){var e,t,n,r,o;r=s.get("markColor"),t=d3.rgb(r),n=t.brighter(1).toString(),o=t.darker(1).toString(),i.createRadialGradient("mark-grad",n,r,o,b),i.createRadialGradient("neutral-grad","#FFFFFF","#f2f2f2","#A4A4A4",b)}function X(e){return e.marked?"url(#mark-grad)":"url(#neutral-grad)"}function V(){b.selectAll("circle").data(m).attr("r",function(e){return d(e.radius)})}function $(){var e,t;S.length=m.length;for(e=0,t=m.length;e<t;e++)S[e]=X(m[e])}function J(){b.selectAll("circle").remove(),b.selectAll("g.label").remove(),T=b.selectAll("circle").data(m),Q(),N=b.selectAll("g.label").data(m),C=N.enter().append("g").attr("class","label").attr("transform",function(e){return"translate("+d(e.x)+","+v(e.y)+")"}),C.each(function(e){var t=d3.select(this),n,r;s.get("astromonicalBodyNumbers")&&t.append("text").text(e.idx).style("font-size",d(1.4*e.radius)+"px"),r=t.selectAll("text"),r.node()&&(r.attr("pointer-events","none").style({"font-weight":"bold",opacity:.7}),r.attr({x:-r.node().getComputedTextLength()/2,y:"0.31em"})),t.select("text.shadow").style({stroke:"#fff","stroke-width":.15*d(e.radius),"stroke-opacity":.7})})}function K(){b.selectAll("path.bodyTrace").remove(),R="",j=s.get("showBodyTrace"),F=s.get("bodyTraceId"),j&&(q=b.selectAll("path.bodyTrace").data([m[F]]),tt())}function Q(){T.enter().append("circle").attr({r:function(e){return d(e.radius)},cx:function(e){return d(e.x)},cy:function(e){return v(e.y)},"fill-opacity":function(e){return e.visible},fill:function(e,t){return S[t]}}).on("mousedown",Z).on("mouseover",Y).on("mouseout",it)}function G(){T.attr({r:function(e){return d(e.radius)},cx:function(e){return d(e.x)},cy:function(e){return v(e.y)}}),(x===0||x>0)&&rt(x)}function Y(e,t){s.get("enableBodyTooltips")&&rt(t)}function Z(e,t){r.node.focus(),s.get("enableBodyTooltips")&&(x!==!1?(k.style("opacity",1e-6),k.style("display","none"),x=!1):(d3.event.shiftKey?x=t:x=!1,rt(t)))}function et(){q.attr({d:nt})}function tt(){q.enter().append("path").attr({"class":"bodyTrace",d:nt,"stroke-width":z,stroke:I,fill:"none"})}function nt(e){var t=Math.floor(d(e.x)*100)/100,n=Math.floor(v(e.y)*100)/100,r,i;return R?(R+=t+","+n+" ",R.length>U&&(r=R.indexOf("L"),i=R.indexOf(" "),R="M"+R.slice(r+1,i)+"L"+R.slice(i+1)),R):(R="M"+t+","+n+"L","M "+t+","+n)}function rt(e){k.style("opacity",1).style("display","inline").style("background","rgba(100%, 100%, 100%, 0.7)").style("left",d(m[e].x)+60+"px").style("top",v(m[e].y)+30+"px").style("zIndex",100).transition().duration(250),L.text("astromonicalBody: "+e+"\n"+"time: "+modelTimeLabel()+"\n"+"speed: "+d3.format("+6.3e")(m[e].speed)+"\n"+"vx:    "+d3.format("+6.3e")(m[e].vx)+"\n"+"vy:    "+d3.format("+6.3e")(m[e].vy)+"\n"+"ax:    "+d3.format("+6.3e")(m[e].ax)+"\n"+"ay:    "+d3.format("+6.3e")(m[e].ay)+"\n")}function it(){!x&&x!==0&&k.style("opacity",1e-6).style(NaN)}function st(){k===undefined&&(k=d3.select("body").append("div").attr("class","tooltip").style("opacity",1e-6),L=k.append("pre"))}function ot(){M=s.get("images"),_=s.get("imageMapping"),D=s.get("imagePath"),D?B=t.actualRoot+D:r.url&&(B=t.actualRoot+r.url.slice(0,r.url.lastIndexOf("/")+1)),I=s.get("bodyTraceColor")}function ut(){function e(e){return function(){e(),r.updateClickHandlers()}}d=r.model2px,v=r.model2pxInv,A=r.getFontSizeInPixels(),O=A*.9,z=A/12,m=s.get_results(),u=s.get("width"),a=s.get("height"),p=u/a,ot(),modelMinX=s.get("minX"),modelMinY=s.get("minY"),modelMaxX=s.get("maxX"),modelMaxY=s.get("maxY"),st(),s.addPropertiesListener(["showBodyTrace","bodyTraceId","backgroundColor","markColor"],e(ft)),s.on("addBody",e(ft)),s.on("removeBody",e(ft))}function at(e){s=e,ut()}function ft(e,t){arguments.length&&(d=e,v=t),A=r.getFontSizeInPixels(),O=A*.9,W(),K(),$(),J()}function lt(){n.time("view update"),G(),j&&et(),n.timeEnd("view update")}var o={},u,a,f,l,c,h,p,d,v,m,g=r.viewport.append("g").attr("class","image-container-below"),y=r.viewport.append("g").attr("class","text-container-below"),b=r.viewport.append("g").attr("class","main-container"),w=r.viewport.append("g").attr("class","image-container-top"),E=r.viewport.append("g").attr("class","text-container-top"),S=[],x,T,N,C,k,L,A,O,M,_,D,P=[],H,B,j,F,I,q,R,U=35500,z;return o={update:lt,repaint:ft,bindModel:at,model2px:r.model2px,model2pxInv:r.model2pxInv},o}}),define("solar-system/views/view",["require","common/views/svg-container","solar-system/views/renderer"],function(e){var t=e("common/views/svg-container"),n=e("solar-system/views/renderer");return function(e,r){return new t(e,r,n)}}),define("solar-system/controllers/scripting-api",["require"],function(e){return function(t){return{getNumberOfBodies:function(){return model.get_num_bodies()},addBody:function(t,n){return n&&n.supressRepaint&&(n.supressEvent=!0),model.addBody(t,n)},removeBody:function(t,n){n&&n.supressRepaint&&(n.supressEvent=!0,delete n.supressRepaint);try{model.removeBody(t,n)}catch(r){if(!n||!n.silent)throw r}},addRandomBody:function(){return model.addRandomBody.apply(model,arguments)},randomBodies:function(n){var r=model.get_num_bodies();n===null&&(n=1+t.randomInteger(r-1));if(!t.isInteger(n))throw new Error("randomBodies: number of bodies requested, "+n+", is not an integer.");if(n<0)throw new Error("randomBodies: number of bodies requested, "+n+", was less be greater than zero.");return n>r&&(n=r),t.choose(n,r)},markBodies:function n(){var e,r;if(arguments.length===0)return;if(t.isArray(arguments[0]))return n.apply(null,arguments[0]);t.unmarkAllBodies();for(e=0,r=arguments.length;e<r;e++)model.setBodyProperties(arguments[e],{marked:1});t.repaint()},unmarkAllBodies:function(){for(var n=0,r=model.get_num_bodies();n<r;n++)model.setBodyProperties(n,{marked:0});t.repaint()},traceBody:function(t){if(t===null)return;model.set({bodyTraceId:t}),model.set({showBodyTrace:!0})},untraceBody:function(){model.set({showBodyTrace:!1})},setBodyProperties:function(n,r,i,s,o){model.setBodyProperties(n,r,i,s),(!o||!o.supressRepaint)&&t.repaint()},getBodyProperties:function(t){return model.getBodyProperties(t)},addTextBox:function(e){model.addTextBox(e)},removeTextBox:function(e){model.removeTextBox(e)},setTextBoxProperties:function(e,t){model.setTextBoxProperties(e,t)}}}}),define("solar-system/benchmarks/benchmarks",["require"],function(e){return function(t){var n=[{name:"commit",numeric:!1,run:function(e){var t="<a href='"+Lab.version.repo.commit.url+"' class='opens-in-new-window' target='_blank'>"+Lab.version.repo.commit.short_sha+"</a>";Lab.version.repo.dirty&&(t+=" <i>dirty</i>"),e(t)}},{name:"bodies",numeric:!0,run:function(e){e(model.get_num_bodies())}},{name:"just graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n,r,i;model.stop(),r=+Date.now(),i=-1;while(i++<100)t.modelContainer.update();n=Date.now()-r,e(100/n*1e3)}},{name:"model (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n,r;model.stop(),n=+Date.now(),r=-1;while(r++<100)model.tick(1,{dontDispatchTickEvent:!0});t=Date.now()-n,e(100/t*1e3)}},{name:"model+graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n,r;model.stop(),t=+Date.now(),r=-1;while(r++<100)model.tick();n=Date.now()-t,e(100/n*1e3)}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(e){model.start(),setTimeout(function(){model.stop();var t=model.get("time");setTimeout(function(){model.start(),setTimeout(function(){model.stop();var n=model.get("time")-t;e(n/(model.get("timeStepsPerTick")*model.get("timeStep"))/2)},2e3)},100)},1e3)}},{name:"interactive",numeric:!1,run:function(e){e(window.location.pathname+window.location.hash)}}];return n}}),define("solar-system/controllers/controller",["require","common/controllers/model-controller","solar-system/models/modeler","solar-system/views/view","solar-system/controllers/scripting-api","solar-system/benchmarks/benchmarks"],function(e){var t=e("common/controllers/model-controller"),n=e("solar-system/models/modeler"),r=e("solar-system/views/view"),i=e("solar-system/controllers/scripting-api"),s=e("solar-system/benchmarks/benchmarks");return function(e,o,u){return new t(e,o,u,n,r,i,s)}}),define("signal-generator/metadata",[],function(){return{mainProperties:{type:{defaultValue:"signal-generator",immutable:!0},frequency:{defaultValue:1,unitType:"frequency",propertyChangeInvalidates:!0},modelSampleRate:{defaultValue:60,propertyChangeInvalidates:!0},timeScale:{defaultValue:1,unitType:"time",propertyChangeInvalidates:!0}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1}}}}),define("signal-generator/modeler",["require","common/lab-modeler-mixin","common/validator","signal-generator/metadata"],function(e){var t=e("common/lab-modeler-mixin"),n=e("common/validator"),r=e("signal-generator/metadata"),i={units:{time:{name:"second",pluralName:"seconds",symbol:"s"},frequency:{name:"Hertz",pluralName:"Hertz",symbol:"Hz"},angle:{name:"radian",pluralName:"radians",symbol:"rad"}}};return function(n){function p(e){return e-2*Math.PI*Math.floor(e/(2*Math.PI))}var s={frequency:function(e){a!==undefined&&(f=p(f+2*Math.PI*(a-e)*h.properties.time)),a=e}},o=new t({metadata:r,setters:s,unitsDefinition:i,initialProperties:n}),u=o.dispatchSupport,a,f=0,l=0,c=0,h;return h={tick:function(){var e=1e3/h.properties.modelSampleRate;c++,l+=.001*e*h.properties.timeScale,h.updateAllOutputProperties(),u.tick()},stepCounter:function(){return c}},o.mixInto(h),u.addEventTypes("tick"),h.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return l}),h.defineOutput("displayTime",{label:"Time",unitType:"time",format:".2f"},function(){return l}),h.defineOutput("signalValue",{label:"Signal Value",format:".2f"},function(){return Math.cos(h.properties.angle)}),h.defineOutput("angle",{label:"Angle",unitType:"angle",format:".2f"},function(){var e=f+2*Math.PI*h.properties.frequency*h.properties.time;return p(e)}),h}}),define("common/views/null-model-view",[],function(){return function(){return{$el:$("<div id='model-container' class='container'/>"),getHeightForWidth:function(){return 0},resize:function(){},bindModel:function(){},setup:function(){},update:function(){}}}}),define("signal-generator/controller",["require","common/controllers/model-controller","signal-generator/modeler","common/views/null-model-view"],function(e){var t=e("common/controllers/model-controller"),n=e("signal-generator/modeler"),r=e("common/views/null-model-view"),i=function(){},s=function(){};return function(e,o,u){return new t(e,o,u,n,r,i,s)}}),define("sensor/metadata",[],function(){return{mainProperties:{type:{defaultValue:"sensor",immutable:!0},sensorType:{defaultValue:"goMotion"},samplesPerSecond:{readOnly:!0}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1}}}}),define("sensor/units-definition",[],function(){return{units:{time:{name:"second",pluralName:"seconds",symbol:"s"},distance:{name:"meter",pluralName:"meters",symbol:"m"}}}}),define("common/mini-class",[],function(){function e(e,t){var n={}.hasOwnProperty,r;for(r in t)n.call(t,r)&&(e[r]=t[r])}function t(t,n){function r(){this.constructor=t}e(t,n),r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype}function n(t){function n(t){e(this,t)}return e(n.prototype,t),n}function r(n,r){function i(t){e(this,t)}return t(i,n),e(i.prototype,r),i}return{defineClass:n,extendClass:r,mixin:e}}),define("sensor/applet/mini-event-emitter",[],function(){return{on:function(e,t){this._ee_listeners||(this._ee_listeners={}),this._ee_listeners[e]||(this._ee_listeners[e]=[]),this._ee_listeners[e].push(t)},emit:function(e){var t=arguments.length>1?[].splice.call(arguments,1):[];if(this._ee_listeners&&this._ee_listeners[e])for(var n=0,r=this._ee_listeners[e].length;n<r;n++)this._ee_listeners[e][n].apply(null,t)},removeListener:function(e,t){if(this._ee_listeners&&this._ee_listeners[e])for(var n=0,r=this._ee_listeners[e].length;n<r;n++)this._ee_listeners[e][n]===t&&this._ee_listeners[e].splice(n,1)},removeListeners:function(e){e?this._ee_listeners&&(this._ee_listeners[e]=[]):this._ee_listeners={}}}}),define("sensor/applet/errors",["require","common/inherit"],function(e){function n(e){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=e}function r(){n.apply(this,Array.prototype.slice.apply(arguments))}function i(){n.apply(this,Array.prototype.slice.apply(arguments))}function s(){n.apply(this,Array.prototype.slice.apply(arguments))}var t=e("common/inherit");return t(r,Error),t(i,Error),t(s,Error),window.JavaLoadError=r,{JavaLoadError:r,AppletInitializationError:i,SensorConnectionError:s}}),define("sensor/applet/sensor-applet",["require","common/mini-class","./mini-event-emitter","./errors","lab.config"],function(e){function o(e,t,n,r,i){var s=0,o;o=window.setInterval(function(){s++,e()?(window.clearInterval(o),r()):s>n&&(window.clearInterval(o),i())},t)}var t=e("common/mini-class"),n=e("./mini-event-emitter"),r=e("./errors"),i=e("lab.config"),s;return s=t.defineClass({_state:"not appended",_isInAppletCallback:!1,testAppletReadyInterval:100,getCodebase:function(){return i.actualRoot+"jnlp"},getTestAppletHTML:function(){return["<applet ",'id="',this.appletId,'-test-applet" ','class="applet test-sensor-applet" ','code="org.concord.sensor.applet.DetectionApplet" ','codebase="',this.getCodebase(),'" ','width="150px" ','height="150px" ','MAYSCRIPT="true" ',">",'<param name="MAYSCRIPT" value="true" />',"</applet>"].join("")},getState:function(){return this._state},getIsInAppletCallback:function(){return this._isInAppletCallback},startAppletCallback:function(){if(this.getIsInAppletCallback())throw new Error("SensorApplet.startAppletCallback was called without previous endAppletCallback call");this._isInAppletCallback=!0},endAppletCallback:function(){if(!this.getIsInAppletCallback())throw new Error("SensorApplet.endAppletCallback was called without previous startAppletCallback call");this._isInAppletCallback=!1},append:function(e){if(this.getState()!=="not appended")throw new Error("Can't call append() when sensor applet has left 'not appended' state");this._appendTestAppletHTML(),this._appendCallback=e},_appendTestAppletHTML:function(){$("body").append(this.getTestAppletHTML()),this.testAppletInstance=$("#"+this.appletId+"-test-applet")[0],this._state="test applet appended",this._waitForTestAppletReady()},_waitForTestAppletReady:function(){function t(){try{return e.testAppletInstance.areYouLoaded()}catch(t){return!1}}function n(){e._appendHTML(e.getHTML()),e._state="appended",e._waitForAppletReady()}function i(){e._appendCallback(new r.JavaLoadError("Timed out waiting for test applet to respond."))}var e=this;o(t,this.testAppletReadyInterval,10,n,i)},_waitForAppletReady:function(){function t(){return e.testAppletReady()}function n(){$(e.testAppletInstance).remove(),e.getState()==="appended"&&(e._state="applet ready"),e.isSensorConnected()||e._appendCallback(new r.SensorConnectionError("Device reported the requested sensor type was not attached.")),e.initializeSensor()}function i(){e._appendCallback(new r.AppletInitializationError("Timed out waiting for sensor applet to be ready."))}var e=this;o(t,this.testAppletReadyInterval,10,n,i)},sensorIsReady:function(){var e=this;this._state="stopped",setTimeout(function(){e._appendCallback(null),e._appendCallback=null},10)},start:function(){this.getState()==="stopped"&&(this._state="started",this._startSensor())},stop:function(){this.getState()==="started"&&(this._state="stopped",this._stopSensor())},remove:function(){function t(){e.getState()!=="not appended"&&(e._removeApplet(),e._state="not appended")}var e=this;this.getIsInAppletCallback()?window.setTimeout(function(){t()},10):t()},_appendHTML:function(e){$("body").append(e),this.appletInstance=$("#"+this.appletId)[0]},_removeApplet:function(){$("#"+this.appletId).remove()},getHTML:function(){throw new Error("Override this method!")},testAppletReady:function(){throw new Error("Override this method!")},_startSensor:function(){throw new Error("Override this method!")},_stopSensor:function(){throw new Error("Override this method!")}}),t.mixin(s.prototype,n),s}),define("sensor/applet/vernier-sensor-applet",["require","common/mini-class","./sensor-applet"],function(e){var t=e("common/mini-class"),n=e("./sensor-applet");return t.extendClass(n,{listenerPath:"",measurementType:"",deviceType:"",appletId:"sensor-applet",classNames:"applet sensor-applet",jarUrls:["com/sun/jna/jna.jar","org/concord/sensor/sensor.jar","org/concord/sensor/sensor-vernier/sensor-vernier.jar","org/concord/sensor/sensor-applets/sensor-applets.jar"],deviceSpecificJarUrls:[],code:"org.concord.sensor.applet.SensorApplet",getHTML:function(){var e=this.jarUrls.concat(this.deviceSpecificJarUrls);return["<applet ",'id="',this.appletId,'" ','class="',this.classNames,'" ','archive="',e.join(", "),'" ','code="',this.code,'" ','codebase="',this.getCodebase(),'" ','width="1px" ','height="1px" ','MAYSCRIPT="true" ',">",'<param name="MAYSCRIPT" value="true" />',"</applet>"].join("")},testAppletReady:function(){try{this.appletInstance.getSensorRequest(this.measurementType)}catch(e){return!1}return!0},isSensorConnected:function(){return this.appletInstance.isInterfaceConnected(this.deviceType)},initializeSensor:function(){var e;return this.isSensorConnected()?(e=this.appletInstance.getSensorRequest(this.measurementType),this.appletInstance.initSensorInterface(this.listenerPath,this.deviceType,[e])):!1},_stopSensor:function(){var e=this;this.getIsInAppletCallback()?window.setTimeout(function(){e.appletInstance.stopCollecting()},10):this.appletInstance.stopCollecting()},_startSensor:function(){var e=this;this.getIsInAppletCallback()?window.setTimeout(function(){e.appletInstance.startCollecting()},10):this.appletInstance.startCollecting()},sensorsReady:function(){this.startAppletCallback(),this.sensorIsReady(),this.endAppletCallback()},dataReceived:function(e,t,n){n=n||[],this.startAppletCallback();for(var r=0,i=n.length;r<i;r++)this.emit("data",n[r]);this.endAppletCallback()},deviceUnplugged:function(){var e=this;this.startAppletCallback(),window.setTimeout(function(){e.emit("deviceUnplugged")},10),this.endAppletCallback()},sensorUnplugged:function(){var e=this;this.startAppletCallback(),window.setTimeout(function(){e.emit("sensorUnplugged")},10),this.endAppletCallback()}})}),define("sensor/applet/applet-classes",["require","common/mini-class","./vernier-sensor-applet"],function(e){var t=e("common/mini-class"),n=e("./vernier-sensor-applet");return{goio:t.extendClass(n,{deviceType:"golink",deviceSpecificJarUrls:["org/concord/sensor/goio-jna/goio-jna.jar"]}),labquest:t.extendClass(n,{deviceType:"labquest",deviceSpecificJarUrls:["org/concord/sensor/labquest-jna/labquest-jna.jar"]})}}),define("sensor/applet/sensor-definitions",[],function(){return{goMotion:{appletClass:"goio",measurementType:"distance",sensorName:"GoMotion",deviceName:"GoMotion",samplesPerSecond:20,tareable:!0}}}),define("sensor/modeler",["require","common/property-support","common/property-description","cs!common/running-average-filter","common/validator","./metadata","./units-definition","./applet/applet-classes","./applet/errors","./applet/sensor-definitions","common/controllers/basic-dialog"],function(e){function c(e,t){var n=new l({width:"60%",buttons:t});n.setContent(e),n.open()}var t=e("common/property-support"),n=e("common/property-description"),r=e("cs!common/running-average-filter"),i=e("common/validator"),s=e("./metadata"),o=e("./units-definition"),u=e("./applet/applet-classes"),a=e("./applet/errors"),f=e("./applet/sensor-definitions"),l=e("common/controllers/basic-dialog");return function(l){function A(e,t,r){var u,a,f,l;if(t==="mainProperty")u=s.mainProperties;else{if(t!=="viewOption")throw new Error(t+" is not a supported built-in property type");u=s.viewOptions}f=i.propertyChangeInvalidates(u[e]),a={type:t,writable:i.propertyIsWritable(u[e]),set:r,includeInHistoryState:!!u[e].storeInTickHistory,validate:function(t){return i.validateSingleProperty(u[e],e,t,!1)},beforeSetCallback:f?O:undefined,afterSetCallback:f?M:undefined},l=u[e].unitType,l&&(a.description=new n(o,{unitType:l})),h.defineProperty(e,a)}function O(){N===0&&(h.storeComputedProperties(),h.deleteComputedPropertyCachedValues(),h.enableCaching=!1),N++}function M(){N--,D(),N===0&&(h.enableCaching=!0,h.notifyChangedComputedProperties())}function _(e){O(),e(),M()}function D(){C.forEach(function(e){e.addSample()})}function P(){y.removeListeners("data"),y.removeListeners("deviceUnplugged"),y.removeListeners("sensorUnplugged"),y.remove(),_(function(){w=!1})}function H(){y.on("data",q),y.on("deviceUnplugged",function(){F("device")}),y.on("sensorUnplugged",function(){F("sensor")}),y.append(function(e){if(e){e instanceof a.JavaLoadError?j("It appears that Java applets cannot run in your browser. If you are able to fix this, reload the page to use the sensor"):e instanceof a.AppletInitializationError?j("The sensor applet appears not to be loading. If you are able to fix this, reload the page to use the sensor"):e instanceof a.SensorConnectionError?B():j("There was an unexpected error when connecting to the sensor.");return}_(function(){w=!0})})}function B(){P(),c("The "+L.properties.sensorName+' does not appear to be attached. Try re-attaching it, and then click "Try Again".',{"Try Again":function(){$(this).dialog("close"),H()},Cancel:function(){$(this).dialog("close")}})}function j(e){P(),c(e,{OK:function(){$(this).dialog("close")}})}function F(e){P(),L.stop(),c("The "+L.properties[e+"Name"]+' was unplugged. Try plugging it back in, and then click "Try Again".',{"Try Again":function(){$(this).dialog("close"),H()},Cancel:function(){$(this).dialog("close")}})}function I(e){var t;if(g===e)return;g=e,y&&P(),E=f[g].samplesPerSecond,t=u[f[g].appletClass],y=window.Lab.sensor[g]=new t({listenerPath:"Lab.sensor."+g,measurementType:f[g].measurementType,appletId:g+"-sensor"}),H()}function q(e){T++,S+=1/E,window.__bizarreSafariFix=1,x=e,h.deleteComputedPropertyCachedValues(),h.notifyAllComputedProperties(),D(),m.tick()}var h=new t({types:["mainProperty","viewOption","parameter","output"]}),p,d,v=!0,m=d3.dispatch("play","stop","tick","reset","stepForward","stepBack","seek","invalidation"),g,y,b=!1,w=!1,E,S=0,x,T=0,N=0,C=[],k,L;return L={on:function(e,t){m.on(e,t)},start:function(){if(!L.properties.isPlayable)return;v=!1,y&&y.start(),m.play()},stop:function(){v=!0,y&&y.stop(),m.stop(),_(function(){b=!0})},isStopped:function(){return v},stepCounter:function(){return T},addPropertiesListener:function(e,t){typeof e=="string"?L.addObserver(e,t):e.forEach(function(e){L.addObserver(e,t)})},defineParameter:function(e,t,r){var i={type:"parameter",includeInHistoryState:!0,invokeSetterAfterBulkRestore:!1,description:new n(o,t),beforeSetCallback:O,afterSetCallback:M};r&&(i.set=function(e){r.call(L,e)}),h.defineProperty(e,i)},defineOutput:function(e,t,r){h.defineProperty(e,{type:"output",writable:!1,get:r,includeInHistoryState:!1,description:new n(o,t)})},defineFilteredOutput:function(e,t,n,i,s){var o,u;if(i!=="RunningAverage")throw new Error("FilteredOutput: unknown filter type "+i+".");o=new r(s),u=L.properties[e];if(u===undefined||isNaN(Number(u)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");o.addSample(L.properties.time,u),C.push({addSample:function(){o.addSample(L.properties.time,L.properties[n])}}),t.property=n,t.type=i,t.period=s,L.defineOutput(e,t,function(){return o.calculate()})}},window.Lab===undefined&&(window.Lab={}),window.Lab.sensor={},h.mixInto(L),k={sensorType:I},d=i.validateCompleteness(s.mainProperties,l),Object.keys(d).forEach(function(e){A(e,"mainProperty",k[e])}),h.setRawValues(d),p=i.validateCompleteness(s.viewOptions,l.viewOptions||{}),Object.keys(p).forEach(function(e){A(e,"viewOption")}),h.setRawValues(p),L.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return S}),L.defineOutput("displayTime",{label:"Time",unitType:"time",format:".2f"},function(){return S}),L.defineOutput("sensorReading",{label:"Sensor Reading",format:".2f"},function(){return x}),L.defineOutput("sensorName",{label:"Sensor Name"},function(){return f[g].sensorName}),L.defineOutput("deviceName",{label:"Sensor Interface Device Name"},function(){return f[g].deviceName}),L.defineOutput("isPlayable",{label:"Playable"},function(){return!b&&w}),I(L.properties.sensorType),L}}),define("sensor/controller",["require","common/controllers/model-controller","sensor/modeler","common/views/null-model-view"],function(e){var t=e("common/controllers/model-controller"),n=e("sensor/modeler"),r=e("common/views/null-model-view"),i=function(){},s=function(){};return function(e,o,u){return new t(e,o,u,n,r,i,s)}}),define("energy2d/models/constants",["require","exports","module"],function(e,t,n){"use strict";t.AIR_THERMAL_CONDUCTIVITY=.025,t.AIR_SPECIFIC_HEAT=1012,t.AIR_DENSITY=1.204,t.AIR_VISCOSITY=1568e-8,t.STEFAN_CONSTANT=5.67e-8}),define("energy2d/metadata",["require","energy2d/models/constants"],function(e){var t=e("energy2d/models/constants");return{mainProperties:{type:{defaultValue:"energy2d",immutable:!0},use_WebGL:{defaultValue:!1},grid_width:{defaultValue:100,immutable:!0},grid_height:{defaultValue:100,immutable:!0},model_width:{defaultValue:10,immutable:!0},model_height:{defaultValue:10,immutable:!0},timeStep:{defaultValue:1},timeStepsPerTick:{defaultValue:4},ticksPerGPUSync:{defaultValue:30},convective:{defaultValue:!0},background_temperature:{defaultValue:0},background_conductivity:{defaultValue:t.AIR_THERMAL_CONDUCTIVITY},background_specific_heat:{defaultValue:t.AIR_SPECIFIC_HEAT},background_density:{defaultValue:t.AIR_DENSITY},background_viscosity:{defaultValue:t.AIR_VISCOSITY},thermal_buoyancy:{defaultValue:25e-5},buoyancy_approximation
:{defaultValue:1},boundary:{defaultValue:{type:"temperature",upper:0,lower:0,left:0,right:0}},measurement_interval:{defaultValue:500},viewupdate_interval:{defaultValue:100},stoptime:{},sunny:{defaultValue:!1},sun_angle:{defaultValue:1.5707964},solar_power_density:{defaultValue:2e3},solar_ray_count:{defaultValue:24},solar_ray_speed:{defaultValue:.1},photon_emission_interval:{defaultValue:20},structure:{}},viewOptions:{showClock:{defaultValue:!0,propertyChangeInvalidates:!1},controlButtons:{defaultValue:"play_reset",propertyChangeInvalidates:!1},color_palette_type:{defaultValue:0},velocity:{defaultValue:!1},minimum_temperature:{defaultValue:0},maximum_temperature:{defaultValue:40},enableKeyboardHandlers:{defaultValue:!0}},part:{rectangle:{conflictsWith:["ellipse","ring","polygon"]},ellipse:{conflictsWith:["rectangle","ring","polygon"]},ring:{conflictsWith:["rectangle","ellipse","polygon"]},polygon:{conflictsWith:["rectangle","ellipse","ring"]},shapeType:{readOnly:!0,serialize:!1},x:{serialize:!1},y:{serialize:!1},width:{serialize:!1},height:{serialize:!1},a:{serialize:!1},b:{serialize:!1},inner:{serialize:!1},outer:{serialize:!1},raw_x_coords:{serialize:!1},raw_y_coords:{serialize:!1},thermal_conductivity:{defaultValue:1},specific_heat:{defaultValue:1300},density:{defaultValue:25},transmission:{defaultValue:0},reflection:{defaultValue:0},absorption:{defaultValue:1},emissivity:{defaultValue:0},temperature:{defaultValue:0},constant_temperature:{defaultValue:!1},power:{defaultValue:0},wind_speed:{defaultValue:0},wind_angle:{defaultValue:0},visible:{defaultValue:!0},filled:{defaultValue:!0},color:{defaultValue:"auto"},label:{},texture:{},uid:{},draggable:{defaultValue:!0}},sensor:{type:{required:!0,immutable:!0},x:{required:!0,unitType:"length"},y:{required:!0,unitType:"length"},angle:{immutable:!0},label:{defaultValue:""},value:{readOnly:!0,serialize:!1}}}}),define("energy2d/models/physics-solvers/heat-solver",["require","exports","module","arrays"],function(e,t){"use strict";var n=e("arrays"),r=5;t.makeHeatSolver=function(e){var t=e.getModelOptions(),i=t.grid_width,s=t.grid_height,o=r,u=e.getConductivityArray(),a=e.getCapacityArray(),f=e.getDensityArray(),l=e.getUVelocityArray(),c=e.getVVelocityArray(),h=e.getBoundaryTemperatureArray(),p=e.getFluidityArray(),d=n.create(i*s,0,e.getArrayType()),v=i-1,m=s-1,g=i-2,y=s-2,b=t.model_width/t.grid_width,w=t.model_height/t.grid_height,E=function(e){var n=t.boundary,r=n.upper,o=n.lower,a=n.left,f=n.right,l,c,h,p;if(n.type==="temperature"){for(l=0;l<i;l+=1)h=l*i,e[h]=r,e[h+m]=o;for(c=0;c<s;c+=1)e[c]=a,e[v*i+c]=f}else if(n.type==="flux"){for(l=0;l<i;l+=1)h=l*i,p=h+m,e[h]=e[h+1]+r*w/u[h],e[p]=e[h+y]-o*w/u[p];for(c=0;c<s;c+=1)e[c]=e[i+c]-a*b/u[c],e[v*i+c]=e[g*i+c]+f*b/u[v*i+c]}},S=function(e){var n=t.timeStep,r=.5*n/b,s=.5*n/w,o,u,a,f,h,g,y,S;for(o=1;o<v;o+=1){a=o*i;for(u=1;u<m;u+=1)f=a+u,g=f-i,h=f+i,S=f-1,y=f+1,p[f]&&(d[f]=e[f]-r*(l[h]*e[h]-l[g]*e[g])-s*(c[y]*e[y]-c[S]*e[S]))}E(d);for(o=1;o<v;o+=1){a=o*i;for(u=1;u<m;u+=1)f=a+u,p[f]&&(g=f-i,h=f+i,S=f-1,y=f+1,e[f]=.5*(e[f]+d[f])-.5*r*l[f]*(d[h]-d[g])-.5*s*c[f]*(d[y]-d[S]))}E(e)};return{solve:function(e,r,s){var l=t.timeStep,c=.5/(b*b),p=.5/(w*w),g=1/l,y,x,T,N,C,k,L,A,O,M,_,D,P,H,B;n.copy(r,d);for(L=0;L<o;L+=1){for(A=1;A<v;A+=1){M=A*i;for(O=1;O<m;O+=1)_=M+O,isNaN(h[_])?(P=_-i,D=_+i,B=_-1,H=_+1,x=a[_]*f[_]*g,y=u[_],T=c*(y+u[P]),N=c*(y+u[D]),C=p*(y+u[B]),k=p*(y+u[H]),r[_]=(d[_]*x+s[_]+T*r[P]+N*r[D]+C*r[B]+k*r[H])/(x+T+N+C+k)):r[_]=h[_]}E(r)}e&&S(r)}}}}),define("energy2d/gpu/context",[],function(){"use strict";var e;return{getWebGLContext:function(){if(!e){var t=document.createElement("canvas");try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(n){}if(!e)throw new Error("GL: WebGL not supported.")}return e},get error(){if(!e)return"WebGL unavailable";var t=e.getError();return t===e.NO_ERROR?undefined:t}}}),define("energy2d/gpu/shader",["require","common/console","energy2d/gpu/context"],function(e){"use strict";var t=e("common/console"),n=e("energy2d/gpu/context"),r,i=function(e,t,n){var r;while((r=e.exec(t))!==null)n(r)},s=function(e){var t=Object.prototype.toString.call(e);return t==="[object Array]"||t==="[object Float32Array]"},o=function(e){var t=Object.prototype.toString.call(e);return t==="[object Number]"||t==="[object Boolean]"},u;return u=function(e,t){function f(e,t){var n=r.createShader(e);r.shaderSource(n,t),r.compileShader(n);if(!r.getShaderParameter(n,r.COMPILE_STATUS))throw new Error("Shader: compile error.\n"+r.getShaderInfoLog(n)+"\nSource:\n"+t);return n}var s="      attribute vec4 gl_Vertex;      attribute vec4 gl_TexCoord;      attribute vec3 gl_Normal;      attribute vec4 gl_Color;      ",o="      precision highp float;      ",u=function(e,t){var n={},r;return r=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(t),t=r?r[1]+e+t.substr(r[1].length):e+t,i(/\bgl_\w+\b/g,e,function(e){n[e]===undefined&&(t=t.replace(new RegExp("\\b"+e+"\\b","g"),"_"+e),n[e]=!0)}),t},a={};r=n.getWebGLContext(),e=u(s,e),t=u(o,t),this.program=r.createProgram(),r.attachShader(this.program,f(r.VERTEX_SHADER,e)),r.attachShader(this.program,f(r.FRAGMENT_SHADER,t)),r.linkProgram(this.program);if(!r.getProgramParameter(this.program,r.LINK_STATUS))throw new Error("Shader: link error.\n"+r.getProgramInfoLog(this.program)+"\nSource:\n"+e+"\n\n"+t);this.attributes={},this.uniformLocations={},i(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,e+t,function(e){a[e[2]]=1}),this.isSampler=a},u.prototype.uniforms=function(e){var n,i,u;r.useProgram(this.program);for(n in e)if(e.hasOwnProperty(n)){this.uniformLocations[n]===undefined&&(this.uniformLocations[n]=r.getUniformLocation(this.program,n)),i=this.uniformLocations[n];if(i===null){t.warn("Shader: name "+n+" does not correspond to an active uniform variable.");continue}u=e[n];if(s(u))switch(u.length){case 1:r.uniform1fv(i,new Float32Array(u));break;case 2:r.uniform2fv(i,new Float32Array(u));break;case 3:r.uniform3fv(i,new Float32Array(u));break;case 4:r.uniform4fv(i,new Float32Array(u));break;case 9:r.uniformMatrix3fv(i,!1,new Float32Array([u[0],u[3],u[6],u[1],u[4],u[7],u[2],u[5],u[8]]));break;case 16:r.uniformMatrix4fv(i,!1,new Float32Array([u[0],u[4],u[8],u[12],u[1],u[5],u[9],u[13],u[2],u[6],u[10],u[14],u[3],u[7],u[11],u[15]]));break;default:throw new Error("Shader: don't know how to load uniform \""+n+'" of length '+u.length)}else{if(!o(u))throw new Error('Shader: attempted to set uniform "'+n+'" to invalid value '+u);(this.isSampler[n]?r.uniform1i:r.uniform1f).call(r,i,u)}}return this},u.prototype.draw=function(e,t){r.useProgram(this.program),this.drawBuffers(e.vertexBuffers,e.indexBuffers[t===r.LINES?"lines":"triangles"],arguments.length<2?r.TRIANGLES:t)},u.prototype.drawBuffers=function(e,t,n){var i=0,s,o,u;for(s in e)if(e.hasOwnProperty(s)){o=e[s],this.attributes[s]===undefined&&(this.attributes[s]=r.getAttribLocation(this.program,s.replace(/^gl_/,"_gl_"))),u=this.attributes[s];if(u===-1||!o.buffer)continue;r.bindBuffer(r.ARRAY_BUFFER,o.buffer),r.enableVertexAttribArray(u),r.vertexAttribPointer(u,o.buffer.spacing,r.FLOAT,!1,0,0),i=o.buffer.length/o.buffer.spacing}for(s in this.attributes)this.attributes.hasOwnProperty(s)&&e[s]===undefined&&r.disableVertexAttribArray(this.attributes[s]);i&&(!t||t.buffer)&&(t?(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.buffer),r.drawElements(n,t.buffer.length,r.UNSIGNED_SHORT,0)):r.drawArrays(n,0,i))},u}),define("energy2d/gpu/texture",["require","energy2d/gpu/context"],function(e){"use strict";var t=e("energy2d/gpu/context"),n,r;return r=function(e,r,i){n=t.getWebGLContext(),i=i||{},this.id=n.createTexture(),this.width=e,this.height=r,this.format=i.format||n.RGBA,this.type=i.type||n.UNSIGNED_BYTE,this.tex_unit=null,this.fbo=null,n.bindTexture(n.TEXTURE_2D,this.id),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,i.mag_filter||i.filter||n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i.min_filter||i.filter||n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i.wrap||i.wrap_s||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i.wrap||i.wrap_t||n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,this.format,e,r,0,this.format,this.type,null)},r.prototype.setAsRenderTarget=function(){this.fbo===null?(this.fbo=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,this.fbo),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.id,0),n.viewport(0,0,this.width,this.height)):(n.bindFramebuffer(n.FRAMEBUFFER,this.fbo),n.viewport(0,0,this.width,this.height))},r.prototype.bind=function(e){this.tex_unit=e||0,n.activeTexture(n.TEXTURE0+this.tex_unit),n.bindTexture(n.TEXTURE_2D,this.id)},r.prototype.unbind=function(e){if(this.tex_unit===null)return;n.activeTexture(n.TEXTURE0+this.tex_unit),n.bindTexture(n.TEXTURE_2D,null),this.tex_unit=null},r.prototype.drawTo=function(e){if(this.fbo===null)throw new Error("Texture: call setupAsRenderTarget() method first.");n.bindFramebuffer(n.FRAMEBUFFER,this.fbo),n.viewport(0,0,this.width,this.height),e(),n.bindFramebuffer(n.FRAMEBUFFER,null)},r.prototype.swapWith=function(e){var t;t=e.id,e.id=this.id,this.id=t,t=e.tex_unit,e.tex_unit=this.tex_unit,this.tex_unit=t,t=e.fbo,e.fbo=this.fbo,this.fbo=t},r}),define("energy2d/gpu/mesh",["require","energy2d/gpu/context"],function(e){"use strict";var t=e("energy2d/gpu/context"),n,r,i;return r=function(e,r){n=t.getWebGLContext(),this.buffer=null,this.target=e,this.type=r,this.data=[]},r.prototype.compile=function(e){var t=[],r,i,s;for(r=0,i=1e4;r<this.data.length;r+=i)t=Array.prototype.concat.apply(t,this.data.slice(r,r+i));s=this.data.length?t.length/this.data.length:0;if(s!==Math.round(s))throw new Error("Mesh: buffer elements not of consistent size, average size is "+s);this.buffer=this.buffer||n.createBuffer(),this.buffer.length=t.length,this.buffer.spacing=s,n.bindBuffer(this.target,this.buffer),n.bufferData(this.target,new this.type(t),e||n.STATIC_DRAW)},i=function(e){n=t.getWebGLContext(),e=e||{},this.vertexBuffers={},this.indexBuffers={},this.addVertexBuffer("vertices","gl_Vertex"),e.coords&&this.addVertexBuffer("coords","gl_TexCoord"),e.normals&&this.addVertexBuffer("normals","gl_Normal"),e.colors&&this.addVertexBuffer("colors","gl_Color"),(e.lines===undefined||e.triangles)&&this.addIndexBuffer("triangles"),e.lines&&this.addIndexBuffer("lines")},i.prototype.addVertexBuffer=function(e,t){var i=this.vertexBuffers[t]=new r(n.ARRAY_BUFFER,Float32Array);i.name=e,this[e]=[]},i.prototype.addIndexBuffer=function(e){var t=this.indexBuffers[e]=new r(n.ELEMENT_ARRAY_BUFFER,Uint16Array);this[e]=[]},i.prototype.compile=function(){var e,t,n;for(e in this.vertexBuffers)this.vertexBuffers.hasOwnProperty(e)&&(n=this.vertexBuffers[e],n.data=this[n.name],n.compile());for(t in this.indexBuffers)this.indexBuffers.hasOwnProperty(t)&&(n=this.indexBuffers[t],n.data=this[t],n.compile())},i.plane=function(e){var t,n,r,s,o,u,a,f;e=e||{},t=new i(e),n=e.detailX||e.detail||1,r=e.detailY||e.detail||1;for(o=0;o<=r;o+=1){u=o/r;for(s=0;s<=n;s+=1)a=s/n,t.vertices.push([2*a-1,2*u-1,0]),t.coords&&t.coords.push([a,u]),t.normals&&t.normals.push([0,0,1]),s<n&&o<r&&(f=s+o*(n+1),t.triangles.push([f,f+1,f+n+1]),t.triangles.push([f+n+1,f+1,f+n+2]))}return t.compile(),t},i}),define("energy2d/gpu/gpgpu",["require","energy2d/gpu/context","energy2d/gpu/texture","energy2d/gpu/shader","energy2d/gpu/mesh"],function(e){"use strict";var t=e("energy2d/gpu/context"),n=e("energy2d/gpu/texture"),r=e("energy2d/gpu/shader"),i=e("energy2d/gpu/mesh"),s,o,u,a,f,l,c,h=!1,p=!1,d,v,m="    varying vec2 coord;    void main() {      coord = gl_Vertex.xy * 0.5 + 0.5;      gl_Position = vec4(gl_Vertex.xyz, 1.0);    }",g="    uniform sampler2D texture;    uniform float channel;    varying vec2 coord;    float shift_right(float v, float amt) {      v = floor(v) + 0.5;      return floor(v / exp2(amt));    }    float shift_left(float v, float amt) {      return floor(v * exp2(amt) + 0.5);    }        float mask_last(float v, float bits) {      return mod(v, shift_left(1.0, bits));    }    float extract_bits(float num, float from, float to) {      from = floor(from + 0.5);      to = floor(to + 0.5);      return mask_last(shift_right(num, from), to - from);    }    vec4 encode_float(float val) {      if (val == 0.0)        return vec4(0, 0, 0, 0);      float sign = val > 0.0 ? 0.0 : 1.0;      val = abs(val);      float exponent = floor(log2(val));      float biased_exponent = exponent + 127.0;      float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;            float t = biased_exponent / 2.0;      float last_bit_of_biased_exponent = fract(t) * 2.0;      float remaining_bits_of_biased_exponent = floor(t);            float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;      float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;      float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;      float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;      return vec4(byte4, byte3, byte2, byte1);    }    void main() {      vec4 data = texture2D(texture, coord);      if (channel == 0.0)        gl_FragColor = encode_float(data.r);      else if (channel == 1.0)        gl_FragColor = encode_float(data.g);      else if (channel == 2.0)        gl_FragColor = encode_float(data.b);      else        gl_FragColor = encode_float(data.a);    }",y="    uniform sampler2D texture;    varying vec2 coord;    void main() {      gl_FragColor = texture2D(texture, coord);    }",b="GPGPU: call init(grid_width, grid_height) with proper dimensions first!",w={WebGLContext:{required:!0,available:!1},OES_texture_float:{required:!0,available:!1},"FLOAT texture as render target":{required:!0,available:!1},OES_texture_float_linear:{required:!1,available:!1}},E=function(){s=t.getWebGLContext();if(!s)throw w.WebGLContext.available=!1,new Error("GPGPU: WebGL is not supported!");w.WebGLContext.available=!0;if(!s.getExtension("OES_texture_float"))throw w.OES_texture_float.available=!1,new Error("GPGPU: OES_texture_float is not supported!");w.OES_texture_float.available=!0,s.getExtension("OES_texture_float_linear")?w.OES_texture_float_linear.available=!0:(w.OES_texture_float_linear.available=!1,console.warn("GPGPU: OES_texture_float_linear is not supported. Renering quality will be affected.")),a=new n(1,1,{type:s.FLOAT,format:s.RGBA,filter:w.OES_texture_float_linear.available?s.LINEAR:s.NEAREST}),a.setAsRenderTarget();if(s.checkFramebufferStatus(s.FRAMEBUFFER)!==s.FRAMEBUFFER_COMPLETE)throw s.bindFramebuffer(s.FRAMEBUFFER,null),w["FLOAT texture as render target"].available=!1,new Error("GPGPU: FLOAT texture as render target is not supported!");w["FLOAT texture as render target"].available=!0,s.bindFramebuffer(s.FRAMEBUFFER,null),s.disable(s.DEPTH_TEST),c=i.plane(),d=new r(m,g),v=new r(m,y),p=!0},S=function(e,t,n,r,i){var s,o,u;if(e.length!==t.length||e.length!==n.length||e.length!==r.length||i.length!==e.length*4)throw new Error("GPGPU: Invalid input data length.");for(s=0,u=e.length;s<u;s+=1)o=s*4,i[o]=e[s],i[o+1]=t[s],i[o+2]=n[s],i[o+3]=r[s]};return{init:function(e,t){var r;p||E(),o=e,u=t,r=w.OES_texture_float_linear.available?s.LINEAR:s.NEAREST,a=new n(o,u,{type:s.FLOAT,format:s.RGBA,filter:r}),f=new n(o,u,{type:s.UNSIGNED_BYTE,format:s.RGBA,filter:r}),l=new Float32Array(o*u*4)},get featuresInfo(){if(!p)try{E()}catch(e){}return w},getWebGLContext:function(){return s===undefined&&E(),s},createTexture:function(){return!o||!u?new Error(b):new n(o,u,{type:s.FLOAT,format:s.RGBA,filter:w.OES_texture_float_linear.available?s.LINEAR:s.NEAREST})},convertToRGBA:function(e,t,n){var r,i,s,a;if(e.length!==o*u)throw new Error("GPGPU: Invalid input data length.");n===undefined?r=new Float32Array(e.length*4):r=n,t===undefined&&(t=0);for(i=0,s=e.length;i<s;i+=1)a=i*4,r[a]=r[a+1]=r[a+2]=r[a+3]=0,r[a+t]=e[i];return r},writeTexture:function(e,t){var n=this.convertToRGBA(t,0,l);s.bindTexture(s.TEXTURE_2D,e.id),s.texImage2D(s.TEXTURE_2D,0,e.format,e.width,e.height,0,e.format,e.type,n)},writeRGBATexture:function(e,t,n,r,i){S(t,n,r,i,l),s.bindTexture(s.TEXTURE_2D,e.id),s.texImage2D(s.TEXTURE_2D,0,e.format,e.width,e.height,0,e.format,e.type,l)},readTexture:function(e,t,n){var r;if(!s||e.width!==o||e.height!==u)return new Error(b);n===undefined&&(n=0),r=new Uint8Array(t.buffer),e.bind(),f.setAsRenderTarget(),d.uniforms({channel:n}),d.draw(c),s.readPixels(0,0,f.width,f.height,f.format,f.type,r)},copyTexture:function(e,t){e.bind(),t.setAsRenderTarget(),v.draw(c)},executeProgram:function(e,t,n){var r,i;for(r=0,i=t.length;r<i;r+=1)t[r].bind(r);a.setAsRenderTarget(),e.draw(c);for(r=0,i=t.length;r<i;r+=1)t[r].unbind(r);n.swapWith(a)},setSynchronizationAllowed:function(e){h=e},tryFinish:function(){h&&s.finish()}}}),define("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl",[],function(){return"varying vec2 coord;\n\nvoid main() {\n  coord = gl_Vertex.xy * 0.5 + 0.5;\n  gl_Position = vec4(gl_Vertex.xy, 0.0, 1.0);\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl",[],function(){return'// texture 0:\n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1:\n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n\nuniform vec2 grid;\nuniform float hx;\nuniform float hy;\nuniform float inv_timeStep;\n\n// Boundary conditions uniforms\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    float tb = data0.b;\n    // Check if tb is NaN. isnan() function is not available\n    // in OpenGL ES GLSL, so use some tricks. IEEE 754 spec defines\n    // that NaN != NaN, however this seems to not work on Windows.\n    // So, also check if the value is outside [-3.4e38, 3.4e38] (3.4e38\n    // is close to 32Float max value), as such values are not expected.\n    if (tb != tb || tb < -3.4e38 || tb > 3.4e38) {\n      vec4 data1 = texture2D(data1_tex, coord);\n      vec4 data0_m_dy = texture2D(data0_tex, coord - dy);\n      vec4 data0_p_dy = texture2D(data0_tex, coord + dy);\n      vec4 data0_m_dx = texture2D(data0_tex, coord - dx);\n      vec4 data0_p_dx = texture2D(data0_tex, coord + dx);\n      float sij = data1.g * data1.b * inv_timeStep;\n      float rij = data0.a;\n      float axij = hx * (rij + data0_m_dy.a);\n      float bxij = hx * (rij + data0_p_dy.a);\n      float ayij = hy * (rij + data0_m_dx.a);\n      float byij = hy * (rij + data0_p_dx.a);\n      data0.r = (data0.g * sij + data1.r\n                 + axij * data0_m_dy.r\n                 + bxij * data0_p_dy.r\n                 + ayij * data0_m_dx.r\n                 + byij * data0_p_dx.r)\n                 / (sij + axij + bxij + ayij + byij);\n    } else {\n      data0.r = tb;\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.r = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.r = vS;\n    } else if (coord.y < grid.y) {\n      data0.r = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.r = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n'}),define("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl",[],function(){return"// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n\nuniform vec2 grid;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\nuniform float delta_x;\nuniform float delta_y;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  if (coord.x < grid.x) {\n    data0.r = texture2D(data0_tex, coord + dx).r\n            + vN * delta_y / data0.a;\n  } else if (coord.x > 1.0 - grid.x) {\n    data0.r = texture2D(data0_tex, coord - dx).r\n            - vS * delta_y / data0.a;\n  } else if (coord.y < grid.y) {\n    data0.r = texture2D(data0_tex, coord + dy).r\n            - vW * delta_x / data0.a;\n  } else if (coord.y > 1.0 - grid.y) {\n    data0.r = texture2D(data0_tex, coord - dy).r\n            + vE * delta_x / data0.a;\n  }\n  gl_FragColor = data0;\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl",[],function(){return"// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n\nvarying vec2 coord;\n\nvoid main() {\n	vec4 data0 = texture2D(data0_tex, coord);\n	data0.g = data0.r;\n	gl_FragColor = data0;\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl",[],function(){return'// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\n// Boundary conditions uniforms.\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    \n    float fluidity = texture2D(data1_tex, coord).a;\n    if (fluidity == 1.0) {\n      vec2 dx = vec2(grid.x, 0.0);\n      vec2 dy = vec2(0.0, grid.y);\n\n      // Temperature.\n      float t_m_dy = texture2D(data0_tex, coord - dy).r;\n      float t_p_dy = texture2D(data0_tex, coord + dy).r;\n      float t_m_dx = texture2D(data0_tex, coord - dx).r;\n      float t_p_dx = texture2D(data0_tex, coord + dx).r;\n      // Velocity.\n      float u_m_dy = texture2D(data2_tex, coord - dy).r;\n      float u_p_dy = texture2D(data2_tex, coord + dy).r;\n      float v_m_dx = texture2D(data2_tex, coord - dx).g;\n      float v_p_dx = texture2D(data2_tex, coord + dx).g;\n      // Update T0.\n      data0.g = data0.r - tx * (u_p_dy * t_p_dy - u_m_dy * t_m_dy)\n                        - ty * (v_p_dx * t_p_dx - v_m_dx * t_m_dx);\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.g = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.g = vS;\n    } else if (coord.y < grid.y) {\n      data0.g = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.g = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n'}),define("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl",[],function(){return'// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\n// Boundary conditions uniforms.\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    \n    float fluidity = texture2D(data1_tex, coord).a;\n    if (fluidity == 1.0) {\n      vec2 dx = vec2(grid.x, 0.0);\n      vec2 dy = vec2(0.0, grid.y);\n\n      // Temperature t0.\n      float t0_m_dy = texture2D(data0_tex, coord - dy).g;\n      float t0_p_dy = texture2D(data0_tex, coord + dy).g;\n      float t0_m_dx = texture2D(data0_tex, coord - dx).g;\n      float t0_p_dx = texture2D(data0_tex, coord + dx).g;\n      // Velocity.\n      float u = texture2D(data2_tex, coord).r;\n      float v = texture2D(data2_tex, coord).g;\n      // Update T.\n      data0.r = 0.5 * (data0.r + data0.g)\n              - 0.5 * tx * u * (t0_p_dy - t0_m_dy)\n              - 0.5 * ty * v * (t0_p_dx - t0_m_dx);\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.r = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.r = vS;\n    } else if (coord.y < grid.y) {\n      data0.r = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.r = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n'}),define("energy2d/models/physics-solvers-gpu/heat-solver-gpu",["require","exports","module","energy2d/gpu/shader","energy2d/gpu/gpgpu","text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl","text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl","text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl","text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl","text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl","text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl","text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl"],function(e,t){"use strict";var n=e("energy2d/gpu/shader"),r=e("energy2d/gpu/gpgpu"),i=e("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl"),s=e("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl"),o=e("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl"),u=e("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl"),a=e("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl"),f=e("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl"),l=e("text!energy2d/models/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl"),c=10;t.makeHeatSolverGPU=function(e){var t=new n(i,s),h=new n(i,o),p=new n(i,u),d=new n(i,a),v=new n(i,f),m=new n(i,l),g=e.getModelOptions(),y=g.grid_width,b=g.grid_height,w=g.timeStep,E=g.boundary,S=g.model_width/g.grid_width,x=g.model_height/g.grid_height,T=c,N=e.getSimulationTexture(0),C=e.getSimulationTexture(1),k=e.getSimulationTexture(2),L=[N,C,k],A=[N,C],O=[N],M=[1/b,1/y],_=function(){var e;e={data0_tex:0,data1_tex:1,grid:M,enforce_temp:0,hx:.5/(S*S),hy:.5/(x*x),inv_timeStep:1/w},t.uniforms(e),e={data0_tex:0,data1_tex:1,data2_tex:2,grid:M,enforce_temp:0,tx:.5*w/S,ty:.5*w/x},v.uniforms(e),m.uniforms(e),E.type==="temperature"?(e={enforce_temp:1,vN:E.upper,vS:E.lower,vW:E.left,vE:E.right},t.uniforms(e),v.uniforms(e),m.uniforms(e)):E.type==="flux"&&(e={data0_tex:0,grid:M,vN:E.upper,vS:E.lower,vW:E.left,vE:E.right,delta_x:S,delta_y:x},h.uniforms(e),p.uniforms(e))},D=function(){r.executeProgram(v,L,N),E.type==="flux"&&r.executeProgram(p,O,N),r.executeProgram(m,L,N),E.type==="flux"&&r.executeProgram(h,O,N)},P={solve:function(e){var n;r.executeProgram(d,O,N);for(n=0;n<T;n+=1)r.executeProgram(t,A,N),E.type==="flux"&&r.executeProgram(h,O,N);e&&D()}};return _(),P}}),define("energy2d/models/physics-solvers/fluid-solver",["require","exports","module","arrays"],function(e,t){"use strict";var n=e("arrays"),r=5,i=0,s=0,o=1;t.makeFluidSolver=function(e){var t=e.getModelOptions(),u=t.grid_width,a=t.grid_height,f=r,l=i,c=e.getTemperatureArray(),h=e.getFluidityArray(),p=e.getUWindArray(),d=e.getVWindArray(),v=e.getArrayType(),m=n.create(u*a,0,v),g=n.create(u*a,0,v),y=u-1,b=a-1,w=u-2,E=a-2,S=t.model_width/t.grid_width,x=t.model_height/t.grid_height,T=.5/S,N=.5/x,C=1/(S*S),k=1/(x*x),L=function(e,t){var n=e===1,r=e===2,i=y*u,s=w*u,o,a,f,l,c,h,p;for(o=1;o<y;o+=1)f=o*u,l=f+1,c=f+b,h=f+E,t[f]=r?-t[l]:t[l],t[c]=r?-t[h]:t[h];for(a=1;a<b;a+=1)p=u+a,t[a]=n?-t[p]:t[p],t[i+a]=n?-t[s+a]:t[s+a];t[0]=.5*(t[u]+t[1]),t[i]=.5*(t[s]+t[i+1]),t[b]=.5*(t[u+b]+t[E]),t[i+b]=.5*(t[s+b]+t[i+E])},A=function(e,t){var n=0,r,i,s,o,a,f,l,c,v,m;for(s=1;s<y;s+=1){a=s*u;for(o=1;o<b;o+=1)f=a+o,c=f-u,l=f+u,m=f-1,v=f+1,h[f]||(r=p[f],i=d[f],n=0,h[c]?(n+=1,e[f]=r-e[c],t[f]=i+t[c]):h[l]&&(n+=1,e[f]=r-e[l],t[f]=i+t[l]),h[m]?(n+=1,e[f]=r+e[m],t[f]=i-t[m]):h[v]&&(n+=1,e[f]=r+e[v],t[f]=i-t[v]),n===0&&(e[f]=r,t[f]=i))}},O=function(e){var t,n,r,i,s,o,a,f;for(t=1;t<y;t+=1){r=t*u;for(n=1;n<b;n+=1)i=r+n,h[i]||(o=i-u,s=i+u,f=i-1,a=i+1,h[o]?e[i]=e[o]:h[s]&&(e[i]=e[s]),h[f]?e[i]=e[f]:h[a]&&(e[i]=e[a]))}},M=function(e,t){var n=0,r=a,i=0,s,o;for(s=t-1;s>0;s-=1){o=e*u+s;if(!h[o]){n=s;break}}for(s=t+1;s<a;s+=1){o=e*u+s;if(!h[o]){r=s;break}}for(s=n;s<r;s+=1)o=e*u+s,i+=c[o];return i/(r-n)},_=function(e){var n=l*t.timeStep,r=t.thermal_buoyancy*t.timeStep,i,a,f,p,d;switch(t.buoyancy_approximation){case s:i=function(e){var t=0,n=e.length,r;for(r=0;r<n;r+=1)t+=e[r];return t/n}(c);for(a=1;a<y;a+=1){p=a*u;for(f=1;f<b;f+=1)d=p+f,h[d]&&(e[d]+=(n-r)*c[d]+r*i)}break;case o:for(a=1;a<y;a+=1){p=a*u;for(f=1;f<b;f+=1)d=p+f,h[d]&&(i=M(a,f),e[d]+=(n-r)*c[d]+r*i)}}},D=function(e,t,n,r){var i=.5/(C+k),s,o,a,l,c,p,d,v,m;for(o=1;o<y;o+=1){l=o*u;for(a=1;a<b;a+=1)c=l+a,h[c]&&(d=c-u,p=c+u,m=c-1,v=c+1,r[c]=(e[p]-e[d])*T+(t[v]-t[m])*N,n[c]=0)}L(0,r),L(0,n),O(r),O(n);for(s=0;s<f;s+=1)for(o=1;o<y;o+=1){l=o*u;for(a=1;a<b;a+=1)c=l+a,h[c]&&(d=c-u,p=c+u,m=c-1,v=c+1,n[c]=i*((n[d]+n[p])*C+(n[m]+n[v])*k-r[c]))}for(o=1;o<y;o+=1){l=o*u;for(a=1;a<b;a+=1)c=l+a,h[c]&&(d=c-u,p=c+u,m=c-1,v=c+1,e[c]-=(n[p]-n[d])*T,t[c]-=(n[v]-n[m])*N)}L(1,e),L(2,t)},P=function(e,r,i){var s=t.timeStep,o=t.background_viscosity,a=s*o*C,l=s*o*k,c=1/(1+2*(a+l)),p,d,v,m,g,w,E,S,x;n.copy(i,r);for(p=0;p<f;p+=1){for(d=1;d<y;d+=1){m=d*u;for(v=1;v<b;v+=1)g=m+v,h[g]&&(E=g-u,w=g+u,x=g-1,S=g+1,i[g]=(r[g]+a*(i[E]+i[w])+l*(i[x]+i[S]))*c)}L(e,i)}},H=function(e,r,i){var s=t.timeStep,o=.5*s/S,a=.5*s/x,f,l,c,p,d,v,w,E;for(f=1;f<y;f+=1){c=f*u;for(l=1;l<b;l+=1)p=c+l,h[p]&&(v=p-u,d=p+u,E=p-1,w=p+1,i[p]=r[p]-o*(m[d]*r[d]-m[v]*r[v])-a*(g[w]*r[w]-g[E]*r[E]))}L(e,i);for(f=1;f<y;f+=1){c=f*u;for(l=1;l<b;l+=1)p=c+l,h[p]&&(v=p-u,d=p+u,E=p-1,w=p+1,r[p]=.5*(r[p]+i[p])-.5*o*m[p]*(i[d]-i[v])-.5*a*g[p]*(i[w]-i[E]))}n.copy(r,i),L(e,i)},B=function(e,t,n){H(e,t,n)};return{solve:function(e,r){t.thermal_buoyancy!==0&&_(r),A(e,r),t.background_viscosity>0&&(P(1,m,e),P(2,g,r),D(e,r,m,g),A(e,r)),n.copy(e,m),n.copy(r,g),B(1,m,e),B(2,g,r),D(e,r,m,g),A(e,r)}}}}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl",[],function(){return"varying vec2 coord;\n\nvoid main() {\n  coord = gl_Vertex.xy * 0.5 + 0.5;\n  gl_Position = vec4(gl_Vertex.xy, 0.0, 1.0);\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = data2.ba - tx * (data2_p_dy.bb * data2_p_dy.ba - data2_m_dy.bb * data2_m_dy.ba)\n              - ty * (data2_p_dx.aa * data2_p_dx.ba - data2_m_dx.aa * data2_m_dx.ba);\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = 0.5 * (data2.ba + data2.rg) \n            - 0.5 * tx * data2.bb * (data2_p_dy.rg - data2_m_dy.rg)\n            - 0.5 * ty * data2.aa * (data2_p_dx.rg - data2_m_dx.rg);\n  }\n\n  gl_FragColor = data2;\n}\n"
}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl",[],function(){return"// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  // Process corners.\n  // TODO: values from previous step are used for corners.\n  if (coord.x < grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = 0.5 * (data2_p_dy.rg + data2_p_dx.rg);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = 0.5 * (data2_p_dy.rg + data2_m_dx.rg);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = 0.5 * (data2_m_dy.rg + data2_m_dx.rg);\n  }\n  else if (coord.x < grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = 0.5 * (data2_m_dy.rg + data2_p_dx.rg);\n  }\n  // Process boundaries.\n  // Left.\n  else if (coord.x < grid.x) {\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = vec2(data2_p_dx.r, -data2_p_dx.g);\n  }\n  // Right.\n  else if (coord.x > 1.0 - grid.x) {\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = vec2(data2_m_dx.r, -data2_m_dx.g);\n  }\n  // Down.\n  else if (coord.y < grid.y) {\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    data2.rg = vec2(-data2_p_dy.r, data2_p_dy.g);\n  }\n  // Up.\n  else if (coord.y > 1.0 - grid.y) {\n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    data2.rg = vec2(-data2_m_dy.r, data2_m_dy.g);\n  }\n  \n  gl_FragColor = data2;\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl",[],function(){return"// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  // Process corners.\n  // TODO: values from previous step are used for corners.\n  if (coord.x < grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.ba = 0.5 * (data2_p_dy.ba + data2_p_dx.ba);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.ba = 0.5 * (data2_p_dy.ba + data2_m_dx.ba);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.ba = 0.5 * (data2_m_dy.ba + data2_m_dx.ba);\n  }\n  else if (coord.x < grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.ba = 0.5 * (data2_m_dy.ba + data2_p_dx.ba);\n  }\n  // Process boundaries.\n  // Left.\n  else if (coord.x < grid.x) {\n    data2.ba = texture2D(data2_tex, coord + dx).ba;\n  }\n  // Right.\n  else if (coord.x > 1.0 - grid.x) {\n    data2.ba = texture2D(data2_tex, coord - dx).ba;\n  }\n  // Down.\n  else if (coord.y < grid.y) {\n    data2.ba = texture2D(data2_tex, coord + dy).ba;\n  }\n  // Up.\n  else if (coord.y > 1.0 - grid.y) {\n    data2.ba = texture2D(data2_tex, coord - dy).ba;\n  }\n  \n  gl_FragColor = data2;\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 0.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n\n    if (texture2D(data1_tex, coord - dy).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord - dy).ba;\n    } \n    else if (texture2D(data1_tex, coord + dy).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord + dy).ba;\n    } \n\n    if (texture2D(data1_tex, coord - dx).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord - dx).ba;\n    } \n    else if (texture2D(data1_tex, coord + dx).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord + dx).ba;\n    } \n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n// texture 3: \n// - R: uWind\n// - G: vWind\n// - B: undefined\n// - A: undefined\nuniform sampler2D data3_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n\n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 0.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n\n    int count = 0;\n\n    if (texture2D(data1_tex, coord - dy).a == 1.0) {\n      count += 1;\n      vec2 data2_m_dy = texture2D(data2_tex, coord - dy).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(-data2_m_dy.r, data2_m_dy.g);\n    } \n    else if (texture2D(data1_tex, coord + dy).a == 1.0) {\n      count += 1;\n      vec2 data2_p_dy = texture2D(data2_tex, coord + dy).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(-data2_p_dy.r, data2_p_dy.g);\n    } \n\n    if (texture2D(data1_tex, coord - dx).a == 1.0) {\n      count += 1;\n      vec2 data2_m_dx = texture2D(data2_tex, coord - dx).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(data2_m_dx.r, -data2_m_dx.g);\n    } \n    else if (texture2D(data1_tex, coord + dx).a == 1.0) {\n      count += 1;\n      vec2 data2_p_dx = texture2D(data2_tex, coord + dx).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(data2_p_dx.r, -data2_p_dx.g);\n    } \n\n    if (count == 0) {\n      data2.rg = texture2D(data3_tex, coord).rg;\n    }\n  }\n  \n  gl_FragColor = data2;\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl",[],function(){return"// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nvarying vec2 coord;\n\nvoid main() {\n	vec4 data2 = texture2D(data2_tex, coord);\n	data2.ba = data2.rg;\n	gl_FragColor = data2;\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float i2dx;\nuniform float i2dy;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // Phi.\n    data2.b = 0.0;\n    // Div.\n    data2.a = (data2_p_dy.r - data2_m_dy.r) * i2dx + (data2_p_dx.g - data2_m_dx.g) * i2dy;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float s;\nuniform float idxsq;\nuniform float idysq;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // Phi.\n    data2.b = s * ((data2_m_dy.b + data2_p_dy.b) * idxsq + (data2_m_dx.b + data2_p_dx.b) * idysq - data2.a);\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float i2dx;\nuniform float i2dy;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // U.\n    data2.r -= (data2_p_dy.b - data2_m_dy.b) * i2dx;\n    // V.\n    data2.g -= (data2_p_dx.b - data2_m_dx.b) * i2dy;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl",[],function(){return"// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float hx;\nuniform float hy;\nuniform float dn;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = (data2.ba + hx * (data2_m_dy.rg + data2_p_dy.rg)\n                         + hy * (data2_m_dx.rg + data2_p_dx.rg)) * dn;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl",[],function(){return"// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float g;\nuniform float b;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    float t = texture2D(data0_tex, coord).r;\n    // Get average column temperature.\n\n    float avg_t = t;\n    float count = 1.0;\n    vec2 n_coord = coord - dx;\n    // Silly while(true) loop (almost).\n    // While loops are not allowed.\n    // For loops with non-constant expressions also.\n    for (int i = 1; i != 0; i++) {\n      if (n_coord.x > 0.0 && texture2D(data1_tex, n_coord).a == 1.0) {\n        avg_t += texture2D(data0_tex, n_coord).r;\n        count += 1.0;\n        n_coord -= dx;\n      } else {\n        break;\n      }\n    }\n    n_coord = coord + dx;\n    // Silly while(true) loop (almost).\n    // While loops are not allowed.\n    // For loops with non-constant expressions also.\n    for (int i = 1; i != 0; i++) {\n      if (n_coord.x < 1.0 && texture2D(data1_tex, n_coord).a == 1.0) {\n        avg_t += texture2D(data0_tex, n_coord).r;\n        count += 1.0;\n        n_coord += dx;\n      } else {\n        break;\n      }\n    }\n    avg_t /= count;\n\n    // Update velocity V component.\n    data2.g += (g - b) * t + b * avg_t;\n  }\n\n  gl_FragColor = data2;\n}\n"}),define("energy2d/models/physics-solvers-gpu/fluid-solver-gpu",["require","exports","module","energy2d/gpu/shader","energy2d/gpu/gpgpu","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl","text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl"],function(e,t){"use strict";var n=e("energy2d/gpu/shader"),r=e("energy2d/gpu/gpgpu"),i=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl"),s=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl"),o=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl"),u=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl"),a=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl"),f=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl"),l=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl"),c=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl"),h=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl"),p=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl"),d=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl"),v=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl"),m=e("text!energy2d/models/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl"),g=10,y=0;t.makeFluidSolverGPU=function(e){var t=new n(i,s),b=new n(i,o),w=new n(i,u),E=new n(i,a),S=new n(i,f),x=new n(i,l),T=new n(i,c),N=new n(i,h),C=new n(i,p),k=new n(i,d),L=new n(i,v),A=new n(i,m),O=e.getSimulationTexture(0),M=e.getSimulationTexture(1),_=e.getSimulationTexture(2),D=e.getSimulationTexture(3),P=e.getModelOptions(),H=P.grid_width,B=P.grid_height,j=P.timeStep,F=P.thermal_buoyancy,I=P.background_viscosity,q=P.model_width/P.grid_width,R=P.model_height/P.grid_height,U=g,z=y,W=.5/q,X=.5/R,V=1/(q*q),$=1/(R*R),J=.5/(V+$),K=j*I*V,Q=j*I*$,G=1/(1+2*(K+Q)),Y=z*j,Z=F*j,et=[1/B,1/H],tt=[_],nt=[M,_],rt=[O,M,_],it=[M,_,D],st=function(){var e;e={data1_tex:0,data2_tex:1,grid:et,tx:.5*j/q,ty:.5*j/R},t.uniforms(e),b.uniforms(e),e={data2_tex:0,grid:et},w.uniforms(e),E.uniforms(e),e={data1_tex:0,data2_tex:1,grid:et},S.uniforms(e),e={data1_tex:0,data2_tex:1,data3_tex:2,grid:et},x.uniforms(e),e={data1_tex:0,data2_tex:1,grid:et,i2dx:W,i2dy:X},N.uniforms(e),k.uniforms(e),e={data1_tex:0,data2_tex:1,grid:et,s:J,idxsq:V,idysq:$},C.uniforms(e),e={data1_tex:0,data2_tex:1,grid:et,hx:K,hy:Q,dn:G},L.uniforms(e),e={data0_tex:0,data1_tex:1,data2_tex:2,grid:et,g:Y,b:Z},A.uniforms(e)},ot=function(){r.executeProgram(A,rt,_)},ut=function(){r.executeProgram(t,nt,_),r.executeProgram(w,tt,_),r.executeProgram(b,nt,_),r.executeProgram(w,tt,_)},at=function(){var e;r.executeProgram(N,nt,_),r.executeProgram(E,tt,_),r.executeProgram(S,nt,_);for(e=0;e<U;e+=1)r.executeProgram(C,nt,_);r.executeProgram(k,nt,_),r.executeProgram(w,tt,_)},ft=function(){var e;r.executeProgram(T,tt,_);for(e=0;e<U;e+=1)r.executeProgram(L,nt,_),r.executeProgram(w,tt,_)},lt=function(){r.executeProgram(x,it,_)},ct=function(){r.executeProgram(T,tt,_)},ht={solve:function(){F!==0&&ot(),lt(),I>0&&(ft(),at(),lt()),ct(),ut(),at(),lt()}};return st(),ht}}),define("energy2d/models/helpers",["require","exports","module"],function(e,t,n){"use strict";t.hypot=function(e,t){var n;return e=Math.abs(e),t=Math.abs(t),n=Math.min(e,t),e=Math.max(e,t),e===0?0:(n/=e,e*Math.sqrt(1+n*n))}}),define("energy2d/models/shape",["require","exports","module"],function(e,t,n){"use strict";t.pointInsidePolygon=function(e,t,n,r,i){var s=0,o,u;for(o=0,u=e-1;o<e;u=o,o+=1)n[o]>i!=n[u]>i&&r<(t[u]-t[o])*(i-n[o])/(n[u]-n[o])+t[o]&&(s=!s);return!!s};var r=t.Line=function(e,t,n,r){this.x1=e,this.y1=t,this.x2=n,this.y2=r};r.prototype.intersectsLine=function(e){var t,n={x:this.x1,y:this.y1},r={x:this.x2,y:this.y2},i={x:e.x1,y:e.y1},s={x:e.x2,y:e.y2},o=(s.x-i.x)*(n.y-i.y)-(s.y-i.y)*(n.x-i.x),u=(r.x-n.x)*(n.y-i.y)-(r.y-n.y)*(n.x-i.x),a=(s.y-i.y)*(r.x-n.x)-(s.x-i.x)*(r.y-n.y),f,l;return a!==0?(f=o/a,l=u/a,0<=f&&f<=1&&0<=l&&l<=1?t=!0:t=!1):o===0||u===0?t=!0:t=!1,t};var i=t.Polygon=function(e,t,n){this.count=e,this.raw_x_coords=t,this.raw_y_coords=n,this.x_coords=new Array(e),this.y_coords=new Array(e),this.x=0,this.y=0};Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(e){var t,n;for(t=0,n=this.count;t<n;t++)this.x_coords[t]=this.raw_x_coords[t]+e;this._x=e}}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(e){var t,n;for(t=0,n=this.count;t<n;t++)this.y_coords[t]=this.raw_y_coords[t]+e;this._y=e}}),i.prototype.polygonize=function(){return this},i.prototype.contains=function(e,t){var n=this.x_coords,r=this.y_coords,i=this.count,s=0,o,u;for(o=0,u=i-1;o<i;u=o,o+=1)r[o]>t!=r[u]>t&&e<(n[u]-n[o])*(t-r[o])/(r[u]-r[o])+n[o]&&(s=!s);return!!s};var s=t.Rectangle=function(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r,this.polygon_cache=undefined};s.prototype.polygonize=function(){var e,t,n,r;return this.polygon_cache||(e=this.x,t=this.y,n=this.width,r=this.height,this.polygon_cache=new i(4,[e,e+n,e+n,e],[t,t,t+r,t+r])),this.polygon_cache},s.prototype.contains=function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height};var o=function(e,t,n,r,s){var o=new Array(s),u=new Array(s),a=2*Math.PI/s,f,l;for(l=0;l<s;l+=1)f=a*l,o[l]=e+n*Math.cos(f),u[l]=t+r*Math.sin(f);return new i(s,o,u)},u=t.Ellipse=function(e,t,n,r){this.x=e,this.y=t,this.a=n,this.b=r,this.polygon_cache=undefined};u.prototype.POLYGON_SEGMENTS=50,u.prototype.polygonize=function(){return this.polygon_cache||(this.polygon_cache=o(this.x,this.y,this.a*.5,this.b*.5,this.POLYGON_SEGMENTS)),this.polygon_cache},u.prototype.contains=function(e,t){var n=e-this.x,r=t-this.y,i=this.a*.5,s=this.b*.5;return n*n/(i*i)+r*r/(s*s)<=1};var a=t.Ring=function(e,t,n,r){this.x=e,this.y=t,this.inner=n,this.outer=r,this.polygon_cache=undefined};a.prototype.POLYGON_SEGMENTS=50,a.prototype.polygonize=function(){return this.polygon_cache||(this.polygon_cache=o(this.x,this.y,this.outer*.5,this.outer*.5,this.POLYGON_SEGMENTS)),this.polygon_cache},a.prototype.polygonizeInner=function(){var e,t,n,r,i,s,u,a,f,l;return this.polygon_cache_inner||(this.polygon_cache_inner=o(this.x,this.y,this.inner*.5,this.inner*.5,this.POLYGON_SEGMENTS)),this.polygon_cache_inner},a.prototype.contains=function(e,t){var n=e-this.x,r=t-this.y,i=this.outer*.5,s=this.outer*.5,o=this.inner*.5,u=this.inner*.5;return n*n/(i*i)+r*r/(s*s)<=1&&n*n/(o*o)+r*r/(u*u)>=1}}),define("energy2d/models/photon",["require","exports","module","energy2d/models/helpers","energy2d/models/shape","energy2d/models/shape"],function(e,t,n){"use strict";var r=e("energy2d/models/helpers").hypot,i=e("energy2d/models/shape").Line,s=e("energy2d/models/shape").Rectangle,o=t.Photon=function(e,t,n,r,i){this.x=e,this.y=t,this.energy=n,this.c=r,i!==undefined&&(this.vx=Math.cos(i)*r,this.vy=Math.sin(i)*r)};o.prototype.isContained=function(e,t,n,r){return this.x>=e&&this.x<=t&&this.y>=n&&this.y<=r},o.prototype.move=function(e){this.x+=this.vx*e,this.y+=this.vy*e},o.prototype.reflectFromLine=function(e,t){var n=this.x,s=this.y,o=this.x-this.vx*t,u=this.y-this.vy*t,a=new i(n,s,o,u),f=this.vx,l=this.vy,c,h,p,d,v;return a.intersectsLine(e)?(n=e.x1,s=e.y1,o=e.x2,u=e.y2,c=1/r(n-o,s-u),h=(u-s)*c,p=(o-n)*c,d=f*p+l*h,v=l*p-f*h,this.vx=d*p+v*h,this.vy=d*h-v*p,!0):!1},o.prototype.reflectFromRectangle=function(e,t){var n=e.x,r=e.y,i=e.x+e.width,s=e.y+e.height,o,u;o=this.vx*t,this.x-o<n?this.vx=-Math.abs(this.vx):this.x-o>i&&(this.vx=Math.abs(this.vx)),u=this.vy*t,this.y-u<r?this.vy=-Math.abs(this.vy):this.y-u>s&&(this.vy=Math.abs(this.vy))},o.prototype.reflectFromPolygon=function(e,t){var n=new i,r,s;for(r=0,s=e.count-1;r<s;r+=1){n.x1=e.x_coords[r],n.y1=e.y_coords[r],n.x2=e.x_coords[r+1],n.y2=e.y_coords[r+1];if(this.reflectFromLine(n,t))return}n.x1=e.x_coords[e.count-1],n.y1=e.y_coords[e.count-1],n.x2=e.x_coords[0],n.y2=e.y_coords[0],this.reflectFromLine(n,t)},o.prototype.reflect=function(e,t){return e.contains(this.x,this.y)?(e instanceof s?this.reflectFromRectangle(e,t):this.reflectFromPolygon(e.polygonize(),t),!0):!1}}),define("energy2d/models/physics-solvers/ray-solver",["require","exports","module","energy2d/models/photon"],function(e,t){"use strict";var n=e("energy2d/models/photon").Photon;t.makeRaySolver=function(e){var t=e.getModelOptions(),r=e.getPowerArray(),i=e.getPartsArray(),s=e.getPhotonsArray(),o=t.model_width,u=t.model_height,a=t.grid_width,f=t.grid_height,l=a-1,c=f-1,h=t.model_width/t.grid_width,p=t.model_height/t.grid_height,d=function(){return Math.PI-t.sun_angle},v=function(){var e=0;while(e<s.length)s[e]===undefined?s.splice(e,1):e+=1},m=function(){var e,t;for(e=0,t=s.length;e<t;e+=1)s[e].isContained(0,o,0,u)||(s[e]=undefined);v()},g=function(e,t){var n,r;for(n=0,r=i.length;n<r;n+=1)if(i[n].contains(e,t))return!0;return!1},y=function(e,r){var i=d(),a=t.solar_power_density,f=t.solar_ray_speed,l=Math.floor(o/e),c=Math.floor(u/r),h,p,v;if(i>=0&&i<.5*Math.PI){p=0;for(v=1;v<=l;v+=1)h=e*v,g(h,p)||s.push(new n(h,p,a,f,i));h=0;for(v=0;v<=c;v+=1)p=r*v,g(h,p)||s.push(new n(h,p,a,f,i))}else if(i<0&&i>=-0.5*Math.PI){p=u;for(v=1;v<=l;v+=1)h=e*v,g(h,p)||s.push(new n(h,p,a,f,i));h=0;for(v=0;v<=c;v+=1)p=u-r*v,g(h,p)||s.push(new n(h,p,a,f,i))}else if(i<Math.PI+.001&&i>=.5*Math.PI){p=0;for(v=0;v<=l;v+=1)h=o-e*v,g(h,p)||s.push(new n(h,p,a,f,i));h=o;for(v=1;v<=c;v+=1)p=r*v,g(h,p)||s.push(new n(h,p,a,f,i))}else if(i>=-Math.PI&&i<-0.5*Math.PI){p=u;for(v=0;v<=l;v+=1)h=o-e*v,g(h,p)||s.push(new n(h,p,a,f,i));h=o;for(v=1;v<=c;v+=1)p=u-r*v,g(h,p)||s.push(new n(h,p,a,f,i))}};return{solve:function(){var e=t.timeStep,n=t.photon_emission_interval,o=1/(e*n),u=1/h,a=1/p,d,g,y,b,w,E,S,x;for(w=0,S=s.length;w<S;w+=1){d=s[w],d.move(e);for(E=0,x=i.length;E<x;E+=1){g=i[E];if(g.reflect(d,e))break;if(g.absorb(d)){y=Math.max(Math.min(Math.round(d.x*u),l),0),b=Math.max(Math.min(Math.round(d.y*a),c),0),r[y*f+b]=d.energy*o,s[w]=undefined;break}}}v(),m()},radiate:function(){var t,n,r;for(n=0,r=i.length;n<r;n+=1)t=i[n],t.emissivity>0&&t.radiate(e)},sunShine:function(){var e=d(),n,r,i;if(e<0)return;n=Math.abs(Math.sin(e)),r=Math.abs(Math.cos(e)),i=n*u<r*o?u/r:o/n,i/=t.solar_ray_count,y(i/n,i/r)}}}}),define("energy2d/models/default-config",["require","exports","module","energy2d/models/constants"],function(e,t,n){"use strict";var r=e("energy2d/models/constants");t.DEFAULT_VALUES={model:{use_WebGL:!1,grid_width:100,grid_height:100,model_width:10,model_height:10,timeStep:1,convective:!0,background_temperature:0,background_conductivity:r.AIR_THERMAL_CONDUCTIVITY,background_specific_heat:r.AIR_SPECIFIC_HEAT,background_density:r.AIR_DENSITY,background_viscosity:r.AIR_VISCOSITY,thermal_buoyancy:25e-5,buoyancy_approximation:1,boundary:{temperature_at_border:{upper:0,lower:0,left:0,right:0}},measurement_interval:500,viewupdate_interval:100,stoptime:undefined,sunny:!1,sun_angle:1.5707964,solar_power_density:2e3,solar_ray_count:24,solar_ray_speed:.1,photon_emission_interval:20,structure:undefined},part:{thermal_conductivity:1,specific_heat:1300,density:25,transmission:0,reflection:0,absorption:1,emissivity:0,temperature:0,constant_temperature:!1,power:0,wind_speed:0,wind_angle:0,visible:!0,filled:!0,color:"gray",label:undefined,texture:undefined,uid:undefined,draggable:!0}},t.fillWithDefaultValues=function(e,t){var n,r,i=function(e){return e===undefined?undefined:JSON.parse(JSON.stringify(e))};if(e===undefined)return i(t);r=i(e);for(n in t)t.hasOwnProperty(n)&&e[n]===undefined&&(r[n]=i(t[n]));return r}}),define("energy2d/models/part",["require","exports","module","energy2d/models/default-config","energy2d/models/constants","energy2d/models/helpers","energy2d/models/photon","energy2d/models/shape","energy2d/models/shape","energy2d/models/shape","energy2d/models/shape","energy2d/models/shape","energy2d/models/shape"],function(e,t,n){"use strict";var r=e("energy2d/models/default-config"),i=e("energy2d/models/constants"),s=e("energy2d/models/helpers").hypot,o=e("energy2d/models/photon").Photon,u=e("energy2d/models/shape"),a=e("energy2d/models/shape").Line,f=e("energy2d/models/shape").Polygon,l=e("energy2d/models/shape").Rectangle,c=e("energy2d/models/shape").Ellipse,h=e("energy2d/models/shape").Ring,p=.5,d=20,v=100,m=Math.sin(Math.PI/6),g=Math.cos(Math.PI/6),y=Math.sin(Math.PI/3),b=Math.cos(Math.PI/3),w=t.Part=function(e){var t,n,i;e=r.fillWithDefaultValues(e,r.DEFAULT_VALUES.part);if(e.rectangle)i=this.rectangle=e.rectangle,this.shape=new l(i.x,i.y,i.width,i.height);else if(e.ellipse)i=this.ellipse=e.ellipse,this.shape=new c(i.x,i.y,i.a,i.b);else if(e.ring)i=this.ring=e.ring,this.shape=new h(i.x,i.y,i.inner,i.outer);else{if(!e.polygon)throw new Error("Part: shape not defined.");this.polygon=e.polygon;if(typeof this.polygon.vertices=="string"){t=this.polygon.count,this.polygon.vertices=this.polygon.vertices.split(", "),this.polygon.x_coords=[],this.polygon.y_coords=[];if(t*2!==this.polygon.vertices.length)throw new Error("Part: polygon contains different vertices count than declared in the count parameter.");for(n=0;n<t;n+=1)this.polygon.x_coords[n]=this.polygon.vertices[2*n]=Number(this.polygon.vertices[2*n]),this.polygon.y_coords[n]=this.polygon.vertices[2*n+1]=Number(this.polygon.vertices[2*n+1]);this.shape=new f(t,this.polygon.x_coords,this.polygon.y_coords)}}this.thermal_conductivity=e.thermal_conductivity,this.specific_heat=e.specific_heat,this.density=e.density,this.temperature=e.temperature,this.constant_temperature=e.constant_temperature,this.power=e.power,this.wind_speed=e.wind_speed,this.wind_angle=e.wind_angle,this.transmission=e.transmission,this.reflection=e.reflection,this.absorption=e.absorption,this.emissivity=e.emissivity,this.visible=e.visible,this.filled=e.filled,this.color=e.color,this.texture=e.texture,this.label=e.label,this.draggable=e.draggable};Object.defineProperty(w.prototype,"shapeType",{get:function(){return this.rectangle?"rectangle":this.ellipse?"ellipse":this.ring?"ring":this.polygon?"polygon":null}}),["x","y","width","height","inner","outer","a","b","raw_x_coords","raw_y_coords"].forEach(function(e){Object.defineProperty(w.prototype,e,{get:function(){return this.shape[e]},set:function(t){typeof this.shape[e]!="undefined"&&(this.shape[e]=t,this.polygon_cache=undefined)}})}),w.prototype.getLabel=function(){var e=this.label,t;return e==="%temperature"?t=this.temperature+" °C":e==="%density"?t=this.density+" kg/m³":e==="%specific_heat"?t=this.specific_heat+" J/(kg×°C)":e==="%thermal_conductivity"?t=this.thermal_conductivity+" W/(m×°C)":e==="%power_density"?t=this.power+" W/m³":e==="%area"?this.rectangle?t=this.rectangle.width*this.rectangle.height+" m²":this.ellipse&&(t=this.ellipse.width*this.ellipse.height*.25*Math.PI+" m²"):e==="%width"?this.rectangle?t=this.rectangle.width+" m":this.ellipse&&(t=this.ellipse.width+" m"):e==="%height"?this.rectangle?t=this.rectangle.height+" m":this.ellipse&&(t=this.ellipse.height+" m"):t=e,t},w.prototype.getGridCells=function(e,t,n,r){var i=e-1,s=t-1,o=i/n,a=s/r,f=function(e){var n,r,u,f,l,c,h,p=[];u=Math.min(Math.max(Math.ceil(e.x*o),0),i),f=Math.min(Math.max(Math.ceil(e.y*a),0),s),l=Math.min(Math.max(Math.floor((e.x+e.width)*o),0),i),c=Math.min(Math.max(Math.floor((e.y+e.height)*a),0),s),p=new Array((l-u+1)*(c-f+1)),h=0;for(n=u;n<=l;n+=1)for(r=f;r<=c;r+=1)p[h+=1]=n*t+r;return p},l=function(e){var n=e.x*o,r=e.y*a,u=e.a*.5*o,f=e.b*.5*a,l,c,h,p,d,v,m,g,y=[];h=Math.min(Math.max(Math.ceil(n-u),0),i),p=Math.min(Math.max(Math.floor(n+u),0),i),y=[],g=0;for(c=h;c<=p;c+=1){l=Math.sqrt(1-(c-n)*(c-n)/(u*u)),v=Math.min(Math.max(Math.ceil(r-f*l),0),s),m=Math.min(Math.max(Math.floor(r+f*l),0),s);for(d=v;d<=m;d+=1)y[g+=1]=c*t+d}return y},c=function(e){var n=e.x*o,r=e.y*a,u=e.outer*.5*o,f=e.outer*.5*a,l=e.inner*.5*o,c=e.inner*.5*a,h,p,d,v,m,g,y,b,w,E,S=[];p=Math.min(Math.max(Math.ceil(n-u),0),i),d=Math.min(Math.max(Math.floor(n+u),0),i);for(h=p;h<=d;h+=1){w=Math.sqrt(1-(h-n)*(h-n)/(u*u)),m=Math.min(Math.max(Math.ceil(r-f*w),0),s),b=Math.min(Math.max(Math.floor(r+f*w),0),s);if(Math.abs(h-n)<l){w=Math.sqrt(1-(h-n)*(h-n)/(l*l)),g=Math.min(Math.max(Math.ceil(r-c*w),0),s),y=Math.min(Math.max(Math.floor(r+c*w),0),s);for(v=m;v<=g;v+=1)S[E+=1]=h*t+v;for(v=y;v<=b;v+=1)S[E+=1]=h*t+v}else for(v=m;v<=b;v+=1)S[E+=1]=h*t+v}return S},h=function(e){var n=e.count,r=e.vertices,f=new Array(n),l=new Array(n),c=Number.MAX_VALUE,h=Number.MIN_VALUE,p=Number.MAX_VALUE,d=Number.MIN_VALUE,v,m,g,y,b,w,E,S=[];for(v=0;v<n;v+=1)f[v]=r[v*2]*o,l[v]=r[v*2+1]*a,f[v]<c&&(c=f[v]),f[v]>h&&(h=f[v]),l[v]<p&&(p=l[v]),l[v]>d&&(d=l[v]);m=Math.min(Math.max(Math.round(c),0),i),b=Math.min(Math.max(Math.round(p),0),s),g=Math.min(Math.max(Math.round(h),0),i),w=Math.min(Math.max(Math.round(d),0),s),S=[],E=0;for(v=m;v<=g;v+=1)for(y=b;y<=w;y+=1)u.pointInsidePolygon(n,f,l,v,y)&&(S[E+=1]=v*t+y);return S};if(this.rectangle)return f(this.shape);if(this.ellipse)return l(this.shape);if(this.ring)return c(this.shape);if(this.polygon)return h(this.polygon);throw new Error("Part: unknown shape.")},w.prototype.contains=function(e,t){return this.shape.contains(e,t)},w.prototype.reflect=function(e,t){return Math.abs(this.reflection-1)<.001?e.reflect(this.shape,t):!1},w.prototype.absorb=function(e){return Math.abs(this.absorption-1)<.001?this.shape.contains(e.x,e.y):!1},w.prototype.getIrradiance=function(e){var t;return this.emissivity===0?0:(t=273+e,t*=t,this.emissivity*i.STEFAN_CONSTANT*v*t*t)},w.prototype.radiate=function(e){var t=this.shape.polygonize(),n=new a,r,i;if(this.emissivity===0)return;for(r=0,i=t.count-1;r<i;r+=1)n.x1=t.x_coords[r],n.y1=t.y_coords[r],n.x2=t.x_coords[r+1],n.y2=t.y_coords[r+1],this.radiateFromLine(e,n);n.x1=t.x_coords[t.count-1
],n.y1=t.y_coords[t.count-1],n.x2=t.x_coords[0],n.y2=t.y_coords[0],this.radiateFromLine(e,n)},w.prototype.radiateFromLine=function(e,t){var n,r,i,u,a,f,l,c,h,v,w,E,S,x,T,N,C;if(this.emissivity===0)return;n=e.getModelOptions(),r=s(t.x1-t.x2,t.y1-t.y2),i=(t.x2-t.x1)/r,u=(t.y2-t.y1)/r,a=Math.max(1,Math.round(r/p)),v=n.solar_ray_speed*u,w=-n.solar_ray_speed*i;if(a===1)h=.5*r,f=t.x1+h*i,l=t.y1+h*u,h=e.getAverageTemperatureAt(f,l),h>d&&(h=e.getTemperatureAt(f,l),c=new o(f,l,this.getIrradiance(h),n.solar_ray_speed),c.vx=v,c.vy=w,e.addPhoton(c),this.constant_temperature||e.setTemperatureAt(f,l,h-c.energy/this.specific_heat));else{E=new Array(4),S=new Array(4),E[0]=v*g-w*m,S[0]=v*m+w*g,E[1]=w*m+v*g,S[1]=w*g-v*m,E[2]=v*b-w*y,S[2]=v*y+w*b,E[3]=w*y+v*b,S[3]=w*b-v*y,x=1+E.length;for(N=0;N<a;N+=1){h=(N+.5)*p,f=t.x1+h*i,l=t.y1+h*u,h=e.getAverageTemperatureAt(f,l),T=this.getIrradiance(h)/x;if(h>d){c=new o(f,l,T,n.solar_ray_speed),c.vx=v,c.vy=w,e.addPhoton(c);for(C=0;C<x-1;C+=1)c=new o(f,l,T,n.solar_ray_speed),c.vx=E[C],c.vy=S[C],e.addPhoton(c);this.constant_temperature||e.changeAverageTemperatureAt(f,l,-T*x/this.specific_heat)}}}}}),define("energy2d/models/core-model",["require","exports","module","arrays","energy2d/models/physics-solvers/heat-solver","energy2d/models/physics-solvers-gpu/heat-solver-gpu","energy2d/models/physics-solvers/fluid-solver","energy2d/models/physics-solvers-gpu/fluid-solver-gpu","energy2d/models/physics-solvers/ray-solver","energy2d/models/part","energy2d/gpu/gpgpu","energy2d/models/helpers"],function(e,t){"use strict";var n=e("arrays"),r=e("energy2d/models/physics-solvers/heat-solver"),i=e("energy2d/models/physics-solvers-gpu/heat-solver-gpu"),s=e("energy2d/models/physics-solvers/fluid-solver"),o=e("energy2d/models/physics-solvers-gpu/fluid-solver-gpu"),u=e("energy2d/models/physics-solvers/ray-solver"),a=e("energy2d/models/part"),f=e("energy2d/gpu/gpgpu"),l=e("energy2d/models/helpers").hypot,c=function(){try{new Float32Array}catch(e){return"regular"}return"Float32Array"}();t.makeCoreModel=function(e){var t=e.grid_width,h=e.grid_height,p=t*h,d=e.model_width/t,v=e.model_height/h,m=0,g,y,b,w,E,S,x,T=!1,N,C={start:function(){},stop:function(){},startFPS:function(){},updateFPS:function(){},stopFPS:function(){}},k=n.create(p,e.background_temperature,c),L=n.create(p,NaN,c),A=n.create(p,0,c),O=n.create(p,0,c),M=n.create(p,0,c),_=n.create(p,0,c),D=n.create(p,0,c),P=n.create(p,e.background_conductivity,c),H=n.create(p,e.background_specific_heat,c),B=n.create(p,e.background_density,c),j=n.create(p,!0,c),F=[],I=[],q=function(){var t=[],n,r,i;if(e.structure&&e.structure.part){n=e.structure.part,n.constructor!==Array&&(n=[n]),t=new Array(n.length);for(r=0,i=n.length;r<i;r+=1)t[r]=new a.Part(n[r])}return t}(),R=function(){T=!1;if(typeof window=="undefined")throw new Error("Core model: WebGL GPGPU unavailable in the node.js environment.");f.init(h,t),I[0]=f.createTexture(),I[1]=f.createTexture(),I[2]=f.createTexture(),I[3]=f.createTexture(),U(),w=i.makeHeatSolverGPU(K),E=o.makeFluidSolverGPU(K),T=!0},U=function(){f.writeRGBATexture(I[0],k,k,L,P),f.writeRGBATexture(I[1],M,H,B,j),f.writeRGBATexture(I[2],A,O,A,O),f.writeRGBATexture(I[3],_,D,_,D)},z=function(){S=function(){var t,n;if(e.sunny)return!0;for(t=0,n=q.length;t<n;t+=1)if(q[t].emissivity>0)return!0;return!1}(),x=function(){var e,t;for(e=0,t=q.length;e<t;e+=1)if(q[e].power>0)return!0;return!1}()},W=function(n,r){var i=e.model_width,s=e.model_height,o,u,a,f;o=n.getGridCells(t,h,i,s);for(a=0,f=o.length;a<f;a+=1)u=o[a],r||(k[u]=n.temperature),j[u]=!1,M[u]=n.power,P[u]=n.thermal_conductivity,H[u]=n.specific_heat,B[u]=n.density,n.wind_speed!==0&&(_[u]=n.wind_speed*Math.cos(n.wind_angle),D[u]=n.wind_speed*Math.sin(n.wind_angle)),n.constant_temperature&&(L[u]=n.temperature)},X=function(t){t||(n.fill(k,e.background_temperature),n.fill(A,0),n.fill(O,0)),n.fill(L,NaN),n.fill(M,0),n.fill(_,0),n.fill(D,0),n.fill(P,e.background_conductivity),n.fill(H,e.background_specific_heat),n.fill(B,e.background_density),n.fill(j,!0)},V=function(e){if(!q||q.length===0)return;var t;for(t=q.length-1;t>=0;t-=1)W(q[t],e)},$=function(){var e,n,r,i,s,o,u,a;for(i=0;i<t;i+=1){n=i*d,s=i*h;for(o=0;o<h;o+=1){r=o*v,M[s+o]=0;if(x)for(u=0,a=q.length;u<a;u+=1){e=q[u];if(e.power!==0&&e.shape.contains(n,r)){M[s+o]=e.power;break}}}}},J=function(e,t){var n=(A[e*h+t+1]-A[e*h+t-1])/d,r=(O[(e+1)*h+t]-O[(e-1)*h+t])/v;return.5*(n-r)},K={nextStep:function(){C.start("Core model step"),T?(e.convective&&(C.start("Fluid solver GPU"),E.solve(),C.stop("Fluid solver GPU")),C.start("Heat solver GPU"),w.solve(e.convective),C.stop("Heat solver GPU")):(S&&(C.start("Ray solver CPU"),m%e.photon_emission_interval===0&&($(),e.sunny&&b.sunShine(),b.radiate()),b.solve(),C.stop("Ray solver CPU")),e.convective&&(C.start("Fluid solver CPU"),y.solve(A,O),C.stop("Fluid solver CPU")),C.start("Heat solver CPU"),g.solve(e.convective,k,M),C.stop("Heat solver CPU")),m+=1,C.stop("Core model step")},setPerformanceTools:function(e){C=e},reset:function(){m=0,X(),z(),V(),T&&U()},partsChanged:function(e,t){X(!0),z(),V(!0),$(),t==="temperature"&&W(e)},addPart:function(e){q.push(e),W(e)},removePart:function(e){q.splice(e,1),K.partsChanged()},useWebGL:function(e){if(T===e)return;if(!K.isWebGLCompatible()){T=!1;return}e?R():(K.syncTemperature(),K.syncVelocity(),T=!1)},isWebGLActive:function(){return T},isWebGLCompatible:function(){return!S},getWebGLError:function(){return N},syncTemperature:function(){T&&f.readTexture(I[0],k)},syncVelocity:function(){T&&(f.readTexture(I[2],A,0),f.readTexture(I[2],O,1))},getIndexOfStep:function(){return m},getModelOptions:function(){return e},getTemperatureAt:function(e,n){var r=Math.max(Math.min(t-1,Math.round(e/d)),0),i=Math.max(Math.min(h-1,Math.round(n/v)),0);return k[r*h+i]},setTemperatureAt:function(e,n,r){var i=Math.max(Math.min(t-1,Math.round(e/d)),0),s=Math.max(Math.min(h-1,Math.round(n/v)),0);k[i*h+s]=r},getAverageTemperatureAt:function(e,n){var r=0,i=t-1,s=h-1,o=Math.round(e/d),u=Math.round(n/v),a,f;return a=Math.max(Math.min(i,o),0),f=Math.max(Math.min(s,u),0),r+=k[a*h+f],a=Math.max(Math.min(i,o+1),0),f=Math.max(Math.min(s,u),0),r+=k[a*h+f],a=Math.max(Math.min(i,o-1),0),f=Math.max(Math.min(s,u),0),r+=k[a*h+f],a=Math.max(Math.min(i,o),0),f=Math.max(Math.min(s,u+1),0),r+=k[a*h+f],a=Math.max(Math.min(i,o),0),f=Math.max(Math.min(s,u-1),0),r+=k[a*h+f],r*.2},changeAverageTemperatureAt:function(e,n,r){var i=t-1,s=h-1,o=Math.round(e/d),u=Math.round(n/v),a,f;r*=.2,a=Math.min(i,o),f=Math.min(s,u),a>=0&&f>=0&&(k[a*h+f]+=r),a=Math.min(i,o+1),f=Math.min(s,u),a>=0&&f>=0&&(k[a*h+f]+=r),a=Math.min(i,o-1),f=Math.min(s,u),a>=0&&f>=0&&(k[a*h+f]+=r),a=Math.min(i,o),f=Math.min(s,u+1),a>=0&&f>=0&&(k[a*h+f]+=r),a=Math.min(i,o),f=Math.min(s,u-1),a>=0&&f>=0&&(k[a*h+f]+=r)},getVorticityAt:function(e,n){var r=Math.max(Math.min(t-1,Math.round(e/d)),0),i=Math.max(Math.min(h-1,Math.round(n/v)),0);return J(r,i)},getAverageVorticityAt:function(e,n){var r=Math.max(Math.min(t-1,Math.round(e/d)),0),i=Math.max(Math.min(h-1,Math.round(n/v)),0),s=J(r,i);return s+=J(r-1,i),s+=J(r+1,i),s+=J(r,i-1),s+=J(r,i+1),s+=J(r-1,i-1),s+=J(r-1,i+1),s+=J(r+1,i-1),s+=J(r+1,i+1),s/9},getSpeedAt:function(e,n){var r=Math.max(Math.min(t-1,Math.round(e/d)),0),i=Math.max(Math.min(h-1,Math.round(n/v)),0);return l(A[r*h+i],O[r*h+i])},getHeatFluxAt:function(e,n){var r=Math.max(Math.min(t-1,Math.round(e/d)),0),i=Math.max(Math.min(h-1,Math.round(n/v)),0),s=-P[r*h+i]*(k[(r+1)*h+i]-k[(r-1)*h+i])/(2*d),o=-P[r*h+i]*(k[r*h+i+1]-k[r*h+i-1])/(2*v);return[s,o]},addPhoton:function(e){F.push(e)},removePhoton:function(e){var t=F.indexOf(e);t!==-1&&F.splice(t,1)},getArrayType:function(){return c},getPerformanceModel:function(){return C},getTemperatureArray:function(){return k},getUVelocityArray:function(){return A},getVVelocityArray:function(){return O},getUWindArray:function(){return _},getVWindArray:function(){return D},getBoundaryTemperatureArray:function(){return L},getPowerArray:function(){return M},getConductivityArray:function(){return P},getCapacityArray:function(){return H},getDensityArray:function(){return B},getFluidityArray:function(){return j},getPhotonsArray:function(){return F},getPartsArray:function(){return q},getTemperatureTexture:function(){return I[0]},getVelocityTexture:function(){return I[2]},getSimulationTexture:function(e){return I[e]}};return z(),V(),g=r.makeHeatSolver(K),y=s.makeFluidSolver(K),b=u.makeRaySolver(K),K}}),define("energy2d/modeler",["require","common/alert","common/console","common/validator","common/lab-modeler-mixin","energy2d/metadata","energy2d/models/core-model","energy2d/models/part"],function(e){"use strict";var t=e("common/alert"),n=e("common/console"),r=e("common/validator"),i=e("common/lab-modeler-mixin"),s=e("energy2d/metadata"),o=e("energy2d/models/core-model"),u=e("energy2d/models/part").Part,a={units:{time:{name:"second",pluralName:"seconds",symbol:"s"},temperature:{name:"degree Celsius",pluralName:"degrees Celsius",symbol:"°C"},length:{name:"meter",pluralName:"meters",symbol:"m"},velocity:{name:"meter per second",pluralName:"meters per second",symbol:"m/s"}}};return function(f){function b(e){try{c.useWebGL(e)}catch(t){n.warn("WebGL initialization failed. CPU solvers and rendering will be used."),n.warn(t.message)}}function w(){c.syncTemperature(),c.syncVelocity()}function E(){var e=l.getTemperatureArray(),t,n;for(t=0,n=e.length;t<n;t++)if(isNaN(e[t])||Math.abs(e[t])>1e10)return l.stop(),c.reset(),!0;return!1}function S(e){var t={thermometer:function(){return l.getTemperatureAt(this.x,this.y)},anemometer:function(){return this._rot},heatFlux:function(){var e=l.getHeatFluxAt(this.x,this.y);return e[0]*this._sin+e[1]*this._cos}},n={thermometer:{label:"Temperature",unitType:"temperature",format:".1f"},anemometer:{},heatFlux:{label:"Heat Flux",unitName:"Watt Per Square Meter",unitPluralName:"Watts Per Square Meter",unitAbbreviation:"W/m²",format:".1f"}};m=[],e.forEach(function(e,i){e=r.validateCompleteness(s.sensor,e),e.type==="anemometer"&&(e._rot=0,g.push(e)),e.type==="heatFlux"&&(e._sin=Math.sin(e.angle*Math.PI/180),e._cos=Math.cos(e.angle*Math.PI/180)),Object.defineProperty(e,"value",{enumerable:!0,get:t[e.type]}),m.push(e),l.defineOutput("sensor-"+i,n[e.type],function(){return e.value})})}function x(){var e,t,n;for(t=0,n=g.length;t<n;t++)e=g[t],e._rot+=l.getSpeedAt(e.x,e.y)*(l.getVorticityAt(e.x,e.y)<0?-1:1)*l.properties.timeStep*700,e._rot=e._rot%360}var l,c,h=new i({metadata:s,unitsDefinition:a,initialProperties:f,setters:{use_WebGL:function(e){c&&b(e),v=l.properties.ticksPerGPUSync},ticksPerGPUSync:function(e){c&&w(),v=Number(e)}}}),p=h.propertySupport,d=h.dispatchSupport,v=0,m=[],g=[],y={};return l={tick:function(){var e,n,r;for(e=0,n=l.properties.timeStepsPerTick;e<n;e++)c.nextStep();c.isWebGLActive()?v>0?v--:(w(),v=Number(l.properties.ticksPerGPUSync),r=E()):r=E(),x(),l.updateAllOutputProperties(),d.tick(),r&&t("The model has diverged and has been reset!\n\nTry changing its parameters (e.g. 'timeStep', positions of parts etc.) or reload it to restore the initial configuration.")},syncTemperature:function(){p.invalidatingChangePreHook(),c.syncTemperature(),p.invalidatingChangePostHook()},syncVelocity:function(){p.invalidatingChangePreHook(),c.syncVelocity(),p.invalidatingChangePostHook()},addPart:function(e){var t=l.properties.use_WebGL,n;l.properties.use_WebGL=!1,e=r.validateCompleteness(s.part,e),n=new u(e),p.invalidatingChangePreHook(),c.addPart(n),y.parts=null,p.invalidatingChangePostHook(),l.properties.use_WebGL=t,d.partsChanged()},removePart:function(e){var t=l.properties.use_WebGL;l.properties.use_WebGL=!1,p.invalidatingChangePreHook(),c.removePart(e),p.invalidatingChangePostHook(),l.properties.use_WebGL=t,d.partsChanged()},getTime:function(){return l.properties.timeStep*c.getIndexOfStep()},isWebGLActive:function(){return c.isWebGLActive()},isWebGLCompatible:function(){return c.isWebGLCompatible()},getWebGLError:function(){return c.getWebGLError()},getIndexOfStep:function(){return c.getIndexOfStep()},getTemperatureAt:function(e,t){return c.getTemperatureAt(e,t)},getAverageTemperatureAt:function(e,t){return c.getAverageTemperatureAt(e,t)},getVorticityAt:function(e,t){return c.getVorticityAt(e,t)},getHeatFluxAt:function(e,t){return c.getHeatFluxAt(e,t)},getAverageVorticityAt:function(e,t){return c.getAverageVorticityAt(e,t)},getSpeedAt:function(e,t){return c.getSpeedAt(e,t)},getTemperatureArray:function(){return c.getTemperatureArray()},getTemperatureTexture:function(){return c.getTemperatureTexture()},getUVelocityArray:function(){return c.getUVelocityArray()},getVVelocityArray:function(){return c.getVVelocityArray()},getVelocityTexture:function(){return c.getVelocityTexture()},getPhotonsArray:function(){return c.getPhotonsArray()},getPartsArray:function(){function e(e){Object.defineProperty(this,"_rawPart",{enumerable:!1,get:function(){return e}})}return Object.keys(s.part).forEach(function(t){Object.defineProperty(e.prototype,t,{enumerable:!0,get:function(){return this._rawPart[t]},set:function(e){var n=l.properties.use_WebGL;l.properties.use_WebGL=!1,p.invalidatingChangePreHook(),this._rawPart[t]=r.validateSingleProperty(s.part[t],t,e),c.partsChanged(this._rawPart,t),p.invalidatingChangePostHook(),l.properties.use_WebGL=n,d.partsChanged()}})}),e.prototype.computeLabel=function(){return this._rawPart.getLabel()},function(){if(!y.parts){var t=c.getPartsArray(),n=[],r,i;for(r=0,i=t.length;r<i;r++)n.push(new e(t[r]));y.parts=n}return y.parts}}(),getSensorsArray:function(){function e(e){Object.defineProperty(this,"_rawObj",{enumerable:!1,get:function(){return e}})}var t={x:function(e){return Math.max(0,Math.min(l.properties.model_width,e))},y:function(e){return Math.max(0,Math.min(l.properties.model_height,e))}};return Object.keys(s.sensor).forEach(function(n){Object.defineProperty(e.prototype,n,{enumerable:!0,get:function(){return this._rawObj[n]},set:function(e){p.invalidatingChangePreHook(),e=t[n]?t[n](e):e,this._rawObj[n]=r.validateSingleProperty(s.sensor[n],n,e),p.invalidatingChangePostHook(),d.sensorsChanged()}})}),function(){if(!y.sensors){var t=[],n,r;for(n=0,r=m.length;n<r;n++)t.push(new e(m[n]));y.sensors=t}return y.sensors}}(),setPerformanceTools:function(){return c.setPerformanceTools()}},function(){h.mixInto(l),d.addEventTypes("tick","partsChanged","sensorsChanged"),c=o.makeCoreModel(l.properties),b(l.properties.use_WebGL),f.sensors&&S(f.sensors),l.defineOutput("minX",{},function(){return 0}),l.defineOutput("minY",{},function(){return 0}),l.defineOutput("maxX",{},function(){return l.properties.model_width}),l.defineOutput("maxY",{},function(){return l.properties.model_height}),l.defineOutput("time",{label:"Time",unitType:"time",format:".2f"},function(){return l.getTime()}),l.defineOutput("displayTime",{label:"Time"},function(){var e=d3.format("02d");return function(){var t=l.getTime(),n,r,i,s;return t=Math.floor(t),n=t%60,t=Math.floor(t/60),r=t%60,t=Math.floor(t/60),i=t%24,t=Math.floor(t/24),s=t,s+":"+e(i)+":"+e(r)+":"+e(n)}}())}(),l}}),define("energy2d/views/helpers",[],function(){"use strict";return{HSVToRGB:function(e,t,n){var r,i,s,o,u,a,f,l;e=Math.max(0,Math.min(360,e)),t=Math.max(0,Math.min(100,t)),n=Math.max(0,Math.min(100,n)),t/=100,n/=100;if(t===0)return r=i=s=n,[Math.round(r*255),Math.round(i*255),Math.round(s*255)];e/=60,o=Math.floor(e),u=e-o,a=n*(1-t),f=n*(1-t*u),l=n*(1-t*(1-u));switch(o){case 0:r=n,i=l,s=a;break;case 1:r=f,i=n,s=a;break;case 2:r=a,i=n,s=l;break;case 3:r=a,i=f,s=n;break;case 4:r=l,i=a,s=n;break;default:r=n,i=a,s=f}return[Math.round(r*255),Math.round(i*255),Math.round(s*255)]}}}),define("energy2d/views/color-palette",["require","energy2d/views/helpers"],function(e){"use strict";var t=e("energy2d/views/helpers"),n,r;return n={},n[0]=n.RAINBOW=[[0,0,128],[20,50,120],[20,100,200],[10,150,150],[120,180,50],[220,200,10],[240,160,36],[225,50,50],[230,85,110],[250,250,250],[255,255,255]],n[1]=n.IRON=[[40,20,100],[80,20,150],[150,20,150],[200,50,120],[220,80,80],[230,120,30],[240,200,20],[240,220,80],[255,255,125],[250,250,250],[255,255,255]],n[2]=n.GRAY=[[50,50,50],[75,75,75],[100,100,100],[125,125,125],[150,150,150],[175,175,175],[200,200,200],[225,225,225],[250,250,250],[255,255,255]],n[3]=n.RAINBOW2=function(){var e=t.HSVToRGB,n=256,r=new Array(n),i;for(i=0;i<n;i+=1)r[i]=t.HSVToRGB(n-1-i,100,90);return r}(),r=function(e){if(e===undefined||e==="DEFAULT")e="RAINBOW";this.color_palette_id=e},r.prototype.getRGBArray=function(){if(n[this.color_palette_id]!==undefined)return n[this.color_palette_id]},r}),define("energy2d/views/heatmap",["require","energy2d/views/color-palette"],function(e){"use strict";var t=e("energy2d/views/color-palette");return function(n){var r="energy2d-heatmap-view",i,s,o,u,a,f,l,c,h,p,d,v=0,m=50,g=function(){i=$("<canvas />"),i.attr("id",n||r),s=i[0].getContext("2d"),window.devicePixelRatio>1&&(s.webkitBackingStorePixelRatio>1||typeof s.webkitBackingStorePixelRatio=="undefined")?o=window.devicePixelRatio:o=1},y={renderHeatmap:function(){var e,t,n,r,i,u,a,f,g,y,b,w;if(!h)throw new Error("Heatmap: bind heatmap before rendering.");s.clearRect(0,0,p,d),s.fillStyle="rgb(0,0,0)",e=c/Math.max(1,m-v),u=s.getImageData(0,0,p/o,d/o),a=u.data,b=0,w=4*p;for(f=0;f<p;f+=1){y=f*d,b=4*f;for(g=0;g<d;g+=1)n=e*(h[y+g]-v),t=Math.floor(n),n-=t,t<0?(t=0,n=0):t>c-1&&(t=c-1,n=1),r=l[t],i=l[t+1],a[b]=r[0]*(1-n)+i[0]*n,a[b+1]=r[1]*(1-n)+i[1]*n,a[b+2]=r[2]*(1-n)+i[2]*n,a[b+3]=255,b+=w}s.putImageData(u,0,0)},bindHeatmap:function(e,t,n){if(t*n!==e.length)throw new Error("Heatmap: provided heatmap has wrong dimensions.");h=e,p=t,d=n,this.setCanvasSize(p,d)},getHTMLElement:function(){return i},resize:function(){},updateCanvasSize:function(){u=i.width(),a=i.height(),f?(i.attr("width",u),i.attr("height",a),y.renderHeatmap()):this.setCanvasSize(p,d)},setCanvasSize:function(e,t){i.attr("width",e/o),i.attr("height",t/o)},setHQRenderingEnabled:function(e){f=e,this.updateCanvasSize()},setMinTemperature:function(e){v=e},setMaxTemperature:function(e){m=e},setColorPalette:function(e){l=(new t(e)).getRGBArray(),c=l.length-1}};return y.setColorPalette("DEFAULT"),g(),y}}),define("text!energy2d/views/heatmap-webgl-glsl/basic.vs.glsl",[],function(){return"varying vec2 coord;\n\nvoid main() {\n  coord = gl_TexCoord.xy;\n  gl_Position = vec4(gl_Vertex.xyz, 1.0);\n}\n"}),define("text!energy2d/views/heatmap-webgl-glsl/temp-renderer.fs.glsl",[],function(){return"// Provided textur contains temperature data in R channel.\nuniform sampler2D heatmap_tex;\nuniform sampler2D palette_tex;\n\nuniform float max_temp;\nuniform float min_temp;\n\nvarying vec2 coord;\n\nvoid main() {\n  float temp = texture2D(heatmap_tex, coord).r;\n  float scaled_temp = (temp - min_temp) / max(1.0, max_temp - min_temp);\n  gl_FragColor = texture2D(palette_tex, vec2(scaled_temp, 0.5));\n}\n"}),define("energy2d/views/heatmap-webgl",["require","energy2d/gpu/context","energy2d/gpu/texture","energy2d/gpu/shader","energy2d/gpu/mesh","energy2d/views/color-palette","text!energy2d/views/heatmap-webgl-glsl/basic.vs.glsl","text!energy2d/views/heatmap-webgl-glsl/temp-renderer.fs.glsl"],function(e){"use strict";var t=e("energy2d/gpu/context"),n=e("energy2d/gpu/texture"),r=e("energy2d/gpu/shader"),i=e("energy2d/gpu/mesh"),s=e("energy2d/views/color-palette"),o=e("text!energy2d/views/heatmap-webgl-glsl/basic.vs.glsl"),u=e("text!energy2d/views/heatmap-webgl-glsl/temp-renderer.fs.glsl");return function(a){var f=t.getWebGLContext(),l=new r(o,u),c=i.plane({coords:!0}),h,p="energy2d-heatmap-webgl-view",d,v,m,g,y=0,b=50,w=function(){d=$(f.canvas),d.attr("id",a||p)},E=function(){f.bindFramebuffer(f.FRAMEBUFFER,null),f.viewport(0,0,v,m)},S={renderHeatmap:function(){if(!g)throw new Error("Heatmap: bind heatmap texture before rendering.");E(),f.clear(f.COLOR_BUFFER_BIT),g.bind(0),h.bind(1),l.draw(c),h.unbind(1),g.unbind(0)},resize:function(){v=d.width(),m=d.height(),d.attr("width",v),d.attr("height",m),S.renderHeatmap()},bindHeatmapTexture:function(e){g=e},getHTMLElement:function(){return d},setMinTemperature:function(e){y=e,l.uniforms({min_temp:y})},setMaxTemperature:function(e){b=e,l.uniforms({max_temp:b})},setColorPalette:function(e){var t,r,i,o,u;t=(new s(e)).getRGBArray(),r=t.length,i=new Uint8Array(r*4);for(o=0;o<r;o+=1)u=o*4,i[u]=t[o][0],i[u+1]=t[o][1],i[u+2]=t[o][2],i[u+3]=255;h=new n(r,1,{type:f.UNSIGNED_BYTE,format:f.RGBA,filter:f.LINEAR}),f.bindTexture(f.TEXTURE_2D,h.id),f.texImage2D(f.TEXTURE_2D,0,h.format,r,1,0,h.format,h.type,i)}};return S.setColorPalette("DEFAULT"),l.uniforms({heatmap_tex:0,palette_tex:1,min_temp:y,max_temp:b}),c.coords=[[1,0],[1,1],[0,0],[0,1]],c.compile(),w(),S}}),define("energy2d/views/webgl-status",["require","common/controllers/checkbox-controller","energy2d/gpu/gpgpu"],function(e){"use strict";var t=e("common/controllers/checkbox-controller"),n=e("energy2d/gpu/gpgpu"),r='<p><a href="http://get.webgl.org" target="_blank">Click to learn more about WebGL.</a></p>';return function(i){var s="energy2d-webgl-status",o,u,a,f,l=new t({type:"checkbox",id:"webgl-status-checkbox",text:"WebGL-accelerated physics engine",property:"use_WebGL"}),c=l.getViewContainer(),h,p=function(){var e;o=$("<div />"),o.attr("id",i||s),a=$('<div id="status-wrapper"/>'),a.appendTo(o),f=$("<div />"),f.appendTo(a),e=$('<a id="hide-webgl-status" class="button"><i class="icon-remove"></i></a>'),e.on("click",v),e.appendTo(a),c.appendTo(a),u=$('<a id="show-webgl-status" class="button"><i class="icon-bolt"></i></a>'),u.on("click",d),u.appendTo(o),a.hide()},d=function(){u.hide(),a.fadeIn()},v=function(){u.fadeIn(),a.fadeOut()},m={bindModel:function(e){h=e,l.modelLoadedCallback()},render:function(){var e=h.isWebGLCompatible(),t=n.featuresInfo,i=!0,s=!0,o=h.properties.use_WebGL&&!h.isWebGLActive(),a;f.empty(),Object.keys(t).forEach(function(e){var n=t[e];n.required&&!n.available&&(i=!1),!n.required&&!n.available&&(s=!1)}),i&&s?f.append('<p>Your browser <span class="happy">supports</span> WebGL as well as all required and optional extensions!</p>'):i?(f.append('<p>Your browser <span class="happy">supports</span> WebGL and all required extensions! However some optional extensions are unavailable:</p>'),Object.keys(t).forEach(function(e){var n=t[e],r;n.required||(r=n.available?'<span class="happy"><i class="icon-ok"></i></span>':'<span class="sad"><i class="icon-remove"></i></span>',f.append('<p class="extension">'+r+" "+e+"</p>"))}),f.append("<p>WebGL rendering quality can be affected.</p>")):t.WebGL?(f.append('<p>Your browser <span class="happy">supports</span> WebGL, however not all required extensions are available:</p>'),Object.keys(t).forEach(function(e){var n=t[e],r;n.required&&(r=n.available?'<span class="happy"><i class="icon-ok"></i></span>':'<span class="sad"><i class="icon-remove"></i></span>',f.append('<p class="extension">'+r+" "+e+"</p>"))}),f.append(r)):(f.append('<p>Sorry, your browser <span class="sad">does not support</span> WebGL.'),f.append(r)),e?(a='This model is <span class="happy">compatible</span> with WebGL-accelerated physics engine',h.isWebGLActive()?a+=' and it is <span class="happy">active</span>.':(a+=', but it is <span class="sad">inactive</span>.',o?a+=' Unfortunately, its initialization <span class="sad">failed</span>. Check the browser console for details.':i&&(a+=" Enable it to speed up simulation:")),f.append("<p>"+a+"</p>")):f.append('<p>Unfortunately, some features used in this model are <span class="sad">incompatible</span> with WebGL-accelerated physics engine.</p>'),!i||!e||o?c.hide():c.show(),o?(a="WebGL initialization failed.",u.removeClass("happy"),u.addClass("sad")):!i||!e?(a="WebGL unavailable.",u.removeClass("happy"),u.addClass("sad")):h.isWebGLActive()?(a="WebGL available and active.",u.removeClass("sad"),u.addClass("happy")):(a="WebGL available, but inactive.",u.removeClass("happy"),u.removeClass("sad")),a+=" Click for detailed information.",u.attr("title",a),o&&d()},getHTMLElement:function(){return o}};return p(),m}}),define("energy2d/views/vectormap",[],function(){"use strict";return function(t){var n="energy2d-vectormap-view",r=100,i=8,s=Math.cos(.523598776),o=Math.sin(.523598776),u=4,a="rgb(175,175,175)",f,l,c,h,p,d,v,m,g,y=!0,b=function(){f=$("<canvas />"),f.attr("id",t||n),l=f[0].getContext("2d")},w=function(e,t,n,a){var f=1/Math.sqrt(n*n+a*a),c=n*f,h=a*f,p=e+c*i+n*r,d=t+h*i+a*r,v=u*(c*s+h*o),m=u*(h*s-c*o);l.beginPath(),l.moveTo(e,t),l.lineTo(p,d),l.lineTo(p-v,d-m),l.moveTo(p,d),v=u*(c*s-h*o),m=u*(h*s+c*o),l.lineTo(p-v,d-m),l.stroke()},E={renderVectormap:function(){if(!y)return;var e,t,n,r,i,s,o,u,f,b;if(!p||!d)throw new Error("Vectormap: bind vectormap before rendering.");e=c/v,t=h/m,l.clearRect(0,0,c,h),l.strokeStyle=a,l.lineWidth=1;for(o=1;o<v-1;o+=g){f=o*m,n=(o+.5)*e;for(u=1;u<m-1;u+=g)b=f+u,r=(u+.5)*t,i=p[b],s=d[b],i*i+s*s>1e-15&&w(n,r,i,s)}},clear:function(){l.clearRect(0,0,c,h)},get enabled(){return y},set enabled(e){y=e,y||E.clear()},bindVectormap:function(e,t,n,r,i){if(n*r!==e.length)throw new Error("Heatmap: provided U component of vectormap has wrong dimensions.");if(n*r!==t.length)throw new Error("Heatmap: provided V component of vectormap has wrong dimensions.");p=e,d=t,v=n,m=r,g=Math.round(n/i)},getHTMLElement:function(){return f},resize:function(){c=f.width(),h=f.height(),f.attr("width",c),f.attr("height",h),E.renderVectormap()}};return b(),E}}),define("text!energy2d/views/vectormap-webgl-glsl/vectormap.vs.glsl",[],function(){return"// Provided texture contains vector data in RG channels.\nattribute vec2 origin;\n\nuniform sampler2D vectormap_tex;\nuniform float base_length;\nuniform float vector_scale;\nuniform vec2 scale;\n\nvoid main() {\n  // Read vector which should be visualized.\n  vec2 vec = texture2D(vectormap_tex, gl_TexCoord.xy).xy;\n  vec.y = -vec.y;\n\n  if (length(vec) < 1e-15) {\n    // Do not draw to small vectors.\n    // Set position outside [-1, 1] region, which is rendered.\n    gl_Position = vec4(2.0);\n    return;\n  }\n\n  // Test which part of the vector arrow is being processed. \n  if (gl_Vertex.x == 0.0 && gl_Vertex.y == 0.0) {\n    // Origin of the arrow is being processed.\n    // Just transform its coordinates.\n    gl_Position = vec4(origin, 0.0, 1.0);\n  } else {\n    // Other parts of arrow are being processed.\n    // Set proper length of the arrow, rotate it, scale\n    // and finally transform.\n\n    // Calculate arrow length.\n    vec2 new_pos = gl_Vertex.xy;\n    new_pos.x += base_length + vector_scale * length(vec);\n\n    // Calculate angle between reference arrow (horizontal).\n    vec = normalize(vec);\n    float angle = acos(dot(vec, vec2(1.0, 0.0)));\n    if (vec.y < 0.0) {\n      angle = -angle;\n    }\n    // Prepare rotation matrix.\n    // See: http://en.wikipedia.org/wiki/Rotation_matrix\n    mat2 rot_m = mat2(\n      cos(angle), sin(angle),\n     -sin(angle), cos(angle)\n    );\n    // Rotate.\n    new_pos = rot_m * new_pos;\n    // Scale.\n    new_pos = new_pos * scale;\n    // Transform.\n    gl_Position = vec4(new_pos + origin, 0.0, 1.0);\n  }\n}\n"}),define("text!energy2d/views/vectormap-webgl-glsl/vectormap.fs.glsl",[],function(){return"uniform vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n"}),define("energy2d/views/vectormap-webgl",["require","energy2d/gpu/context","energy2d/gpu/shader","energy2d/gpu/mesh","text!energy2d/views/vectormap-webgl-glsl/vectormap.vs.glsl","text!energy2d/views/vectormap-webgl-glsl/vectormap.fs.glsl"],function(e){"use strict";var t=e("energy2d/gpu/context"),n=e("energy2d/gpu/shader"),r=e("energy2d/gpu/mesh"),i=e("text!energy2d/views/vectormap-webgl-glsl/vectormap.vs.glsl"),s=e("text!energy2d/views/vectormap-webgl-glsl/vectormap.fs.glsl");return function(o){var u=t.getWebGLContext(),a=new n(i,s),f=new r({coords:!0,lines:!0}),l="energy2d-vectormap-webgl-view",c=100,h=8,p=[.7,.7,.7,1],d,v,m,g,y,b,w,E=!0,S=function(){var e,t,n,r,i,s=2/y,o=2/b,u=1/y,a=1/b;f.addVertexBuffer("origins","origin"),f.vertices=[],f.origins=[],f.coords=[],f.lines=[],n=0;for(e=1;e<y-1;e+=w)for(t=1;t<b-1;t+=w)f.vertices.push([0,0,0],[.01,0,0],[-3,2,0],[-3,-2,0]),r=[-1+(e+.5)*s,1-(t+.5)*o,0],f.origins.push(r,r,r,r),i=[(t+.5)*a,(e+.5)*u],f.coords.push(i,i,i,i),f.lines.push([n,n+1],[n+1,n+2],[n+1,n+3]),n+=4;f.compile()},x=function(){d=$(u.canvas),d.attr("id",o||l)},T=function(){u.bindFramebuffer(u.FRAMEBUFFER,null),u.viewport(0,0,v,m)},N={renderVectormap:function(){if(!E)return;if(!g)throw new Error("Vectormap: bind heatmap texture before rendering.");T(),g.bind(0),a.draw(f,u.LINES),g.unbind(0)},get enabled(){return E},set enabled(e){E=e},resize:function(){v=d.width(),m=d.height(),d.attr("width",v),d.attr("height",m),a.uniforms({scale:[2/v,2/m]}),N.renderVectormap()},bindVectormapTexture:function(e,t,n,r){g=e,y=t,b=n,w=Math.round(y/r),S()},getHTMLElement:function(){return d}};return a.uniforms({vectormap_tex:0,base_length:h,vector_scale:c,color:p}),x(),N}}),define("energy2d/views/photons",[],function(){"use strict";return function(t){var n="energy2d-photons-view",r="energy2d-photons-view",i=10,s,o,u,a,f,l,c,h,p,d=function(){s=$("<canvas />"),s.attr("id",t||n),s.addClass(r),o=s[0].getContext("2d")},v=function(){o.strokeStyle="rgba(255,255,255,128)",o.lineWidth=.5},m={renderPhotons:function(){var e,t,n,r,s,h;if(!f)throw new Error("Photons view: bind parts array before rendering.");o.clearRect(0,0,u,a);for(s=0,h=f.length;s<h;s+=1)e=f[s],t=e.x*l,n=e.y*c,r=1/Math.sqrt(e.vx*e.vx+e.vy*e.vy),o.beginPath(),o.moveTo(t,n),o.lineTo(t+i*e.vx*r,n+i*e.vy*r),o.stroke()},bindPhotonsArray:function(e,t,n){f=e,h=t,p=n,l=u/h,c=a/p},getHTMLElement:function(){return s},resize:function(){u=s.width(),a=s.height(),l=u/h,c=a/p,s.attr("width",u),s.attr("height",a),v(),m.renderPhotons()}};return d(),v(),m}}),define("energy2d/views/parts",[],function(){var e=-1,t=2;return function(r,i){function h(e){return e.label?this:null}function p(e){return"translate("+u(e.x||0)+","+a(e.y||0)+")"}function d(e){return u(e.width)+t}function v(e){return u(e.height)+t}function m(e){return u(e.a*.5)}function g(e){return u(e.b*.5)}function y(e){return e.visible?undefined:"none"}function b(e){return e.texture?"url(#texture-1)":"none"}function w(e){return e.computeLabel()}function E(){return-this.getBBox().width/2}function S(e){if(!e.filled)return"rgba(0, 0, 0, 0)";var t;if(e.color==="auto")e.power>0?t="#FFFF00":e.power<0?t="#B0C4DE":e.constant_temperature?t="rgba(0, 0, 0, 0)":t="#999";else{t=e.color;if(!isNaN(parseInt(t,16))){while(t.length<6)t="0"+t;t="#"+t}}return t}function x(e){var t=[],n=e.raw_x_coords,r=e.raw_y_coords,i,s;for(i=0,s=n.length;i<s;i++)t.push(u(n[i])),t.push(a(r[i]));return"M"+t.join(",")+"Z"}function T(e){switch(e.shapeType){case"polygon":return x(e);case"ring":return l(e)}}function N(e){var t=e.shapeType;return t==="rectangle"||t==="polygon"?this.parentNode.firstElementChild.getBBox().width/2:0}function C(e){var t=e.shapeType;return t==="rectangle"||t==="polygon"?this.parentNode.firstElementChild.getBBox().height/2:0}function k(){var e=i.append("defs").append("pattern").attr("id","texture-1").attr("patternUnits","userSpaceOnUse").attr("x",0).attr("y",0).attr("width","0.7em").attr("height","0.7em").attr("viewBox","0 0 16 16");e.append("path").attr("class","e2d-texture-path-shadow").attr("d","M0,0 L16,16 M-1,15 L1,17 M15,-1 L17,1"),e.append("path").attr("class","e2d-texture-path").attr("d","M0,0 L16,16 M-1,15 L1,17 M15,-1 L17,1")}function L(t,n,r){n=n.select(f[t]),n.append(t).attr("class","e2d-part-shape"),n.append(t).attr("class","e2d-part-shape-outline").attr("fill",b);switch(t){case"rect":r.selectAll("rect").attr("x",e).attr("y",e).attr("width",d).attr("height",v);break;case"ellipse":r.selectAll("ellipse").attr("rx",m).attr("ry",g);break;case"path":r.selectAll("path").attr("d",T)}}function A(e,t){e=e.select(h),e.append("text").attr("class","e2d-part-label-shadow").attr("dy",".35em"),e.append("text").attr("class","e2d-part-label").attr("dy",".35em"),t.selectAll(".e2d-part-label, .e2d-part-label-shadow").text(w).attr("dx",E).attr("x",N).attr("y",C)}var s,o,u=r.model2px,a=r.model2pxInv,f={rect:function(e){return e.shapeType==="rectangle"?this:null},ellipse:function(e){return e.shapeType==="ellipse"?this:null},path:function(e){return e.shapeType==="polygon"||e.shapeType==="ring"?this:null}},l=d3.svg.arc().innerRadius(function(e){return u(e.inner*.5)}).outerRadius(function(e){return u(e.outer*.5)}).startAngle(0).endAngle(Math.PI*2),c=function(){var e,t,n,r,i,s,o;return d3.behavior.drag().origin(function(e){return{x:u(e.x),y:a(e.y)}}).on("dragstart",function(f){var l,c;f.draggable&&(e=t=null,l=u.range(),c=a.range(),n=Math.min(l[0],l[1]),r=Math.max(l[0],l[1]),i=Math.min(c[0],c[1]),s=Math.max(c[0],c[1]),o=this.getBBox(),o.x0=o.x+10,o.y0=o.y+10,o.x1=o.x+o.width-10,o.y1=o.y+o.height-10,d3.select(this).style
("opacity",.7))}).on("drag",function(u){u.draggable&&(e=d3.event.x,t=d3.event.y,e-=Math.max(0,o.x0+e-r)+Math.min(0,o.x1+e-n),t-=Math.max(0,o.y0+t-s)+Math.min(0,o.y1+t-i),d3.select(this).attr("transform","translate("+e+","+t+")"))}).on("dragend",function(n){n.draggable&&(d3.select(this).style("opacity",1),e!==null&&(n.x=u.invert(e),n.y=a.invert(t)))})}();return s={renderParts:function(){if(!o)return;var e,t;e=i.selectAll(".e2d-part").data(o),t=e.enter().append("g").attr("class","e2d-part part"),L("rect",t,e),L("ellipse",t,e),L("path",t,e),A(t,e),t.call(c),e.attr("transform",p),e.select(".e2d-part-shape").attr("fill",S).style("display",y),e.exit().remove()},bindPartsArray:function(e){o=e}},function(){k()}(),s}}),define("energy2d/views/sensors",[],function(){var e=2,t=5;return function(r,i){function v(e){return e.type==="thermometer"?this:null}function m(e){return e.type==="anemometer"?this:null}function g(e){return e.type==="heatFlux"?this:null}function y(e){return e+"%"}function b(e){return"translate("+o(e.x)+","+u(e.y)+")"}function w(){return-this.getBBox().width/2}function E(e){return e.label}function S(e){return e.value.toFixed(1)+" °C"}function x(e){return y(c(e.value))}function T(e){return"rotate("+e.value+")"}function N(e){return e.value.toFixed(1)+" W/m²"}function C(e){return"rotate("+e.angle+")"}function k(e){e=e.append("g").attr("class","e2d-measuring-point"),e.append("line").attr("x1",0).attr("y1","-0.8%").attr("x2",0).attr("y2","0.8%"),e.append("line").attr("x1","-0.8%").attr("y1",0).attr("x2","0.8%").attr("y2",0),e.append("circle").attr("r","0.8%")}function L(n,r){n=n.select(v),n.append("rect").attr("class","e2d-thermometer-fill"),n.append("rect").attr("class","e2d-thermometer-background"),n.append("text").attr("class","e2d-sensor-reading-shadow"),n.append("text").attr("class","e2d-sensor-reading"),n.append("text").attr("class","e2d-sensor-label-shadow"),n.append("text").attr("class","e2d-sensor-label"),n.call(k),r=r.select(v),r.select(".e2d-thermometer-fill").attr("x",y(-0.5*e)).attr("y",y(-0.5*t)).attr("width",y(e)).attr("height",y(t)),f=r.select(".e2d-thermometer-background").attr("x",y(-0.5*e)).attr("y",y(-0.5*t)).attr("width",y(e)).attr("height",x),r.select(".e2d-sensor-reading"),r.select(".e2d-sensor-reading-shadow"),l=r.selectAll(".e2d-sensor-reading, .e2d-sensor-reading-shadow").text(S).attr("y",y(-0.5*t)).attr("dy","-.2em").attr("dx","-.7em"),r.selectAll(".e2d-sensor-label, .e2d-sensor-label-shadow").text(E).attr("dx",w).attr("dy","1em").attr("y",y(.5*t))}function A(e,t){e=e.select(m),e.append("text").attr("class","e2d-sensor-label-shadow"),e.append("text").attr("class","e2d-sensor-label");var n=e.append("svg").attr("class","e2d-anemometer-shape").attr("viewBox","-50 -50 100 100").attr("x","-3%").attr("y","-3%").attr("width","6%").attr("height","6%").append("g").attr("class","e2d-anemometer-rot");n.append("path").attr("d","M-10,10 L0,50 L10,10 Z").attr("transform","rotate(0)"),n.append("path").attr("d","M-10,10 L0,50 L10,10 Z").attr("transform","rotate(120)"),n.append("path").attr("d","M-10,10 L0,50 L10,10 Z").attr("transform","rotate(240)"),n.append("circle").attr("r",12),t=t.select(m),h=t.select(".e2d-anemometer-rot").attr("transform",T),t.selectAll(".e2d-sensor-label, .e2d-sensor-label-shadow").text(E).attr("dx",w).attr("dy","0.7em").attr("y","3%")}function O(e,t){e=e.select(g);var n=e.append("g").attr("transform",C);n.append("rect").attr("class","e2d-heatflux-shape").attr("x","-3%").attr("y","-1%").attr("width","6%").attr("height","2%"),n.append("svg").attr("viewBox","0 0 6 1").attr("x","-3%").attr("y","-1%").attr("width","6%").attr("height","2%").append("path").attr("class","e2d-heatflux-pattern").attr("d","M0,0L1,1L2,0L3,1L4,0L5,1L6,0"),n.append("text").attr("class","e2d-sensor-reading-shadow"),n.append("text").attr("class","e2d-sensor-reading"),n.append("text").attr("class","e2d-sensor-label-shadow"),n.append("text").attr("class","e2d-sensor-label"),n.call(k),t=t.select(g),t.select(".e2d-sensor-reading"),t.select(".e2d-sensor-reading-shadow"),p=t.selectAll(".e2d-sensor-reading, .e2d-sensor-reading-shadow").text(N).attr("y","-1%").attr("dy","-.2em").attr("dx","-1.8em"),t.selectAll(".e2d-sensor-label, .e2d-sensor-label-shadow").text(E).attr("dx",w).attr("dy","0.9em").attr("y","1%")}var s,o=r.model2px,u=r.model2pxInv,a,f,l,c=d3.scale.linear().clamp(!0).domain([0,50]).range([t,0]),h,p,d=d3.behavior.drag().origin(function(e){return{x:o(e.x),y:u(e.y)}}).on("drag",function(e){e.x=o.invert(d3.event.x),e.y=u.invert(d3.event.y)});return s={update:function(){f.attr("height",x),l.text(S),h.attr("transform",T),p.text(N)},renderSensors:function(){if(!a)return;var e,t;e=i.selectAll(".e2d-sensor").data(a),t=e.enter().append("g").attr("class","e2d-sensor sensor"),L(t,e),A(t,e),O(t,e),t.call(d),e.attr("transform",b),e.exit().remove()},bindSensorsArray:function(e){a=e},setMinMaxTemp:function(e,t){c.domain([e,t])}},s}}),define("energy2d/views/renderer",["require","energy2d/views/heatmap","energy2d/views/heatmap-webgl","energy2d/views/webgl-status","energy2d/views/vectormap","energy2d/views/vectormap-webgl","energy2d/views/photons","energy2d/views/parts","energy2d/views/sensors"],function(e){var t=e("energy2d/views/heatmap"),n=e("energy2d/views/heatmap-webgl"),r=e("energy2d/views/webgl-status"),i=e("energy2d/views/vectormap"),s=e("energy2d/views/vectormap-webgl"),o=e("energy2d/views/photons"),u=e("energy2d/views/parts"),a=e("energy2d/views/sensors");return function(f){function S(e){var t=e.getHTMLElement();t.css("width","100%"),t.css("height","100%"),t.css("position","absolute"),t.css("top",0),t.css("left",0),t.css("z-index",w),w+=1,b.append(t)}function x(){var e=c.properties;b.empty(),w=0,c.isWebGLActive()?(h=new n,p=new s,S(p)):(h=new t,S(h),p=new i,S(p)),d=new o,S(d),c.isWebGLActive()?(h.bindHeatmapTexture(c.getTemperatureTexture()),p.bindVectormapTexture(c.getVelocityTexture(),e.grid_width,e.grid_height,25)):(h.bindHeatmap(c.getTemperatureArray(),e.grid_width,e.grid_height),p.bindVectormap(c.getUVelocityArray(),c.getVVelocityArray(),e.grid_width,e.grid_height,25)),v.bindPartsArray(c.getPartsArray(),e.model_width,e.model_height),m.bindSensorsArray(c.getSensorsArray()),d.bindPhotonsArray(c.getPhotonsArray(),e.model_width,e.model_height),g.bindModel(c),v.renderParts(),m.renderSensors(),g.render()}function T(){var e=c.properties;p.enabled=e.velocity,h.setMinTemperature(e.minimum_temperature),h.setMaxTemperature(e.maximum_temperature),h.setColorPalette(e.color_palette_type),m.setMinMaxTemp(e.minimum_temperature,e.maximum_temperature)}var l,c,h,p,d,v,m,g=new r,y=g.getHTMLElement(),b=$("<div>"),w=0,E=!0;return l={getHeightForWidth:function(e){return e*c.properties.grid_height/c.properties.grid_width},resize:function(){if(E)return;h.resize(),p.resize(),d.resize(),v.renderParts(),m.renderSensors()},reset:function(){},setup:function(){x(),T(),l.update(),E=!1},update:function(){h.renderHeatmap(),p.renderVectormap(),d.renderPhotons(),m.update()},setFocus:function(){c.get("enableKeyboardHandlers")&&this.$el.focus()},bindModel:function(e){c=e,c.addPropertiesListener("use_WebGL",function(){x(),T(),l.update()}),c.addPropertiesListener(["color_palette_type","velocity","minimum_temperature","maximum_temperature"],function(){T(),l.update()}),c.on("tick.view-update",l.update),c.on("partsChanged.view-update",v.renderParts),c.on("sensorsChanged.view-update",m.renderSensors)}},function(){function t(e,t,n){e.css({position:"absolute",width:"100%",height:n?undefined:"100%",top:0,left:0,"z-index":t})}var e=f.viewport;v=new u(f,e.append("g").attr("class","parts-layer")),m=new a(f,e.append("g").attr("class","sensors-layer")),f.$el.append(b),t(b,-1),f.$el.append(y),t(y,1,!0)}(),l}}),define("energy2d/benchmarks/benchmarks",[],function(){return function(t){var n=[{name:"commit",numeric:!1,run:function(e){var t="<a href='"+Lab.version.repo.commit.url+"' class='opens-in-new-window' target='_blank'>"+Lab.version.repo.commit.short_sha+"</a>";Lab.version.repo.dirty&&(t+=" <i>dirty</i>"),e(t)}},{name:"just graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n,r,i;model.stop(),model.properties.use_WebGL=!1,r=+Date.now(),i=0;while(i++<100)t.modelContainer.update();n=Date.now()-r,e(100/n*1e3)}},{name:"model (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n;model.stop(),t=+Date.now(),model.suppressEvents(function(){var e=0;while(e++<50)model.tick()}),n=Date.now()-t,e(50/n*1e3)}},{name:"model+graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n,r;model.stop(),model.properties.use_WebGL=!1,t=+Date.now(),r=0;while(r++<50)model.tick();n=Date.now()-t,e(50/n*1e3)}},{name:"model+graphics-webgl(steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n,r;model.stop(),model.properties.use_WebGL=!0,t=+Date.now(),r=0;while(r++<50)model.tick();n=Date.now()-t,e(50/n*1e3)}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(e){model.properties.use_WebGL=!1,model.start(),setTimeout(function(){model.stop();var t=model.get("time");setTimeout(function(){model.start(),setTimeout(function(){model.stop();var n=model.get("time")-t;e(n/(model.get("timeStepsPerTick")*model.get("timeStep"))/2)},2e3)},100)},1e3)}},{name:"fps-webgl",numeric:!0,formatter:d3.format("5.1f"),run:function(e){model.properties.use_WebGL=!0,model.start(),setTimeout(function(){model.stop();var t=model.get("time");setTimeout(function(){model.start(),setTimeout(function(){model.stop();var n=model.get("time")-t;e(n/(model.get("timeStepsPerTick")*model.get("timeStep"))/2)},2e3)},100)},1e3)}},{name:"interactive",numeric:!1,run:function(e){e(window.location.pathname+window.location.hash)}}];return n}}),define("energy2d/controllers/scripting-api",[],function(){return function(t){return{getTemperatureAt:function(t,n){return model.getTemperatureAt(t,n)},getAverageTemperatureAt:function(t,n){return model.getAverageTemperatureAt(t,n)},getPart:function(t){return model.getPartsArray()[t]},addPart:function(t){model.addPart(t)},removePart:function(t){model.removePart(t)},getNumberOfParts:function(){return model.getPartsArray().length},syncTemperature:function(){model.syncTemperature()}}}}),define("energy2d/controllers/controller",["require","energy2d/modeler","common/views/svg-container","energy2d/views/renderer","energy2d/benchmarks/benchmarks","energy2d/controllers/scripting-api"],function(e){var t=e("energy2d/modeler"),n=e("common/views/svg-container"),r=e("energy2d/views/renderer"),i=e("energy2d/benchmarks/benchmarks"),s=e("energy2d/controllers/scripting-api");return function(e,o){model=new t(o);var u,a=d3.dispatch("modelLoaded"),f=new n(model,e,r,{origin:"top-left"}),l;return u={get type(){return"energy2d"},get benchmarks(){return l},get modelUrl(){return e},get modelContainer(){return f},on:function(e,t){a.on(e,t)},getViewContainer:function(){return u.modelContainer.$el},getHeightForWidth:function(e){return u.modelContainer.getHeightForWidth(e)},resize:function(){u.modelContainer.resize()},repaint:function(){u.modelContainer.repaint()},enableKeyboardHandlers:function(){return!0},reload:function(e,n,r){u.modelUrl=e||u.modelUrl,o=n||o,model=new t(o),u.modelContainer.bindModel(model),r||a.modelLoaded()},modelInDOM:function(){u.modelContainer.setup()},state:function(){return null},ScriptingAPI:s},l=new i(u),u}}),define("common/controllers/interactives-controller",["require","lab.config","arrays","common/alert","common/controllers/interactive-metadata","common/validator","common/controllers/bar-graph-controller","common/controllers/graph-controller","common/controllers/export-controller","common/controllers/scripting-api","common/controllers/button-controller","common/controllers/checkbox-controller","common/controllers/text-controller","common/controllers/image-controller","common/controllers/radio-controller","common/controllers/slider-controller","common/controllers/pulldown-controller","common/controllers/numeric-output-controller","common/controllers/parent-message-api","common/controllers/thermometer-controller","common/controllers/playback-controller","common/controllers/div-controller","common/controllers/setup-banner","common/controllers/about-dialog","common/controllers/share-dialog","common/controllers/credits-dialog","common/layout/semantic-layout","common/layout/templates","md2d/controllers/controller","solar-system/controllers/controller","signal-generator/controller","sensor/controller","energy2d/controllers/controller"],function(e){var t=e("lab.config"),n=e("arrays"),r=e("common/alert"),i=e("common/controllers/interactive-metadata"),s=e("common/validator"),o=e("common/controllers/bar-graph-controller"),u=e("common/controllers/graph-controller"),a=e("common/controllers/export-controller"),f=e("common/controllers/scripting-api"),l=e("common/controllers/button-controller"),c=e("common/controllers/checkbox-controller"),h=e("common/controllers/text-controller"),p=e("common/controllers/image-controller"),d=e("common/controllers/radio-controller"),v=e("common/controllers/slider-controller"),m=e("common/controllers/pulldown-controller"),g=e("common/controllers/numeric-output-controller"),y=e("common/controllers/parent-message-api"),b=e("common/controllers/thermometer-controller"),w=e("common/controllers/playback-controller"),E=e("common/controllers/div-controller"),S=e("common/controllers/setup-banner"),x=e("common/controllers/about-dialog"),T=e("common/controllers/share-dialog"),N=e("common/controllers/credits-dialog"),C=e("common/layout/semantic-layout"),k=e("common/layout/templates"),L={md2d:e("md2d/controllers/controller"),"solar-system":e("solar-system/controllers/controller"),"signal-generator":e("signal-generator/controller"),sensor:e("sensor/controller"),energy2d:e("energy2d/controllers/controller")},A={text:h,image:p,button:l,checkbox:c,pulldown:m,radio:d,thermometer:b,barGraph:o,graph:u,slider:v,numericOutput:g,div:E,playback:w};return function(o,u){function R(e){if(d[e])return d[e];throw new Error("No model found with id "+e)}function U(e,r){function u(e,t,r){function o(e,t){var r;for(r in e)t[r]===undefined?n.isArray(e[r])?t[r]=$.extend(!0,[],e[r]):typeof e[r]=="object"?t[r]=$.extend(!0,{},e[r]):t[r]=e[r]:typeof t[r]=="object"&&!(t[r]instanceof Array)&&(t[r]=o(e[r],t[r]));return t}var i,s;return s=$.extend(!0,{},r),s=o(e.viewOptions||{},s),i=$.extend(!0,{},t),i=o(e||{},i),i.viewOptions=s,i}function a(e,t){var n=u(t,o,s);c?c.reload(e,n,!0):(f(t.type,e,n),c.on("modelLoaded",J),l.modelController=c),I.setupModel(c),z(),J(),I.layoutInteractive()}function f(e,t,n){var r=e||"md2d";if(L[r]==null)throw new Error("Couldn't understand modelType '"+r+"'!");c=new L[r](t,n,l),c.ScriptingAPI&&(_.extend(c.ScriptingAPI),_.exposeScriptingAPI())}var i=R(e),s,o;l.currentModel=i,i.viewOptions?s=$.extend(!0,{},i.viewOptions):s={controlButtons:"play"},g=[],i.onLoad&&g.push(_.makeFunctionInScriptContext(V(i.onLoad))),i.modelOptions&&(o=$.extend(!0,{},i.modelOptions)),r?a(i.url,r):i.url?$.get(t.actualRoot+i.url).done(function(e){e=typeof e=="string"?JSON.parse(e):e,a(i.url,e)}).fail(function(){r={type:"md2d",width:2.5,height:1.5,viewOptions:{backgroundColor:"rgba(245,200,200,255)",showClock:!1,textBoxes:[{text:"Model could not be loaded:",x:0,y:1,width:2.5,height:.25,fontScale:1.4,layer:1,frame:"rectangle",textAlign:"center",strokeOpacity:0,backgroundColor:"rgb(232,231,231)"},{text:i.url,x:0,y:.8,width:2.5,height:.25,fontScale:.9,layer:1,frame:"rectangle",textAlign:"center",strokeOpacity:0,backgroundColor:"rgb(232,231,231)"}]}},a(i.url,r)}):(r=i.model,a("",r))}function z(){h.off("keydown.interactiveController"),c&&c.enableKeyboardHandlers()&&h.on("keydown.interactiveController",function(e){var t=e.keycode||e.which;switch(t){case 13:e.preventDefault(),_.api.start();break;case 32:e.preventDefault(),_.api.isStopped()?_.api.start():_.api.stop();break;case 37:e.preventDefault(),_.api.isStopped()?_.api.stepBack():_.api.stop();break;case 39:e.preventDefault(),_.api.isStopped()?_.api.stepForward():_.api.stop()}})}function W(){var e,t,n,r,i,s,u;typeof o.template=="string"?e=k[o.template]:e=o.template,t=o.layout,i=o.fontScale,s=S(_,o,F,B,j),r=s.components;for(n in r)r.hasOwnProperty(n)&&(n=r[n],n.modelLoadedCallback&&m.push($.proxy(n.modelLoadedCallback,n)));e=s.template.concat(e),t=$.extend({},t,s.layout),r=$.extend({},E,s.components),I.initialize(e,t,r,i),Q()&&($(window).unbind("resize"),$(window).on("resize",function(){l.resize()})),u=function(){l.resize(),setTimeout(l.resize,50)},document.addEventListener("fullscreenchange",u,!1),document.addEventListener("mozfullscreenchange",u,!1),document.addEventListener("webkitfullscreenchange",u,!1)}function X(e){var t=e.type,n=e.id,r;r=new A[t](e,_,l);if(!r.getViewContainer().hasClass("component"))throw new Error("Invalid Interactive Component implementation. Each component has to have 'component' class.");E[n]=r,O.push(r),r.modelLoadedCallback&&m.push($.proxy(r.modelLoadedCallback,r))}function V(e){return typeof e=="string"?e:e.join("\n")}function J(){var e,t;Y("basic",l.currentModel.outputs,o.outputs),Z(l.currentModel.parameters,o.parameters),Y("filtered",l.currentModel.filteredOutputs,o.filteredOutputs),c.modelInDOM();for(e=0;e<m.length;e++)m[e]();H=new y(model,c.modelContainer,l);for(e=0;e<v.length;e++)t=v[e],model.addPropertiesListener(t[0],t[1]);for(e=0;e<g.length;e++)g[e]();for(e=0;e<w.length;e++)w[e]()}function K(e){function l(e,t){var n,o,u;if(!t)return;try{for(n=0,o=t.length;n<o;n++)t[n]=s.validateCompleteness(i[e],t[n])}catch(a){throw u="Incorrect "+e+" definition:\n"+a.message,r(u),new Error(u)}}var t,n,o,u,a,f;try{e=s.validateCompleteness(i.interactive,e)}catch(c){throw f="Incorrect interactive definition:\n"+c.message,r(f),new Error(f)}l("model",e.models),l("parameter",e.parameters),l("output",e.outputs),l("filteredOutput",e.filteredOutputs),o=e.models;for(t=0,n=o.length;t<n;t++)u=o[t],l("parameter",u.parameters),l("output",u.outputs),l("filteredOutput",u.filteredOutputs);a=e.components;try{for(t=0,n=a.length;t<n;t++)a[t]=s.validateCompleteness(i[a[t].type],a[t])}catch(c){throw f="Incorrect "+a[t].type+" component definition:\n"+c.message,r(f),new Error(f)}if(e.exports)try{e.exports=s.validateCompleteness(i.exports,e.exports)}catch(c){throw f="Incorrect exports definition:\n"+c.message,r(f),new Error(f)}return e}function Q(){return h.parent().parent().prop("nodeName")==="BODY"}function G(e){var t,n,r;m=[],o=K(e),p=o.models;for(n=0,r=p.length;n<r;n++)d[p[n].id]=p[n];t=o.components||[],O=[],E={};for(n=0,r=t.length;n<r;n++)X(t[n]);o.exports&&(P=new a(o.exports),m.push(P.modelLoadedCallback),a.isExportAvailable()&&X({type:"button",text:"Analyze Data",id:"-lab-analyze-data",action:"exportData();"})),W(),U(p[0].id)}function Y(e,t,n){function o(e){if(!e)return;for(var t=0;t<e.length;t++)r[e[t].name]=e[t]}if(!t&&!n)return;var r={},i,s;o(n),o(t);for(i in r)if(r.hasOwnProperty(i)){s=r[i];switch(e){case"basic":model.defineOutput(s.name,{label:s.label,unitType:s.unitType,unitName:s.unitName,unitPluralName:s.unitPluralName,unitAbbreviation:s.unitAbbreviation},_.makeFunctionInScriptContext(V(s.value)));break;case"filtered":model.defineFilteredOutput(s.name,{label:s.label,unitType:s.unitType,unitName:s.unitName,unitPluralName:s.unitPluralName,unitAbbreviation:s.unitAbbreviation},s.property,s.type,s.period)}}}function Z(e,t){if(!e&&!t)return;var n={},r,i,s,o;r=(t||[]).concat(e||[]);for(i=0;i<r.length;i++)s=r[i],o=undefined,s.onChange&&(o=_.makeFunctionInScriptContext("value",V(s.onChange))),model.defineParameter(s.name,{label:s.label,unitType:s.unitType,unitName:s.unitName,unitPluralName:s.unitPluralName,unitAbbreviation:s.unitAbbreviation},o),s.initialValue!==undefined&&(n[s.name]=s.initialValue),M[s.name]=s;model.set(n)}var l={},c,h,p=[],d={},v=[],m=[],g=[],b=[],w=[],E={},O=[],M=[],_,D,P,H,B,j,F,I,q;return q=function(){var e=-1;return function(){return e++}},l={getDGExportController:function(){return P},getModelController:function(){return c},pushOnLoadScript:function(e){g.push(e)},getNextTabIndex:q,resize:function(){var e;I.layoutInteractive();for(e=0;e<b.length;e++)b[e]()},on:function(e,t){if(typeof t=="function")t=[t];else{if(!$.isArray(t))throw new Error("Invalid callback, must be a function or array of functions.");if(t.some(function(e){return typeof e!="function"}))throw new Error("Invalid callback, must be an array of functions.")}switch(e){case"resize":b=b.concat(t);break;case"modelLoaded":w=w.concat(t)}},get:function(e){return o[e]},serialize:function(){var e,t,r,i,s;if(model!==undefined&&model.get!==undefined)for(i in M)M.hasOwnProperty(i)&&(i=M[i],s=model.get(i.name),s!==undefined&&(i.initialValue=s));e={title:o.title,publicationStatus:o.publicationStatus,subtitle:o.subtitle,fontScale:o.fontScale,about:n.isArray(o.about)?$.extend(!0,[],o.about):o.about,models:$.extend(!0,[],o.models),parameters:$.extend(!0,[],o.parameters),outputs:$.extend(!0,[],o.outputs),filteredOutputs:$.extend(!0,[],o.filteredOutputs)},e.components=[];for(t=0,r=O.length;t<r;t++)O[t].serialize&&e.components.push(O[t].serialize());return e.layout=$.extend(!0,{},o.layout),typeof o.template=="string"?e.template=o.template:e.template=$.extend(!0,{},o.template),e},loadInteractive:G,validateInteractive:K,loadModel:U},_=new f(l,D),_.exposeScriptingAPI(),h=$(u),l.interactiveContainer=h,I=new C(h),F=new N,B=new x,j=new T,l.on("resize",$.proxy(j.updateIframeSize,j)),G(o,u),l}}),define("md2d/public-api",["require","common/controllers/interactives-controller","common/benchmark/benchmark"],function(e){var t=e("common/controllers/interactives-controller"),n=e("common/benchmark/benchmark"),r;return r={version:"0.0.1",interactivesController:t},window.controllers=r,window.benchmark=n,r}),define("solar-system/public-api",["require","common/controllers/interactives-controller","common/benchmark/benchmark"],function(e){var t=e("common/controllers/interactives-controller"),n=e("common/benchmark/benchmark"),r;return r={version:"0.0.1",interactivesController:t},window.controllers=r,window.benchmark=n,r}),define("grapher/public-api",["require","../lab.version","../lab.config","grapher/core/graph","grapher/bar-graph/bar-graph-model","grapher/bar-graph/bar-graph-view"],function(e){"use strict";var t=e("../lab.version"),n=e("../lab.config"),r=e("grapher/core/graph"),i=e("grapher/bar-graph/bar-graph-model"),s=e("grapher/bar-graph/bar-graph-view"),o;return o={version:"0.0.1",Graph:r,BarGraphModel:i,BarGraphView:s},window.Lab=window.Lab||{},window.Lab.config=n,window.Lab.grapher=o,o}),define("import-export/netlogo-importer",["require","underscore"],function(e){function r(e){return e.units?e.label+" ("+e.units+")":e.label}var t=e("underscore"),n=["computationalInputs","computationalOutputs","studentInputs"];return{importRun:function(e,i){return typeof e=="string"&&(e=JSON.parse(e)),{perRunLabels:t.flatten(n.map(function(t){return e.description[t]})).map(r),perRunValues:t.flatten(n.map(function(t){return e.runs[i][t]})),perTickLabels:e.description.timeSeriesData.map(r),perTickValues:e.runs[i].timeSeriesData.map(function(e){return e.map(t.identity)})}},numberOfRuns:function(e){return typeof e=="string"&&(e=JSON.parse(e)),e.runs.length},timeStamps:function(e){return typeof e=="string"&&(e=JSON.parse(e)),t.pluck(e.runs,"timeStamp")},runHavingTimeStamp:function(e,t){typeof e=="string"&&(e=JSON.parse(e));for(var n=0;n<e.runs.length;n++)if(e.runs[n].timeStamp===t)return n;return null}}}),define("import-export/public-api",["require","import-export/dg-exporter","import-export/netlogo-importer"],function(e){"use strict";return window.Lab=window.Lab||{},window.Lab.importExport={version:"0.0.1",dgExporter:e("import-export/dg-exporter"),netlogoImporter:e("import-export/netlogo-importer")}}),define("public-api",["require","lab.version","lab.config","common/structured-clone","md2d/public-api","solar-system/public-api","grapher/public-api","import-export/public-api"],function(e){var t=e("lab.version"),n=e("lab.config"),r=e("common/structured-clone");e("md2d/public-api"),e("solar-system/public-api"),e("grapher/public-api"),e("import-export/public-api"),window.Lab=window.Lab||{},window.Lab.version=t,window.Lab.config=n,window.Lab.structuredClone=r}),require(["public-api"],undefined,undefined,!0)})();